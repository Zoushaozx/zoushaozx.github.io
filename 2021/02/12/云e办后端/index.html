<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="云e办，前后端分离，前端vue 后端Java后端技术栈123456789101112131415springboot springmvc mybatisplus 对项目侵入少 代码编写简单Lombok	注解插件AutoGenerator	Swagger2	接口文档springsecret 安全框架jwt 令牌captcha 图形验证码redis	easypoi 文档导入导出rabbitmq 消息队">
<meta property="og:type" content="article">
<meta property="og:title" content="云e办">
<meta property="og:url" content="http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/index.html">
<meta property="og:site_name" content="Zoux">
<meta property="og:description" content="云e办，前后端分离，前端vue 后端Java后端技术栈123456789101112131415springboot springmvc mybatisplus 对项目侵入少 代码编写简单Lombok	注解插件AutoGenerator	Swagger2	接口文档springsecret 安全框架jwt 令牌captcha 图形验证码redis	easypoi 文档导入导出rabbitmq 消息队">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-02-12T19:11:21.000Z">
<meta property="article:modified_time" content="2021-03-03T06:43:37.796Z">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>云e办</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about">关于</a></li>
         
          <li><a href="/archives">归档</a></li>
         
          <li><a href="/projects">项目</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2021/02/12/hexo/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2021/02/12/linux/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&text=云e办"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=云e办"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&is_video=false&description=云e办"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=云e办&body=Check out this article: http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=云e办"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=云e办"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=云e办"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=云e办"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&name=云e办&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&t=云e办"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%91e%E5%8A%9E%EF%BC%8C%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%EF%BC%8C%E5%89%8D%E7%AB%AFvue-%E5%90%8E%E7%AB%AFJava"><span class="toc-number">1.</span> <span class="toc-text">云e办，前后端分离，前端vue 后端Java</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">2.</span> <span class="toc-text">后端技术栈</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">3.</span> <span class="toc-text">前端技术栈</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-number">4.</span> <span class="toc-text">搭建后端项目</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B"><span class="toc-number">5.</span> <span class="toc-text">逆向工程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Jwt-Token%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">6.</span> <span class="toc-text">Jwt Token工具类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.</span> <span class="toc-text">公共返回对象</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E4%B9%8B%E5%90%8E%E8%BF%94%E5%9B%9Etoken"><span class="toc-number">8.</span> <span class="toc-text">登录之后返回token</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">9.</span> <span class="toc-text">获取当前登录用户信息</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95"><span class="toc-number">10.</span> <span class="toc-text">退出登录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEsecurity%E7%99%BB%E9%99%86%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">11.</span> <span class="toc-text">配置security登陆过滤器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#security%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C"><span class="toc-number">12.</span> <span class="toc-text">security自定义返回结果</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swagger2%E6%8F%90%E4%BE%9BAuthorize"><span class="toc-number">13.</span> <span class="toc-text">swagger2提供Authorize</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">14.</span> <span class="toc-text">生成验证码</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E6%A0%A1%E9%AA%8C"><span class="toc-number">15.</span> <span class="toc-text">验证码校验</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7id%E6%9F%A5%E8%AF%A2%E8%8F%9C%E5%8D%95%E5%88%97%E8%A1%A8"><span class="toc-number">16.</span> <span class="toc-text">根据用户id查询菜单列表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E9%9B%86%E6%88%90%E8%8F%9C%E5%8D%95%E5%8A%9F%E8%83%BD"><span class="toc-number">17.</span> <span class="toc-text">Redis集成菜单功能</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E8%AF%B7%E6%B1%82url%E5%88%A4%E6%96%AD%E8%A7%92%E8%89%B2"><span class="toc-number">18.</span> <span class="toc-text">根据请求url判断角色</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2"><span class="toc-number">19.</span> <span class="toc-text">判断用户角色</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%81%8C%E4%BD%8D%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">20.</span> <span class="toc-text">职位管理功能实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8"><span class="toc-number">21.</span> <span class="toc-text">全局异常</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%81%8C%E7%A7%B0%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">22.</span> <span class="toc-text">职称管理功能实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%BB%84%E8%A7%92%E8%89%B2%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">23.</span> <span class="toc-text">权限组角色功能实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="toc-number">24.</span> <span class="toc-text">存储过程的创建和使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">25.</span> <span class="toc-text">部门管理功能实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E5%91%98%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD"><span class="toc-number">26.</span> <span class="toc-text">操作员管理功能</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD-%E5%88%86%E9%A1%B5"><span class="toc-number">27.</span> <span class="toc-text">员工管理功能-分页</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD-%E6%B7%BB%E5%8A%A0-%E5%88%A0%E9%99%A4-%E6%9B%B4%E6%96%B0%E5%91%98%E5%B7%A5"><span class="toc-number">28.</span> <span class="toc-text">员工管理功能-添加&#x2F;删除&#x2F;更新员工</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA"><span class="toc-number">29.</span> <span class="toc-text">员工数据导入导出</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%82%AE%E4%BB%B6%E5%8A%9F%E8%83%BD"><span class="toc-number">30.</span> <span class="toc-text">邮件功能</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E7%AB%AF%E5%8F%AF%E9%9D%A0%E6%8A%95%E9%80%92%E6%96%B9%E6%A1%88%E4%BB%8B%E7%BB%8D"><span class="toc-number">31.</span> <span class="toc-text">生产端可靠投递方案介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E6%B6%88%E6%81%AF%E5%9B%9E%E8%B0%83%E6%9C%BA%E5%88%B6"><span class="toc-number">32.</span> <span class="toc-text">开启消息回调机制</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E7%AB%AF%E6%B6%88%E6%81%AF%E6%8A%95%E9%80%92%E5%8F%AF%E9%9D%A0%E6%80%A7%E5%AE%9E%E7%8E%B0"><span class="toc-number">33.</span> <span class="toc-text">生产端消息投递可靠性实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E7%AB%AF%E5%B9%82%E7%AD%89%E6%80%A7"><span class="toc-number">34.</span> <span class="toc-text">消费端幂等性</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E8%B5%84%E5%B8%90%E5%A5%97%E7%AE%A1%E7%90%86%E5%AE%9E%E7%8E%B0"><span class="toc-number">35.</span> <span class="toc-text">工资帐套管理实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E5%B8%90%E5%A5%97%E7%AE%A1%E7%90%86%E5%AE%9E%E7%8E%B0"><span class="toc-number">36.</span> <span class="toc-text">员工帐套管理实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WebSocket%E5%9C%A8%E7%BA%BF%E8%81%8A%E5%A4%A9%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">37.</span> <span class="toc-text">WebSocket在线聊天功能实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">38.</span> <span class="toc-text">个人中心功能实现</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        云e办
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name"></span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-02-12T19:11:21.000Z" itemprop="datePublished">2021-02-12</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="云e办，前后端分离，前端vue-后端Java"><a href="#云e办，前后端分离，前端vue-后端Java" class="headerlink" title="云e办，前后端分离，前端vue 后端Java"></a>云e办，前后端分离，前端vue 后端Java</h1><h1 id="后端技术栈"><a href="#后端技术栈" class="headerlink" title="后端技术栈"></a>后端技术栈</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">springboot </span><br><span class="line">springmvc </span><br><span class="line">mybatisplus 对项目侵入少 代码编写简单</span><br><span class="line">Lombok	注解插件</span><br><span class="line">AutoGenerator	</span><br><span class="line">Swagger2	接口文档</span><br><span class="line">springsecret 安全框架</span><br><span class="line">jwt 令牌</span><br><span class="line">captcha 图形验证码</span><br><span class="line">redis	</span><br><span class="line">easypoi 文档导入导出</span><br><span class="line">rabbitmq 消息队列 异步处理</span><br><span class="line">mail 邮件 </span><br><span class="line">websocket 在线聊天</span><br><span class="line">fastDFS 文件服务器 承载静态资源</span><br></pre></td></tr></table></figure>
<h1 id="前端技术栈"><a href="#前端技术栈" class="headerlink" title="前端技术栈"></a>前端技术栈</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vue</span><br><span class="line">element UI</span><br><span class="line">vue_cli 项目搭建</span><br><span class="line">vuex 状态管理</span><br><span class="line">vuerouter 路由管理</span><br><span class="line">axios 通讯框架</span><br><span class="line">es6 前端语法</span><br><span class="line">webpack 打包</span><br><span class="line">websocket 在线聊天</span><br><span class="line">vue_chat 在线聊天</span><br><span class="line">font_awesome 字体</span><br><span class="line">js-file-download 文件下载</span><br></pre></td></tr></table></figure>


<h1 id="搭建后端项目"><a href="#搭建后端项目" class="headerlink" title="搭建后端项目"></a>搭建后端项目</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">搭建数据库 yeb.sql</span><br><span class="line">lombok 插件</span><br><span class="line">整个项目采用了maven 聚合的项目</span><br><span class="line"></span><br><span class="line">创建父工程：</span><br><span class="line">	1⃣️spring initialize-&gt;next-&gt;修改Group&#x2F;Artifact-&gt;next-&gt;spring boot devtools-&gt;Project location（项目存放地址）</span><br><span class="line">	2⃣️父工程只是用来做pom依赖管理，就可以只保留pom.xml</span><br><span class="line">	3⃣️修改pom文件</span><br><span class="line">    删除dependencies标签</span><br><span class="line">    删除build标签</span><br><span class="line">    加packaging标签</span><br><span class="line">		    &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">创建子项目：</span><br><span class="line">	1⃣️new-&gt;Module-&gt;Maven-&gt;Create from archetype-&gt;org...:maven-ar..-quickstart等待默认依赖加载完成</span><br><span class="line">	2⃣️删除main和test下面的App和Apptest类</span><br><span class="line">	3⃣️更改包名，com.xxxx.server</span><br><span class="line">	4⃣️修改server的pom依赖</span><br><span class="line">		我们会发现，父工程下面多了，这个是关联server的</span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;module&gt;yeb-server&lt;&#x2F;module&gt;</span><br><span class="line">    &lt;&#x2F;modules&gt;</span><br><span class="line">    </span><br><span class="line">    此时观察server的pom是否有关联父工程的parent标签，没有就加上 </span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;yeb&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.zoux&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    </span><br><span class="line">    name和url标签可以删除</span><br><span class="line">    </span><br><span class="line">    maven.compiler.source&#x2F;maven.compiler.target 版本改为1.8</span><br><span class="line">    </span><br><span class="line">    删除build标签 </span><br><span class="line">    删除dependency标签</span><br><span class="line">    </span><br><span class="line">    添加依赖</span><br><span class="line">    	&lt;!--web 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--lombok 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--mysql 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--mybatis 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.3.1.tmp&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">         </span><br><span class="line">	5⃣️新建resources目录，并设置配置文件</span><br><span class="line">  	在main下面新建resources，并设置为source目录 mark directory as -&gt; resource root</span><br><span class="line">  	并在resources里面新建文件，</span><br><span class="line">  	application.yml</span><br><span class="line">  	内容：</span><br><span class="line">  		server:</span><br><span class="line"> 			 # 端口</span><br><span class="line">			  port: 8081</span><br><span class="line"></span><br><span class="line">  		spring:</span><br><span class="line">        #数据源配置</span><br><span class="line">        datasource:</span><br><span class="line">          driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">          url: jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;yeb?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai</span><br><span class="line">          username: root</span><br><span class="line">          password: rootzoux</span><br><span class="line">          hikari:	</span><br><span class="line">            # 连接池名</span><br><span class="line">            pool-name: DateHikariCP</span><br><span class="line">            # 最小空闲连接数</span><br><span class="line">            minimum-idle: 5</span><br><span class="line">            #最大连接存活最大时间，默认600000 10分钟</span><br><span class="line">            idle-timeout: 180000</span><br><span class="line">            #最大连接数，默认10</span><br><span class="line">            maximum-pool-size: 10</span><br><span class="line">            #从连接池返回的连接自动提交</span><br><span class="line">            auto-commit: true</span><br><span class="line">            #连接存活的最大时间，0表示永久存活，默认1800000 30分钟</span><br><span class="line">            max-lifetime: 1800000</span><br><span class="line">            #连接超时，30000 默认30秒</span><br><span class="line">            connection-timeout: 30000</span><br><span class="line">            #测试连接是否可用的查询语句</span><br><span class="line">            connection-test-query: SELECT 1</span><br><span class="line">				# Mabatis-plug 配置</span><br><span class="line">        mybatis-plus:</span><br><span class="line">          #配置 Mapper映射文件</span><br><span class="line">          mapper-locations: classpath*:&#x2F;mapper&#x2F;*Mapper.xml</span><br><span class="line">          #配置 Mabatis数据返回类型别名 默认别名是类名</span><br><span class="line">          type-aliases-package: com.zoux.server.pojo</span><br><span class="line">          #自动驼峰命名</span><br><span class="line">          configuration:</span><br><span class="line">            map-underscore-to-camel-case: false</span><br><span class="line"></span><br><span class="line">        # mybatis SQL 打印 （接口所在的包，不是mapper.xml 所在的包）</span><br><span class="line">        logging:</span><br><span class="line">          level:</span><br><span class="line">            com.zoux.server.mapper: debug</span><br><span class="line">            </span><br><span class="line">	6⃣️在resources目录下新建mapper</span><br><span class="line">	7⃣️添加包名，pojo，service，mapper，service.impl,controller</span><br><span class="line">	8⃣️启动类YebApplication</span><br><span class="line">			import org.springframework.boot.SpringApplication;</span><br><span class="line">			import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">			@SpringBootApplication</span><br><span class="line">			public class YebAppication &#123;</span><br><span class="line">   			 public static void main(String[] args) &#123;</span><br><span class="line">       			 SpringApplication.run(YebAppication.class, args);</span><br><span class="line">   			 &#125;</span><br><span class="line">			&#125;</span><br><span class="line">	9⃣️添加mapper扫描</span><br><span class="line">	@MapperScan(&quot;com.zoux.server.mapper&quot;)</span><br><span class="line">	🔟在resources下新建comfig目录，将YebAppication.yml</span><br></pre></td></tr></table></figure>
<h1 id="逆向工程"><a href="#逆向工程" class="headerlink" title="逆向工程"></a>逆向工程</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line">根据新建pojo mapper controller 单表查询</span><br><span class="line">mybatisplus，官网</span><br><span class="line">https:&#x2F;&#x2F;mp.baomidou.com&#x2F;guide&#x2F;generator.html</span><br><span class="line">逆向工程本身与项目没有太大关联，就新建module承载</span><br><span class="line">1⃣️新建module，maven，quikerstart</span><br><span class="line">2⃣️删除pom， name、url标签，maven.compiler.source&#x2F;target 版本号为1.8，删除dependencies&#x2F;build标签</span><br><span class="line">3⃣️删除App类，新建包generator</span><br><span class="line">4⃣️删除test文件夹</span><br><span class="line">5⃣️指定父工程</span><br><span class="line">	    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;yeb&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.zoux&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">   		 &lt;&#x2F;parent&gt;</span><br><span class="line"> 6⃣️添加依赖</span><br><span class="line"> 		&lt;!--web 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--mybatis 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.3.1.tmp&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--mybatis-plus 代码生成器依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-plus-generator&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.3.1.tmp&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--    ferrmarker 依赖 模版--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.freemarker&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;freemarker&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--mysql 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">7⃣️新建类MysqlGenerator</span><br><span class="line">package com.zoux.generator;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.core.exceptions.MybatisPlusException;</span><br><span class="line">import com.baomidou.mybatisplus.core.toolkit.StringPool;</span><br><span class="line">import com.baomidou.mybatisplus.core.toolkit.StringUtils;</span><br><span class="line">import com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line">import com.baomidou.mybatisplus.generator.InjectionConfig;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.*;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.po.TableInfo;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line">import com.baomidou.mybatisplus.generator.engine.FreemarkerTemplateEngine;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Scanner;</span><br><span class="line"></span><br><span class="line">public class MysqlGenerator &#123;</span><br><span class="line">    &#x2F;&#x2F; 演示例子，执行 main 方法控制台输入模块表名回车自动生成对应项目目录中</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * &lt;p&gt;</span><br><span class="line">     * 读取控制台内容</span><br><span class="line">     * &lt;&#x2F;p&gt;</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static String scanner(String tip) &#123;</span><br><span class="line">        Scanner scanner &#x3D; new Scanner(System.in);</span><br><span class="line">        StringBuilder help &#x3D; new StringBuilder();</span><br><span class="line">        help.append(&quot;请输入&quot; + tip + &quot;：&quot;);</span><br><span class="line">        System.out.println(help.toString());</span><br><span class="line">        if (scanner.hasNext()) &#123;</span><br><span class="line">            String ipt &#x3D; scanner.next();</span><br><span class="line">            if (StringUtils.isNotBlank(ipt)) &#123;</span><br><span class="line">                return ipt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        throw new MybatisPlusException(&quot;请输入正确的&quot; + tip + &quot;！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        &#x2F;&#x2F; 代码生成器</span><br><span class="line">        AutoGenerator mpg &#x3D; new AutoGenerator();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 全局配置</span><br><span class="line">        GlobalConfig gc &#x3D; new GlobalConfig();</span><br><span class="line">        String projectPath &#x3D; System.getProperty(&quot;user.dir&quot;);</span><br><span class="line">        gc.setOutputDir(projectPath + &quot;&#x2F;yeb-generator&#x2F;src&#x2F;main&#x2F;java&quot;);</span><br><span class="line">        &#x2F;&#x2F;作者</span><br><span class="line">        gc.setAuthor(&quot;zoux&quot;);</span><br><span class="line">        &#x2F;&#x2F;是否打开输出目录</span><br><span class="line">        gc.setOpen(false);</span><br><span class="line">        &#x2F;&#x2F;xml  开启BaseResultMap</span><br><span class="line">        gc.setBaseResultMap(true);</span><br><span class="line">        &#x2F;&#x2F;xml  开启BaseColumnList</span><br><span class="line">        gc.setBaseColumnList(true);</span><br><span class="line">        &#x2F;&#x2F;实体属性 Swagger2 注解</span><br><span class="line">        gc.setSwagger2(true); &#x2F;&#x2F;实体属性 Swagger2 注解</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 数据源配置</span><br><span class="line">        DataSourceConfig dsc &#x3D; new DataSourceConfig();</span><br><span class="line">        dsc.setUrl(&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;yeb?useUnicode&#x3D;true&amp;useSSL&#x3D;false&amp;characterEncoding&#x3D;utf8&amp;serverTimezone&#x3D;Asia&quot; + &quot;&#x2F;Shanghai&quot;);</span><br><span class="line">        &#x2F;&#x2F; dsc.setSchemaName(&quot;public&quot;);</span><br><span class="line">        dsc.setDriverName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span><br><span class="line">        dsc.setUsername(&quot;root&quot;);</span><br><span class="line">        dsc.setPassword(&quot;rootzoux&quot;);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 包配置</span><br><span class="line">        PackageConfig pc &#x3D; new PackageConfig();</span><br><span class="line">&#x2F;&#x2F;        pc.setModuleName(scanner(&quot;模块名&quot;));</span><br><span class="line">        pc.setParent(&quot;com.zoux&quot;)</span><br><span class="line">                .setEntity(&quot;pojo&quot;)</span><br><span class="line">                .setMapper(&quot;mapper&quot;)</span><br><span class="line">                .setService(&quot;service&quot;)</span><br><span class="line">                .setServiceImpl(&quot;service.impl&quot;)</span><br><span class="line">                .setController(&quot;controller&quot;);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 自定义配置</span><br><span class="line">        InjectionConfig cfg &#x3D; new InjectionConfig() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void initMap() &#123;</span><br><span class="line">                &#x2F;&#x2F; to do nothing</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 如果模板引擎是 freemarker</span><br><span class="line">        String templatePath &#x3D; &quot;&#x2F;templates&#x2F;mapper.xml.ftl&quot;;</span><br><span class="line">        &#x2F;&#x2F; 如果模板引擎是 velocity</span><br><span class="line">        &#x2F;&#x2F; String templatePath &#x3D; &quot;&#x2F;templates&#x2F;mapper.xml.vm&quot;;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 自定义输出配置</span><br><span class="line">        List&lt;FileOutConfig&gt; focList &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">        &#x2F;&#x2F; 自定义配置会被优先输出</span><br><span class="line">        focList.add(new FileOutConfig(templatePath) &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public String outputFile(TableInfo tableInfo) &#123;</span><br><span class="line">                &#x2F;&#x2F; 自定义输出文件名 ， 如果你 Entity 设置了前后缀、此处注意 xml 的名称会跟着发生变化！！</span><br><span class="line">&#x2F;&#x2F;                return projectPath + &quot;&#x2F;src&#x2F;main&#x2F;resources&#x2F;mapper&#x2F;&quot; + pc.getModuleName()</span><br><span class="line">&#x2F;&#x2F;                        + &quot;&#x2F;&quot; + tableInfo.getEntityName() + &quot;Mapper&quot; + StringPool.DOT_XML;</span><br><span class="line">                return projectPath + &quot;&#x2F;yeb-generator&#x2F;src&#x2F;main&#x2F;resources&#x2F;mapper&#x2F;&quot; + tableInfo.getEntityName() + &quot;Mapper&quot; + StringPool.DOT_XML;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        &#x2F;*</span><br><span class="line">        cfg.setFileCreate(new IFileCreate() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean isCreate(ConfigBuilder configBuilder, FileType fileType, String filePath) &#123;</span><br><span class="line">                &#x2F;&#x2F; 判断自定义文件夹是否需要创建</span><br><span class="line">                checkDir(&quot;调用默认方法创建的目录，自定义目录用&quot;);</span><br><span class="line">                if (fileType &#x3D;&#x3D; FileType.MAPPER) &#123;</span><br><span class="line">                    &#x2F;&#x2F; 已经生成 mapper 文件判断存在，不想重新生成返回 false</span><br><span class="line">                    return !new File(filePath).exists();</span><br><span class="line">                &#125;</span><br><span class="line">                &#x2F;&#x2F; 允许生成模板文件</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        *&#x2F;</span><br><span class="line">        cfg.setFileOutConfigList(focList);</span><br><span class="line">        mpg.setCfg(cfg);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 配置模板</span><br><span class="line">        TemplateConfig templateConfig &#x3D; new TemplateConfig();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 配置自定义输出模板</span><br><span class="line">        &#x2F;&#x2F;指定自定义模板路径，注意不要带上.ftl&#x2F;.vm, 会根据使用的模板引擎自动识别</span><br><span class="line">        &#x2F;&#x2F; templateConfig.setEntity(&quot;templates&#x2F;entity2.java&quot;);</span><br><span class="line">        &#x2F;&#x2F; templateConfig.setService();</span><br><span class="line">        &#x2F;&#x2F; templateConfig.setController();</span><br><span class="line"></span><br><span class="line">        templateConfig.setXml(null);</span><br><span class="line">        mpg.setTemplate(templateConfig);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 策略配置</span><br><span class="line">        StrategyConfig strategy &#x3D; new StrategyConfig();</span><br><span class="line">        &#x2F;&#x2F;数据库表映射到实体的命名策略</span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        &#x2F;&#x2F;数据库表字段映射到实体的命名策略</span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.no_change);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;strategy.setSuperEntityClass(&quot;你自己的父类实体,没有就不用设置!&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;lombok 模型</span><br><span class="line">        strategy.setEntityLombokModel(true);</span><br><span class="line">        &#x2F;&#x2F;生成@RestController 控制器 这个相对于普通controller 返回数据为json字符串</span><br><span class="line">        strategy.setRestControllerStyle(true);</span><br><span class="line">        &#x2F;&#x2F; 公共父类</span><br><span class="line">        &#x2F;&#x2F;strategy.setSuperControllerClass(&quot;你自己的父类控制器,没有就不用设置!&quot;);</span><br><span class="line">        &#x2F;&#x2F; 写于父类中的公共字段</span><br><span class="line">        &#x2F;&#x2F;strategy.setSuperEntityColumns(&quot;id&quot;);</span><br><span class="line">        strategy.setInclude(scanner(&quot;表名，多个英文逗号分割&quot;).split(&quot;,&quot;));</span><br><span class="line">        strategy.setControllerMappingHyphenStyle(true);</span><br><span class="line">        &#x2F;&#x2F;表前缀</span><br><span class="line">        &#x2F;&#x2F;strategy.setTablePrefix(pc.getModuleName() + &quot;_&quot;);</span><br><span class="line">        strategy.setTablePrefix(&quot;t_&quot;);</span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        mpg.setTemplateEngine(new FreemarkerTemplateEngine());</span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">8⃣️运行，输入表名，</span><br><span class="line">9⃣️将所有生成的类拷贝到yeb-server</span><br><span class="line">🔟更改路径，和添加swagger依赖</span><br><span class="line">	        &lt;!--Swagger2 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger2&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.7.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--Swagger第三方UI依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.github.xiaoymin&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;swagger-bootstrap-ui&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.9.6&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Jwt-Token工具类"><a href="#Jwt-Token工具类" class="headerlink" title="Jwt Token工具类"></a>Jwt Token工具类</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">1⃣️引入jwt，security依赖</span><br><span class="line">	 		&lt;!--security 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-security&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--JWT 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.jsonwebtoken&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jjwt&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;0.9.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">2⃣️引入security配置，application.yml</span><br><span class="line">jwt:</span><br><span class="line">  #JWT存储的请求头</span><br><span class="line">  tokenHeader: Authorization</span><br><span class="line">  #JWT 加密使用的密钥</span><br><span class="line">  secret: yeb-secret</span><br><span class="line">  #JWT 的超期限时间 （60*60*24）</span><br><span class="line">  expiration: 604800</span><br><span class="line">  #JWT 负载中拿到开头</span><br><span class="line">  tokenHead: Bearer</span><br><span class="line">3⃣️新建包config.security</span><br><span class="line">4⃣️新建JwtTokenUtil类 </span><br><span class="line">5⃣️添加注解@Component </span><br><span class="line">	把普通pojo实例化到spring容器中，相当于配置文件中的泛指各种组件，就是说当我们的类不属于各种归类的时候（不属于@Controller、@Services等的时候），我们就可以使用@Component来标注这个类</span><br><span class="line">6⃣️准备荷载变量</span><br><span class="line">	CLAIM_KEY_USERNAME</span><br><span class="line">	CLAIM_KEY_CREATED</span><br><span class="line">	secret</span><br><span class="line">	expiration</span><br><span class="line">	</span><br><span class="line">		private static final String CLAIM_KEY_USERNAME&#x3D;&quot;sub&quot;;</span><br><span class="line">    private static final String CLAIM_KEY_CREATED&#x3D;&quot;created&quot;;</span><br><span class="line">    @Value(&quot;$&#123;jwt.secret&#125;&quot;)</span><br><span class="line">    private String secret;</span><br><span class="line">    @Value(&quot;$&#123;jwt.expiration&#125;&quot;)</span><br><span class="line">    private Long expiration;</span><br><span class="line">    </span><br><span class="line">7⃣️主要功能</span><br><span class="line">	一 根据用户名生成token</span><br><span class="line">	1，根据用户信息生成token</span><br><span class="line">		public String generatorToken(UserDetails userDetails) &#123;</span><br><span class="line">        Map&lt;String, Object&gt; claims &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        claims.put(CLAIM_KEY_USERNAME, userDetails.getUsername());</span><br><span class="line">        claims.put(CLAIM_KEY_CREATED, new Date());</span><br><span class="line">        return generatorToken();</span><br><span class="line">        &#125;</span><br><span class="line">  2，根据荷载生成JWT TOKEN</span><br><span class="line">  	private String generatorToken(Map&lt;String,Object&gt; claims) &#123;</span><br><span class="line">        return Jwts.builder()</span><br><span class="line">                .setClaims(claims)</span><br><span class="line">                .setExpiration(generateExpirationDate())</span><br><span class="line">                .signWith(SignatureAlgorithm.ES512,secret)</span><br><span class="line">                .compact();</span><br><span class="line">                &#125;</span><br><span class="line">  3，生成token失效时间</span><br><span class="line">   private Date generateExpirationDate() &#123;</span><br><span class="line">        return new Date(System.currentTimeMillis() + expiration * 1000);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"> 二 从token拿用户名</span><br><span class="line">  1，从token中获得登录用户名</span><br><span class="line">  public String getUserNameFromToken(String token) &#123;</span><br><span class="line">        String username;</span><br><span class="line">        try &#123;</span><br><span class="line">            Claims claims &#x3D; getClaimsFromToken(token);</span><br><span class="line">            username &#x3D; claims.getSubject();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            username &#x3D; null;</span><br><span class="line">        &#125;</span><br><span class="line">        return username;</span><br><span class="line">    &#125;</span><br><span class="line">  2，从token里面获取荷载</span><br><span class="line">  private Claims getClaimsFromToken(String token) &#123;</span><br><span class="line">        Claims claims &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            claims &#x3D; Jwts.parser()</span><br><span class="line">                    .setSigningKey(secret)</span><br><span class="line">                    .parseClaimsJws(token)</span><br><span class="line">                    .getBody();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return claims;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">	三 判断token是否失效</span><br><span class="line">	1，token是否过期</span><br><span class="line">	 private boolean isTokenExpired(String token) &#123;</span><br><span class="line">        Date expiredDate &#x3D; getExpiredDateFromToken(token);</span><br><span class="line">        return expiredDate.before(new Date());</span><br><span class="line">    &#125;</span><br><span class="line">    private Date getExpiredDateFromToken(String token) &#123;</span><br><span class="line">        Claims claims &#x3D; getClaimsFromToken(token);</span><br><span class="line">        return claims.getExpiration();</span><br><span class="line">    &#125;</span><br><span class="line">	2，token里面的用户名与userDetail里面用户名是否一致</span><br><span class="line">	public boolean validateToken(String token, UserDetails userDetails) &#123;</span><br><span class="line">        String username &#x3D; getUserNameFromToken(token);</span><br><span class="line">        return username.equals(userDetails.getUsername()) &amp;&amp; !isTokenExpired(token);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">	四 是否可以刷新token</span><br><span class="line">	 public boolean canRefresh(String token) &#123;</span><br><span class="line">        return !isTokenExpired(token);</span><br><span class="line">    &#125;</span><br><span class="line">	五 刷新token</span><br><span class="line">	public String refreshToken(String token) &#123;</span><br><span class="line">        Claims claims &#x3D; getClaimsFromToken(token);</span><br><span class="line">        claims.put(CLAIM_KEY_CREATED, new Date());</span><br><span class="line">        return generatorToken(claims);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="公共返回对象"><a href="#公共返回对象" class="headerlink" title="公共返回对象"></a>公共返回对象</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">登录流程：</span><br><span class="line">	前端传用户名和密码</span><br><span class="line">	后端校验用户名和密码，</span><br><span class="line">		有错误就重新输入</span><br><span class="line">		正确就会生成JWT令牌，并且返回给前端，前端获得JWT令牌就会放入到请求头里面，任何请求都会携带JWT令牌，</span><br><span class="line">		后端会有对应的拦截器，对JWT令牌做相应的验证，验证通过才能访问对应的接口，验证不通过，令牌可能失效了，可能是用户名有问题，或者密码有问题，不是合法登陆</span><br><span class="line">		</span><br><span class="line">1⃣️在pojo新建公共返回对象RespBean</span><br><span class="line">2⃣️加注解@Data，生成getters and setters</span><br><span class="line">	@NoArgsConstructor 无参</span><br><span class="line">	@AllArgsConstructor	有参</span><br><span class="line">3⃣️成功，失败返回方法，公共变量，code message obj</span><br><span class="line"> public static RespBean success(String message) &#123;</span><br><span class="line">        return new RespBean(200, message, null);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="登录之后返回token"><a href="#登录之后返回token" class="headerlink" title="登录之后返回token"></a>登录之后返回token</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">一 前端传用户名密码，后端校验</span><br><span class="line">	1⃣️Admin类，里面实现springsecurity框架UserDetails</span><br><span class="line">	实现方法，除了getAuthorities的返回值不变，isEnabled返回值为属性字段enabled，</span><br><span class="line">	其他的都返回true</span><br><span class="line">	2⃣️新建登陆实体类 AdminLoginParam</span><br><span class="line">		添加lombok注解</span><br><span class="line">			@Data</span><br><span class="line">			@EqualsAndHashCode 此注解会生成equals(Object other) 和 hashCode()方法 callSuper是否调用父类中的方法</span><br><span class="line">			@Accessors(chain &#x3D; true)，Accessors翻译是存取器。通过该注解可以控制getter和setter方法的形式chain为true，setter方法返回当前对象</span><br><span class="line">		  @ApiModel(value &#x3D; &quot;AdminLogin对对象&quot;,description &#x3D; &quot;&quot; swagger注解</span><br><span class="line">		  @ApiModelProperty(value &#x3D; &quot;密码&quot;,required &#x3D; true) swagger注解，required是否必填</span><br><span class="line">	3⃣️controller编写，LoginController</span><br><span class="line">		注解：</span><br><span class="line">			@Api(tags &#x3D; &quot;LoginController&quot;) 表示标识这个类是swagger的资源 </span><br><span class="line">			@RestController 等同于@Controller + @ResponseBody，表明了这个类是一个控制器类+表示方法的返回值直接以指定的格式写入Http response body</span><br><span class="line">      @ApiOperation(value &#x3D; &quot;登陆之后返回token&quot;)表示一个http请求的操作 </span><br><span class="line">       @PostMapping(&quot;&#x2F;login&quot;) 映射一个POST请求 </span><br><span class="line">   4⃣️添加方法 login，参数 AdminLoginParam，HttpServletRequest</span><br><span class="line">      public RespBean login(AdminLoginParam adminLoginParam, HttpServletRequest request);</span><br><span class="line">   5⃣️引入IAdminService，并加入方法login，参数（用户名，密码，request）</span><br><span class="line">   6⃣️在IAminService里面实现login</span><br><span class="line">   7⃣️在AdminServiceImpl实现login</span><br><span class="line">   	 注入UserDetailsService</span><br><span class="line">   	 通过UserDetailsService，获得UserDetails</span><br><span class="line">   	 注入PasswordEncoder</span><br><span class="line">   	 利用PasswordEncoder 匹配一下密码</span><br><span class="line">   	 判断userDetails账户是否禁用</span><br><span class="line">   	 注入JWT工具类</span><br><span class="line">   	 生成token</span><br><span class="line">   	 注入tokenHead，jwt配置</span><br><span class="line">   	 将token装入map</span><br><span class="line">		 使用springsecurity框架，登陆成功后，获取用户信息可以使用springsecurity提供的对象userdetails等</span><br><span class="line">		 所以登录时，要将用户信息放入springsecurity全文中</span><br><span class="line">		 UsernamePasswordAuthenticationToken authenticationToken &#x3D; new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());</span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(authenticationToken);</span><br><span class="line">	8⃣️passwordEncoder对象等待处理</span><br></pre></td></tr></table></figure>
<h1 id="获取当前登录用户信息"><a href="#获取当前登录用户信息" class="headerlink" title="获取当前登录用户信息"></a>获取当前登录用户信息</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">登陆时将当前登录对象设制到springsecurity全局，所以可以利用Principal获取当前登录用户对象</span><br><span class="line">1⃣️在LoginController新建方法getAdminInfo</span><br><span class="line">2⃣️利用Principal获取用户对象</span><br><span class="line">3⃣️将获得admin对象密码置空，避免前端获取明文密码</span><br><span class="line">4⃣️在IAdminService定义getAdminByUserName</span><br><span class="line">5⃣️在AdminServiceImpl实现getAdminByUserName</span><br><span class="line">	注入AdminMapper</span><br><span class="line">	return adminMapper.selectOne(</span><br><span class="line">			newQueryWrapper&lt;Admin()</span><br><span class="line">					   .eq(&quot;username&quot;,username)</span><br><span class="line">					   .eq(&quot;enabled&quot;, true)</span><br><span class="line">					   );</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="退出登录"><a href="#退出登录" class="headerlink" title="退出登录"></a>退出登录</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">后端返回200状态码，前端根据状态码，将请求头里面的token删除 </span><br><span class="line">1⃣️在LoginController里面 新建方法logout 返回状态码200</span><br></pre></td></tr></table></figure>
<h1 id="配置security登陆过滤器"><a href="#配置security登陆过滤器" class="headerlink" title="配置security登陆过滤器"></a>配置security登陆过滤器</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">1⃣️准备配置类SecurityConfig，继承 WebSecurityConfigurerAdapter</span><br><span class="line">2⃣️注解@Configuration</span><br><span class="line">3⃣️注入Bean UserDetailsService，重写这个容器里的</span><br><span class="line">		@Override</span><br><span class="line">    @Bean</span><br><span class="line">    public UserDetailsService userDetailsService() &#123;</span><br><span class="line">        return username -&gt; &#123;</span><br><span class="line">            Admin admin &#x3D; adminService.getAdminByUserName(username);</span><br><span class="line">            if (null !&#x3D; admin) &#123;</span><br><span class="line">                return admin;</span><br><span class="line">            &#125;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">4⃣️重写configure方法，能够将我们重写的UserDetyailsService 注入到springsecurit</span><br><span class="line">5⃣️实现passwordEncoder容器</span><br><span class="line">6⃣️重写springsecurity配置configure(HttpSecurity http)</span><br><span class="line">	关闭scrf，使用JWT不需要csrf</span><br><span class="line">	 http.csrf()</span><br><span class="line">        .disable()</span><br><span class="line">	关闭session相关的</span><br><span class="line">		基于token不需要session</span><br><span class="line">                .sessionManagement()</span><br><span class="line">                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">	允许登陆访问</span><br><span class="line">		.antMatchers(&quot;&#x2F;login&quot;, &quot;logout&quot;)</span><br><span class="line">	配置生效</span><br><span class="line">		.permitAll();</span><br><span class="line">	访问请求要求认证</span><br><span class="line">                .anyRequest()</span><br><span class="line">                .authenticated()</span><br><span class="line">   缓存关闭</span><br><span class="line">                .headers()</span><br><span class="line">                .cacheControl();</span><br><span class="line">   添加jwt登陆授权拦截器</span><br><span class="line">        http.addFilterBefore();</span><br><span class="line">   自定义未授权，或者未登录的结果返回</span><br><span class="line">        http.exceptionHandling()</span><br><span class="line">                .accessDeniedHandler()</span><br><span class="line">                .authenticationEntryPoint();</span><br><span class="line">7⃣️准备jwt的登陆过滤器 JwtAuthorizationTokenFilter 继承OncePerRequestFilter 重写doFilterInternal&#x3D;&#x3D;相当于前置拦截</span><br><span class="line">	通过request获取Header</span><br><span class="line">	进行token校验</span><br><span class="line">		token是否存在，token是否以tokenHead为开头</span><br><span class="line">	利用JwtUtils获取用户名</span><br><span class="line">	进行用户名判断</span><br><span class="line">		判断用户名是否为空，同时检查springsecurity全局上下文找不到用户对象，即未登录</span><br><span class="line">	获取userdetails，相当于登陆了</span><br><span class="line">	判断token是否有效，有效就将token重新放入用户对象	</span><br><span class="line">		重新设置用户对象,更新荷载</span><br><span class="line">		重新设置用户对象，更新details</span><br><span class="line">		设置springsecurity全局上下文</span><br><span class="line">	经过一系列验证，最后进行放行</span><br><span class="line">8⃣️回到SecurityConfig类，利用Bean注解将JwtAuthorizationTokenFilter暴露出来</span><br><span class="line">	并填入【添加jwt登陆授权拦截器】同时加上参数，UsernamePasswordAuthenticationFilter.class</span><br></pre></td></tr></table></figure>
<h1 id="security自定义返回结果"><a href="#security自定义返回结果" class="headerlink" title="security自定义返回结果"></a>security自定义返回结果</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1⃣️新建类RestAuthorizationEntryPoint，实现AuthenticationEntryPoint</span><br><span class="line">2⃣️通过response设置字符集</span><br><span class="line">3⃣️设置数据交流格式</span><br><span class="line">4⃣️获取输出流</span><br><span class="line">5⃣️自定义返回类型</span><br><span class="line"></span><br><span class="line">1⃣️新建类RestfulAccessDeniedHandler实现AccessDeniedHandler重写handle方法</span><br><span class="line">2⃣️通过response设置字符集</span><br><span class="line">3⃣️设置数据交流格式</span><br><span class="line">4⃣️获取输出流</span><br><span class="line">5⃣️自定义返回类型</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在SecurityConfig类中进行注入RestAuthorizationEntryPoint，RestfulAccessDeniedHandler</span><br><span class="line">将注入的两个类放入配置中</span><br></pre></td></tr></table></figure>
<p>swagger2配资</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1⃣️pom依赖</span><br><span class="line">	 &lt;!--Swagger2 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger2&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.7.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--Swagger第三方UI依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.github.xiaoymin&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;swagger-bootstrap-ui&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.9.6&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line"> 2⃣️配置swagger，新建Swagger2Config类</span><br><span class="line"> 		注解</span><br><span class="line"> 		@Component 配置类</span><br><span class="line">		@EnableSwagger2 开启swagger2</span><br><span class="line"> 3⃣️准备APiInfo</span><br><span class="line"> 4⃣️注入bean，规定扫描那些包，具体什么包，任意路径	 	</span><br><span class="line"> 5⃣️启动测试，重写允许通过方法，添加通过资源</span><br><span class="line"> 	 public void configure(WebSecurity web) throws Exception &#123;</span><br><span class="line">        web.ignoring().antMatchers(</span><br><span class="line">                &quot;&#x2F;login&quot;,</span><br><span class="line">                &quot;&#x2F;logout&quot;,</span><br><span class="line">                &quot;&#x2F;css&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;js&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;index.html&quot;,</span><br><span class="line">                &quot;favicon.ico&quot;,</span><br><span class="line">                &quot;&#x2F;doc.html&quot;,</span><br><span class="line">                &quot;&#x2F;webjars&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;swagger-resources&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;v2&#x2F;api-docs&#x2F;**&quot;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="swagger2提供Authorize"><a href="#swagger2提供Authorize" class="headerlink" title="swagger2提供Authorize"></a>swagger2提供Authorize</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">实现全局登录</span><br><span class="line">1⃣️在swagger2config类createRestApi方法里面继续添加 </span><br><span class="line">																	.securityContexts()</span><br><span class="line">									                .securitySchemes();</span><br><span class="line">2⃣️完成securitySchemes</span><br><span class="line">	设置请求头信息</span><br><span class="line">		新建List</span><br><span class="line">		新建ApiKey，三个参数</span><br><span class="line">		将ApiKey加入List</span><br><span class="line">		返回List</span><br><span class="line">3⃣️完成securityContexts</span><br><span class="line">	设置登陆访问认证路径</span><br><span class="line">	result.add(getContextByPath(&quot;&#x2F;hello&#x2F;.*&quot;));</span><br><span class="line">	默认权限</span><br><span class="line">	.securityReferences(defaultAuth())</span><br><span class="line">	指代路径</span><br><span class="line">	.forPaths(PathSelectors.regex(pathRegex))</span><br><span class="line">	默认权限</span><br><span class="line">		授权范围</span><br><span class="line">			AuthorizationScope authorizationScope &#x3D; new AuthorizationScope(&quot;global&quot;, &quot;accessEverything&quot;);</span><br><span class="line">     	result.add(new SecurityReference(&quot;Authorization&quot;, authorizationScopes));</span><br><span class="line">4⃣️json传参</span><br><span class="line">更改LoginController&#x2F;login 参数注解@RequestBody ，更改JwtTokenUtil&#x2F;generatorToken&#x2F;加密模式HS512</span><br><span class="line">5⃣️注意，SecurityConfig&#x2F;configure（WebSecurity web）里面放行的配置与SecurityConfig&#x2F;configure(HttpSecurity http)的放行配置重合，</span><br><span class="line">可以将SecurityConfig&#x2F;configure(HttpSecurity http)的login放行配置进行注释</span><br><span class="line">	.antMatchers(&quot;&#x2F;login&quot;, &quot;&#x2F;logout&quot;)</span><br><span class="line">  .permitAll()</span><br><span class="line">6⃣️进行Authorize设置，将Bearer空格tokon进行保存</span><br></pre></td></tr></table></figure>
<h1 id="生成验证码"><a href="#生成验证码" class="headerlink" title="生成验证码"></a>生成验证码</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">1⃣️引入Google验证码依赖</span><br><span class="line">	 &lt;!--验证码--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.github.axet&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;kaptcha&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;0.0.9&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">2⃣️准备谷歌验证码配置类</span><br><span class="line">	注解@Configuration</span><br><span class="line">	准备bean</span><br><span class="line">	具体配置</span><br><span class="line">				&#x2F;&#x2F;验证码生成器</span><br><span class="line">        DefaultKaptcha defaultKaptcha &#x3D; new DefaultKaptcha();</span><br><span class="line">        &#x2F;&#x2F;配置</span><br><span class="line">        Properties properties &#x3D; new Properties();</span><br><span class="line">        &#x2F;&#x2F;是否有边框</span><br><span class="line">        properties.setProperty(&quot;kaptcha.border&quot;, &quot;yes&quot;);</span><br><span class="line">        &#x2F;&#x2F;设置边框颜色</span><br><span class="line">        properties.setProperty(&quot;kaptcha.border.color&quot;, &quot;105,179,90&quot;);</span><br><span class="line">        &#x2F;&#x2F;边框粗细度，默认为1</span><br><span class="line">        &#x2F;&#x2F; properties.setProperty(&quot;kaptcha.border.thickness&quot;,&quot;1&quot;);</span><br><span class="line">        &#x2F;&#x2F;验证码</span><br><span class="line">        properties.setProperty(&quot;kaptcha.session.key&quot;, &quot;code&quot;);</span><br><span class="line">        &#x2F;&#x2F;验证码文本字符颜色 默认为黑色</span><br><span class="line">        properties.setProperty(&quot;kaptcha.textproducer.font.color&quot;, &quot;blue&quot;);</span><br><span class="line">        &#x2F;&#x2F;设置字体样式</span><br><span class="line">        properties.setProperty(&quot;kaptcha.textproducer.font.names&quot;, &quot;宋体,楷体,微软雅 黑&quot;);</span><br><span class="line">        &#x2F;&#x2F;字体大小，默认40</span><br><span class="line">        properties.setProperty(&quot;kaptcha.textproducer.font.size&quot;, &quot;30&quot;);</span><br><span class="line">        &#x2F;&#x2F;验证码文本字符内容范围 默认为abced2345678gfynmnpwx</span><br><span class="line">        &#x2F;&#x2F; properties.setProperty(&quot;kaptcha.textproducer.char.string&quot;, &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F;字符长度，默认为5</span><br><span class="line">        properties.setProperty(&quot;kaptcha.textproducer.char.length&quot;, &quot;4&quot;);</span><br><span class="line">        &#x2F;&#x2F;字符间距 默认为2</span><br><span class="line">        properties.setProperty(&quot;kaptcha.textproducer.char.space&quot;, &quot;4&quot;);</span><br><span class="line">        &#x2F;&#x2F;验证码图片宽度 默认为200</span><br><span class="line">        properties.setProperty(&quot;kaptcha.image.width&quot;, &quot;100&quot;);</span><br><span class="line">        &#x2F;&#x2F;验证码图片高度 默认为40</span><br><span class="line">        properties.setProperty(&quot;kaptcha.image.height&quot;, &quot;40&quot;);</span><br><span class="line">        Config config &#x3D; new Config(properties);</span><br><span class="line">        defaultKaptcha.setConfig(config);</span><br><span class="line">        return defaultKaptcha;</span><br><span class="line">3⃣️新建Controller</span><br><span class="line">	注解</span><br><span class="line">	类注解  @RestController</span><br><span class="line">	@ApiOperation(value &#x3D; &quot;验证码&quot;)</span><br><span class="line">  @GetMapping(value &#x3D; &quot;&#x2F;captcha&quot;)</span><br><span class="line">  添加方法captcha参数为（HttpServletRequest，HttpServletResponse）</span><br><span class="line">  通过流传递图片到前端,需要对response响应头做相应处理</span><br><span class="line">  	response.setDateHeader(&quot;Expires&quot;, 0);</span><br><span class="line">    response.setHeader(&quot;Cache-Control&quot;, &quot;no-store, no-cache, must-revalidate&quot;);</span><br><span class="line">    response.addHeader(&quot;Cache-Control&quot;, &quot;post-check&#x3D;0, pre-check&#x3D;0&quot;);</span><br><span class="line">    response.setHeader(&quot;Pragma&quot;, &quot;no-cache&quot;);</span><br><span class="line">    response.setContentType(&quot;image&#x2F;jpeg&quot;);</span><br><span class="line">  注入DefaultKaptcha</span><br><span class="line">  生成验证码</span><br><span class="line">  获取验证码文本内容</span><br><span class="line">  将验证码放入session</span><br><span class="line">  根据text创建图像验证码</span><br><span class="line">  输出流输出图片，格式为jpg</span><br><span class="line">4⃣️添加放行SecurityConfig&#x2F;configure(WebSecurity web)+&quot;&#x2F;captcha&quot;</span><br><span class="line">5⃣️接口文档验证码乱码-在注解添加 @GetMapping(value &#x3D; &quot;&#x2F;captcha&quot;,produces &#x3D; &quot;image&#x2F;jpeg&quot;)</span><br></pre></td></tr></table></figure>
<h1 id="验证码校验"><a href="#验证码校验" class="headerlink" title="验证码校验"></a>验证码校验</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1⃣️在AdminLoginParam添加接收参数</span><br><span class="line">	@ApiModelProperty(value &#x3D; &quot;验证码&quot;,required &#x3D; true)</span><br><span class="line">    private String code;</span><br><span class="line">2⃣️在LoginController，添加参数验证码，同时在IAdminService&#x2F;AdminServiceImpl也进行改变</span><br><span class="line">3⃣️在AdminServiceImpl，获取验证码</span><br><span class="line">	String captcha &#x3D; (String) request.getSession().getAttribute(&quot;captcha&quot;);</span><br><span class="line">4⃣️验证码比较</span><br><span class="line">	不为空前端输入与后端验证码进行匹配</span><br></pre></td></tr></table></figure>
<h1 id="根据用户id查询菜单列表"><a href="#根据用户id查询菜单列表" class="headerlink" title="根据用户id查询菜单列表"></a>根据用户id查询菜单列表</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">1⃣️更改pojo实体类Menu</span><br><span class="line">	 @ApiModelProperty(value &#x3D; &quot;子菜单&quot;)</span><br><span class="line">   @TableField(exist &#x3D; false)</span><br><span class="line">   private List&lt;Menu&gt; children;	</span><br><span class="line">2⃣️更改MenuController</span><br><span class="line">	更改路径&#x2F;system&#x2F;cfg</span><br><span class="line">	注入 IMenuService</span><br><span class="line">	在getMenuByAdminId返回getMenusByAdminId</span><br><span class="line">	用户信息一般是从后端获取，而不是前端获取，因为可能会被篡改</span><br><span class="line">3⃣️在IMenuService接口定义getMenusByAdminId</span><br><span class="line">4⃣️在MenuServiceImpl实现getMenusByAdminId</span><br><span class="line">	return menuMapper.getMenusAdminId(((Admin)(SecurityContextHolder.getContext().getAuthentication().getPrincipal())).getId());</span><br><span class="line">5⃣️在MenuMapper定义getMenusAdminId</span><br><span class="line">6⃣️在MenuMapper写查询方法 定义返回类型</span><br><span class="line">	&lt;!--根据用户id查询菜单列表--&gt;</span><br><span class="line">	&lt;select id&#x3D;&quot;getMenusAdminId&quot; resultMap&#x3D;&quot;Menus&quot;&gt;</span><br><span class="line">        select distinct m1.*,</span><br><span class="line">                        m2.id            as id2,</span><br><span class="line">                        m2.url           as url2,</span><br><span class="line">                        m2.path          as path2,</span><br><span class="line">                        m2.&#96;component&#96;   as component2,</span><br><span class="line">                        m2.name          as name2,</span><br><span class="line">                        m2.&#96;iconCls&#96;     as iconCls2,</span><br><span class="line">                        m2.&#96;keepAlive&#96;   as keepAlive2,</span><br><span class="line">                        m2.&#96;requireAuth&#96; as requireAuth2,</span><br><span class="line">                        m2.&#96;parentId&#96;    as parentId2,</span><br><span class="line">                        m2.enabled       as enabled2</span><br><span class="line">        from &#96;t_menu&#96; m1,</span><br><span class="line">             &#96;t_menu&#96; m2,</span><br><span class="line">             &#96;t_menu_role&#96; mr,</span><br><span class="line">             &#96;t_admin_role&#96; ar</span><br><span class="line">        where m1.id &#x3D; m2.&#96;parentId&#96;</span><br><span class="line">          and m2.id &#x3D; mr.&#96;mid&#96;</span><br><span class="line">          and mr.&#96;rid&#96; &#x3D; ar.&#96;rid&#96;</span><br><span class="line">          and ar.&#96;adminId&#96; &#x3D; #&#123;id&#125;</span><br><span class="line">          and m2.enabled &#x3D; true</span><br><span class="line">        order by m2.id</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;resultMap id&#x3D;&quot;Menus&quot; type&#x3D;&quot;com.zoux.server.pojo.Menu&quot; extends&#x3D;&quot;BaseResultMap&quot;&gt;</span><br><span class="line">        &lt;collection property&#x3D;&quot;children&quot; ofType&#x3D;&quot;com.zoux.server.pojo.Menu&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;id2&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;url2&quot; property&#x3D;&quot;url&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;path2&quot; property&#x3D;&quot;path&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;component2&quot; property&#x3D;&quot;component&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;name2&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;iconCls2&quot; property&#x3D;&quot;iconCls&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;keepAlive2&quot; property&#x3D;&quot;keepAlive&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;requireAuth2&quot; property&#x3D;&quot;requireAuth&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;parentId2&quot; property&#x3D;&quot;parentId&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;enabled2&quot; property&#x3D;&quot;enabled&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;collection&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Redis集成菜单功能"><a href="#Redis集成菜单功能" class="headerlink" title="Redis集成菜单功能"></a>Redis集成菜单功能</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">1⃣️添加依赖</span><br><span class="line">	&lt;!--spring data redis 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--commons-pool2 对象池依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.commons&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-pool2&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">2⃣️添加配置application.yml </span><br><span class="line">	redis:</span><br><span class="line">    #超时时间</span><br><span class="line">    timeout:  10000ms</span><br><span class="line">    #服务器地址</span><br><span class="line">    host: 47.100.92.101</span><br><span class="line">    #服务器端口</span><br><span class="line">    port: 6379</span><br><span class="line">    database: 0</span><br><span class="line">    #    password: root</span><br><span class="line">    lettuce:</span><br><span class="line">      #默认连接数，默认是8</span><br><span class="line">      max-active: 1024</span><br><span class="line">      #最大连接阻塞等待时间</span><br><span class="line">      max-wait: 1000ms</span><br><span class="line">      #最大空闲连接</span><br><span class="line">      max-idle: 200</span><br><span class="line">      #最小空闲连接</span><br><span class="line">      min-idle: 5</span><br><span class="line">3⃣️新建redis配置类RedisConfig 参数RedisConnectionFactory</span><br><span class="line">	引入Bean RedisTemplate</span><br><span class="line">	序列化</span><br><span class="line">	String类型序列器</span><br><span class="line">	 Hash类型序列器</span><br><span class="line">	 将RedisConnectionFactory 加入到RedisTemplate</span><br><span class="line">4⃣️更改Menucontroller-&gt;IMenuService-&gt;MenuServiceImpl&#x2F;getMenusByAdminId方法</span><br><span class="line">	注入RedisTemplate</span><br><span class="line">	先去redis获取</span><br><span class="line">	判断menus是否为空,就通过数据库进行查询</span><br><span class="line">		将数据设置到redis中</span><br><span class="line">5⃣️后期，当涉及到数据菜单更新时，我们要重置redis里面的数据</span><br></pre></td></tr></table></figure>
<h1 id="根据请求url判断角色"><a href="#根据请求url判断角色" class="headerlink" title="根据请求url判断角色"></a>根据请求url判断角色</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">权限RBAC基本概念</span><br><span class="line">	Role- Based Access Controller</span><br><span class="line">	权限与角色相关联，用户通过扮演适当的角色从而得到这些角色的权限。</span><br><span class="line">	管理是层级相互依赖的，权限赋予给角色，角色又赋予用户。</span><br><span class="line">	权限设计清楚，管理方便</span><br><span class="line">	RBAC实际上是who what how三元组之间的关系，也就是who 对what进行how的操作</span><br><span class="line">	谁对什么资源做了怎样的操作。</span><br><span class="line">	</span><br><span class="line">1⃣️pojo-Menu添加属性</span><br><span class="line">		@ApiModelProperty(value &#x3D; &quot;角色列表&quot;)</span><br><span class="line">    @TableField(exist &#x3D; false)</span><br><span class="line">    private List&lt;Menu&gt; roles;</span><br><span class="line">2⃣️在IMenuService定义getMenusWithRole</span><br><span class="line">3⃣️在MenuServiceImpl实现getMenusWithRole</span><br><span class="line">4⃣️在MenuMapper定义getMenusWithRole</span><br><span class="line">5⃣️在MenuMapper.xml实现sql</span><br><span class="line">	并实现返回map</span><br><span class="line">6⃣️将实现的getMenusWithRole放入过滤器中</span><br><span class="line">	顺便更新config目录结构，重启项目，验证是否出现错误</span><br><span class="line">7⃣️	新建CustomFilter配置类</span><br><span class="line">	注解@Component</span><br><span class="line">	实现FilterInvocationSecurityMetadataSource重写内部方法 getAttributes</span><br><span class="line">	注入IMenuService</span><br><span class="line">	引入AntPathMatcher</span><br><span class="line">		在做uri匹配规则发现这个类，根据源码对该类进行分析，它主要用来做类URLs字符串匹配；</span><br><span class="line">		获取请求的url</span><br><span class="line">		获得menus</span><br><span class="line">		循环判断 我们当前的url与获取的url是否匹配</span><br><span class="line">		判断请求url与角色允许url是否匹配</span><br><span class="line">		利用jdk8新特性stream流map一下</span><br><span class="line">		能够匹配就将匹配的角色放入&#x2F;list</span><br><span class="line">		如果url匹配不上就默认给一个登陆角色</span><br></pre></td></tr></table></figure>
<h1 id="判断用户角色"><a href="#判断用户角色" class="headerlink" title="判断用户角色"></a>判断用户角色</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">1⃣️修改pojo-Admin</span><br><span class="line">		@ApiModelProperty(value &#x3D; &quot;角色&quot;)</span><br><span class="line">    @TableField(exist &#x3D; false)</span><br><span class="line">    private List&lt;Role&gt; roles;</span><br><span class="line">    更改getAuthorities</span><br><span class="line">    	获取权限列表</span><br><span class="line">2⃣️IAdminService定义getRoles</span><br><span class="line">3⃣️在AdminServiceImpl实现getRoles</span><br><span class="line">	注入RoleMapper</span><br><span class="line">	新建方法getRoles</span><br><span class="line">4⃣️在RoleMapper定义getRoles</span><br><span class="line">5⃣️在RoleMapper.xml中实现sql</span><br><span class="line">7⃣️在登录方法中加入getRoles</span><br><span class="line">	在LoginController-getAdminInfo&#x2F;loadUserByUsername实现方法</span><br><span class="line">		添加获取用户角色    </span><br><span class="line">8⃣️添加拦截</span><br><span class="line">	新建类CustomUrlDecisionManager</span><br><span class="line">		注解@Component</span><br><span class="line">		实现AccessDecisionManager，并重写其方法decide</span><br><span class="line">			获取当前url需要角色</span><br><span class="line">			判断角色是否登陆即可访问的角色，此角色在CustomFilter中设置</span><br><span class="line">			判断是否登陆</span><br><span class="line">			判断用户角色是否为url所需角色</span><br><span class="line">			如若不满足，抛出异常</span><br><span class="line">				throw new AccessDeniedException(&quot;权限不足，请联系管理员！&quot;);</span><br><span class="line">9⃣️配置securityconfig</span><br><span class="line">	引入CustomFilter，CustomUrlDecisionManager</span><br><span class="line">	在访问请求要求认证下添加</span><br><span class="line">		动态权限配置</span><br><span class="line">		.withObjectPostProcessor()</span><br><span class="line">			new ObjectPostProcessor范型为FilterSecurityInterceptor重写其方法postProcess</span><br><span class="line">				添加CustomFilter，CustomUrlDecisionManager</span><br><span class="line">					o.setAccessDecisionManager(customUrlDecisionManager);</span><br><span class="line">          o.setSecurityMetadataSource(customFilter);</span><br><span class="line">        返回o</span><br><span class="line">🔟准备测试类</span><br><span class="line">	HelloController</span><br><span class="line">	注解@RestController</span><br><span class="line">		@GetMapping(&quot;&#x2F;employee&#x2F;basic&#x2F;hello&quot;)</span><br><span class="line">    public String hello2() &#123;</span><br><span class="line">        return &quot;&#x2F;employee&#x2F;basic&#x2F;hell&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;hello&quot;)</span><br><span class="line">    public String hello() &#123;</span><br><span class="line">        return &quot;hello&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;employee&#x2F;advanced&#x2F;hello&quot;)</span><br><span class="line">    public String hello3() &#123;</span><br><span class="line">        return &quot;&#x2F;employee&#x2F;advanced&#x2F;hello&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="职位管理功能实现"><a href="#职位管理功能实现" class="headerlink" title="职位管理功能实现"></a>职位管理功能实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1⃣️自定义日期格式</span><br><span class="line">	pojo-Position</span><br><span class="line">	添加注解</span><br><span class="line">		@JsonFormat(pattern &#x3D; &quot;yyyy-MM-dd&quot;,timezone &#x3D; &quot;Asia&#x2F;Shanghai&quot;)</span><br><span class="line">2⃣️更改PositionController</span><br><span class="line">	查询</span><br><span class="line">    @ApiOperation(value &#x3D; &quot;获取所有职位信息&quot;)</span><br><span class="line">    注解@RequestMapping(&quot;&#x2F;system&#x2F;basic&#x2F;pos&quot;)		</span><br><span class="line">    注入IPositionService</span><br><span class="line">    创建方法getAllPositions</span><br><span class="line">      返回return positionService.list();</span><br><span class="line">  添加</span><br><span class="line">  	方法入参注解@RequestBody 接收前端传递给后端的json字符串中的数据的</span><br><span class="line">  	加入当前时间</span><br><span class="line">  		position.setCreateDate(LocalDateTime.now());</span><br><span class="line">  	positionService.save(position)</span><br><span class="line">  更新</span><br><span class="line">  	positionService.updateById(position)</span><br><span class="line">  删除</span><br><span class="line">  	注解@PathVariable 接收请求路径中占位符的值</span><br><span class="line">  	positionService.removeById(id)</span><br><span class="line">  批量删除</span><br><span class="line">  	positionService.removeByIds(Arrays.asList(ids))</span><br></pre></td></tr></table></figure>
<h1 id="全局异常"><a href="#全局异常" class="headerlink" title="全局异常"></a>全局异常</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1⃣️新建包exception并新建类GlobalException</span><br><span class="line">	注解@RestControllerAdvice 表示控制器的一个增强类</span><br><span class="line">	捕捉异常</span><br><span class="line">    @ExceptionHandler</span><br><span class="line">  </span><br></pre></td></tr></table></figure>
<h1 id="职称管理功能实现"><a href="#职称管理功能实现" class="headerlink" title="职称管理功能实现"></a>职称管理功能实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1⃣️给pojo-Joblevel类的属性createDate加上注解</span><br><span class="line">	@JsonFormat(pattern &#x3D; &quot;yyyy-MM-dd&quot;,timezone &#x3D; &quot;Asia&#x2F;Shanghai&quot;)</span><br><span class="line">2⃣️修改JoblevelController注解@RequestMapping的路径与数据库相匹配</span><br><span class="line">	@RequestMapping(&quot;&#x2F;system&#x2F;basic&#x2F;joblevel&quot;)</span><br><span class="line">	与职位管理功能类似</span><br></pre></td></tr></table></figure>
<h1 id="权限组角色功能实现"><a href="#权限组角色功能实现" class="headerlink" title="权限组角色功能实现"></a>权限组角色功能实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">通过角色表和用户表管关联，进而给用户分配不同的角色</span><br><span class="line">也可以通过菜单角色也菜单表关联，进而给用户分配不同的角色，可以拥有不同菜单的权限</span><br><span class="line">权限组分为角色和菜单部分</span><br><span class="line">1⃣️新建PermissionController</span><br><span class="line">  	添加注解</span><br><span class="line">  		@RestController</span><br><span class="line">			@RequestMapping(&quot;&#x2F;system&#x2F;basic&#x2F;permission&quot;)</span><br><span class="line">		注入IRoleService</span><br><span class="line">		注入IMenuService</span><br><span class="line">    实现角色部分</span><br><span class="line">    	查询角色</span><br><span class="line">    	添加角色</span><br><span class="line">    		给名字加上前缀</span><br><span class="line">    	删除角色</span><br><span class="line">    实现菜单部分</span><br><span class="line">    	查询所有菜单</span><br><span class="line">    		在IMenuService中定义getAllMenus方法</span><br><span class="line">    		在MenuServiceImpl中实现getAllMenus方法</span><br><span class="line">    		在MenuMapper定义getAllMenus方法</span><br><span class="line">    		在MenuMapper.xml实现sql 编写resultMap</span><br><span class="line">    	根据角色id查询菜单id</span><br><span class="line">      	@ApiOperation(value &#x3D; &quot;根据角色id查询菜单id&quot;)</span><br><span class="line">    		@GetMapping(&quot;&#x2F;mid&#x2F;&#123;rid&#125;&quot;)</span><br><span class="line">    		public List&lt;Integer&gt; getMidByRid(@PathVariable Integer rid) &#123;</span><br><span class="line">           return menuRoleService.list(new QueryWrapper&lt;MenuRole&gt;().eq(&quot;rid&quot;, rid)).stream().map(MenuRole::getMid).collect(Collectors.toList());</span><br><span class="line">        &#125;</span><br><span class="line">    更新角色菜单</span><br><span class="line">       流程：</span><br><span class="line">       	每次更新之前，将这个角色的菜单清空</span><br><span class="line">       	然后根据传入的角色id与菜单id进行关联</span><br><span class="line">				涉及到了两步加上注解@Transactional 事物注解</span><br><span class="line">        	注入mapper</span><br><span class="line">        	删除角色下所有菜单	</span><br><span class="line">        		menuRoleMapper.delete(new QueryWrapper&lt;MenuRole&gt;().eq(&quot;rid&quot;, rid));</span><br><span class="line">        	批量更新菜单</span><br><span class="line">        		insertRecord</span><br><span class="line">        		在menuRoleMapper下定义insertRecord 注意在入参加上注解@Param</span><br><span class="line">						在mapper实现sql</span><br><span class="line">							&lt;!--  更新角色菜单  --&gt;</span><br><span class="line">              &lt;insert id&#x3D;&quot;insertRecord&quot;&gt;</span><br><span class="line">                  insert into t_menu_role(mid,rid) values</span><br><span class="line">                  &lt;foreach collection&#x3D;&quot;mids&quot; item&#x3D;&quot;mid&quot; separator&#x3D;&quot;,&quot;&gt;</span><br><span class="line">                      (#&#123;mid&#125;,#&#123;rid&#125;)</span><br><span class="line">                  &lt;&#x2F;foreach&gt;</span><br><span class="line">              &lt;&#x2F;insert&gt;</span><br></pre></td></tr></table></figure>
<h1 id="存储过程的创建和使用"><a href="#存储过程的创建和使用" class="headerlink" title="存储过程的创建和使用"></a>存储过程的创建和使用</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">存储过程就是具有名字的一段代码，用来完成一个特定的功能</span><br><span class="line">创建的存储过程保存在数据库的数据字典中</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;定义了用户root，使用本地IP地址			创建了存储过程名字为deleteDep</span><br><span class="line">CREATE DEFINER&#x3D;&#96;root&#96;@&#96;localhost&#96; PROCEDURE &#96;deleteDep&#96;(in did int,out result int)</span><br><span class="line">begin</span><br><span class="line">  declare ecount int;</span><br><span class="line">  declare pid int;</span><br><span class="line">  declare pcount int;</span><br><span class="line">  declare a int;</span><br><span class="line">  &#x2F;&#x2F;不存在id，或者有子部门</span><br><span class="line">  select count(*) into a from t_department where id&#x3D;did and isParent&#x3D;false;</span><br><span class="line">  if a&#x3D;0 then set result&#x3D;-2;</span><br><span class="line">  else</span><br><span class="line">  &#x2F;&#x2F;查询部门下员工数量</span><br><span class="line">  select count(*) into ecount from t_employee where departmentId&#x3D;did;</span><br><span class="line">  if ecount&gt;0 then set result&#x3D;-1;</span><br><span class="line">  &#x2F;&#x2F;有员工不能进行删除</span><br><span class="line">  else </span><br><span class="line">  &#x2F;&#x2F;查询 父id</span><br><span class="line">  select parentId into pid from t_department where id&#x3D;did;</span><br><span class="line">  &#x2F;&#x2F;正式删除</span><br><span class="line">  delete from t_department where id&#x3D;did and isParent&#x3D;false;</span><br><span class="line">  &#x2F;&#x2F;获得受影响行数</span><br><span class="line">  select row_count() into result;</span><br><span class="line">  &#x2F;&#x2F;查询部门的父部门</span><br><span class="line">  select count(*) into pcount from t_department where parentId&#x3D;pid;</span><br><span class="line">  &#x2F;&#x2F;判断当子部门为0时，就改变字段isParent。</span><br><span class="line">  if pcount&#x3D;0 then update t_department set isParent&#x3D;false where id&#x3D;pid;</span><br><span class="line">  end if;</span><br><span class="line">  end if;</span><br><span class="line">  end if;</span><br><span class="line">end</span><br><span class="line">&#x2F;&#x2F;定义了用户root，使用本地IP地址      创建了存储过程名字为addDep 参数 in表输入参数 depName表输入参数名称 out输出参数</span><br><span class="line">CREATE DEFINER&#x3D;&#96;root&#96;@&#96;localhost&#96; PROCEDURE &#96;addDep&#96;(in depName varchar(32),in parentId int,in enabled boolean,out result int,out result2 int)</span><br><span class="line">begin</span><br><span class="line">&#x2F;&#x2F;定义了did int类型的</span><br><span class="line">  declare did int;</span><br><span class="line">  declare pDepPath varchar(64);</span><br><span class="line">  &#x2F;&#x2F;插入数据</span><br><span class="line">  insert into t_department set name&#x3D;depName,parentId&#x3D;parentId,enabled&#x3D;enabled;</span><br><span class="line">  &#x2F;&#x2F;获取受影响的行数</span><br><span class="line">  select row_count() into result;</span><br><span class="line">  &#x2F;&#x2F;获取插入的最后一条的id</span><br><span class="line">  select last_insert_id() into did;</span><br><span class="line">  set result2&#x3D;did;</span><br><span class="line">  &#x2F;&#x2F;查询路径 放入到pDepPath里面</span><br><span class="line">  select depPath into pDepPath from t_department where id&#x3D;parentId;</span><br><span class="line">  &#x2F;在原有的路径的基础上加上上一次插入的路径</span><br><span class="line">  update t_department set depPath&#x3D;concat(pDepPath,&#39;.&#39;,did) where id&#x3D;did;</span><br><span class="line">  &#x2F;&#x2F;经过上一句，这条数据库记录本身就上升为有子部门的记录了</span><br><span class="line">  update t_department set isParent&#x3D;true where id&#x3D;parentId;</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h1 id="部门管理功能实现"><a href="#部门管理功能实现" class="headerlink" title="部门管理功能实现"></a>部门管理功能实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">1⃣️获取所有部门</span><br><span class="line">	更改DepartmentController</span><br><span class="line">		注解RequestMapping路径&#x2F;system&#x2F;basic&#x2F;department</span><br><span class="line">		注入IDepartmentService</span><br><span class="line">		定义方法getAllDepartments</span><br><span class="line">			注解</span><br><span class="line">				@ApiOperation(value &#x3D; &quot;获取所有部门&quot;)</span><br><span class="line">		    @GetMapping(&quot;&#x2F;&quot;)</span><br><span class="line">	在pojo-Department中</span><br><span class="line">    	定义属性</span><br><span class="line">    		@ApiModelProperty(value &#x3D; &quot;子部门列表&quot;)</span><br><span class="line">        @TableField(exist &#x3D; false)</span><br><span class="line">        private List&lt;Department&gt; children;</span><br><span class="line">        @ApiModelProperty(value &#x3D; &quot;返回结果，存储过程使用&quot;)</span><br><span class="line">        @TableField(exist &#x3D; false)</span><br><span class="line">        private Integer result;</span><br><span class="line">  在IDepartmentService定义getAllDepartments</span><br><span class="line">  在DepartmentServiceImpl实现getAllDepartments</span><br><span class="line">  	注入departmentMapper</span><br><span class="line">  在DepartmentMapper定义getAllDepartments</span><br><span class="line">  在DepartmentMapper.xml实现sql</span><br><span class="line">  	利用mybatis提供的递归查询实现</span><br><span class="line">  		在DepartmentServiceImpl的getAllDepartments方法提供入参（最大的parentid）</span><br><span class="line">  		递归体现在DepartmentMapper.xml编写resultMap时</span><br><span class="line">  			&lt;resultMap id&#x3D;&quot;DepartmentWithChildren&quot; type&#x3D;&quot;com.zoux.server.pojo.Department&quot; extends&#x3D;&quot;BaseResultMap&quot;&gt;</span><br><span class="line">        &lt;collection property&#x3D;&quot;children&quot; ofType&#x3D;&quot;com.zoux.server.pojo.Department&quot;</span><br><span class="line">                    select&#x3D;&quot;com.zoux.server.mapper.DepartmentMapper.getAllDepartments&quot; column&#x3D;&quot;id&quot;&gt;</span><br><span class="line">        &lt;&#x2F;collection&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line">    	其中select&#x3D;&quot;com.zoux.server.mapper.DepartmentMapper.getAllDepartments&quot; column&#x3D;&quot;id&quot;&gt;</span><br><span class="line">    	为入口</span><br><span class="line">2⃣️添加部门</span><br><span class="line">	修改DepartmentController</span><br><span class="line">		注解</span><br><span class="line">			@ApiOperation(value &#x3D; &quot;添加部门&quot;)</span><br><span class="line">    	@PostMapping(&quot;&#x2F;&quot;)</span><br><span class="line">    新建方法addDep</span><br><span class="line">    在IDepartmentService定义addDep</span><br><span class="line">    在DepartmentServiceImpl实现addDep</span><br><span class="line">	    更改即将存储的department</span><br><span class="line">	    	enabled&#x3D;true</span><br><span class="line">	    判断添加是否成功</span><br><span class="line">    在DepartmentMapper定义addDep</span><br><span class="line">    在DepartmentMapper.xml里面实现sql</span><br><span class="line">    	不使用传统insert</span><br><span class="line">    	使用存储过程</span><br><span class="line">    		&lt;!--    添加部门  --&gt;</span><br><span class="line">        &lt;select id&#x3D;&quot;addDep&quot; statementType&#x3D;&quot;CALLABLE&quot;&gt;</span><br><span class="line">            call addDep(#&#123;name,mode &#x3D; IN,jdbcType&#x3D;VARCHAR&#125;,</span><br><span class="line">                #&#123;parentId,mode &#x3D; IN,jdbcType&#x3D;INTEGER&#125;,</span><br><span class="line">                #&#123;enabled,mode &#x3D; IN,jdbcType&#x3D;BOOLEAN&#125;,</span><br><span class="line">                #&#123;result,mode &#x3D; OUT,jdbcType&#x3D;INTEGER&#125;,</span><br><span class="line">                #&#123;id,mode &#x3D; OUT,jdbcType&#x3D;INTEGER&#125;)</span><br><span class="line">        &lt;&#x2F;select&gt;</span><br><span class="line">3⃣️删除部门 </span><br><span class="line">	修改DepartmentController</span><br><span class="line">		注解</span><br><span class="line">			@ApiOperation(value &#x3D; &quot;删除部门&quot;)</span><br><span class="line">   	  @DeleteMapping(&quot;&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">   	新建方法deleteDep  </span><br><span class="line">   	在IDepartmentService定义deleteDep</span><br><span class="line">    在DepartmentServiceImpl实现deleteDep</span><br><span class="line">    	判断删除是否成功</span><br><span class="line">    在DepartmentMapper定义addDep</span><br><span class="line">    在DepartmentMapper.xml里面实现sql</span><br><span class="line">    	不使用传统insert</span><br><span class="line">    	使用存储过程</span><br><span class="line">      	&lt;!--    删除部门  --&gt;</span><br><span class="line">        &lt;select id&#x3D;&quot;deleteDep&quot; statementType&#x3D;&quot;CALLABLE&quot;&gt;</span><br><span class="line">            call deleteDep( #&#123;id,mode &#x3D; IN,jdbcType&#x3D;INTEGER&#125;,</span><br><span class="line">                #&#123;result,mode &#x3D; OUT,jdbcType&#x3D;INTEGER&#125;</span><br><span class="line">                )</span><br><span class="line">        &lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>
<h1 id="操作员管理功能"><a href="#操作员管理功能" class="headerlink" title="操作员管理功能"></a>操作员管理功能</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">1⃣️获取所有操作员</span><br><span class="line">	修改AdminController</span><br><span class="line">		注解</span><br><span class="line">      @RequestMapping(&quot;&#x2F;system&#x2F;admin&quot;)</span><br><span class="line">      @GetMapping(&quot;&#x2F;&quot;)</span><br><span class="line">		注入adminService</span><br><span class="line">		新建方法getAllAdmins参数keyword</span><br><span class="line">		在IAdminService定义getAllAdmins方法</span><br><span class="line">		在AdminServiceImpl实现getAllAdmins</span><br><span class="line">		在AdminMapper定义getAllAdmins</span><br><span class="line">		在AdminMapper.xml实现sql 编写resultMap</span><br><span class="line">			&lt;select id&#x3D;&quot;getAllAdmins&quot; resultMap&#x3D;&quot;AdminWithRole&quot;&gt;</span><br><span class="line">        select</span><br><span class="line">        a.*,</span><br><span class="line">        r.id as rid,</span><br><span class="line">        r.name as rname,</span><br><span class="line">        r.nameZh as rnameZh</span><br><span class="line">        from t_admin a</span><br><span class="line">        LEFT JOIN</span><br><span class="line">        t_admin_role ar ON a.id &#x3D; ar.adminId</span><br><span class="line">        LEFT JOIN</span><br><span class="line">        t_role r ON r.id &#x3D; ar.rid</span><br><span class="line">        where a.id !&#x3D;#&#123;id&#125;</span><br><span class="line"></span><br><span class="line">        &lt;if test&#x3D;&quot;null!&#x3D;keyword and &#39;&#39;!&#x3D;keyword&quot;&gt;</span><br><span class="line">            and a.name   like CONCAT(&#39;%&#39;,#&#123;keyword&#125;,&#39;%&#39;)</span><br><span class="line">        &lt;&#x2F;if&gt;</span><br><span class="line">        ORDER BY</span><br><span class="line">        a.id</span><br><span class="line">    	&lt;&#x2F;select&gt;</span><br><span class="line">    	&lt;resultMap id&#x3D;&quot;AdminWithRole&quot; type&#x3D;&quot;com.zoux.server.pojo.Admin&quot; extends&#x3D;&quot;BaseResultMap&quot;&gt;</span><br><span class="line">        &lt;collection property&#x3D;&quot;roles&quot; ofType&#x3D;&quot;com.zoux.server.pojo.Role&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;rid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;rname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;rnameZh&quot; property&#x3D;&quot;nameZh&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;collection&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line">2⃣️更新操作员</span><br><span class="line">	AdminController新建方法updateAdmin</span><br><span class="line">		注解</span><br><span class="line">			ApiOperation(value &#x3D; &quot;更新操作员&quot;)</span><br><span class="line">   	  PutMapping(&quot;&#x2F;&quot;)</span><br><span class="line">   	  RequestBody</span><br><span class="line">   	调用adminService.updateById（admin ）</span><br><span class="line">    更改pojo-Admin	指定属性enabled，lombok注解@Getter(AccessLevel.NONE)</span><br><span class="line">    	因为实现了UserDetails，所以有关enabled的get方法被重写，使用get方法时就会出现错误，关闭lombok，		get方法</span><br><span class="line">3⃣️删除操作员</span><br><span class="line">	在AdminController新建方法deleteAdmin</span><br><span class="line">	注解</span><br><span class="line">		@ApiOperation(value &#x3D; &quot;删除操作员&quot;)</span><br><span class="line">    @DeleteMapping(&quot;&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    @PathVariable</span><br><span class="line">  注入adminService</span><br><span class="line">  	调用removeById(id)  </span><br><span class="line">4⃣️获取所有角色</span><br><span class="line">	在AdminController新建方法getAllRoles</span><br><span class="line">	注解</span><br><span class="line">		@ApiOperation(value &#x3D; &quot;获取所有角色&quot;)</span><br><span class="line">    @GetMapping(&quot;&#x2F;roles&quot;)</span><br><span class="line">  注入roleService</span><br><span class="line">  	调用list（）</span><br><span class="line">5⃣️更新操作员角色</span><br><span class="line">	在AdminController新建方法updateAdminOfRole</span><br><span class="line">	注解：</span><br><span class="line">		@ApiOperation(value &#x3D; &quot;更新操作员角色&quot;)</span><br><span class="line">    @PutMapping(&quot;&#x2F;role&quot;)</span><br><span class="line">  注入adminService</span><br><span class="line">  	调用updateAdminOfRole(adminId, rids)</span><br><span class="line">  在AdminServiceImpl</span><br><span class="line">  	注入adminRoleMapper</span><br><span class="line">  		调用delete，根据adminId删除角色</span><br><span class="line">  			delete(new QueryWrapper&lt;AdminRole&gt;().eq(&quot;adminId&quot;, adminId))</span><br><span class="line">  		新建addAdminOfRole</span><br><span class="line">  	判断addAdminOfRole方法返回结果</span><br><span class="line">  在AdminRoleMapper定义addAdminOfRole方法</span><br><span class="line">  在AdminRoleMapper.xml实现sql</span><br><span class="line">  	&lt;!--    更新操作员角色--&gt;</span><br><span class="line">    &lt;update id&#x3D;&quot;addAdminOfRole&quot;&gt;</span><br><span class="line">        insert into t_admin_role(adminId,rid) values</span><br><span class="line">        &lt;foreach collection&#x3D;&quot;rids&quot; item&#x3D;&quot;rid&quot; separator&#x3D;&quot;,&quot;&gt;</span><br><span class="line">            (#&#123;adminId&#125;,#&#123;rid&#125;)</span><br><span class="line">        &lt;&#x2F;foreach&gt;</span><br><span class="line">    &lt;&#x2F;update&gt;	</span><br></pre></td></tr></table></figure>
<h1 id="员工管理功能-分页"><a href="#员工管理功能-分页" class="headerlink" title="员工管理功能-分页"></a>员工管理功能-分页</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">1⃣️分页配置</span><br><span class="line">	新建配置类MybatisPlusConfig</span><br><span class="line">		注解@Configuration</span><br><span class="line">		注入</span><br><span class="line">			@Bean</span><br><span class="line">			PaginationInterceptor</span><br><span class="line">	新建公共分页返回对象pojo-RespPageBean</span><br><span class="line">  	注解</span><br><span class="line">  		@Data</span><br><span class="line">			@NoArgsConstructor</span><br><span class="line">			@AllArgsConstructor</span><br><span class="line">			</span><br><span class="line">		定义属性</span><br><span class="line">    	 Long total	总条数</span><br><span class="line">    	 List&lt;?&gt; data	数据list</span><br><span class="line">2⃣️全局时间格式转换类DateConverter</span><br><span class="line">		注解</span><br><span class="line">			@Component</span><br><span class="line">		实现Converter&lt;String, LocalDate&gt;</span><br><span class="line">			重写convert</span><br><span class="line">				return LocalDate.parse(source, DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&quot;));</span><br><span class="line">		给pojo-Employee于时间相关的属性加上注解，以便用于前端访问</span><br><span class="line">			@JsonFormat(pattern &#x3D; &quot;yyyy-MM-dd&quot;,timezone &#x3D; &quot;Asia&#x2F;Shanghai&quot;)</span><br><span class="line">3⃣️将外接表在pojo-Employee体现</span><br><span class="line">		@ApiModelProperty(value &#x3D; &quot;民族&quot;)</span><br><span class="line">    @TableField(exist &#x3D; false)</span><br><span class="line">    private Nation nation;</span><br><span class="line">4⃣️获取员工分页查询</span><br><span class="line">	修改EmployeeController</span><br><span class="line">		根据t_menu确定注解@RequestMapping(&quot;&#x2F;employee&#x2F;basic&quot;)路径</span><br><span class="line">		新建方法getEmployee</span><br><span class="line">			注解</span><br><span class="line">			 @ApiOperation(value &#x3D; &quot;获取所有员工（分页）&quot;)</span><br><span class="line">	     @GetMapping(&quot;&#x2F;&quot;)</span><br><span class="line">			参数</span><br><span class="line">				@RequestParam(defaultValue &#x3D; &quot;1&quot;) Integer currentPage,</span><br><span class="line">        @RequestParam(defaultValue &#x3D; &quot;10&quot;) Integer size,</span><br><span class="line">        Employee employee,</span><br><span class="line">        LocalDate[] beginDateScope</span><br><span class="line">      注入employeeEcService，添加方法getEmployeeByPage</span><br><span class="line">      	参数(currentPage, size, employee, beginDateScope)</span><br><span class="line">      在IEmployeeEcService定义getEmployeeByPage</span><br><span class="line">      在EmployeeEcServiceImpl实现getEmployeeByPage</span><br><span class="line">      	开启分页 page&#x2F;com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line">      	Page&lt;EmployeeEc&gt; page &#x3D; new Page&lt;&gt;(currentPage, size);</span><br><span class="line">      	注入employeeMapper，</span><br><span class="line">      		在employeeMapper定义getEmployeeByPage</span><br><span class="line">      		参数(page, employee, beginDateScope)</span><br><span class="line">      	将查询结果设置到IPage</span><br><span class="line">      	通过RespPageBean将IPage拆解返回</span><br><span class="line">      		RespPageBean respPageBean &#x3D; new RespPageBean(employeeByPage.getTotal(), 							employeeByPage.getRecords());</span><br><span class="line">      在EmployeeMapper定义getEmployeeByPage</span><br><span class="line">      在EmployeeMapper.xml实现sql，编写resultMap</span><br><span class="line">      	 &lt;!--    获取所有员工(分页)--&gt;</span><br><span class="line">        &lt;select id&#x3D;&quot;getEmployeeByPage&quot; resultMap&#x3D;&quot;EmployeeInfo&quot;&gt;</span><br><span class="line">            SELECT</span><br><span class="line">            e.*,</span><br><span class="line">            n.id AS nid,</span><br><span class="line">            n.&#96;name&#96; AS nname,</span><br><span class="line">            p.id AS pid,</span><br><span class="line">            p.&#96;name&#96; AS pname,</span><br><span class="line">            d.id AS did,</span><br><span class="line">            d.&#96;name&#96; AS dname,</span><br><span class="line">            j.id AS jid,</span><br><span class="line">            j.&#96;name&#96; AS jname,</span><br><span class="line">            pos.id AS posid,</span><br><span class="line">            pos.&#96;name&#96; AS posname</span><br><span class="line">            FROM</span><br><span class="line">            t_employee e,</span><br><span class="line">            t_nation n,</span><br><span class="line">            t_politics_status p,</span><br><span class="line">            t_department d,</span><br><span class="line">            t_joblevel j,</span><br><span class="line">            t_position pos</span><br><span class="line">            WHERE</span><br><span class="line">            e.nationId &#x3D; n.id</span><br><span class="line">            AND e.politicId &#x3D; p.id</span><br><span class="line">            AND e.departmentId &#x3D; d.id</span><br><span class="line">            AND e.jobLevelId &#x3D; j.id</span><br><span class="line">            AND e.posId &#x3D; pos.id</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;employee.name and &#39;&#39;!&#x3D;employee.name&quot;&gt;</span><br><span class="line">                AND e.&#96;name&#96; LIKE concat( &#39;%&#39;, #&#123;employee.name&#125;, &#39;%&#39; )</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;employee.politicId &quot;&gt;</span><br><span class="line">                AND e.politicId &#x3D;#&#123;employee.politicId&#125;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;employee.nationId &quot;&gt;</span><br><span class="line">                AND e.nationId &#x3D;#&#123;mployee.nationId&#125;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;employee.jobLevelId &quot;&gt;</span><br><span class="line">                AND e.jobLevelId &#x3D;#&#123;mployee.jobLevelId&#125;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;employee.posId &quot;&gt;</span><br><span class="line">                AND e.posId &#x3D;#&#123;mployee.posId&#125;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;employee.engageForm and &#39;&#39;!&#x3D;employee.engageForm&quot;&gt;</span><br><span class="line">                AND e.engageForm &#x3D;#&#123;mployee.engageForm&#125;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;employee.departmentId &quot;&gt;</span><br><span class="line">                AND e.departmentId &#x3D;#&#123;mployee.departmentId&#125;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;beginDateScope and 2&#x3D;&#x3D;beginDateScope.length&quot;&gt;</span><br><span class="line">            AND e.beginDate BETWEEN</span><br><span class="line">            #&#123;beginDateScope[0]&#125; AND #&#123;beginDateScope[1]&#125;</span><br><span class="line">       		  &lt;&#x2F;if&gt;</span><br><span class="line">            ORDER BY</span><br><span class="line">            e.id</span><br><span class="line">         &lt;&#x2F;select&gt;</span><br><span class="line">					</span><br><span class="line">					&lt;resultMap id&#x3D;&quot;EmployeeInfo&quot; type&#x3D;&quot;com.zoux.server.pojo.Employee&quot; extends&#x3D;&quot;BaseResultMap&quot;&gt;</span><br><span class="line">            &lt;association property&#x3D;&quot;nation&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Nation&quot;&gt;</span><br><span class="line">                &lt;id column&#x3D;&quot;nid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">                &lt;result column&#x3D;&quot;nname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;association&gt;</span><br><span class="line">            &lt;association property&#x3D;&quot;politicsStatus&quot; javaType&#x3D;&quot;com.zoux.server.pojo.PoliticsStatus&quot;&gt;</span><br><span class="line">                &lt;id column&#x3D;&quot;pid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">                &lt;result column&#x3D;&quot;pname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;association&gt;</span><br><span class="line">            &lt;association property&#x3D;&quot;department&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Department&quot;&gt;</span><br><span class="line">                &lt;id column&#x3D;&quot;did&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">                &lt;result column&#x3D;&quot;dname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;association&gt;</span><br><span class="line">            &lt;association property&#x3D;&quot;joblevel&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Joblevel&quot;&gt;</span><br><span class="line">                &lt;id column&#x3D;&quot;jid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">                &lt;result column&#x3D;&quot;jname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;association&gt;</span><br><span class="line">            &lt;association property&#x3D;&quot;position&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Position&quot;&gt;</span><br><span class="line">                &lt;id column&#x3D;&quot;posid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">                &lt;result column&#x3D;&quot;posname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;association&gt;</span><br><span class="line">        &lt;&#x2F;resultMap&gt;</span><br></pre></td></tr></table></figure>
<h1 id="员工管理功能-添加-删除-更新员工"><a href="#员工管理功能-添加-删除-更新员工" class="headerlink" title="员工管理功能-添加/删除/更新员工"></a>员工管理功能-添加/删除/更新员工</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">1⃣️获取所有政治面貌</span><br><span class="line">2⃣️获取所有职称</span><br><span class="line">3⃣️获取所有民族</span><br><span class="line">4⃣️获取所有职位</span><br><span class="line">5⃣️获取所有部门</span><br><span class="line">前六步步骤一摸一样</span><br><span class="line">	在EmployeeController编辑</span><br><span class="line">    注入departmentService</span><br><span class="line">    @ApiOperation(value &#x3D; &quot;获取所有部门&quot;)</span><br><span class="line">      @GetMapping(&quot;&#x2F;department&quot;)</span><br><span class="line">      public List&lt;Department&gt; getAllDepartment() &#123;</span><br><span class="line">          return departmentService.getAllDepartments();</span><br><span class="line">      &#125;</span><br><span class="line">6⃣️获取工号</span><br><span class="line">	在EmployeeController新建maxWorkId</span><br><span class="line">	注入employeeEcService</span><br><span class="line">	在IEmployeeEcService定义maxWorkId</span><br><span class="line">	在EmployeeEcServiceImpl实现maxWorkId</span><br><span class="line">		注入employeeMapper</span><br><span class="line">    	查询sql	</span><br><span class="line">    		employeeMapper.selectMaps(new QueryWrapper&lt;Employee&gt;().select(&quot;max(workId)&quot;))</span><br><span class="line">    返回格式化后的数据</span><br><span class="line">    	String.format(&quot;%08d&quot;, Integer.parseInt(maps.get(0).get(&quot;max(workId)&quot;).toString()) + 1)</span><br><span class="line">7⃣️添加员工</span><br><span class="line">	在EmployeeController新建addEmp</span><br><span class="line">	注入employeeEcService</span><br><span class="line">	在IEmployeeEcService定义addEmp</span><br><span class="line">	在EmployeeEcServiceImpl实现addEmp</span><br><span class="line">		计算合同期限计算,保留2位小数</span><br><span class="line">	注入employeeMapper</span><br><span class="line">  	调用nsert(employee)</span><br><span class="line">  返回提示	</span><br><span class="line">8⃣️更新员工</span><br><span class="line">	在EmployeeController新建updateEmp</span><br><span class="line">	注解RequestBody</span><br><span class="line">		if (employeeEcService.updateById(employee)) &#123;</span><br><span class="line">            return RespBean.success(&quot;更新成功&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;更新失败&quot;);</span><br><span class="line">9⃣️删除员工</span><br><span class="line">	在EmployeeController新建deleteEmp</span><br><span class="line">		注解PathVariable</span><br><span class="line">	 if (employeeEcService.removeById(id)) &#123;</span><br><span class="line">            return RespBean.success(&quot;删除成功&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;删除失败&quot;);</span><br></pre></td></tr></table></figure>
<h1 id="员工数据导入导出"><a href="#员工数据导入导出" class="headerlink" title="员工数据导入导出"></a>员工数据导入导出</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">1⃣️引入easy poi依赖</span><br><span class="line">	 &lt;!--   easy poi依赖     --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;cn.afterturn&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;easypoi-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.1.3&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">2⃣️pojo-Employee加上easypoi注解</span><br><span class="line">		@ApiModelProperty(value &#x3D; &quot;性别&quot;)</span><br><span class="line">		@Excel(name &#x3D; &quot;性别&quot;)</span><br><span class="line">    private String gender;</span><br><span class="line">    with长度 format格式化</span><br><span class="line">   		@Excel(name &#x3D; &quot;出生日期&quot;, width &#x3D; 30, format &#x3D; &quot;yyyy-MM-dd&quot;)</span><br><span class="line"> 		跨实体类注解</span><br><span class="line"> 			@ApiModelProperty(value &#x3D; &quot;职位&quot;)</span><br><span class="line">      @TableField(exist &#x3D; false)</span><br><span class="line">      @ExcelEntity(name &#x3D; &quot;职位&quot;)</span><br><span class="line">      private Position position;</span><br><span class="line">      	进入到具体实体类加注解</span><br><span class="line">      		  @ApiModelProperty(value &#x3D; &quot;职位&quot;)</span><br><span class="line">            @Excel(name &#x3D; &quot;职位&quot;)</span><br><span class="line">            private String name;</span><br><span class="line">3⃣️导出数据</span><br><span class="line">	在EmployeeController新建exportEmployee方法</span><br><span class="line">		注解</span><br><span class="line">    	@ApiOperation(value &#x3D; &quot;导出员工数据&quot;)</span><br><span class="line">    	@GetMapping(value &#x3D; &quot;&#x2F;export&quot;,produces &#x3D; &quot;application&#x2F;octet-stream&quot;)</span><br><span class="line">		参数</span><br><span class="line">			HttpServletResponse response</span><br><span class="line">		注入</span><br><span class="line">			employeeService</span><br><span class="line">				新建方法getEmployee</span><br><span class="line">					将查询的数据存入List</span><br><span class="line">					ExportParams params &#x3D; new ExportParams(&quot;员工表&quot;, &quot;员工表&quot;, ExcelType.HSSF);</span><br><span class="line">        	Workbook workbook &#x3D; ExcelExportUtil.exportExcel(params, Employee.class, list);</span><br><span class="line">        	输出流</span><br><span class="line">        		ServletOutputStream out &#x3D; null;</span><br><span class="line">        		&#x2F;&#x2F;以流的形式传输</span><br><span class="line">            response.setHeader(&quot;content-type&quot;, &quot;application&#x2F;octet-stream&quot;);</span><br><span class="line">            &#x2F;&#x2F;防止中文乱码</span><br><span class="line">            response.setHeader(&quot;content-disposition&quot;, &quot;attachment;filename&#x3D;&quot; + URLEncoder.encode(&quot;员工表.xls&quot;, &quot;UTF-8&quot;));</span><br><span class="line">            out&#x3D;response.getOutputStream();</span><br><span class="line">            workbook.write(out);</span><br><span class="line">            </span><br><span class="line">		在IEmployeeService定义	getEmployee</span><br><span class="line">    在EmployeeServiceImpl实现 getEmployee</span><br><span class="line">    	注入employeeMapper</span><br><span class="line">    在EmployeeMapper 定义	getEmployee</span><br><span class="line">    在EmployeeMapper.xml实现sql，编写resultMap</span><br><span class="line">    	&lt;!--    导出员工数据--&gt;</span><br><span class="line">   	 &lt;select id&#x3D;&quot;getEmployee&quot; resultMap&#x3D;&quot;EmployeeInfo&quot;&gt;</span><br><span class="line">        SELECT e.*,</span><br><span class="line">        n.id AS nid,</span><br><span class="line">        n.&#96;name&#96; AS nname,</span><br><span class="line">        p.id AS pid,</span><br><span class="line">        p.&#96;name&#96; AS pname,</span><br><span class="line">        d.id AS did,</span><br><span class="line">        d.&#96;name&#96; AS dname,</span><br><span class="line">        j.id AS jid,</span><br><span class="line">        j.&#96;name&#96; AS jname,</span><br><span class="line">        pos.id AS posid,</span><br><span class="line">        pos.&#96;name&#96; AS posname</span><br><span class="line">        FROM t_employee e,</span><br><span class="line">        t_nation n,</span><br><span class="line">        t_politics_status p,</span><br><span class="line">        t_department d,</span><br><span class="line">        t_joblevel j,</span><br><span class="line">        t_position pos</span><br><span class="line">        WHERE e.nationId &#x3D; n.id</span><br><span class="line">        AND e.politicId &#x3D; p.id</span><br><span class="line">        AND e.departmentId &#x3D; d.id</span><br><span class="line">        AND e.jobLevelId &#x3D; j.id</span><br><span class="line">        AND e.posId &#x3D; pos.id</span><br><span class="line">        &lt;if test&#x3D;&quot;null!&#x3D;id&quot;&gt;</span><br><span class="line">            AND e.id &#x3D; #&#123;id&#125;</span><br><span class="line">        &lt;&#x2F;if&gt;</span><br><span class="line">        ORDER BY e.id</span><br><span class="line">    	&lt;&#x2F;select&gt;</span><br><span class="line">    	</span><br><span class="line">    	&lt;resultMap id&#x3D;&quot;EmployeeInfo&quot; type&#x3D;&quot;com.zoux.server.pojo.Employee&quot; extends&#x3D;&quot;BaseResultMap&quot;&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;nation&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Nation&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;nid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;nname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;association&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;politicsStatus&quot; javaType&#x3D;&quot;com.zoux.server.pojo.PoliticsStatus&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;pid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;pname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;association&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;department&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Department&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;did&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;dname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;association&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;joblevel&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Joblevel&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;jid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;jname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;association&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;position&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Position&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;posid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;posname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;association&gt;</span><br><span class="line">    	&lt;&#x2F;resultMap&gt;</span><br><span class="line">3⃣️导入数据    	</span><br><span class="line">	修改pojo类 Nation PoliticsStatus Department Joblevel Position</span><br><span class="line">		修改@EqualsAndHashCode(callSuper &#x3D; false,of &#x3D; &quot;name&quot;)</span><br><span class="line">			重写关于name的equals和hashcode方法</span><br><span class="line">		加入@NoArgsConstructor</span><br><span class="line">		加入@RequiredArgsConstructor</span><br><span class="line">		在属性name加上非空注解@NonNull</span><br><span class="line">	在EmployeeController类里面新建importEmployee方法</span><br><span class="line">  	注解</span><br><span class="line">  		 @ApiOperation(value &#x3D; &quot;导入员工数据&quot;)</span><br><span class="line">   		 @PostMapping(&quot;&#x2F;import&quot;)</span><br><span class="line">   	入参</span><br><span class="line">    	MultipartFile file</span><br><span class="line">    准备即将名字转id集合</span><br><span class="line">   	 List&lt;Nation&gt; nationList &#x3D; nationService.list();</span><br><span class="line">   	导入参数</span><br><span class="line">    	ImportParams params &#x3D; new ImportParams();</span><br><span class="line">    去掉标题行</span><br><span class="line">    	params.setTitleRows(1);</span><br><span class="line">    excel import 工具类 	</span><br><span class="line">    	List&lt;Employee&gt; list &#x3D; ExcelImportUtil.importExcel(file.getInputStream(), Employee.class, params);</span><br><span class="line">    将子表名称转换为id</span><br><span class="line">    	list.forEach(employee -&gt; &#123;</span><br><span class="line">    		名族id</span><br><span class="line">     		employee.setNationId(nationList.get(nationList.indexOf(new Nation(employee.getNation().getName()))).getId());</span><br><span class="line">    	&#125;);</span><br><span class="line">    保存数据集合</span><br><span class="line">    	employeeService.saveBatch(list)</span><br></pre></td></tr></table></figure>
<h1 id="邮件功能"><a href="#邮件功能" class="headerlink" title="邮件功能"></a>邮件功能</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">1⃣️开启邮箱SMTP服务</span><br><span class="line">	以qq邮箱为例</span><br><span class="line">		网页登陆-&gt;账户-&gt;POP3&#x2F;IMAP&#x2F;SMTP&#x2F;Exchange&#x2F;CardDAV&#x2F;CalDAV服务-&gt;开启SMTP服务</span><br><span class="line">2⃣️新建module</span><br><span class="line">	maven-quickstart</span><br><span class="line">		pom修改</span><br><span class="line">			关联sever</span><br><span class="line">				&lt;parent&gt;</span><br><span class="line">          &lt;groupId&gt;com.zoux&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;yeb-server&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    		&lt;&#x2F;parent&gt;</span><br><span class="line">    	sourceEncoding-UTF-8</span><br><span class="line">      source-1.8</span><br><span class="line">      target-1.8</span><br><span class="line">      rabbitmq 依赖</span><br><span class="line">      mail依赖</span><br><span class="line">      thymeleaf 依赖 </span><br><span class="line">      server依赖</span><br><span class="line">3⃣️新建配置文件resources&#x2F;config&#x2F;appicatioon.xml</span><br><span class="line">	端口配置</span><br><span class="line">	邮件配置</span><br><span class="line">	rabbitmq配置</span><br><span class="line">4⃣️添加启动类</span><br><span class="line">		MailApplication</span><br><span class="line">			注解SpringBootApplication</span><br><span class="line">			main方法</span><br><span class="line">				SpringApplication.run(MailApplication.class, args);</span><br><span class="line">4⃣️创建邮件模版resources&#x2F;templates&#x2F;mail.html</span><br><span class="line">	&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot; xmlns:th&#x3D;&quot;http:&#x2F;&#x2F;www.thymeleaf.org&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;入职欢迎邮件&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    欢迎 &lt;span th:text&#x3D;&quot;$&#123;name&#125;&quot;&gt;&lt;&#x2F;span&gt; 加入 XXXX 大家庭，您的入职信息如下：</span><br><span class="line">    &lt;table border&#x3D;&quot;1&quot;&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;姓名&lt;&#x2F;td&gt;</span><br><span class="line">            &lt;td th:text&#x3D;&quot;$&#123;name&#125;&quot;&gt;&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;&#x2F;tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;职位&lt;&#x2F;td&gt;</span><br><span class="line">            &lt;td th:text&#x3D;&quot;$&#123;posName&#125;&quot;&gt;&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;&#x2F;tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;职称&lt;&#x2F;td&gt;</span><br><span class="line">            &lt;td th:text&#x3D;&quot;$&#123;joblevelName&#125;&quot;&gt;&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;&#x2F;tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;部门&lt;&#x2F;td&gt;</span><br><span class="line">            &lt;td th:text&#x3D;&quot;$&#123;departmentName&#125;&quot;&gt;&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;&#x2F;tr&gt;</span><br><span class="line">    &lt;&#x2F;table&gt;</span><br><span class="line">    &lt;p&gt;我们公司的工作忠旨是严格，创新，诚信，您的加入将为我们带来新鲜的血液，带来创新的思维，以及为</span><br><span class="line">        我们树立良好的公司形象!希望在以后的工作中我们能够齐心协力，与时俱进，团结协作!同时也祝您在本公</span><br><span class="line">        司，工作愉快，实现自己的人生价值!希望在未来的日子里，携手共进！&lt;&#x2F;p&gt;</span><br><span class="line">		&lt;&#x2F;body&gt;</span><br><span class="line">		&lt;&#x2F;html&gt;</span><br><span class="line">5⃣️在yeb-server添加</span><br><span class="line">	pom依赖rabbitmq</span><br><span class="line">	application.xml配置</span><br><span class="line">6⃣️在EmployeeServiceImpl的addEmp里面加入邮件发送</span><br><span class="line">	注入rabbitTemplate</span><br><span class="line">		Employee emp &#x3D; employeeMapper.getEmployee(employee.getId()).get(0);</span><br><span class="line">    rabbitTemplate.convertAndSend(&quot;mail.welcome&quot;,emp);</span><br><span class="line">    此时，Employee需要实现Serializable</span><br><span class="line">7⃣️在yeb-mail新建MailReceiver    </span><br><span class="line">	注入</span><br><span class="line">	mailProperties</span><br><span class="line">	templateEngine</span><br><span class="line">	javaMailSender</span><br><span class="line">	添加方法handler</span><br><span class="line">		注解</span><br><span class="line">		@RabbitListener(queues &#x3D; &quot;mail.welcome&quot;)</span><br><span class="line">		定义邮件内容</span><br><span class="line">		MimeMessage msg &#x3D; javaMailSender.createMimeMessage();</span><br><span class="line">    MimeMessageHelper helper &#x3D; new MimeMessageHelper(msg);</span><br><span class="line">        try &#123;</span><br><span class="line">            helper.setFrom(mailProperties.getUsername());</span><br><span class="line">            helper.setTo(employee.getEmail());</span><br><span class="line">            helper.setSubject(&quot;入职邮件&quot;);</span><br><span class="line">            helper.setSentDate(new Date());</span><br><span class="line">            Context context &#x3D; new Context();</span><br><span class="line">            context.setVariable(&quot;name&quot;, employee.getName());</span><br><span class="line">            context.setVariable(&quot;posName&quot;, employee.getPosition().getName());</span><br><span class="line">            context.setVariable(&quot;joblevelName&quot;, employee.getJoblevel().getName());</span><br><span class="line">            context.setVariable(&quot;departmentName&quot;, employee.getDepartment().getName());</span><br><span class="line">            String mail &#x3D; templateEngine.process(&quot;mail&quot;, context);</span><br><span class="line">            helper.setText(mail, true);</span><br><span class="line">            javaMailSender.send(msg);</span><br><span class="line">        &#125; catch (MessagingException e) &#123;</span><br><span class="line">            LOGGER.error(&quot;MailReceiver + 邮件发送失败&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#125;&quot;, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">8⃣️在MailApplication编写</span><br><span class="line">	添加队列</span><br><span class="line">	@Bean</span><br><span class="line">    public Queue queue()&#123;</span><br><span class="line">        return new Queue(&quot;mail.welcome&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">9⃣️在MailApplication添加注解忽略数据库配置资源</span><br><span class="line">	@SpringBootApplication(exclude &#x3D; &#123;DataSourceAutoConfiguration.class&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="生产端可靠投递方案介绍"><a href="#生产端可靠投递方案介绍" class="headerlink" title="生产端可靠投递方案介绍"></a>生产端可靠投递方案介绍</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">解偶</span><br><span class="line">异步</span><br><span class="line">流量区分</span><br><span class="line">考虑消息的可靠性</span><br><span class="line">	保证生产端消息的可靠性投递，是否真真切切的投递到了队列或者给消费者消费了</span><br><span class="line">	 保证消息的成功发出 </span><br><span class="line">	 rabbitmq队列成功的接收到消息</span><br><span class="line">	 发送端能够获得rabbitmq确认应答</span><br><span class="line">	消费者怎么做幂等性保证，一条消息重复多发，只消费一条消息	</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="开启消息回调机制"><a href="#开启消息回调机制" class="headerlink" title="开启消息回调机制"></a>开启消息回调机制</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1⃣️新建pojo类MailConstants</span><br><span class="line">	定义常量</span><br><span class="line">2⃣️修改EmployeeServiceImpl&#x2F;addEmp</span><br><span class="line">	注入mailLogMapper</span><br><span class="line">	在发送消息之间加入消息回调</span><br><span class="line">	数据库记录发送的消息</span><br><span class="line">  	MailLog</span><br><span class="line">  发送信息</span><br><span class="line">  rabbitTemplate.convertAndSend(MailConstants.MAIL_EXCHANGE_NAME,</span><br><span class="line">                    MailConstants.MAIL_ROUTING_KEY_NAME,</span><br><span class="line">                    emp,</span><br><span class="line">                    new CorrelationData(msgId));</span><br><span class="line">3⃣️更改MailApplication</span><br><span class="line">  	return new Queue(MailConstants.MAIL_QUEUE_NAME);</span><br><span class="line">4⃣️更改MailReceiver</span><br><span class="line"> 		@RabbitListener(queues &#x3D; MailConstants.MAIL_QUEUE_NAME)监听</span><br><span class="line">5⃣️添加rabbitMQ配置类 RabbitMQConfig</span><br><span class="line">	注入</span><br><span class="line">    cachingConnectionFactory</span><br><span class="line">    mailLogService</span><br><span class="line">	定义常量</span><br><span class="line">		public static final Logger logger &#x3D; LoggerFactory.getLogger(RabbitMQConfig.class);	</span><br><span class="line">	引入Bean</span><br><span class="line">    Binding</span><br><span class="line">    DirectExchange</span><br><span class="line">    Queue	</span><br><span class="line">    RabbitTemplate</span><br><span class="line">6⃣️添加application.xml配置</span><br><span class="line">	 rabbitmq:</span><br><span class="line">    username: guest</span><br><span class="line">    password: guest</span><br><span class="line">    host: localhost</span><br><span class="line">    port: 5672</span><br><span class="line">    # 消息失败回调</span><br><span class="line">    publisher-returns: true</span><br><span class="line">    # 消息确认回调</span><br><span class="line">    publisher-confirm-type: correlated</span><br></pre></td></tr></table></figure>
<p>注入Bean详情</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Queue <span class="title">queue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Queue(MailConstants.MAIL_QUEUE_NAME);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DirectExchange <span class="title">directExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(MailConstants.MAIL_EXCHANGE_NAME);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">binding</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue()).to(directExchange()).with(MailConstants.MAIL_ROUTING_KEY_NAME);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RabbitTemplate <span class="title">rabbitTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        RabbitTemplate rabbitTemplate = <span class="keyword">new</span>  RabbitTemplate(cachingConnectionFactory);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 消息确认回调,确认消息是否到达broker</span></span><br><span class="line"><span class="comment">         * data:消息唯一标识</span></span><br><span class="line"><span class="comment">         * ack：确认结果</span></span><br><span class="line"><span class="comment">         * cause：失败原因</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        rabbitTemplate.setConfirmCallback((data,ack,cause)-&gt;&#123;</span><br><span class="line">            String msgId = data.getId();</span><br><span class="line">            System.out.println(<span class="string">&quot;RabbitMQConfig: msgId = &quot;</span> + msgId);</span><br><span class="line">            <span class="keyword">if</span> (ack)&#123;</span><br><span class="line">                logger.info(<span class="string">&quot;&#123;&#125;==========&gt;消息发送成功&quot;</span>,msgId);</span><br><span class="line">                <span class="comment">//更数据库数据状态</span></span><br><span class="line">                mailLogService.update(<span class="keyword">new</span> UpdateWrapper&lt;MailLog&gt;().set(<span class="string">&quot;status&quot;</span>,<span class="number">1</span>).eq(<span class="string">&quot;msgId&quot;</span>,msgId));</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                logger.error(<span class="string">&quot;&#123;&#125;==========&gt;消息发送失败&quot;</span>,msgId);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 消息失败回调，比如router不到queue时回调</span></span><br><span class="line"><span class="comment">         * msg:消息主题</span></span><br><span class="line"><span class="comment">         * repCode:响应码</span></span><br><span class="line"><span class="comment">         * repText:响应描述</span></span><br><span class="line"><span class="comment">         * exchange:交换机</span></span><br><span class="line"><span class="comment">         * routingKey:路由键</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        rabbitTemplate.setReturnCallback((msg,repCode,repText,exchange,routingKey)-&gt;&#123;</span><br><span class="line">            logger.error(<span class="string">&quot;&#123;&#125;=======================&gt;消息发送到queue时失败&quot;</span>,msg.getBody());</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> rabbitTemplate;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<hr>
<h1 id="生产端消息投递可靠性实现"><a href="#生产端消息投递可靠性实现" class="headerlink" title="生产端消息投递可靠性实现"></a>生产端消息投递可靠性实现</h1><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1⃣️准备包task新建类MailTask</span><br><span class="line">	注解</span><br><span class="line">		Component</span><br><span class="line">	注入</span><br><span class="line">		employeeService</span><br><span class="line">		rabbitTemplate</span><br><span class="line">		mailLogService</span><br><span class="line">	设置定时任务</span><br><span class="line">  	@Scheduled(cron &#x3D; &quot;0&#x2F;10 * * * * ?&quot;) 邮件发送定时任务 10秒一次</span><br><span class="line">  新建方法mailTask</span><br><span class="line">  	判断重试条件</span><br><span class="line">  		状态为0且重试时间小于当前时间的才需要重新发送</span><br><span class="line">  		重试次数超过3次，更新为投递失败，不再重试</span><br><span class="line">  	将上述操作记录到数据库</span><br><span class="line">    	更新重试次数，更新时间，重试时间</span><br><span class="line">    最后重发信息</span><br><span class="line">2⃣️开启定时任务</span><br><span class="line">	YebAppication启动类</span><br><span class="line">		注解</span><br><span class="line">			@EnableScheduling</span><br><span class="line">3⃣️测试</span><br><span class="line">	正常添加员工测试</span><br><span class="line">	测试失败</span><br><span class="line">		单次失败 </span><br><span class="line">			修改EmployeeServiceImpl发送邮件信息参数 交换机名称</span><br><span class="line">			丢失路由，发送失败，就会走定时任务，定时任务是正确的交换机名称</span><br><span class="line">		多次失败</span><br><span class="line">    	修改EmployeeServiceImpl发送邮件信息参数 交换机名称</span><br><span class="line">			修改定时任务交换机名称。</span><br></pre></td></tr></table></figure>
<p>MailTask</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line">import com.baomidou.mybatisplus.core.conditions.update.UpdateWrapper;</span><br><span class="line">import com.zoux.server.pojo.Employee;</span><br><span class="line">import com.zoux.server.pojo.MailConstants;</span><br><span class="line">import com.zoux.server.pojo.MailLog;</span><br><span class="line">import com.zoux.server.service.IEmployeeService;</span><br><span class="line">import com.zoux.server.service.IMailLogService;</span><br><span class="line">import org.springframework.amqp.rabbit.connection.CorrelationData;</span><br><span class="line">import org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 邮件发送定时任务</span><br><span class="line"> *</span><br><span class="line"> * @author zahnglishen</span><br><span class="line"> * @since 1.0.0</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Component</span><br><span class="line">public class MailTask &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private IMailLogService mailLogService;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RabbitTemplate rabbitTemplate;</span><br><span class="line">    @Autowired</span><br><span class="line">    private IEmployeeService employeeService;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 邮件发送定时任务</span><br><span class="line">     * 10秒一次</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Scheduled(cron &#x3D; &quot;0&#x2F;10 * * * * ?&quot;)</span><br><span class="line">    public void mailTask()&#123;</span><br><span class="line">        &#x2F;&#x2F;状态为0且重试时间小于当前时间的才需要重新发送</span><br><span class="line">        List&lt;MailLog&gt; list &#x3D; mailLogService.list(</span><br><span class="line">                new QueryWrapper&lt;MailLog&gt;()</span><br><span class="line">                        .eq(&quot;status&quot;, 0)</span><br><span class="line">                        .lt(&quot;tryTime&quot;,</span><br><span class="line">                        LocalDateTime.now()));</span><br><span class="line">        list.forEach(mailLog -&gt; &#123;</span><br><span class="line">            &#x2F;&#x2F;重试次数超过3次，更新为投递失败，不再重试</span><br><span class="line">            if (3 &lt;&#x3D; mailLog.getCount())&#123;</span><br><span class="line">                mailLogService.update(</span><br><span class="line">                        new UpdateWrapper&lt;MailLog&gt;().</span><br><span class="line">                        set(&quot;status&quot;,2).</span><br><span class="line">                        eq(&quot;msgId&quot;, mailLog.getMsgId()));</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F;更新重试次数，更新时间，重试时间</span><br><span class="line">            mailLogService.update(</span><br><span class="line">                    new UpdateWrapper&lt;MailLog&gt;()</span><br><span class="line">                            .set(&quot;count&quot;,mailLog.getCount()+1)</span><br><span class="line">                            .set(&quot;updateTime&quot;,LocalDateTime.now())</span><br><span class="line">                            .set(&quot;tryTime&quot;,LocalDateTime.now() .plusMinutes(MailConstants.MSG_TIMEOUT))</span><br><span class="line">                            .eq(&quot;msgId&quot;,mailLog.getMsgId()));</span><br><span class="line">            Employee employee &#x3D; employeeService.getEmployee(mailLog.getEid()).get(0);</span><br><span class="line">            System.out.println(&quot;MailTask: employee &#x3D; &quot; + employee );</span><br><span class="line">            System.out.println(&quot;MailTask: msgId: &quot; + mailLog.getMsgId());</span><br><span class="line">            &#x2F;&#x2F;发送消息</span><br><span class="line">            rabbitTemplate.convertAndSend(MailConstants.MAIL_EXCHANGE_NAME,MailConstants.MAIL_ROUTING_KEY_NAME,employee,new CorrelationData(mailLog.getMsgId()));</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="消费端幂等性"><a href="#消费端幂等性" class="headerlink" title="消费端幂等性"></a>消费端幂等性</h1><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">1⃣️rabbitMQ开启手动确认</span><br><span class="line">	yeb-mail&#x2F;application.xml</span><br><span class="line">		listener:</span><br><span class="line">      simple:</span><br><span class="line">        #开启手动确认</span><br><span class="line">        acknowledge-mode: manual</span><br><span class="line">2⃣️yeb-mail&#x2F;application.xml</span><br><span class="line">	加入redis配置</span><br><span class="line">		redis:</span><br><span class="line">    #超时时间</span><br><span class="line">    timeout: 10000ms</span><br><span class="line">    #服务器地址</span><br><span class="line">    host: 47.100.92.101</span><br><span class="line">    #服务器端口</span><br><span class="line">    port: 6379</span><br><span class="line">    database: 0</span><br><span class="line">    #    password: root</span><br><span class="line">    lettuce:</span><br><span class="line">      #默认连接数，默认是8</span><br><span class="line">      max-active: 1024</span><br><span class="line">      #最大连接阻塞等待时间</span><br><span class="line">      max-wait: 1000ms</span><br><span class="line">      #最大空闲连接</span><br><span class="line">      max-idle: 200</span><br><span class="line">      #最小空闲连接</span><br><span class="line">      min-idle: 5</span><br><span class="line">3⃣️修改MailReceiver</span><br><span class="line">	注入</span><br><span class="line">	redisTemplate</span><br><span class="line">	改变handler方法参数</span><br><span class="line">		Message message, Channel channel</span><br><span class="line">	获取employee</span><br><span class="line">		Employee employee &#x3D; (Employee) message.getPayload();</span><br><span class="line">	获取消息序号</span><br><span class="line">  	 MessageHeaders headers &#x3D; message.getHeaders();</span><br><span class="line">     long tag &#x3D; (long) headers.get(AmqpHeaders.DELIVERY_TAG);</span><br><span class="line">  获取msgId</span><br><span class="line">  	 String msgId &#x3D; (String) headers.get(&quot;spring_returned_message_correlation&quot;);</span><br><span class="line">  存入redis</span><br><span class="line">  		HashOperations hash &#x3D; redisTemplate.opsForHash();</span><br><span class="line">  第一次发送邮件时将消息id存入redis</span><br><span class="line">  		LOGGER.info(&quot;邮件发送成功&quot;);</span><br><span class="line">       将消息id存入redis</span><br><span class="line">       hash.put(&quot;mail_log&quot;, msgId, &quot;OK&quot;);</span><br><span class="line">       手动确认消息</span><br><span class="line">       channel.basicAck(tag, false);</span><br><span class="line">  判断信息是否已经消费</span><br><span class="line">  	hash.entries(&quot;mail_log&quot;).containsKey(msgId)</span><br><span class="line">  	确认直接返回不做操作</span><br><span class="line">4⃣️总结</span><br><span class="line">	消息可靠性</span><br><span class="line">		一方面，生产端保证消息被正确的送达，采用了消息落库，开启确认回调以及失败回调加上定时任务</span><br><span class="line">		一方面，幂等性，在redis存入消息id，然后根据这个id去判断，如果id存在，说明这个数据已经被消费了。</span><br></pre></td></tr></table></figure>
<p>MailReceiver详情</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">import com.zoux.server.pojo.Employee;</span><br><span class="line">import com.zoux.server.pojo.MailConstants;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line">import org.springframework.amqp.support.AmqpHeaders;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.autoconfigure.mail.MailProperties;</span><br><span class="line">import org.springframework.data.redis.core.HashOperations;</span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">import org.springframework.mail.javamail.JavaMailSender;</span><br><span class="line">import org.springframework.mail.javamail.MimeMessageHelper;</span><br><span class="line">import org.springframework.messaging.MessageHeaders;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.thymeleaf.TemplateEngine;</span><br><span class="line">import org.thymeleaf.context.Context;</span><br><span class="line">import com.rabbitmq.client.Channel;</span><br><span class="line"></span><br><span class="line">import javax.mail.MessagingException;</span><br><span class="line">import javax.mail.internet.MimeMessage;</span><br><span class="line"></span><br><span class="line">import org.springframework.messaging.Message;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 消息接收者</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class MailReceiver &#123;</span><br><span class="line">    private static final Logger LOGGER &#x3D; LoggerFactory.getLogger(MailReceiver.class);</span><br><span class="line">    @Autowired</span><br><span class="line">    private MailProperties mailProperties;</span><br><span class="line">    @Autowired</span><br><span class="line">    private TemplateEngine templateEngine;</span><br><span class="line">    @Autowired</span><br><span class="line">    private JavaMailSender javaMailSender;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    @RabbitListener(queues &#x3D; MailConstants.MAIL_QUEUE_NAME)</span><br><span class="line">    public void handler(Message message, Channel channel) &#123;</span><br><span class="line">        Employee employee &#x3D; (Employee) message.getPayload();</span><br><span class="line">        MessageHeaders headers &#x3D; message.getHeaders();</span><br><span class="line">        &#x2F;&#x2F;消息序号</span><br><span class="line">        long tag &#x3D; (long) headers.get(AmqpHeaders.DELIVERY_TAG);</span><br><span class="line">        String msgId &#x3D; (String) headers.get(&quot;spring_returned_message_correlation&quot;);</span><br><span class="line">        HashOperations hash &#x3D; redisTemplate.opsForHash();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            if (hash.entries(&quot;mail_log&quot;).containsKey(msgId)) &#123;</span><br><span class="line">                &#x2F;&#x2F;redis中包含key，说明消息已经被消费</span><br><span class="line">                LOGGER.error(&quot;消息已经被消费&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;&#123;&#125;&quot;, msgId);</span><br><span class="line">                &#x2F;**</span><br><span class="line">                 * 手动确认消息</span><br><span class="line">                 * tag:消息序号</span><br><span class="line">                 * multiple:是否多条</span><br><span class="line">                 *&#x2F;</span><br><span class="line">                channel.basicAck(tag, false);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            MimeMessage msg &#x3D; javaMailSender.createMimeMessage();</span><br><span class="line">            MimeMessageHelper helper &#x3D; new MimeMessageHelper(msg);</span><br><span class="line">            helper.setFrom(mailProperties.getUsername());</span><br><span class="line">            helper.setTo(employee.getEmail());</span><br><span class="line">            helper.setSubject(&quot;入职邮件&quot;);</span><br><span class="line">            helper.setSentDate(new Date());</span><br><span class="line">            Context context &#x3D; new Context();</span><br><span class="line">            context.setVariable(&quot;name&quot;, employee.getName());</span><br><span class="line">            context.setVariable(&quot;posName&quot;, employee.getPosition().getName());</span><br><span class="line">            context.setVariable(&quot;joblevelName&quot;, employee.getJoblevel().getName());</span><br><span class="line">            context.setVariable(&quot;departmentName&quot;, employee.getDepartment().getName());</span><br><span class="line">            String mail &#x3D; templateEngine.process(&quot;mail&quot;, context);</span><br><span class="line">            helper.setText(mail, true);</span><br><span class="line">            &#x2F;&#x2F;发送邮件</span><br><span class="line">            javaMailSender.send(msg);</span><br><span class="line">            LOGGER.info(&quot;邮件发送成功&quot;);</span><br><span class="line">            &#x2F;&#x2F;将消息id存入redis</span><br><span class="line">            hash.put(&quot;mail_log&quot;, msgId, &quot;OK&quot;);</span><br><span class="line">            &#x2F;&#x2F;手动确认消息</span><br><span class="line">            channel.basicAck(tag, false);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                &#x2F;**</span><br><span class="line">                 * 手动确认信息</span><br><span class="line">                 * tag 消息序号</span><br><span class="line">                 * multiple 是否确认多条</span><br><span class="line">                 * requeue 是否退回队列</span><br><span class="line">                 *&#x2F;</span><br><span class="line">                channel.basicNack(tag, false, true);</span><br><span class="line">            &#125; catch (IOException ioException) &#123;</span><br><span class="line">                LOGGER.error(&quot;MailReceiver + 邮件发送失败&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#125;&quot;, e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">            LOGGER.error(&quot;MailReceiver + 邮件发送失败&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#125;&quot;, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="工资帐套管理实现"><a href="#工资帐套管理实现" class="headerlink" title="工资帐套管理实现"></a>工资帐套管理实现</h1><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1⃣️更改pojo类Salary属性时间格式</span><br><span class="line">	在时间相关属性上加注解</span><br><span class="line">    @JsonFormat(pattern &#x3D; &quot;yyyy-MM-dd&quot;,timezone &#x3D; &quot;Asia&#x2F;shanghai&quot;)</span><br><span class="line">2⃣️更改SalaryController</span><br><span class="line">	注解路径“&#x2F;salary&#x2F;sob”</span><br><span class="line">	增</span><br><span class="line">		@PostMapping(&quot;&#x2F;&quot;)</span><br><span class="line">	删</span><br><span class="line">		@DeleteMapping(&quot;&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">	改</span><br><span class="line">		@PutMapping(&quot;&#x2F;&quot;)</span><br><span class="line">	查</span><br><span class="line">		@GetMapping(&quot;&#x2F;&quot;)		</span><br></pre></td></tr></table></figure>
<p>SalaryController详情</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">import com.zoux.server.pojo.RespBean;</span><br><span class="line">import com.zoux.server.pojo.Salary;</span><br><span class="line">import com.zoux.server.service.ISalaryService;</span><br><span class="line">import io.swagger.annotations.ApiOperation;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * 前端控制器</span><br><span class="line"> * &lt;&#x2F;p&gt;</span><br><span class="line"> *</span><br><span class="line"> * @author zoux</span><br><span class="line"> * @since 2021-02-13</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;&#x2F;salary&#x2F;sob&quot;)</span><br><span class="line">public class SalaryController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private ISalaryService salaryService;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;获取所有工资套账&quot;)</span><br><span class="line">    @GetMapping(&quot;&#x2F;&quot;)</span><br><span class="line">    public List&lt;Salary&gt; getAllSalary() &#123;</span><br><span class="line">        return salaryService.list();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;添加工资套账&quot;)</span><br><span class="line">    @PostMapping(&quot;&#x2F;&quot;)</span><br><span class="line">    public RespBean addSalary(@RequestBody Salary salary) &#123;</span><br><span class="line">        salary.setCreateDate(LocalDateTime.now());</span><br><span class="line">        if (salaryService.save(salary)) &#123;</span><br><span class="line">            return RespBean.success(&quot;添加成功&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;添加失败&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;删除工资套账&quot;)</span><br><span class="line">    @DeleteMapping(&quot;&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    public RespBean deleteSalary(@PathVariable Integer id) &#123;</span><br><span class="line">        if (salaryService.removeById(id)) &#123;</span><br><span class="line">            return RespBean.success(&quot;删除成功&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;删除失败&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;更新工资套账&quot;)</span><br><span class="line">    @PutMapping(&quot;&#x2F;&quot;)</span><br><span class="line">    public RespBean updateSalary(@RequestBody Salary salary) &#123;</span><br><span class="line">        if (salaryService.updateById(salary)) &#123;</span><br><span class="line">            return RespBean.success(&quot;更新成功&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;更新失败&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<hr>
<h1 id="员工帐套管理实现"><a href="#员工帐套管理实现" class="headerlink" title="员工帐套管理实现"></a>员工帐套管理实现</h1><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1⃣️新建类SalarySobCfgController</span><br><span class="line">	注解	</span><br><span class="line">		@RequestMapping(&quot;&#x2F;salary&#x2F;sobcfg&quot;)</span><br><span class="line">		@RestController</span><br><span class="line">	注入</span><br><span class="line">  	employeeService</span><br><span class="line">  	salaryService</span><br><span class="line">  新建方法</span><br><span class="line">  	获取所有员工套账</span><br><span class="line">  	获取所有工资套账</span><br><span class="line">  	更新员工套账</span><br><span class="line">2⃣️getEmployeeWithSalary需要自定义</span><br><span class="line">	IEmployeeService-&gt;EmployeeServiceImpl-&gt;EmployeeMapper-&gt;EmployeeMapper.xml</span><br><span class="line">3⃣️在pojo-Employee定义，以便用于xml</span><br><span class="line">	@ApiModelProperty(value &#x3D; &quot;工资帐套&quot;)</span><br><span class="line">  @TableField(exist &#x3D; false)</span><br><span class="line">  private Salary salary;</span><br></pre></td></tr></table></figure>
<p>SalarySobCfgController详情</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">import com.baomidou.mybatisplus.core.conditions.update.UpdateWrapper;</span><br><span class="line">import com.zoux.server.pojo.Employee;</span><br><span class="line">import com.zoux.server.pojo.RespBean;</span><br><span class="line">import com.zoux.server.pojo.RespPageBean;</span><br><span class="line">import com.zoux.server.pojo.Salary;</span><br><span class="line">import com.zoux.server.service.IEmployeeService;</span><br><span class="line">import com.zoux.server.service.ISalaryService;</span><br><span class="line">import io.swagger.annotations.ApiOperation;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@RequestMapping(&quot;&#x2F;salary&#x2F;sobcfg&quot;)</span><br><span class="line">@RestController</span><br><span class="line">public class SalarySobCfgController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private ISalaryService salaryService;</span><br><span class="line">    @Autowired</span><br><span class="line">    private IEmployeeService employeeService;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;获取所有员工套账&quot;)</span><br><span class="line">    @GetMapping(&quot;&#x2F;&quot;)</span><br><span class="line">    public RespPageBean getEmployeeWithSalary(@RequestParam(defaultValue &#x3D; &quot;1&quot;) Integer currentPage,@RequestParam(defaultValue &#x3D; &quot;10&quot;) Integer size)&#123;</span><br><span class="line">        return employeeService.getEmployeeWithSalary(currentPage,size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;获取所有工资套账&quot;)</span><br><span class="line">    @GetMapping(&quot;&#x2F;salaries&quot;)</span><br><span class="line">    public List&lt;Salary&gt; getAllSalary()&#123;</span><br><span class="line">        return salaryService.list();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;更新员工套账&quot;)</span><br><span class="line">    @PutMapping(&quot;&#x2F;&quot;)</span><br><span class="line">    public RespBean updateEmployeeSalary(Integer eid,Integer sid)&#123;</span><br><span class="line">        if (employeeService.update(new UpdateWrapper&lt;Employee&gt;().set(&quot;salaryId&quot;,sid).eq(&quot;id&quot;,eid)))&#123;</span><br><span class="line">            return RespBean.success(&quot;更新成功&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;更新失败&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>EmployeeServiceImpl详情</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 获取所有员工套账</span><br><span class="line">     *</span><br><span class="line">     * @param currentPage</span><br><span class="line">     * @param size</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public RespPageBean getEmployeeWithSalary(Integer currentPage, Integer size) &#123;</span><br><span class="line">        &#x2F;&#x2F;开启分页</span><br><span class="line">        Page&lt;Employee&gt; page &#x3D; new Page&lt;&gt;(currentPage, size);</span><br><span class="line"></span><br><span class="line">        IPage&lt;Employee&gt; employeeIPage &#x3D; employeeMapper.getEmployeeWithSalary(page);</span><br><span class="line">        RespPageBean respPageBean &#x3D; new RespPageBean(employeeIPage.getTotal(), employeeIPage.getRecords());</span><br><span class="line">        return respPageBean;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>EmployeeMapper.xml详情</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--    获取所有员工套账--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;getEmployeeWithSalary&quot; resultMap&#x3D;&quot;EmployeeWithSalary&quot;&gt;</span><br><span class="line">        SELECT e.*,</span><br><span class="line">               td.&#96;name&#96;              as dname,</span><br><span class="line">               s.id                   AS sid,</span><br><span class="line">               s.&#96;name&#96;               AS sname,</span><br><span class="line">               s.basicSalary          AS sbasicSalary,</span><br><span class="line">               s.trafficSalary        AS strafficSalary,</span><br><span class="line">               s.lunchSalary          AS slunchSalary,</span><br><span class="line">               s.bonus                AS sbonus,</span><br><span class="line">               s.allSalary            AS sallSalary,</span><br><span class="line">               s.pensionPer           AS spensionPer,</span><br><span class="line">               s.pensionBase          AS spensionBase,</span><br><span class="line">               s.medicalPer           AS smedicalPer,</span><br><span class="line">               s.medicalBase          AS smedicalBase,</span><br><span class="line">               s.accumulationFundPer  AS saccumulationFundPer,</span><br><span class="line">               s.accumulationFundBase AS saccumulationFundBase</span><br><span class="line">        FROM t_employee as e</span><br><span class="line">                 LEFT JOIN t_salary as s ON e.salaryId &#x3D; s.id</span><br><span class="line">                 LEFT JOIN t_department as td ON e.departmentId &#x3D; td.id</span><br><span class="line">        ORDER BY e.id</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;resultMap id&#x3D;&quot;EmployeeWithSalary&quot; type&#x3D;&quot;com.zoux.server.pojo.Employee&quot; extends&#x3D;&quot;BaseResultMap&quot;&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;salary&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Salary&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;sid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;sbasicSalary&quot; property&#x3D;&quot;basicSalary&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;sbonus&quot; property&#x3D;&quot;bonus&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;slunchSalary&quot; property&#x3D;&quot;lunchSalary&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;strafficSalary&quot; property&#x3D;&quot;trafficSalary&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;sallSalary&quot; property&#x3D;&quot;allSalary&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;spensionBase&quot; property&#x3D;&quot;pensionBase&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;spensionPer&quot; property&#x3D;&quot;pensionPer&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;smedicalBase&quot; property&#x3D;&quot;medicalBase&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;smedicalPer&quot; property&#x3D;&quot;medicalPer&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;saccumulationFundBase&quot;</span><br><span class="line">                    property&#x3D;&quot;accumulationFundBase&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;saccumulationFundPer&quot;</span><br><span class="line">                    property&#x3D;&quot;accumulationFundPer&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;sname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;association&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;department&quot;</span><br><span class="line">                     javaType&#x3D;&quot;com.zoux.server.pojo.Department&quot;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;dname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;association&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br></pre></td></tr></table></figure>


<hr>
<h1 id="WebSocket在线聊天功能实现"><a href="#WebSocket在线聊天功能实现" class="headerlink" title="WebSocket在线聊天功能实现"></a>WebSocket在线聊天功能实现</h1><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">最大特点，服务器可以主动向客户推送信息，客户端可以主动向服务器发信息，真正的双向平等对话</span><br><span class="line">1⃣️引入依赖yeb-server</span><br><span class="line">	&lt;!--websocket 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-websocket&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">2⃣️新建类WebSocketConfig，实现WebSocketMessageBrokerConfigurer</span><br><span class="line">	注解</span><br><span class="line">		@Configuration</span><br><span class="line">		@EnableWebSocketMessageBroker</span><br><span class="line">	重写三个方法</span><br><span class="line">  	registerStompEndpoints</span><br><span class="line">  	configureClientInboundChannel</span><br><span class="line">  		jwt令牌相关</span><br><span class="line">  	configureMessageBroker</span><br><span class="line">3⃣️新建pojo类-ChatMsg</span><br><span class="line">4⃣️新建WebSocketController</span><br><span class="line">5⃣️在SecurityConfig进行放行</span><br><span class="line">	&quot;&#x2F;ws&#x2F;**&quot;</span><br><span class="line">6⃣️新建类ChatController	</span><br></pre></td></tr></table></figure>
<p>WebSocketConfig详情</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">import com.zoux.server.config.security.component.JwtTokenUtil;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.messaging.Message;</span><br><span class="line">import org.springframework.messaging.MessageChannel;</span><br><span class="line">import org.springframework.messaging.simp.config.ChannelRegistration;</span><br><span class="line">import org.springframework.messaging.simp.config.MessageBrokerRegistry;</span><br><span class="line">import org.springframework.messaging.simp.stomp.StompCommand;</span><br><span class="line">import org.springframework.messaging.simp.stomp.StompHeaderAccessor;</span><br><span class="line">import org.springframework.messaging.support.ChannelInterceptor;</span><br><span class="line">import org.springframework.messaging.support.MessageHeaderAccessor;</span><br><span class="line">import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line">import org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line">import org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line">import org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line">import org.springframework.util.StringUtils;</span><br><span class="line">import org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;</span><br><span class="line">import org.springframework.web.socket.config.annotation.StompEndpointRegistry;</span><br><span class="line">import org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * WebSocket配置类</span><br><span class="line"> *</span><br><span class="line"> * @author zhanglishen</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@EnableWebSocketMessageBroker</span><br><span class="line">public class WebSocketConfig implements WebSocketMessageBrokerConfigurer &#123;</span><br><span class="line">    @Value(&quot;$&#123;jwt.tokenHead&#125;&quot;)</span><br><span class="line">    private String tokenHead;</span><br><span class="line">    @Autowired</span><br><span class="line">    private JwtTokenUtil jwtTokenUtil;</span><br><span class="line">    @Autowired</span><br><span class="line">    private UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 添加这个Endpoint，这样在网页可以通过websocket连接上服务</span><br><span class="line">     * 也就是我们配置websocket的服务地址，并且可以指定是否使用socketJS</span><br><span class="line">     * @param registry</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public void registerStompEndpoints(StompEndpointRegistry registry) &#123;</span><br><span class="line">        &#x2F;**</span><br><span class="line">         * 1.将ws&#x2F;ep路径注册为stomp的端点，用户连接了这个端点就可以进行websocket通讯，支持</span><br><span class="line">         socketJS</span><br><span class="line">         * 2.setAllowedOrigins(&quot;*&quot;)：允许跨域</span><br><span class="line">         * 3.withSockJS():支持socketJS访问</span><br><span class="line">         *&#x2F;</span><br><span class="line">        registry.addEndpoint(&quot;&#x2F;ws&#x2F;ep&quot;).setAllowedOrigins(&quot;*&quot;).withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 输入通道参数配置</span><br><span class="line">     * @param registration</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public void configureClientInboundChannel(ChannelRegistration registration) &#123;</span><br><span class="line">        registration.interceptors(new ChannelInterceptor() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public Message&lt;?&gt; preSend(Message&lt;?&gt; message, MessageChannel channel) &#123;</span><br><span class="line">                StompHeaderAccessor accessor &#x3D; MessageHeaderAccessor.getAccessor(message, StompHeaderAccessor.class);</span><br><span class="line">                &#x2F;&#x2F;判断是否为连接，如果是，需要获取token，并且设置用户对象</span><br><span class="line">                if (StompCommand.CONNECT.equals(accessor.getCommand()))&#123;</span><br><span class="line">                    &#x2F;&#x2F;客户端发来的</span><br><span class="line">                    String token &#x3D; accessor.getFirstNativeHeader(&quot;Auth-Token&quot;);</span><br><span class="line">                    if (!StringUtils.isEmpty(token))&#123;</span><br><span class="line">                        &#x2F;&#x2F;截取token，去掉前缀</span><br><span class="line">                        String authToken &#x3D; token.substring(tokenHead.length());</span><br><span class="line">                        &#x2F;&#x2F;获取用户名</span><br><span class="line">                        String username &#x3D; jwtTokenUtil.getUserNameFromToken(authToken);</span><br><span class="line">                        &#x2F;&#x2F;token中存在用户名</span><br><span class="line">                        if (!StringUtils.isEmpty(username))&#123;</span><br><span class="line">                            &#x2F;&#x2F;登录</span><br><span class="line">                            UserDetails userDetails &#x3D; userDetailsService.loadUserByUsername(username);</span><br><span class="line">                            &#x2F;&#x2F;验证token是否有效，重新设置用户对象</span><br><span class="line">                            if (jwtTokenUtil.validateToken(authToken,userDetails))&#123;</span><br><span class="line">                                UsernamePasswordAuthenticationToken authenticationToken &#x3D; new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());</span><br><span class="line">                                SecurityContextHolder.getContext().setAuthentication(authenticationToken);</span><br><span class="line">                                accessor.setUser(authenticationToken);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                return message;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 配置消息代理</span><br><span class="line">     * @param registry</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public void configureMessageBroker(MessageBrokerRegistry registry) &#123;</span><br><span class="line">        &#x2F;&#x2F;配置代理域，可以配置多个，配置代理目的地前缀为&#x2F;queue,可以在配置域上向客户端推送消息</span><br><span class="line">        registry.enableSimpleBroker(&quot;&#x2F;queue&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ChatMs详情</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">package com.zoux.server.pojo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.EqualsAndHashCode;</span><br><span class="line">import lombok.experimental.Accessors;</span><br><span class="line">import org.springframework.security.core.parameters.P;</span><br><span class="line"></span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 消息</span><br><span class="line"> *</span><br><span class="line"> * @author zoux</span><br><span class="line"> * @since 1.0.0</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">@Accessors(chain &#x3D; true)</span><br><span class="line">@EqualsAndHashCode(callSuper &#x3D; false)</span><br><span class="line">public class ChatMsg &#123;</span><br><span class="line">    private String from;</span><br><span class="line">    private String to;</span><br><span class="line">    private String content;</span><br><span class="line">    private LocalDateTime date;</span><br><span class="line">    private String fromNickName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>WebSocketController详情</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">package com.zoux.server.controller;</span><br><span class="line">import com.zoux.server.pojo.Admin;</span><br><span class="line">import com.zoux.server.pojo.ChatMsg;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.messaging.handler.annotation.MessageMapping;</span><br><span class="line">import org.springframework.messaging.simp.SimpMessagingTemplate;</span><br><span class="line">import org.springframework.security.core.Authentication;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> *</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Controller</span><br><span class="line">public class WebSocketController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private SimpMessagingTemplate simpMessagingTemplate;</span><br><span class="line"></span><br><span class="line">    @MessageMapping(&quot;&#x2F;ws&#x2F;chat&quot;)</span><br><span class="line">    public void handleMsg(Authentication authentication, ChatMsg chatMsg)&#123;</span><br><span class="line">        Admin admin &#x3D; (Admin) authentication.getPrincipal();</span><br><span class="line">        chatMsg.setFrom(admin.getUsername());</span><br><span class="line">        chatMsg.setFromNickName(admin.getName());</span><br><span class="line">        chatMsg.setDate(LocalDateTime.now());</span><br><span class="line">        &#x2F;**</span><br><span class="line">         * 发送消息</span><br><span class="line">         * 1.消息接收者</span><br><span class="line">         * 2.消息队列</span><br><span class="line">         * 3.消息对象</span><br><span class="line">         *&#x2F;</span><br><span class="line">        simpMessagingTemplate.convertAndSendToUser(chatMsg.getTo(),&quot;&#x2F;queue&#x2F;chat&quot;,chatMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ChatController详情</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">package com.zoux.server.controller;</span><br><span class="line"></span><br><span class="line">import com.zoux.server.pojo.Admin;</span><br><span class="line">import com.zoux.server.service.IAdminService;</span><br><span class="line">import io.swagger.annotations.ApiOperation;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * 在线聊天</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;&#x2F;chat&quot;)</span><br><span class="line">public class ChatController &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private IAdminService adminService;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;获取所有操作员&quot;)</span><br><span class="line">    @GetMapping(&quot;&#x2F;admin&quot;)</span><br><span class="line">    public List&lt;Admin&gt; getAllAdmin(String keywords) &#123;</span><br><span class="line">        return adminService.getAllAdmins(keywords);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SecurityConfig详情</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">package com.zoux.server.config.security;</span><br><span class="line"></span><br><span class="line">import com.zoux.server.config.security.component.*;</span><br><span class="line">import com.zoux.server.pojo.Admin;</span><br><span class="line">import com.zoux.server.service.IAdminService;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.security.config.annotation.ObjectPostProcessor;</span><br><span class="line">import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;</span><br><span class="line">import org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line">import org.springframework.security.config.annotation.web.builders.WebSecurity;</span><br><span class="line">import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line">import org.springframework.security.config.http.SessionCreationPolicy;</span><br><span class="line">import org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line">import org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line">import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line">import org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line">import org.springframework.security.web.access.intercept.FilterSecurityInterceptor;</span><br><span class="line">import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class SecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private IAdminService adminService;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private RestAuthorizationEntryPoint restAuthorizationEntryPoint;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RestfulAccessDeniedHandler restfulAccessDeniedHandler;</span><br><span class="line">    @Autowired</span><br><span class="line">    private CustomUrlDecisionManager customUrlDecisionManager;</span><br><span class="line">    @Autowired</span><br><span class="line">    private CustomFilter customFilter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;</span><br><span class="line">        auth.userDetailsService(userDetailsService()).passwordEncoder(passwordEncoder());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    @Bean</span><br><span class="line">    public UserDetailsService userDetailsService() &#123;</span><br><span class="line">        return username -&gt; &#123;</span><br><span class="line">            Admin admin &#x3D; adminService.getAdminByUserName(username);</span><br><span class="line">            if (null !&#x3D; admin) &#123;</span><br><span class="line">                admin.setRoles(adminService.getRoles(admin.getId()));</span><br><span class="line">                return admin;</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F;抛出异常</span><br><span class="line">            throw new UsernameNotFoundException(&quot;用户名或密码不正确&quot;);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public PasswordEncoder passwordEncoder() &#123;</span><br><span class="line">        return new BCryptPasswordEncoder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;利用Bean注解将JwtAuthorizationTokenFilter暴露出来</span><br><span class="line">    @Bean</span><br><span class="line">    public JwtAuthorizationTokenFilter jwtAuthorizationTokenFilter() &#123;</span><br><span class="line">        return new JwtAuthorizationTokenFilter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void configure(WebSecurity web) throws Exception &#123;</span><br><span class="line">        web.ignoring().antMatchers(</span><br><span class="line">                &quot;&#x2F;login&quot;,</span><br><span class="line">                &quot;&#x2F;logout&quot;,</span><br><span class="line">                &quot;&#x2F;css&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;js&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;index.html&quot;,</span><br><span class="line">                &quot;favicon.ico&quot;,</span><br><span class="line">                &quot;&#x2F;doc.html&quot;,</span><br><span class="line">                &quot;&#x2F;webjars&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;swagger-resources&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;v2&#x2F;api-docs&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;captcha&quot;,</span><br><span class="line">                &quot;&#x2F;ws&#x2F;**&quot;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">        &#x2F;&#x2F;使用JWT不需要csrf</span><br><span class="line">        http.csrf()</span><br><span class="line">                .disable()</span><br><span class="line">                &#x2F;&#x2F;基于token不需要session</span><br><span class="line">                .sessionManagement()</span><br><span class="line">                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">                .and()</span><br><span class="line">                &#x2F;&#x2F;允许登陆访问</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">&#x2F;&#x2F;                .antMatchers(&quot;&#x2F;login&quot;, &quot;&#x2F;logout&quot;)</span><br><span class="line">&#x2F;&#x2F;                .permitAll()</span><br><span class="line">                &#x2F;&#x2F;访问请求要求认证</span><br><span class="line">                .anyRequest()</span><br><span class="line">                .authenticated()</span><br><span class="line">                &#x2F;&#x2F;动态权限配置</span><br><span class="line">                .withObjectPostProcessor(new ObjectPostProcessor&lt;FilterSecurityInterceptor&gt;() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    public &lt;O extends FilterSecurityInterceptor&gt; O postProcess(O o) &#123;</span><br><span class="line">                        o.setAccessDecisionManager(customUrlDecisionManager);</span><br><span class="line">                        o.setSecurityMetadataSource(customFilter);</span><br><span class="line">                        return o;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .and()</span><br><span class="line">                &#x2F;&#x2F;缓存关闭</span><br><span class="line">                .headers()</span><br><span class="line">                .cacheControl();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;添加jwt登陆授权拦截器</span><br><span class="line">        http.addFilterBefore(jwtAuthorizationTokenFilter(), UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">        &#x2F;&#x2F;自定义未授权，或者未登录的结果返回</span><br><span class="line">        http.exceptionHandling()</span><br><span class="line">                .accessDeniedHandler(restfulAccessDeniedHandler)</span><br><span class="line">                .authenticationEntryPoint(restAuthorizationEntryPoint);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<hr>
<h1 id="个人中心功能实现"><a href="#个人中心功能实现" class="headerlink" title="个人中心功能实现"></a>个人中心功能实现</h1><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1⃣️新建AdminInfoController类</span><br><span class="line">	注解</span><br><span class="line">		@RestController</span><br><span class="line">	注入</span><br><span class="line">		adminService</span><br><span class="line">	实现</span><br><span class="line">  	更新当前用户信息 updateAdmin @PutMapping(&quot;&#x2F;admin&#x2F;info&quot;)</span><br><span class="line">  	更新用户密码 updateAdminPassword @PutMapping(&quot;&#x2F;admin&#x2F;pass&quot;)</span><br><span class="line">2⃣️在AdminServiceImpl实现updatePassword</span><br><span class="line">	查询用户</span><br><span class="line">	比较新旧密码</span><br><span class="line">	更新数据</span><br><span class="line">3⃣️自定义Authority解析器</span><br><span class="line">	新建CustomAuthorityDeserializer类，继承JsonDeserializer</span><br><span class="line">	重写deserialize</span><br><span class="line">4⃣️在pojo-Admin启用	Authority解析器</span><br><span class="line">	@JsonDeserialize(using &#x3D; CustomAuthorityDeserializer.class)</span><br><span class="line">5⃣️引入FastDFS依赖 yeb-server pom</span><br><span class="line">	 &lt;!--FastDFS依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.csource&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;fastdfs-client-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.29-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">如果爆红</span><br><span class="line">	在项目下面</span><br><span class="line">		git clone https:&#x2F;&#x2F;github.com&#x2F;happyfish100&#x2F;fastdfs-client-java.git</span><br><span class="line">		cd &#x2F;fastdfs-client-java</span><br><span class="line">		mvn clean install</span><br><span class="line">6⃣️新建文件&#x2F;resources&#x2F;fdfs_client.conf</span><br><span class="line">7⃣️新建工具类FastDFSUtils	</span><br><span class="line">8⃣️AdminInfoController新建方法 更新用户头像 updateUserFace</span><br><span class="line">	注解</span><br><span class="line">		@ApiOperation(value &#x3D; &quot;更新用户头像&quot;)</span><br><span class="line">    @ApiImplicitParams(&#123;@ApiImplicitParam(name &#x3D; &quot;file&quot;, value &#x3D; &quot;头像&quot;, dataType &#x3D; &quot;MultipartFile&quot;)&#125;)</span><br><span class="line">    @PutMapping(&quot;&#x2F;admin&#x2F;userface&quot;)</span><br><span class="line">9⃣️在AdminServiceImpl实现updateAdminUserFace</span><br></pre></td></tr></table></figure>
<p>AdminServiceImpl实现updatePassword</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 更新用户密码</span><br><span class="line">     *</span><br><span class="line">     * @param oldPass</span><br><span class="line">     * @param pass</span><br><span class="line">     * @param adminId</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public RespBean updatePassword(String oldPass, String pass, Integer adminId) &#123;</span><br><span class="line">        Admin admin &#x3D; adminMapper.selectById(adminId);</span><br><span class="line">        BCryptPasswordEncoder encoder &#x3D; new BCryptPasswordEncoder();</span><br><span class="line">        &#x2F;&#x2F;判断旧密码是否正确</span><br><span class="line">        if (encoder.matches(oldPass, admin.getPassword())) &#123;</span><br><span class="line">            admin.setPassword(encoder.encode(pass));</span><br><span class="line">            int result &#x3D; adminMapper.updateById(admin);</span><br><span class="line">            if (1 &#x3D;&#x3D; result) &#123;</span><br><span class="line">                return RespBean.success(&quot;更新成功&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;更新失败&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>AdminInfoController</p>
<p>实现<br>      更新当前用户信息 updateAdmin @PutMapping(“/admin/info”)<br>      更新用户密码 updateAdminPassword @PutMapping(“/admin/pass”)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">    private IAdminService adminService;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;更新当前用户信息&quot;)</span><br><span class="line">    @PutMapping(&quot;&#x2F;admin&#x2F;info&quot;)</span><br><span class="line">    public RespBean updateAdmin(@RequestBody Admin admin, Authentication authentication) &#123;</span><br><span class="line">        &#x2F;&#x2F;更新成功,重新构建Authentication对象</span><br><span class="line">        if (adminService.updateById(admin)) &#123;</span><br><span class="line">            &#x2F;**</span><br><span class="line">             * 1.用户对象</span><br><span class="line">             * 2.凭证（密码）</span><br><span class="line">             * 3.用户角色</span><br><span class="line">             *&#x2F;</span><br><span class="line">            SecurityContextHolder.getContext().setAuthentication(</span><br><span class="line">                    new UsernamePasswordAuthenticationToken(</span><br><span class="line">                            admin,</span><br><span class="line">                            authentication.getCredentials(),</span><br><span class="line">                            authentication.getAuthorities())</span><br><span class="line">            );</span><br><span class="line">            return RespBean.success(&quot;更新成功&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;更新失败&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;更新用户密码&quot;)</span><br><span class="line">    @PutMapping(&quot;&#x2F;admin&#x2F;pass&quot;)</span><br><span class="line">    public RespBean updateAdminPassword(@RequestBody Map&lt;String, Object&gt; info) &#123;</span><br><span class="line">        String oldPass &#x3D; (String) info.get(&quot;oldPass&quot;);</span><br><span class="line">        String pass &#x3D; (String) info.get(&quot;pass&quot;);</span><br><span class="line">        Integer adminId &#x3D; (Integer) info.get(&quot;adminId&quot;);</span><br><span class="line">        return adminService.updatePassword(oldPass, pass, adminId);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>新建文件/resources/fdfs_client.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#连接超时</span><br><span class="line">connect_timeout &#x3D; 2</span><br><span class="line">#网络超时</span><br><span class="line">network_timeout &#x3D; 30</span><br><span class="line">#编码格式</span><br><span class="line">charset &#x3D; UTF-8</span><br><span class="line">#tracker端口号</span><br><span class="line">#http.tracker_http_port &#x3D; 8080</span><br><span class="line">#防盗链功能</span><br><span class="line">http.anti_steal_token &#x3D; no</span><br><span class="line">#秘钥</span><br><span class="line">http.secret_key &#x3D; FastDFS1234567890</span><br><span class="line">#tracker ip：端口号</span><br><span class="line">tracker_server &#x3D; 39.102.65.157:22122</span><br><span class="line">#连接池配置</span><br><span class="line">connection_pool.enabled &#x3D; true</span><br><span class="line">connection_pool.max_count_per_entry &#x3D; 500</span><br><span class="line">connection_pool.max_idle_time &#x3D; 3600</span><br><span class="line">connection_pool.max_wait_time_in_ms &#x3D; 1000</span><br></pre></td></tr></table></figure>
<p>新建工具类FastDFSUtils    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line">package com.zoux.server.utils;</span><br><span class="line"></span><br><span class="line">import org.csource.fastdfs.*;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.core.io.ClassPathResource;</span><br><span class="line">import org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line">import java.io.ByteArrayInputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * FDFS工具类</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class FastDFSUtils &#123;</span><br><span class="line">    private static Logger logger &#x3D; LoggerFactory.getLogger(FastDFSUtils.class);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 初始化客户端</span><br><span class="line">     * ClientClobal.ini 读取配置文件，并初始化对应的配置</span><br><span class="line">     *&#x2F;</span><br><span class="line">    static &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            String filePath &#x3D; new ClassPathResource(&quot;fdfs_client.conf&quot;).getFile().getAbsolutePath();</span><br><span class="line">            ClientGlobal.init(filePath);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            logger.error(&quot;初始化Fdfs失败&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 上传文件</span><br><span class="line">     *</span><br><span class="line">     * @param file</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static String[] upload(MultipartFile file) &#123;</span><br><span class="line">        String filename &#x3D; file.getOriginalFilename();</span><br><span class="line">        logger.info(&quot;File Name :&quot; + filename);</span><br><span class="line">        long startTime &#x3D; System.currentTimeMillis();</span><br><span class="line">        String[] uploadResults &#x3D; null;</span><br><span class="line">        StorageClient storageClient &#x3D; null;</span><br><span class="line">        &#x2F;&#x2F;获取storage客户端</span><br><span class="line">        try &#123;</span><br><span class="line">            storageClient &#x3D; getStorageClient();</span><br><span class="line">            &#x2F;&#x2F;上传</span><br><span class="line">            try &#123;</span><br><span class="line">                uploadResults &#x3D; storageClient.upload_file(file.getBytes(),</span><br><span class="line">                        filename.substring(filename.lastIndexOf(&quot;.&quot;) + 1), null);</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                logger.error(&quot;IO Exception when uploadind the file:&quot; + filename, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            logger.error(&quot;Non IO Exception when uploadind the file:&quot; + filename, e);</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(&quot;upload_file time used:&quot; + (System.currentTimeMillis() - startTime) + &quot; ms&quot;);</span><br><span class="line">        &#x2F;&#x2F;验证上传结果</span><br><span class="line">        if (uploadResults &#x3D;&#x3D; null &amp;&amp; storageClient !&#x3D; null) &#123;</span><br><span class="line">            logger.error(&quot;upload file fail, error code:&quot; + storageClient.getErrorCode());</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;上传成功返回groupName</span><br><span class="line">        logger.info(&quot;upload file successfully!!!&quot; + &quot;group_name:&quot; + uploadResults[0] + &quot;, remoteFileName:&quot; + &quot; &quot; + uploadResults[1]);</span><br><span class="line">        return uploadResults;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 获取文件信息</span><br><span class="line">     *</span><br><span class="line">     * @param groupName</span><br><span class="line">     * @param remoteFileName</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static FileInfo getFileInfo(String groupName, String remoteFileName) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            StorageClient storageClient &#x3D; getStorageClient();</span><br><span class="line">            return storageClient.get_file_info(groupName, remoteFileName);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            logger.error(&quot;IO Exception: Get File from Fast DFS failed&quot;, e);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            logger.error(&quot;Non IO Exception: Get File from Fast DFS failed&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 下载</span><br><span class="line">     *</span><br><span class="line">     * @param groupName</span><br><span class="line">     * @param remoteFileName</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static InputStream downFile(String groupName, String remoteFileName) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            StorageClient storageClient &#x3D; getStorageClient();</span><br><span class="line">            byte[] bytes &#x3D; storageClient.download_file(groupName, remoteFileName);</span><br><span class="line">            InputStream inputStream &#x3D; new ByteArrayInputStream(bytes);</span><br><span class="line">            return inputStream;</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            logger.error(&quot;IO Exception: Get File from Fast DFS failed&quot;, e);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            logger.error(&quot;Non IO Exception: Get File from Fast DFS failed&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 删除文件</span><br><span class="line">     *</span><br><span class="line">     * @param groupName</span><br><span class="line">     * @param remoteFileName</span><br><span class="line">     * @throws Exception</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static void deleteFile(String groupName, String remoteFileName) throws Exception &#123;</span><br><span class="line">        StorageClient storageClient &#x3D; getStorageClient();</span><br><span class="line">        int i &#x3D; storageClient.delete_file(groupName, remoteFileName);</span><br><span class="line">        logger.info(&quot;delete file successfully!!!&quot; + i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 生成Storage客户端</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static StorageClient getStorageClient() throws IOException &#123;</span><br><span class="line">        TrackerServer trackerServer &#x3D; getTrackerServer();</span><br><span class="line">        StorageClient storageClient &#x3D; new StorageClient(trackerServer, null);</span><br><span class="line">        return storageClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 生成Tracker服务器端</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static TrackerServer getTrackerServer() throws IOException &#123;</span><br><span class="line">        TrackerClient trackerClient &#x3D; new TrackerClient();</span><br><span class="line">        TrackerServer trackerServer &#x3D; trackerClient.getTrackerServer();</span><br><span class="line">        return trackerServer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 获取文件路径</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static String getTrackerUrl() &#123;</span><br><span class="line">        TrackerClient trackerClient &#x3D; new TrackerClient();</span><br><span class="line">        TrackerServer trackerServer &#x3D; null;</span><br><span class="line">        StorageServer storageServer &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            trackerServer &#x3D; trackerClient.getTrackerServer();</span><br><span class="line">            storageServer &#x3D; trackerClient.getStoreStorage(trackerServer);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return &quot;http:&#x2F;&#x2F;&quot; + storageServer.getInetSocketAddress().getHostString() + &quot;:8888&#x2F;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<hr>

  </div>
  <div> 
    <a href="https://github.com/Zoushaozx/zoushaozx.github.io/edit/myblog/source/_posts/云e办后端.md" target="_blank">
             <!-- https://github.com/Zoushaozx/zoushaozx.github.io/edit/myblog/source/_posts/hello-world.md -->
      编辑
    </a>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about">关于</a></li>
         
          <li><a href="/archives">归档</a></li>
         
          <li><a href="/projects">项目</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%91e%E5%8A%9E%EF%BC%8C%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%EF%BC%8C%E5%89%8D%E7%AB%AFvue-%E5%90%8E%E7%AB%AFJava"><span class="toc-number">1.</span> <span class="toc-text">云e办，前后端分离，前端vue 后端Java</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">2.</span> <span class="toc-text">后端技术栈</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">3.</span> <span class="toc-text">前端技术栈</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-number">4.</span> <span class="toc-text">搭建后端项目</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B"><span class="toc-number">5.</span> <span class="toc-text">逆向工程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Jwt-Token%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">6.</span> <span class="toc-text">Jwt Token工具类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.</span> <span class="toc-text">公共返回对象</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E4%B9%8B%E5%90%8E%E8%BF%94%E5%9B%9Etoken"><span class="toc-number">8.</span> <span class="toc-text">登录之后返回token</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">9.</span> <span class="toc-text">获取当前登录用户信息</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95"><span class="toc-number">10.</span> <span class="toc-text">退出登录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEsecurity%E7%99%BB%E9%99%86%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">11.</span> <span class="toc-text">配置security登陆过滤器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#security%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C"><span class="toc-number">12.</span> <span class="toc-text">security自定义返回结果</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swagger2%E6%8F%90%E4%BE%9BAuthorize"><span class="toc-number">13.</span> <span class="toc-text">swagger2提供Authorize</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">14.</span> <span class="toc-text">生成验证码</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E6%A0%A1%E9%AA%8C"><span class="toc-number">15.</span> <span class="toc-text">验证码校验</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7id%E6%9F%A5%E8%AF%A2%E8%8F%9C%E5%8D%95%E5%88%97%E8%A1%A8"><span class="toc-number">16.</span> <span class="toc-text">根据用户id查询菜单列表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E9%9B%86%E6%88%90%E8%8F%9C%E5%8D%95%E5%8A%9F%E8%83%BD"><span class="toc-number">17.</span> <span class="toc-text">Redis集成菜单功能</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E8%AF%B7%E6%B1%82url%E5%88%A4%E6%96%AD%E8%A7%92%E8%89%B2"><span class="toc-number">18.</span> <span class="toc-text">根据请求url判断角色</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2"><span class="toc-number">19.</span> <span class="toc-text">判断用户角色</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%81%8C%E4%BD%8D%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">20.</span> <span class="toc-text">职位管理功能实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8"><span class="toc-number">21.</span> <span class="toc-text">全局异常</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%81%8C%E7%A7%B0%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">22.</span> <span class="toc-text">职称管理功能实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%BB%84%E8%A7%92%E8%89%B2%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">23.</span> <span class="toc-text">权限组角色功能实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="toc-number">24.</span> <span class="toc-text">存储过程的创建和使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">25.</span> <span class="toc-text">部门管理功能实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E5%91%98%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD"><span class="toc-number">26.</span> <span class="toc-text">操作员管理功能</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD-%E5%88%86%E9%A1%B5"><span class="toc-number">27.</span> <span class="toc-text">员工管理功能-分页</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD-%E6%B7%BB%E5%8A%A0-%E5%88%A0%E9%99%A4-%E6%9B%B4%E6%96%B0%E5%91%98%E5%B7%A5"><span class="toc-number">28.</span> <span class="toc-text">员工管理功能-添加&#x2F;删除&#x2F;更新员工</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA"><span class="toc-number">29.</span> <span class="toc-text">员工数据导入导出</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%82%AE%E4%BB%B6%E5%8A%9F%E8%83%BD"><span class="toc-number">30.</span> <span class="toc-text">邮件功能</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E7%AB%AF%E5%8F%AF%E9%9D%A0%E6%8A%95%E9%80%92%E6%96%B9%E6%A1%88%E4%BB%8B%E7%BB%8D"><span class="toc-number">31.</span> <span class="toc-text">生产端可靠投递方案介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E6%B6%88%E6%81%AF%E5%9B%9E%E8%B0%83%E6%9C%BA%E5%88%B6"><span class="toc-number">32.</span> <span class="toc-text">开启消息回调机制</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E7%AB%AF%E6%B6%88%E6%81%AF%E6%8A%95%E9%80%92%E5%8F%AF%E9%9D%A0%E6%80%A7%E5%AE%9E%E7%8E%B0"><span class="toc-number">33.</span> <span class="toc-text">生产端消息投递可靠性实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E7%AB%AF%E5%B9%82%E7%AD%89%E6%80%A7"><span class="toc-number">34.</span> <span class="toc-text">消费端幂等性</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E8%B5%84%E5%B8%90%E5%A5%97%E7%AE%A1%E7%90%86%E5%AE%9E%E7%8E%B0"><span class="toc-number">35.</span> <span class="toc-text">工资帐套管理实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E5%B8%90%E5%A5%97%E7%AE%A1%E7%90%86%E5%AE%9E%E7%8E%B0"><span class="toc-number">36.</span> <span class="toc-text">员工帐套管理实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WebSocket%E5%9C%A8%E7%BA%BF%E8%81%8A%E5%A4%A9%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">37.</span> <span class="toc-text">WebSocket在线聊天功能实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">38.</span> <span class="toc-text">个人中心功能实现</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&text=云e办"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=云e办"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&is_video=false&description=云e办"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=云e办&body=Check out this article: http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=云e办"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=云e办"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=云e办"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=云e办"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&name=云e办&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&t=云e办"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2021
    Zoux
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about">关于</a></li>
         
          <li><a href="/archives">归档</a></li>
         
          <li><a href="/projects">项目</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
