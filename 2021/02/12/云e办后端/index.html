<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="äº‘eåŠï¼Œå‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯vue åç«¯Javaåç«¯æŠ€æœ¯æ ˆ123456789101112131415springboot springmvc mybatisplus å¯¹é¡¹ç›®ä¾µå…¥å°‘ ä»£ç ç¼–å†™ç®€å•Lombok	æ³¨è§£æ’ä»¶AutoGenerator	Swagger2	æ¥å£æ–‡æ¡£springsecret å®‰å…¨æ¡†æ¶jwt ä»¤ç‰Œcaptcha å›¾å½¢éªŒè¯ç redis	easypoi æ–‡æ¡£å¯¼å…¥å¯¼å‡ºrabbitmq æ¶ˆæ¯é˜Ÿ">
<meta property="og:type" content="article">
<meta property="og:title" content="äº‘eåŠ">
<meta property="og:url" content="http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/index.html">
<meta property="og:site_name" content="Zoux">
<meta property="og:description" content="äº‘eåŠï¼Œå‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯vue åç«¯Javaåç«¯æŠ€æœ¯æ ˆ123456789101112131415springboot springmvc mybatisplus å¯¹é¡¹ç›®ä¾µå…¥å°‘ ä»£ç ç¼–å†™ç®€å•Lombok	æ³¨è§£æ’ä»¶AutoGenerator	Swagger2	æ¥å£æ–‡æ¡£springsecret å®‰å…¨æ¡†æ¶jwt ä»¤ç‰Œcaptcha å›¾å½¢éªŒè¯ç redis	easypoi æ–‡æ¡£å¯¼å…¥å¯¼å‡ºrabbitmq æ¶ˆæ¯é˜Ÿ">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-02-12T19:11:21.000Z">
<meta property="article:modified_time" content="2021-03-03T06:43:37.796Z">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>äº‘eåŠ</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">é¦–é¡µ</a></li>
         
          <li><a href="/about">å…³äº</a></li>
         
          <li><a href="/archives">å½’æ¡£</a></li>
         
          <li><a href="/projects">é¡¹ç›®</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2021/02/12/hexo/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2021/02/12/linux/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">ä¸Šä¸€ç¯‡</span>
      <span id="i-next" class="info" style="display:none;">ä¸‹ä¸€ç¯‡</span>
      <span id="i-top" class="info" style="display:none;">è¿”å›é¡¶éƒ¨</span>
      <span id="i-share" class="info" style="display:none;">åˆ†äº«æ–‡ç« </span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&text=äº‘eåŠ"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=äº‘eåŠ"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&is_video=false&description=äº‘eåŠ"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=äº‘eåŠ&body=Check out this article: http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=äº‘eåŠ"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=äº‘eåŠ"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=äº‘eåŠ"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=äº‘eåŠ"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&name=äº‘eåŠ&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&t=äº‘eåŠ"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%91e%E5%8A%9E%EF%BC%8C%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%EF%BC%8C%E5%89%8D%E7%AB%AFvue-%E5%90%8E%E7%AB%AFJava"><span class="toc-number">1.</span> <span class="toc-text">äº‘eåŠï¼Œå‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯vue åç«¯Java</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">2.</span> <span class="toc-text">åç«¯æŠ€æœ¯æ ˆ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">3.</span> <span class="toc-text">å‰ç«¯æŠ€æœ¯æ ˆ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-number">4.</span> <span class="toc-text">æ­å»ºåç«¯é¡¹ç›®</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B"><span class="toc-number">5.</span> <span class="toc-text">é€†å‘å·¥ç¨‹</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Jwt-Token%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">6.</span> <span class="toc-text">Jwt Tokenå·¥å…·ç±»</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.</span> <span class="toc-text">å…¬å…±è¿”å›å¯¹è±¡</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E4%B9%8B%E5%90%8E%E8%BF%94%E5%9B%9Etoken"><span class="toc-number">8.</span> <span class="toc-text">ç™»å½•ä¹‹åè¿”å›token</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">9.</span> <span class="toc-text">è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95"><span class="toc-number">10.</span> <span class="toc-text">é€€å‡ºç™»å½•</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEsecurity%E7%99%BB%E9%99%86%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">11.</span> <span class="toc-text">é…ç½®securityç™»é™†è¿‡æ»¤å™¨</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#security%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C"><span class="toc-number">12.</span> <span class="toc-text">securityè‡ªå®šä¹‰è¿”å›ç»“æœ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swagger2%E6%8F%90%E4%BE%9BAuthorize"><span class="toc-number">13.</span> <span class="toc-text">swagger2æä¾›Authorize</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">14.</span> <span class="toc-text">ç”ŸæˆéªŒè¯ç </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E6%A0%A1%E9%AA%8C"><span class="toc-number">15.</span> <span class="toc-text">éªŒè¯ç æ ¡éªŒ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7id%E6%9F%A5%E8%AF%A2%E8%8F%9C%E5%8D%95%E5%88%97%E8%A1%A8"><span class="toc-number">16.</span> <span class="toc-text">æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢èœå•åˆ—è¡¨</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E9%9B%86%E6%88%90%E8%8F%9C%E5%8D%95%E5%8A%9F%E8%83%BD"><span class="toc-number">17.</span> <span class="toc-text">Redisé›†æˆèœå•åŠŸèƒ½</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E8%AF%B7%E6%B1%82url%E5%88%A4%E6%96%AD%E8%A7%92%E8%89%B2"><span class="toc-number">18.</span> <span class="toc-text">æ ¹æ®è¯·æ±‚urlåˆ¤æ–­è§’è‰²</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2"><span class="toc-number">19.</span> <span class="toc-text">åˆ¤æ–­ç”¨æˆ·è§’è‰²</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%81%8C%E4%BD%8D%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">20.</span> <span class="toc-text">èŒä½ç®¡ç†åŠŸèƒ½å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8"><span class="toc-number">21.</span> <span class="toc-text">å…¨å±€å¼‚å¸¸</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%81%8C%E7%A7%B0%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">22.</span> <span class="toc-text">èŒç§°ç®¡ç†åŠŸèƒ½å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%BB%84%E8%A7%92%E8%89%B2%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">23.</span> <span class="toc-text">æƒé™ç»„è§’è‰²åŠŸèƒ½å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="toc-number">24.</span> <span class="toc-text">å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»ºå’Œä½¿ç”¨</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">25.</span> <span class="toc-text">éƒ¨é—¨ç®¡ç†åŠŸèƒ½å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E5%91%98%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD"><span class="toc-number">26.</span> <span class="toc-text">æ“ä½œå‘˜ç®¡ç†åŠŸèƒ½</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD-%E5%88%86%E9%A1%B5"><span class="toc-number">27.</span> <span class="toc-text">å‘˜å·¥ç®¡ç†åŠŸèƒ½-åˆ†é¡µ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD-%E6%B7%BB%E5%8A%A0-%E5%88%A0%E9%99%A4-%E6%9B%B4%E6%96%B0%E5%91%98%E5%B7%A5"><span class="toc-number">28.</span> <span class="toc-text">å‘˜å·¥ç®¡ç†åŠŸèƒ½-æ·»åŠ &#x2F;åˆ é™¤&#x2F;æ›´æ–°å‘˜å·¥</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA"><span class="toc-number">29.</span> <span class="toc-text">å‘˜å·¥æ•°æ®å¯¼å…¥å¯¼å‡º</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%82%AE%E4%BB%B6%E5%8A%9F%E8%83%BD"><span class="toc-number">30.</span> <span class="toc-text">é‚®ä»¶åŠŸèƒ½</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E7%AB%AF%E5%8F%AF%E9%9D%A0%E6%8A%95%E9%80%92%E6%96%B9%E6%A1%88%E4%BB%8B%E7%BB%8D"><span class="toc-number">31.</span> <span class="toc-text">ç”Ÿäº§ç«¯å¯é æŠ•é€’æ–¹æ¡ˆä»‹ç»</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E6%B6%88%E6%81%AF%E5%9B%9E%E8%B0%83%E6%9C%BA%E5%88%B6"><span class="toc-number">32.</span> <span class="toc-text">å¼€å¯æ¶ˆæ¯å›è°ƒæœºåˆ¶</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E7%AB%AF%E6%B6%88%E6%81%AF%E6%8A%95%E9%80%92%E5%8F%AF%E9%9D%A0%E6%80%A7%E5%AE%9E%E7%8E%B0"><span class="toc-number">33.</span> <span class="toc-text">ç”Ÿäº§ç«¯æ¶ˆæ¯æŠ•é€’å¯é æ€§å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E7%AB%AF%E5%B9%82%E7%AD%89%E6%80%A7"><span class="toc-number">34.</span> <span class="toc-text">æ¶ˆè´¹ç«¯å¹‚ç­‰æ€§</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E8%B5%84%E5%B8%90%E5%A5%97%E7%AE%A1%E7%90%86%E5%AE%9E%E7%8E%B0"><span class="toc-number">35.</span> <span class="toc-text">å·¥èµ„å¸å¥—ç®¡ç†å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E5%B8%90%E5%A5%97%E7%AE%A1%E7%90%86%E5%AE%9E%E7%8E%B0"><span class="toc-number">36.</span> <span class="toc-text">å‘˜å·¥å¸å¥—ç®¡ç†å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WebSocket%E5%9C%A8%E7%BA%BF%E8%81%8A%E5%A4%A9%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">37.</span> <span class="toc-text">WebSocketåœ¨çº¿èŠå¤©åŠŸèƒ½å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">38.</span> <span class="toc-text">ä¸ªäººä¸­å¿ƒåŠŸèƒ½å®ç°</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        äº‘eåŠ
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name"></span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-02-12T19:11:21.000Z" itemprop="datePublished">2021-02-12</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="äº‘eåŠï¼Œå‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯vue-åç«¯Java"><a href="#äº‘eåŠï¼Œå‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯vue-åç«¯Java" class="headerlink" title="äº‘eåŠï¼Œå‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯vue åç«¯Java"></a>äº‘eåŠï¼Œå‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯vue åç«¯Java</h1><h1 id="åç«¯æŠ€æœ¯æ ˆ"><a href="#åç«¯æŠ€æœ¯æ ˆ" class="headerlink" title="åç«¯æŠ€æœ¯æ ˆ"></a>åç«¯æŠ€æœ¯æ ˆ</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">springboot </span><br><span class="line">springmvc </span><br><span class="line">mybatisplus å¯¹é¡¹ç›®ä¾µå…¥å°‘ ä»£ç ç¼–å†™ç®€å•</span><br><span class="line">Lombok	æ³¨è§£æ’ä»¶</span><br><span class="line">AutoGenerator	</span><br><span class="line">Swagger2	æ¥å£æ–‡æ¡£</span><br><span class="line">springsecret å®‰å…¨æ¡†æ¶</span><br><span class="line">jwt ä»¤ç‰Œ</span><br><span class="line">captcha å›¾å½¢éªŒè¯ç </span><br><span class="line">redis	</span><br><span class="line">easypoi æ–‡æ¡£å¯¼å…¥å¯¼å‡º</span><br><span class="line">rabbitmq æ¶ˆæ¯é˜Ÿåˆ— å¼‚æ­¥å¤„ç†</span><br><span class="line">mail é‚®ä»¶ </span><br><span class="line">websocket åœ¨çº¿èŠå¤©</span><br><span class="line">fastDFS æ–‡ä»¶æœåŠ¡å™¨ æ‰¿è½½é™æ€èµ„æº</span><br></pre></td></tr></table></figure>
<h1 id="å‰ç«¯æŠ€æœ¯æ ˆ"><a href="#å‰ç«¯æŠ€æœ¯æ ˆ" class="headerlink" title="å‰ç«¯æŠ€æœ¯æ ˆ"></a>å‰ç«¯æŠ€æœ¯æ ˆ</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vue</span><br><span class="line">element UI</span><br><span class="line">vue_cli é¡¹ç›®æ­å»º</span><br><span class="line">vuex çŠ¶æ€ç®¡ç†</span><br><span class="line">vuerouter è·¯ç”±ç®¡ç†</span><br><span class="line">axios é€šè®¯æ¡†æ¶</span><br><span class="line">es6 å‰ç«¯è¯­æ³•</span><br><span class="line">webpack æ‰“åŒ…</span><br><span class="line">websocket åœ¨çº¿èŠå¤©</span><br><span class="line">vue_chat åœ¨çº¿èŠå¤©</span><br><span class="line">font_awesome å­—ä½“</span><br><span class="line">js-file-download æ–‡ä»¶ä¸‹è½½</span><br></pre></td></tr></table></figure>


<h1 id="æ­å»ºåç«¯é¡¹ç›®"><a href="#æ­å»ºåç«¯é¡¹ç›®" class="headerlink" title="æ­å»ºåç«¯é¡¹ç›®"></a>æ­å»ºåç«¯é¡¹ç›®</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">æ­å»ºæ•°æ®åº“ yeb.sql</span><br><span class="line">lombok æ’ä»¶</span><br><span class="line">æ•´ä¸ªé¡¹ç›®é‡‡ç”¨äº†maven èšåˆçš„é¡¹ç›®</span><br><span class="line"></span><br><span class="line">åˆ›å»ºçˆ¶å·¥ç¨‹ï¼š</span><br><span class="line">	1âƒ£ï¸spring initialize-&gt;next-&gt;ä¿®æ”¹Group&#x2F;Artifact-&gt;next-&gt;spring boot devtools-&gt;Project locationï¼ˆé¡¹ç›®å­˜æ”¾åœ°å€ï¼‰</span><br><span class="line">	2âƒ£ï¸çˆ¶å·¥ç¨‹åªæ˜¯ç”¨æ¥åšpomä¾èµ–ç®¡ç†ï¼Œå°±å¯ä»¥åªä¿ç•™pom.xml</span><br><span class="line">	3âƒ£ï¸ä¿®æ”¹pomæ–‡ä»¶</span><br><span class="line">    åˆ é™¤dependenciesæ ‡ç­¾</span><br><span class="line">    åˆ é™¤buildæ ‡ç­¾</span><br><span class="line">    åŠ packagingæ ‡ç­¾</span><br><span class="line">		    &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">åˆ›å»ºå­é¡¹ç›®ï¼š</span><br><span class="line">	1âƒ£ï¸new-&gt;Module-&gt;Maven-&gt;Create from archetype-&gt;org...:maven-ar..-quickstartç­‰å¾…é»˜è®¤ä¾èµ–åŠ è½½å®Œæˆ</span><br><span class="line">	2âƒ£ï¸åˆ é™¤mainå’Œtestä¸‹é¢çš„Appå’ŒApptestç±»</span><br><span class="line">	3âƒ£ï¸æ›´æ”¹åŒ…åï¼Œcom.xxxx.server</span><br><span class="line">	4âƒ£ï¸ä¿®æ”¹serverçš„pomä¾èµ–</span><br><span class="line">		æˆ‘ä»¬ä¼šå‘ç°ï¼Œçˆ¶å·¥ç¨‹ä¸‹é¢å¤šäº†ï¼Œè¿™ä¸ªæ˜¯å…³è”serverçš„</span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;module&gt;yeb-server&lt;&#x2F;module&gt;</span><br><span class="line">    &lt;&#x2F;modules&gt;</span><br><span class="line">    </span><br><span class="line">    æ­¤æ—¶è§‚å¯Ÿserverçš„pomæ˜¯å¦æœ‰å…³è”çˆ¶å·¥ç¨‹çš„parentæ ‡ç­¾ï¼Œæ²¡æœ‰å°±åŠ ä¸Š </span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;yeb&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.zoux&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    </span><br><span class="line">    nameå’Œurlæ ‡ç­¾å¯ä»¥åˆ é™¤</span><br><span class="line">    </span><br><span class="line">    maven.compiler.source&#x2F;maven.compiler.target ç‰ˆæœ¬æ”¹ä¸º1.8</span><br><span class="line">    </span><br><span class="line">    åˆ é™¤buildæ ‡ç­¾ </span><br><span class="line">    åˆ é™¤dependencyæ ‡ç­¾</span><br><span class="line">    </span><br><span class="line">    æ·»åŠ ä¾èµ–</span><br><span class="line">    	&lt;!--web ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--lombok ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--mysql ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--mybatis ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.3.1.tmp&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">         </span><br><span class="line">	5âƒ£ï¸æ–°å»ºresourcesç›®å½•ï¼Œå¹¶è®¾ç½®é…ç½®æ–‡ä»¶</span><br><span class="line">  	åœ¨mainä¸‹é¢æ–°å»ºresourcesï¼Œå¹¶è®¾ç½®ä¸ºsourceç›®å½• mark directory as -&gt; resource root</span><br><span class="line">  	å¹¶åœ¨resourcesé‡Œé¢æ–°å»ºæ–‡ä»¶ï¼Œ</span><br><span class="line">  	application.yml</span><br><span class="line">  	å†…å®¹ï¼š</span><br><span class="line">  		server:</span><br><span class="line"> 			 # ç«¯å£</span><br><span class="line">			  port: 8081</span><br><span class="line"></span><br><span class="line">  		spring:</span><br><span class="line">        #æ•°æ®æºé…ç½®</span><br><span class="line">        datasource:</span><br><span class="line">          driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">          url: jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;yeb?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai</span><br><span class="line">          username: root</span><br><span class="line">          password: rootzoux</span><br><span class="line">          hikari:	</span><br><span class="line">            # è¿æ¥æ± å</span><br><span class="line">            pool-name: DateHikariCP</span><br><span class="line">            # æœ€å°ç©ºé—²è¿æ¥æ•°</span><br><span class="line">            minimum-idle: 5</span><br><span class="line">            #æœ€å¤§è¿æ¥å­˜æ´»æœ€å¤§æ—¶é—´ï¼Œé»˜è®¤600000 10åˆ†é’Ÿ</span><br><span class="line">            idle-timeout: 180000</span><br><span class="line">            #æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤10</span><br><span class="line">            maximum-pool-size: 10</span><br><span class="line">            #ä»è¿æ¥æ± è¿”å›çš„è¿æ¥è‡ªåŠ¨æäº¤</span><br><span class="line">            auto-commit: true</span><br><span class="line">            #è¿æ¥å­˜æ´»çš„æœ€å¤§æ—¶é—´ï¼Œ0è¡¨ç¤ºæ°¸ä¹…å­˜æ´»ï¼Œé»˜è®¤1800000 30åˆ†é’Ÿ</span><br><span class="line">            max-lifetime: 1800000</span><br><span class="line">            #è¿æ¥è¶…æ—¶ï¼Œ30000 é»˜è®¤30ç§’</span><br><span class="line">            connection-timeout: 30000</span><br><span class="line">            #æµ‹è¯•è¿æ¥æ˜¯å¦å¯ç”¨çš„æŸ¥è¯¢è¯­å¥</span><br><span class="line">            connection-test-query: SELECT 1</span><br><span class="line">				# Mabatis-plug é…ç½®</span><br><span class="line">        mybatis-plus:</span><br><span class="line">          #é…ç½® Mapperæ˜ å°„æ–‡ä»¶</span><br><span class="line">          mapper-locations: classpath*:&#x2F;mapper&#x2F;*Mapper.xml</span><br><span class="line">          #é…ç½® Mabatisæ•°æ®è¿”å›ç±»å‹åˆ«å é»˜è®¤åˆ«åæ˜¯ç±»å</span><br><span class="line">          type-aliases-package: com.zoux.server.pojo</span><br><span class="line">          #è‡ªåŠ¨é©¼å³°å‘½å</span><br><span class="line">          configuration:</span><br><span class="line">            map-underscore-to-camel-case: false</span><br><span class="line"></span><br><span class="line">        # mybatis SQL æ‰“å° ï¼ˆæ¥å£æ‰€åœ¨çš„åŒ…ï¼Œä¸æ˜¯mapper.xml æ‰€åœ¨çš„åŒ…ï¼‰</span><br><span class="line">        logging:</span><br><span class="line">          level:</span><br><span class="line">            com.zoux.server.mapper: debug</span><br><span class="line">            </span><br><span class="line">	6âƒ£ï¸åœ¨resourcesç›®å½•ä¸‹æ–°å»ºmapper</span><br><span class="line">	7âƒ£ï¸æ·»åŠ åŒ…åï¼Œpojoï¼Œserviceï¼Œmapperï¼Œservice.impl,controller</span><br><span class="line">	8âƒ£ï¸å¯åŠ¨ç±»YebApplication</span><br><span class="line">			import org.springframework.boot.SpringApplication;</span><br><span class="line">			import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">			@SpringBootApplication</span><br><span class="line">			public class YebAppication &#123;</span><br><span class="line">   			 public static void main(String[] args) &#123;</span><br><span class="line">       			 SpringApplication.run(YebAppication.class, args);</span><br><span class="line">   			 &#125;</span><br><span class="line">			&#125;</span><br><span class="line">	9âƒ£ï¸æ·»åŠ mapperæ‰«æ</span><br><span class="line">	@MapperScan(&quot;com.zoux.server.mapper&quot;)</span><br><span class="line">	ğŸ”Ÿåœ¨resourcesä¸‹æ–°å»ºcomfigç›®å½•ï¼Œå°†YebAppication.yml</span><br></pre></td></tr></table></figure>
<h1 id="é€†å‘å·¥ç¨‹"><a href="#é€†å‘å·¥ç¨‹" class="headerlink" title="é€†å‘å·¥ç¨‹"></a>é€†å‘å·¥ç¨‹</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line">æ ¹æ®æ–°å»ºpojo mapper controller å•è¡¨æŸ¥è¯¢</span><br><span class="line">mybatisplusï¼Œå®˜ç½‘</span><br><span class="line">https:&#x2F;&#x2F;mp.baomidou.com&#x2F;guide&#x2F;generator.html</span><br><span class="line">é€†å‘å·¥ç¨‹æœ¬èº«ä¸é¡¹ç›®æ²¡æœ‰å¤ªå¤§å…³è”ï¼Œå°±æ–°å»ºmoduleæ‰¿è½½</span><br><span class="line">1âƒ£ï¸æ–°å»ºmoduleï¼Œmavenï¼Œquikerstart</span><br><span class="line">2âƒ£ï¸åˆ é™¤pomï¼Œ nameã€urlæ ‡ç­¾ï¼Œmaven.compiler.source&#x2F;target ç‰ˆæœ¬å·ä¸º1.8ï¼Œåˆ é™¤dependencies&#x2F;buildæ ‡ç­¾</span><br><span class="line">3âƒ£ï¸åˆ é™¤Appç±»ï¼Œæ–°å»ºåŒ…generator</span><br><span class="line">4âƒ£ï¸åˆ é™¤testæ–‡ä»¶å¤¹</span><br><span class="line">5âƒ£ï¸æŒ‡å®šçˆ¶å·¥ç¨‹</span><br><span class="line">	    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;yeb&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.zoux&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">   		 &lt;&#x2F;parent&gt;</span><br><span class="line"> 6âƒ£ï¸æ·»åŠ ä¾èµ–</span><br><span class="line"> 		&lt;!--web ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--mybatis ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.3.1.tmp&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--mybatis-plus ä»£ç ç”Ÿæˆå™¨ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-plus-generator&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.3.1.tmp&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--    ferrmarker ä¾èµ– æ¨¡ç‰ˆ--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.freemarker&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;freemarker&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--mysql ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">7âƒ£ï¸æ–°å»ºç±»MysqlGenerator</span><br><span class="line">package com.zoux.generator;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.core.exceptions.MybatisPlusException;</span><br><span class="line">import com.baomidou.mybatisplus.core.toolkit.StringPool;</span><br><span class="line">import com.baomidou.mybatisplus.core.toolkit.StringUtils;</span><br><span class="line">import com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line">import com.baomidou.mybatisplus.generator.InjectionConfig;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.*;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.po.TableInfo;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line">import com.baomidou.mybatisplus.generator.engine.FreemarkerTemplateEngine;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Scanner;</span><br><span class="line"></span><br><span class="line">public class MysqlGenerator &#123;</span><br><span class="line">    &#x2F;&#x2F; æ¼”ç¤ºä¾‹å­ï¼Œæ‰§è¡Œ main æ–¹æ³•æ§åˆ¶å°è¾“å…¥æ¨¡å—è¡¨åå›è½¦è‡ªåŠ¨ç”Ÿæˆå¯¹åº”é¡¹ç›®ç›®å½•ä¸­</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * &lt;p&gt;</span><br><span class="line">     * è¯»å–æ§åˆ¶å°å†…å®¹</span><br><span class="line">     * &lt;&#x2F;p&gt;</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static String scanner(String tip) &#123;</span><br><span class="line">        Scanner scanner &#x3D; new Scanner(System.in);</span><br><span class="line">        StringBuilder help &#x3D; new StringBuilder();</span><br><span class="line">        help.append(&quot;è¯·è¾“å…¥&quot; + tip + &quot;ï¼š&quot;);</span><br><span class="line">        System.out.println(help.toString());</span><br><span class="line">        if (scanner.hasNext()) &#123;</span><br><span class="line">            String ipt &#x3D; scanner.next();</span><br><span class="line">            if (StringUtils.isNotBlank(ipt)) &#123;</span><br><span class="line">                return ipt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        throw new MybatisPlusException(&quot;è¯·è¾“å…¥æ­£ç¡®çš„&quot; + tip + &quot;ï¼&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        &#x2F;&#x2F; ä»£ç ç”Ÿæˆå™¨</span><br><span class="line">        AutoGenerator mpg &#x3D; new AutoGenerator();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; å…¨å±€é…ç½®</span><br><span class="line">        GlobalConfig gc &#x3D; new GlobalConfig();</span><br><span class="line">        String projectPath &#x3D; System.getProperty(&quot;user.dir&quot;);</span><br><span class="line">        gc.setOutputDir(projectPath + &quot;&#x2F;yeb-generator&#x2F;src&#x2F;main&#x2F;java&quot;);</span><br><span class="line">        &#x2F;&#x2F;ä½œè€…</span><br><span class="line">        gc.setAuthor(&quot;zoux&quot;);</span><br><span class="line">        &#x2F;&#x2F;æ˜¯å¦æ‰“å¼€è¾“å‡ºç›®å½•</span><br><span class="line">        gc.setOpen(false);</span><br><span class="line">        &#x2F;&#x2F;xml  å¼€å¯BaseResultMap</span><br><span class="line">        gc.setBaseResultMap(true);</span><br><span class="line">        &#x2F;&#x2F;xml  å¼€å¯BaseColumnList</span><br><span class="line">        gc.setBaseColumnList(true);</span><br><span class="line">        &#x2F;&#x2F;å®ä½“å±æ€§ Swagger2 æ³¨è§£</span><br><span class="line">        gc.setSwagger2(true); &#x2F;&#x2F;å®ä½“å±æ€§ Swagger2 æ³¨è§£</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; æ•°æ®æºé…ç½®</span><br><span class="line">        DataSourceConfig dsc &#x3D; new DataSourceConfig();</span><br><span class="line">        dsc.setUrl(&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;yeb?useUnicode&#x3D;true&amp;useSSL&#x3D;false&amp;characterEncoding&#x3D;utf8&amp;serverTimezone&#x3D;Asia&quot; + &quot;&#x2F;Shanghai&quot;);</span><br><span class="line">        &#x2F;&#x2F; dsc.setSchemaName(&quot;public&quot;);</span><br><span class="line">        dsc.setDriverName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span><br><span class="line">        dsc.setUsername(&quot;root&quot;);</span><br><span class="line">        dsc.setPassword(&quot;rootzoux&quot;);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; åŒ…é…ç½®</span><br><span class="line">        PackageConfig pc &#x3D; new PackageConfig();</span><br><span class="line">&#x2F;&#x2F;        pc.setModuleName(scanner(&quot;æ¨¡å—å&quot;));</span><br><span class="line">        pc.setParent(&quot;com.zoux&quot;)</span><br><span class="line">                .setEntity(&quot;pojo&quot;)</span><br><span class="line">                .setMapper(&quot;mapper&quot;)</span><br><span class="line">                .setService(&quot;service&quot;)</span><br><span class="line">                .setServiceImpl(&quot;service.impl&quot;)</span><br><span class="line">                .setController(&quot;controller&quot;);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; è‡ªå®šä¹‰é…ç½®</span><br><span class="line">        InjectionConfig cfg &#x3D; new InjectionConfig() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void initMap() &#123;</span><br><span class="line">                &#x2F;&#x2F; to do nothing</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; å¦‚æœæ¨¡æ¿å¼•æ“æ˜¯ freemarker</span><br><span class="line">        String templatePath &#x3D; &quot;&#x2F;templates&#x2F;mapper.xml.ftl&quot;;</span><br><span class="line">        &#x2F;&#x2F; å¦‚æœæ¨¡æ¿å¼•æ“æ˜¯ velocity</span><br><span class="line">        &#x2F;&#x2F; String templatePath &#x3D; &quot;&#x2F;templates&#x2F;mapper.xml.vm&quot;;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; è‡ªå®šä¹‰è¾“å‡ºé…ç½®</span><br><span class="line">        List&lt;FileOutConfig&gt; focList &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">        &#x2F;&#x2F; è‡ªå®šä¹‰é…ç½®ä¼šè¢«ä¼˜å…ˆè¾“å‡º</span><br><span class="line">        focList.add(new FileOutConfig(templatePath) &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public String outputFile(TableInfo tableInfo) &#123;</span><br><span class="line">                &#x2F;&#x2F; è‡ªå®šä¹‰è¾“å‡ºæ–‡ä»¶å ï¼Œ å¦‚æœä½  Entity è®¾ç½®äº†å‰åç¼€ã€æ­¤å¤„æ³¨æ„ xml çš„åç§°ä¼šè·Ÿç€å‘ç”Ÿå˜åŒ–ï¼ï¼</span><br><span class="line">&#x2F;&#x2F;                return projectPath + &quot;&#x2F;src&#x2F;main&#x2F;resources&#x2F;mapper&#x2F;&quot; + pc.getModuleName()</span><br><span class="line">&#x2F;&#x2F;                        + &quot;&#x2F;&quot; + tableInfo.getEntityName() + &quot;Mapper&quot; + StringPool.DOT_XML;</span><br><span class="line">                return projectPath + &quot;&#x2F;yeb-generator&#x2F;src&#x2F;main&#x2F;resources&#x2F;mapper&#x2F;&quot; + tableInfo.getEntityName() + &quot;Mapper&quot; + StringPool.DOT_XML;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        &#x2F;*</span><br><span class="line">        cfg.setFileCreate(new IFileCreate() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean isCreate(ConfigBuilder configBuilder, FileType fileType, String filePath) &#123;</span><br><span class="line">                &#x2F;&#x2F; åˆ¤æ–­è‡ªå®šä¹‰æ–‡ä»¶å¤¹æ˜¯å¦éœ€è¦åˆ›å»º</span><br><span class="line">                checkDir(&quot;è°ƒç”¨é»˜è®¤æ–¹æ³•åˆ›å»ºçš„ç›®å½•ï¼Œè‡ªå®šä¹‰ç›®å½•ç”¨&quot;);</span><br><span class="line">                if (fileType &#x3D;&#x3D; FileType.MAPPER) &#123;</span><br><span class="line">                    &#x2F;&#x2F; å·²ç»ç”Ÿæˆ mapper æ–‡ä»¶åˆ¤æ–­å­˜åœ¨ï¼Œä¸æƒ³é‡æ–°ç”Ÿæˆè¿”å› false</span><br><span class="line">                    return !new File(filePath).exists();</span><br><span class="line">                &#125;</span><br><span class="line">                &#x2F;&#x2F; å…è®¸ç”Ÿæˆæ¨¡æ¿æ–‡ä»¶</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        *&#x2F;</span><br><span class="line">        cfg.setFileOutConfigList(focList);</span><br><span class="line">        mpg.setCfg(cfg);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; é…ç½®æ¨¡æ¿</span><br><span class="line">        TemplateConfig templateConfig &#x3D; new TemplateConfig();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; é…ç½®è‡ªå®šä¹‰è¾“å‡ºæ¨¡æ¿</span><br><span class="line">        &#x2F;&#x2F;æŒ‡å®šè‡ªå®šä¹‰æ¨¡æ¿è·¯å¾„ï¼Œæ³¨æ„ä¸è¦å¸¦ä¸Š.ftl&#x2F;.vm, ä¼šæ ¹æ®ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“è‡ªåŠ¨è¯†åˆ«</span><br><span class="line">        &#x2F;&#x2F; templateConfig.setEntity(&quot;templates&#x2F;entity2.java&quot;);</span><br><span class="line">        &#x2F;&#x2F; templateConfig.setService();</span><br><span class="line">        &#x2F;&#x2F; templateConfig.setController();</span><br><span class="line"></span><br><span class="line">        templateConfig.setXml(null);</span><br><span class="line">        mpg.setTemplate(templateConfig);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; ç­–ç•¥é…ç½®</span><br><span class="line">        StrategyConfig strategy &#x3D; new StrategyConfig();</span><br><span class="line">        &#x2F;&#x2F;æ•°æ®åº“è¡¨æ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥</span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        &#x2F;&#x2F;æ•°æ®åº“è¡¨å­—æ®µæ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥</span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.no_change);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;strategy.setSuperEntityClass(&quot;ä½ è‡ªå·±çš„çˆ¶ç±»å®ä½“,æ²¡æœ‰å°±ä¸ç”¨è®¾ç½®!&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;lombok æ¨¡å‹</span><br><span class="line">        strategy.setEntityLombokModel(true);</span><br><span class="line">        &#x2F;&#x2F;ç”Ÿæˆ@RestController æ§åˆ¶å™¨ è¿™ä¸ªç›¸å¯¹äºæ™®é€šcontroller è¿”å›æ•°æ®ä¸ºjsonå­—ç¬¦ä¸²</span><br><span class="line">        strategy.setRestControllerStyle(true);</span><br><span class="line">        &#x2F;&#x2F; å…¬å…±çˆ¶ç±»</span><br><span class="line">        &#x2F;&#x2F;strategy.setSuperControllerClass(&quot;ä½ è‡ªå·±çš„çˆ¶ç±»æ§åˆ¶å™¨,æ²¡æœ‰å°±ä¸ç”¨è®¾ç½®!&quot;);</span><br><span class="line">        &#x2F;&#x2F; å†™äºçˆ¶ç±»ä¸­çš„å…¬å…±å­—æ®µ</span><br><span class="line">        &#x2F;&#x2F;strategy.setSuperEntityColumns(&quot;id&quot;);</span><br><span class="line">        strategy.setInclude(scanner(&quot;è¡¨åï¼Œå¤šä¸ªè‹±æ–‡é€—å·åˆ†å‰²&quot;).split(&quot;,&quot;));</span><br><span class="line">        strategy.setControllerMappingHyphenStyle(true);</span><br><span class="line">        &#x2F;&#x2F;è¡¨å‰ç¼€</span><br><span class="line">        &#x2F;&#x2F;strategy.setTablePrefix(pc.getModuleName() + &quot;_&quot;);</span><br><span class="line">        strategy.setTablePrefix(&quot;t_&quot;);</span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        mpg.setTemplateEngine(new FreemarkerTemplateEngine());</span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">8âƒ£ï¸è¿è¡Œï¼Œè¾“å…¥è¡¨åï¼Œ</span><br><span class="line">9âƒ£ï¸å°†æ‰€æœ‰ç”Ÿæˆçš„ç±»æ‹·è´åˆ°yeb-server</span><br><span class="line">ğŸ”Ÿæ›´æ”¹è·¯å¾„ï¼Œå’Œæ·»åŠ swaggerä¾èµ–</span><br><span class="line">	        &lt;!--Swagger2 ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger2&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.7.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--Swaggerç¬¬ä¸‰æ–¹UIä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.github.xiaoymin&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;swagger-bootstrap-ui&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.9.6&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Jwt-Tokenå·¥å…·ç±»"><a href="#Jwt-Tokenå·¥å…·ç±»" class="headerlink" title="Jwt Tokenå·¥å…·ç±»"></a>Jwt Tokenå·¥å…·ç±»</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸å¼•å…¥jwtï¼Œsecurityä¾èµ–</span><br><span class="line">	 		&lt;!--security ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-security&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--JWT ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.jsonwebtoken&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jjwt&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;0.9.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">2âƒ£ï¸å¼•å…¥securityé…ç½®ï¼Œapplication.yml</span><br><span class="line">jwt:</span><br><span class="line">  #JWTå­˜å‚¨çš„è¯·æ±‚å¤´</span><br><span class="line">  tokenHeader: Authorization</span><br><span class="line">  #JWT åŠ å¯†ä½¿ç”¨çš„å¯†é’¥</span><br><span class="line">  secret: yeb-secret</span><br><span class="line">  #JWT çš„è¶…æœŸé™æ—¶é—´ ï¼ˆ60*60*24ï¼‰</span><br><span class="line">  expiration: 604800</span><br><span class="line">  #JWT è´Ÿè½½ä¸­æ‹¿åˆ°å¼€å¤´</span><br><span class="line">  tokenHead: Bearer</span><br><span class="line">3âƒ£ï¸æ–°å»ºåŒ…config.security</span><br><span class="line">4âƒ£ï¸æ–°å»ºJwtTokenUtilç±» </span><br><span class="line">5âƒ£ï¸æ·»åŠ æ³¨è§£@Component </span><br><span class="line">	æŠŠæ™®é€špojoå®ä¾‹åŒ–åˆ°springå®¹å™¨ä¸­ï¼Œç›¸å½“äºé…ç½®æ–‡ä»¶ä¸­çš„æ³›æŒ‡å„ç§ç»„ä»¶ï¼Œå°±æ˜¯è¯´å½“æˆ‘ä»¬çš„ç±»ä¸å±äºå„ç§å½’ç±»çš„æ—¶å€™ï¼ˆä¸å±äº@Controllerã€@Servicesç­‰çš„æ—¶å€™ï¼‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨@Componentæ¥æ ‡æ³¨è¿™ä¸ªç±»</span><br><span class="line">6âƒ£ï¸å‡†å¤‡è·è½½å˜é‡</span><br><span class="line">	CLAIM_KEY_USERNAME</span><br><span class="line">	CLAIM_KEY_CREATED</span><br><span class="line">	secret</span><br><span class="line">	expiration</span><br><span class="line">	</span><br><span class="line">		private static final String CLAIM_KEY_USERNAME&#x3D;&quot;sub&quot;;</span><br><span class="line">    private static final String CLAIM_KEY_CREATED&#x3D;&quot;created&quot;;</span><br><span class="line">    @Value(&quot;$&#123;jwt.secret&#125;&quot;)</span><br><span class="line">    private String secret;</span><br><span class="line">    @Value(&quot;$&#123;jwt.expiration&#125;&quot;)</span><br><span class="line">    private Long expiration;</span><br><span class="line">    </span><br><span class="line">7âƒ£ï¸ä¸»è¦åŠŸèƒ½</span><br><span class="line">	ä¸€ æ ¹æ®ç”¨æˆ·åç”Ÿæˆtoken</span><br><span class="line">	1ï¼Œæ ¹æ®ç”¨æˆ·ä¿¡æ¯ç”Ÿæˆtoken</span><br><span class="line">		public String generatorToken(UserDetails userDetails) &#123;</span><br><span class="line">        Map&lt;String, Object&gt; claims &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        claims.put(CLAIM_KEY_USERNAME, userDetails.getUsername());</span><br><span class="line">        claims.put(CLAIM_KEY_CREATED, new Date());</span><br><span class="line">        return generatorToken();</span><br><span class="line">        &#125;</span><br><span class="line">  2ï¼Œæ ¹æ®è·è½½ç”ŸæˆJWT TOKEN</span><br><span class="line">  	private String generatorToken(Map&lt;String,Object&gt; claims) &#123;</span><br><span class="line">        return Jwts.builder()</span><br><span class="line">                .setClaims(claims)</span><br><span class="line">                .setExpiration(generateExpirationDate())</span><br><span class="line">                .signWith(SignatureAlgorithm.ES512,secret)</span><br><span class="line">                .compact();</span><br><span class="line">                &#125;</span><br><span class="line">  3ï¼Œç”Ÿæˆtokenå¤±æ•ˆæ—¶é—´</span><br><span class="line">   private Date generateExpirationDate() &#123;</span><br><span class="line">        return new Date(System.currentTimeMillis() + expiration * 1000);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"> äºŒ ä»tokenæ‹¿ç”¨æˆ·å</span><br><span class="line">  1ï¼Œä»tokenä¸­è·å¾—ç™»å½•ç”¨æˆ·å</span><br><span class="line">  public String getUserNameFromToken(String token) &#123;</span><br><span class="line">        String username;</span><br><span class="line">        try &#123;</span><br><span class="line">            Claims claims &#x3D; getClaimsFromToken(token);</span><br><span class="line">            username &#x3D; claims.getSubject();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            username &#x3D; null;</span><br><span class="line">        &#125;</span><br><span class="line">        return username;</span><br><span class="line">    &#125;</span><br><span class="line">  2ï¼Œä»tokené‡Œé¢è·å–è·è½½</span><br><span class="line">  private Claims getClaimsFromToken(String token) &#123;</span><br><span class="line">        Claims claims &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            claims &#x3D; Jwts.parser()</span><br><span class="line">                    .setSigningKey(secret)</span><br><span class="line">                    .parseClaimsJws(token)</span><br><span class="line">                    .getBody();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return claims;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">	ä¸‰ åˆ¤æ–­tokenæ˜¯å¦å¤±æ•ˆ</span><br><span class="line">	1ï¼Œtokenæ˜¯å¦è¿‡æœŸ</span><br><span class="line">	 private boolean isTokenExpired(String token) &#123;</span><br><span class="line">        Date expiredDate &#x3D; getExpiredDateFromToken(token);</span><br><span class="line">        return expiredDate.before(new Date());</span><br><span class="line">    &#125;</span><br><span class="line">    private Date getExpiredDateFromToken(String token) &#123;</span><br><span class="line">        Claims claims &#x3D; getClaimsFromToken(token);</span><br><span class="line">        return claims.getExpiration();</span><br><span class="line">    &#125;</span><br><span class="line">	2ï¼Œtokené‡Œé¢çš„ç”¨æˆ·åä¸userDetailé‡Œé¢ç”¨æˆ·åæ˜¯å¦ä¸€è‡´</span><br><span class="line">	public boolean validateToken(String token, UserDetails userDetails) &#123;</span><br><span class="line">        String username &#x3D; getUserNameFromToken(token);</span><br><span class="line">        return username.equals(userDetails.getUsername()) &amp;&amp; !isTokenExpired(token);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">	å›› æ˜¯å¦å¯ä»¥åˆ·æ–°token</span><br><span class="line">	 public boolean canRefresh(String token) &#123;</span><br><span class="line">        return !isTokenExpired(token);</span><br><span class="line">    &#125;</span><br><span class="line">	äº” åˆ·æ–°token</span><br><span class="line">	public String refreshToken(String token) &#123;</span><br><span class="line">        Claims claims &#x3D; getClaimsFromToken(token);</span><br><span class="line">        claims.put(CLAIM_KEY_CREATED, new Date());</span><br><span class="line">        return generatorToken(claims);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="å…¬å…±è¿”å›å¯¹è±¡"><a href="#å…¬å…±è¿”å›å¯¹è±¡" class="headerlink" title="å…¬å…±è¿”å›å¯¹è±¡"></a>å…¬å…±è¿”å›å¯¹è±¡</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ç™»å½•æµç¨‹ï¼š</span><br><span class="line">	å‰ç«¯ä¼ ç”¨æˆ·åå’Œå¯†ç </span><br><span class="line">	åç«¯æ ¡éªŒç”¨æˆ·åå’Œå¯†ç ï¼Œ</span><br><span class="line">		æœ‰é”™è¯¯å°±é‡æ–°è¾“å…¥</span><br><span class="line">		æ­£ç¡®å°±ä¼šç”ŸæˆJWTä»¤ç‰Œï¼Œå¹¶ä¸”è¿”å›ç»™å‰ç«¯ï¼Œå‰ç«¯è·å¾—JWTä»¤ç‰Œå°±ä¼šæ”¾å…¥åˆ°è¯·æ±‚å¤´é‡Œé¢ï¼Œä»»ä½•è¯·æ±‚éƒ½ä¼šæºå¸¦JWTä»¤ç‰Œï¼Œ</span><br><span class="line">		åç«¯ä¼šæœ‰å¯¹åº”çš„æ‹¦æˆªå™¨ï¼Œå¯¹JWTä»¤ç‰Œåšç›¸åº”çš„éªŒè¯ï¼ŒéªŒè¯é€šè¿‡æ‰èƒ½è®¿é—®å¯¹åº”çš„æ¥å£ï¼ŒéªŒè¯ä¸é€šè¿‡ï¼Œä»¤ç‰Œå¯èƒ½å¤±æ•ˆäº†ï¼Œå¯èƒ½æ˜¯ç”¨æˆ·åæœ‰é—®é¢˜ï¼Œæˆ–è€…å¯†ç æœ‰é—®é¢˜ï¼Œä¸æ˜¯åˆæ³•ç™»é™†</span><br><span class="line">		</span><br><span class="line">1âƒ£ï¸åœ¨pojoæ–°å»ºå…¬å…±è¿”å›å¯¹è±¡RespBean</span><br><span class="line">2âƒ£ï¸åŠ æ³¨è§£@Dataï¼Œç”Ÿæˆgetters and setters</span><br><span class="line">	@NoArgsConstructor æ— å‚</span><br><span class="line">	@AllArgsConstructor	æœ‰å‚</span><br><span class="line">3âƒ£ï¸æˆåŠŸï¼Œå¤±è´¥è¿”å›æ–¹æ³•ï¼Œå…¬å…±å˜é‡ï¼Œcode message obj</span><br><span class="line"> public static RespBean success(String message) &#123;</span><br><span class="line">        return new RespBean(200, message, null);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="ç™»å½•ä¹‹åè¿”å›token"><a href="#ç™»å½•ä¹‹åè¿”å›token" class="headerlink" title="ç™»å½•ä¹‹åè¿”å›token"></a>ç™»å½•ä¹‹åè¿”å›token</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">ä¸€ å‰ç«¯ä¼ ç”¨æˆ·åå¯†ç ï¼Œåç«¯æ ¡éªŒ</span><br><span class="line">	1âƒ£ï¸Adminç±»ï¼Œé‡Œé¢å®ç°springsecurityæ¡†æ¶UserDetails</span><br><span class="line">	å®ç°æ–¹æ³•ï¼Œé™¤äº†getAuthoritiesçš„è¿”å›å€¼ä¸å˜ï¼ŒisEnabledè¿”å›å€¼ä¸ºå±æ€§å­—æ®µenabledï¼Œ</span><br><span class="line">	å…¶ä»–çš„éƒ½è¿”å›true</span><br><span class="line">	2âƒ£ï¸æ–°å»ºç™»é™†å®ä½“ç±» AdminLoginParam</span><br><span class="line">		æ·»åŠ lombokæ³¨è§£</span><br><span class="line">			@Data</span><br><span class="line">			@EqualsAndHashCode æ­¤æ³¨è§£ä¼šç”Ÿæˆequals(Object other) å’Œ hashCode()æ–¹æ³• callSuperæ˜¯å¦è°ƒç”¨çˆ¶ç±»ä¸­çš„æ–¹æ³•</span><br><span class="line">			@Accessors(chain &#x3D; true)ï¼ŒAccessorsç¿»è¯‘æ˜¯å­˜å–å™¨ã€‚é€šè¿‡è¯¥æ³¨è§£å¯ä»¥æ§åˆ¶getterå’Œsetteræ–¹æ³•çš„å½¢å¼chainä¸ºtrueï¼Œsetteræ–¹æ³•è¿”å›å½“å‰å¯¹è±¡</span><br><span class="line">		  @ApiModel(value &#x3D; &quot;AdminLoginå¯¹å¯¹è±¡&quot;,description &#x3D; &quot;&quot; swaggeræ³¨è§£</span><br><span class="line">		  @ApiModelProperty(value &#x3D; &quot;å¯†ç &quot;,required &#x3D; true) swaggeræ³¨è§£ï¼Œrequiredæ˜¯å¦å¿…å¡«</span><br><span class="line">	3âƒ£ï¸controllerç¼–å†™ï¼ŒLoginController</span><br><span class="line">		æ³¨è§£ï¼š</span><br><span class="line">			@Api(tags &#x3D; &quot;LoginController&quot;) è¡¨ç¤ºæ ‡è¯†è¿™ä¸ªç±»æ˜¯swaggerçš„èµ„æº </span><br><span class="line">			@RestController ç­‰åŒäº@Controller + @ResponseBodyï¼Œè¡¨æ˜äº†è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªæ§åˆ¶å™¨ç±»+è¡¨ç¤ºæ–¹æ³•çš„è¿”å›å€¼ç›´æ¥ä»¥æŒ‡å®šçš„æ ¼å¼å†™å…¥Http response body</span><br><span class="line">      @ApiOperation(value &#x3D; &quot;ç™»é™†ä¹‹åè¿”å›token&quot;)è¡¨ç¤ºä¸€ä¸ªhttpè¯·æ±‚çš„æ“ä½œ </span><br><span class="line">       @PostMapping(&quot;&#x2F;login&quot;) æ˜ å°„ä¸€ä¸ªPOSTè¯·æ±‚ </span><br><span class="line">   4âƒ£ï¸æ·»åŠ æ–¹æ³• loginï¼Œå‚æ•° AdminLoginParamï¼ŒHttpServletRequest</span><br><span class="line">      public RespBean login(AdminLoginParam adminLoginParam, HttpServletRequest request);</span><br><span class="line">   5âƒ£ï¸å¼•å…¥IAdminServiceï¼Œå¹¶åŠ å…¥æ–¹æ³•loginï¼Œå‚æ•°ï¼ˆç”¨æˆ·åï¼Œå¯†ç ï¼Œrequestï¼‰</span><br><span class="line">   6âƒ£ï¸åœ¨IAminServiceé‡Œé¢å®ç°login</span><br><span class="line">   7âƒ£ï¸åœ¨AdminServiceImplå®ç°login</span><br><span class="line">   	 æ³¨å…¥UserDetailsService</span><br><span class="line">   	 é€šè¿‡UserDetailsServiceï¼Œè·å¾—UserDetails</span><br><span class="line">   	 æ³¨å…¥PasswordEncoder</span><br><span class="line">   	 åˆ©ç”¨PasswordEncoder åŒ¹é…ä¸€ä¸‹å¯†ç </span><br><span class="line">   	 åˆ¤æ–­userDetailsè´¦æˆ·æ˜¯å¦ç¦ç”¨</span><br><span class="line">   	 æ³¨å…¥JWTå·¥å…·ç±»</span><br><span class="line">   	 ç”Ÿæˆtoken</span><br><span class="line">   	 æ³¨å…¥tokenHeadï¼Œjwté…ç½®</span><br><span class="line">   	 å°†tokenè£…å…¥map</span><br><span class="line">		 ä½¿ç”¨springsecurityæ¡†æ¶ï¼Œç™»é™†æˆåŠŸåï¼Œè·å–ç”¨æˆ·ä¿¡æ¯å¯ä»¥ä½¿ç”¨springsecurityæä¾›çš„å¯¹è±¡userdetailsç­‰</span><br><span class="line">		 æ‰€ä»¥ç™»å½•æ—¶ï¼Œè¦å°†ç”¨æˆ·ä¿¡æ¯æ”¾å…¥springsecurityå…¨æ–‡ä¸­</span><br><span class="line">		 UsernamePasswordAuthenticationToken authenticationToken &#x3D; new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());</span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(authenticationToken);</span><br><span class="line">	8âƒ£ï¸passwordEncoderå¯¹è±¡ç­‰å¾…å¤„ç†</span><br></pre></td></tr></table></figure>
<h1 id="è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯"><a href="#è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯"></a>è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ç™»é™†æ—¶å°†å½“å‰ç™»å½•å¯¹è±¡è®¾åˆ¶åˆ°springsecurityå…¨å±€ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨Principalè·å–å½“å‰ç™»å½•ç”¨æˆ·å¯¹è±¡</span><br><span class="line">1âƒ£ï¸åœ¨LoginControlleræ–°å»ºæ–¹æ³•getAdminInfo</span><br><span class="line">2âƒ£ï¸åˆ©ç”¨Principalè·å–ç”¨æˆ·å¯¹è±¡</span><br><span class="line">3âƒ£ï¸å°†è·å¾—adminå¯¹è±¡å¯†ç ç½®ç©ºï¼Œé¿å…å‰ç«¯è·å–æ˜æ–‡å¯†ç </span><br><span class="line">4âƒ£ï¸åœ¨IAdminServiceå®šä¹‰getAdminByUserName</span><br><span class="line">5âƒ£ï¸åœ¨AdminServiceImplå®ç°getAdminByUserName</span><br><span class="line">	æ³¨å…¥AdminMapper</span><br><span class="line">	return adminMapper.selectOne(</span><br><span class="line">			newQueryWrapper&lt;Admin()</span><br><span class="line">					   .eq(&quot;username&quot;,username)</span><br><span class="line">					   .eq(&quot;enabled&quot;, true)</span><br><span class="line">					   );</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="é€€å‡ºç™»å½•"><a href="#é€€å‡ºç™»å½•" class="headerlink" title="é€€å‡ºç™»å½•"></a>é€€å‡ºç™»å½•</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åç«¯è¿”å›200çŠ¶æ€ç ï¼Œå‰ç«¯æ ¹æ®çŠ¶æ€ç ï¼Œå°†è¯·æ±‚å¤´é‡Œé¢çš„tokenåˆ é™¤ </span><br><span class="line">1âƒ£ï¸åœ¨LoginControlleré‡Œé¢ æ–°å»ºæ–¹æ³•logout è¿”å›çŠ¶æ€ç 200</span><br></pre></td></tr></table></figure>
<h1 id="é…ç½®securityç™»é™†è¿‡æ»¤å™¨"><a href="#é…ç½®securityç™»é™†è¿‡æ»¤å™¨" class="headerlink" title="é…ç½®securityç™»é™†è¿‡æ»¤å™¨"></a>é…ç½®securityç™»é™†è¿‡æ»¤å™¨</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸å‡†å¤‡é…ç½®ç±»SecurityConfigï¼Œç»§æ‰¿ WebSecurityConfigurerAdapter</span><br><span class="line">2âƒ£ï¸æ³¨è§£@Configuration</span><br><span class="line">3âƒ£ï¸æ³¨å…¥Bean UserDetailsServiceï¼Œé‡å†™è¿™ä¸ªå®¹å™¨é‡Œçš„</span><br><span class="line">		@Override</span><br><span class="line">    @Bean</span><br><span class="line">    public UserDetailsService userDetailsService() &#123;</span><br><span class="line">        return username -&gt; &#123;</span><br><span class="line">            Admin admin &#x3D; adminService.getAdminByUserName(username);</span><br><span class="line">            if (null !&#x3D; admin) &#123;</span><br><span class="line">                return admin;</span><br><span class="line">            &#125;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">4âƒ£ï¸é‡å†™configureæ–¹æ³•ï¼Œèƒ½å¤Ÿå°†æˆ‘ä»¬é‡å†™çš„UserDetyailsService æ³¨å…¥åˆ°springsecurit</span><br><span class="line">5âƒ£ï¸å®ç°passwordEncoderå®¹å™¨</span><br><span class="line">6âƒ£ï¸é‡å†™springsecurityé…ç½®configure(HttpSecurity http)</span><br><span class="line">	å…³é—­scrfï¼Œä½¿ç”¨JWTä¸éœ€è¦csrf</span><br><span class="line">	 http.csrf()</span><br><span class="line">        .disable()</span><br><span class="line">	å…³é—­sessionç›¸å…³çš„</span><br><span class="line">		åŸºäºtokenä¸éœ€è¦session</span><br><span class="line">                .sessionManagement()</span><br><span class="line">                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">	å…è®¸ç™»é™†è®¿é—®</span><br><span class="line">		.antMatchers(&quot;&#x2F;login&quot;, &quot;logout&quot;)</span><br><span class="line">	é…ç½®ç”Ÿæ•ˆ</span><br><span class="line">		.permitAll();</span><br><span class="line">	è®¿é—®è¯·æ±‚è¦æ±‚è®¤è¯</span><br><span class="line">                .anyRequest()</span><br><span class="line">                .authenticated()</span><br><span class="line">   ç¼“å­˜å…³é—­</span><br><span class="line">                .headers()</span><br><span class="line">                .cacheControl();</span><br><span class="line">   æ·»åŠ jwtç™»é™†æˆæƒæ‹¦æˆªå™¨</span><br><span class="line">        http.addFilterBefore();</span><br><span class="line">   è‡ªå®šä¹‰æœªæˆæƒï¼Œæˆ–è€…æœªç™»å½•çš„ç»“æœè¿”å›</span><br><span class="line">        http.exceptionHandling()</span><br><span class="line">                .accessDeniedHandler()</span><br><span class="line">                .authenticationEntryPoint();</span><br><span class="line">7âƒ£ï¸å‡†å¤‡jwtçš„ç™»é™†è¿‡æ»¤å™¨ JwtAuthorizationTokenFilter ç»§æ‰¿OncePerRequestFilter é‡å†™doFilterInternal&#x3D;&#x3D;ç›¸å½“äºå‰ç½®æ‹¦æˆª</span><br><span class="line">	é€šè¿‡requestè·å–Header</span><br><span class="line">	è¿›è¡Œtokenæ ¡éªŒ</span><br><span class="line">		tokenæ˜¯å¦å­˜åœ¨ï¼Œtokenæ˜¯å¦ä»¥tokenHeadä¸ºå¼€å¤´</span><br><span class="line">	åˆ©ç”¨JwtUtilsè·å–ç”¨æˆ·å</span><br><span class="line">	è¿›è¡Œç”¨æˆ·ååˆ¤æ–­</span><br><span class="line">		åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦ä¸ºç©ºï¼ŒåŒæ—¶æ£€æŸ¥springsecurityå…¨å±€ä¸Šä¸‹æ–‡æ‰¾ä¸åˆ°ç”¨æˆ·å¯¹è±¡ï¼Œå³æœªç™»å½•</span><br><span class="line">	è·å–userdetailsï¼Œç›¸å½“äºç™»é™†äº†</span><br><span class="line">	åˆ¤æ–­tokenæ˜¯å¦æœ‰æ•ˆï¼Œæœ‰æ•ˆå°±å°†tokené‡æ–°æ”¾å…¥ç”¨æˆ·å¯¹è±¡	</span><br><span class="line">		é‡æ–°è®¾ç½®ç”¨æˆ·å¯¹è±¡,æ›´æ–°è·è½½</span><br><span class="line">		é‡æ–°è®¾ç½®ç”¨æˆ·å¯¹è±¡ï¼Œæ›´æ–°details</span><br><span class="line">		è®¾ç½®springsecurityå…¨å±€ä¸Šä¸‹æ–‡</span><br><span class="line">	ç»è¿‡ä¸€ç³»åˆ—éªŒè¯ï¼Œæœ€åè¿›è¡Œæ”¾è¡Œ</span><br><span class="line">8âƒ£ï¸å›åˆ°SecurityConfigç±»ï¼Œåˆ©ç”¨Beanæ³¨è§£å°†JwtAuthorizationTokenFilteræš´éœ²å‡ºæ¥</span><br><span class="line">	å¹¶å¡«å…¥ã€æ·»åŠ jwtç™»é™†æˆæƒæ‹¦æˆªå™¨ã€‘åŒæ—¶åŠ ä¸Šå‚æ•°ï¼ŒUsernamePasswordAuthenticationFilter.class</span><br></pre></td></tr></table></figure>
<h1 id="securityè‡ªå®šä¹‰è¿”å›ç»“æœ"><a href="#securityè‡ªå®šä¹‰è¿”å›ç»“æœ" class="headerlink" title="securityè‡ªå®šä¹‰è¿”å›ç»“æœ"></a>securityè‡ªå®šä¹‰è¿”å›ç»“æœ</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸æ–°å»ºç±»RestAuthorizationEntryPointï¼Œå®ç°AuthenticationEntryPoint</span><br><span class="line">2âƒ£ï¸é€šè¿‡responseè®¾ç½®å­—ç¬¦é›†</span><br><span class="line">3âƒ£ï¸è®¾ç½®æ•°æ®äº¤æµæ ¼å¼</span><br><span class="line">4âƒ£ï¸è·å–è¾“å‡ºæµ</span><br><span class="line">5âƒ£ï¸è‡ªå®šä¹‰è¿”å›ç±»å‹</span><br><span class="line"></span><br><span class="line">1âƒ£ï¸æ–°å»ºç±»RestfulAccessDeniedHandlerå®ç°AccessDeniedHandleré‡å†™handleæ–¹æ³•</span><br><span class="line">2âƒ£ï¸é€šè¿‡responseè®¾ç½®å­—ç¬¦é›†</span><br><span class="line">3âƒ£ï¸è®¾ç½®æ•°æ®äº¤æµæ ¼å¼</span><br><span class="line">4âƒ£ï¸è·å–è¾“å‡ºæµ</span><br><span class="line">5âƒ£ï¸è‡ªå®šä¹‰è¿”å›ç±»å‹</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åœ¨SecurityConfigç±»ä¸­è¿›è¡Œæ³¨å…¥RestAuthorizationEntryPointï¼ŒRestfulAccessDeniedHandler</span><br><span class="line">å°†æ³¨å…¥çš„ä¸¤ä¸ªç±»æ”¾å…¥é…ç½®ä¸­</span><br></pre></td></tr></table></figure>
<p>swagger2é…èµ„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸pomä¾èµ–</span><br><span class="line">	 &lt;!--Swagger2 ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger2&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.7.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--Swaggerç¬¬ä¸‰æ–¹UIä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.github.xiaoymin&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;swagger-bootstrap-ui&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.9.6&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line"> 2âƒ£ï¸é…ç½®swaggerï¼Œæ–°å»ºSwagger2Configç±»</span><br><span class="line"> 		æ³¨è§£</span><br><span class="line"> 		@Component é…ç½®ç±»</span><br><span class="line">		@EnableSwagger2 å¼€å¯swagger2</span><br><span class="line"> 3âƒ£ï¸å‡†å¤‡APiInfo</span><br><span class="line"> 4âƒ£ï¸æ³¨å…¥beanï¼Œè§„å®šæ‰«æé‚£äº›åŒ…ï¼Œå…·ä½“ä»€ä¹ˆåŒ…ï¼Œä»»æ„è·¯å¾„	 	</span><br><span class="line"> 5âƒ£ï¸å¯åŠ¨æµ‹è¯•ï¼Œé‡å†™å…è®¸é€šè¿‡æ–¹æ³•ï¼Œæ·»åŠ é€šè¿‡èµ„æº</span><br><span class="line"> 	 public void configure(WebSecurity web) throws Exception &#123;</span><br><span class="line">        web.ignoring().antMatchers(</span><br><span class="line">                &quot;&#x2F;login&quot;,</span><br><span class="line">                &quot;&#x2F;logout&quot;,</span><br><span class="line">                &quot;&#x2F;css&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;js&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;index.html&quot;,</span><br><span class="line">                &quot;favicon.ico&quot;,</span><br><span class="line">                &quot;&#x2F;doc.html&quot;,</span><br><span class="line">                &quot;&#x2F;webjars&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;swagger-resources&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;v2&#x2F;api-docs&#x2F;**&quot;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="swagger2æä¾›Authorize"><a href="#swagger2æä¾›Authorize" class="headerlink" title="swagger2æä¾›Authorize"></a>swagger2æä¾›Authorize</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">å®ç°å…¨å±€ç™»å½•</span><br><span class="line">1âƒ£ï¸åœ¨swagger2configç±»createRestApiæ–¹æ³•é‡Œé¢ç»§ç»­æ·»åŠ  </span><br><span class="line">																	.securityContexts()</span><br><span class="line">									                .securitySchemes();</span><br><span class="line">2âƒ£ï¸å®ŒæˆsecuritySchemes</span><br><span class="line">	è®¾ç½®è¯·æ±‚å¤´ä¿¡æ¯</span><br><span class="line">		æ–°å»ºList</span><br><span class="line">		æ–°å»ºApiKeyï¼Œä¸‰ä¸ªå‚æ•°</span><br><span class="line">		å°†ApiKeyåŠ å…¥List</span><br><span class="line">		è¿”å›List</span><br><span class="line">3âƒ£ï¸å®ŒæˆsecurityContexts</span><br><span class="line">	è®¾ç½®ç™»é™†è®¿é—®è®¤è¯è·¯å¾„</span><br><span class="line">	result.add(getContextByPath(&quot;&#x2F;hello&#x2F;.*&quot;));</span><br><span class="line">	é»˜è®¤æƒé™</span><br><span class="line">	.securityReferences(defaultAuth())</span><br><span class="line">	æŒ‡ä»£è·¯å¾„</span><br><span class="line">	.forPaths(PathSelectors.regex(pathRegex))</span><br><span class="line">	é»˜è®¤æƒé™</span><br><span class="line">		æˆæƒèŒƒå›´</span><br><span class="line">			AuthorizationScope authorizationScope &#x3D; new AuthorizationScope(&quot;global&quot;, &quot;accessEverything&quot;);</span><br><span class="line">     	result.add(new SecurityReference(&quot;Authorization&quot;, authorizationScopes));</span><br><span class="line">4âƒ£ï¸jsonä¼ å‚</span><br><span class="line">æ›´æ”¹LoginController&#x2F;login å‚æ•°æ³¨è§£@RequestBody ï¼Œæ›´æ”¹JwtTokenUtil&#x2F;generatorToken&#x2F;åŠ å¯†æ¨¡å¼HS512</span><br><span class="line">5âƒ£ï¸æ³¨æ„ï¼ŒSecurityConfig&#x2F;configureï¼ˆWebSecurity webï¼‰é‡Œé¢æ”¾è¡Œçš„é…ç½®ä¸SecurityConfig&#x2F;configure(HttpSecurity http)çš„æ”¾è¡Œé…ç½®é‡åˆï¼Œ</span><br><span class="line">å¯ä»¥å°†SecurityConfig&#x2F;configure(HttpSecurity http)çš„loginæ”¾è¡Œé…ç½®è¿›è¡Œæ³¨é‡Š</span><br><span class="line">	.antMatchers(&quot;&#x2F;login&quot;, &quot;&#x2F;logout&quot;)</span><br><span class="line">  .permitAll()</span><br><span class="line">6âƒ£ï¸è¿›è¡ŒAuthorizeè®¾ç½®ï¼Œå°†Bearerç©ºæ ¼tokonè¿›è¡Œä¿å­˜</span><br></pre></td></tr></table></figure>
<h1 id="ç”ŸæˆéªŒè¯ç "><a href="#ç”ŸæˆéªŒè¯ç " class="headerlink" title="ç”ŸæˆéªŒè¯ç "></a>ç”ŸæˆéªŒè¯ç </h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸å¼•å…¥GoogleéªŒè¯ç ä¾èµ–</span><br><span class="line">	 &lt;!--éªŒè¯ç --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.github.axet&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;kaptcha&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;0.0.9&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">2âƒ£ï¸å‡†å¤‡è°·æ­ŒéªŒè¯ç é…ç½®ç±»</span><br><span class="line">	æ³¨è§£@Configuration</span><br><span class="line">	å‡†å¤‡bean</span><br><span class="line">	å…·ä½“é…ç½®</span><br><span class="line">				&#x2F;&#x2F;éªŒè¯ç ç”Ÿæˆå™¨</span><br><span class="line">        DefaultKaptcha defaultKaptcha &#x3D; new DefaultKaptcha();</span><br><span class="line">        &#x2F;&#x2F;é…ç½®</span><br><span class="line">        Properties properties &#x3D; new Properties();</span><br><span class="line">        &#x2F;&#x2F;æ˜¯å¦æœ‰è¾¹æ¡†</span><br><span class="line">        properties.setProperty(&quot;kaptcha.border&quot;, &quot;yes&quot;);</span><br><span class="line">        &#x2F;&#x2F;è®¾ç½®è¾¹æ¡†é¢œè‰²</span><br><span class="line">        properties.setProperty(&quot;kaptcha.border.color&quot;, &quot;105,179,90&quot;);</span><br><span class="line">        &#x2F;&#x2F;è¾¹æ¡†ç²—ç»†åº¦ï¼Œé»˜è®¤ä¸º1</span><br><span class="line">        &#x2F;&#x2F; properties.setProperty(&quot;kaptcha.border.thickness&quot;,&quot;1&quot;);</span><br><span class="line">        &#x2F;&#x2F;éªŒè¯ç </span><br><span class="line">        properties.setProperty(&quot;kaptcha.session.key&quot;, &quot;code&quot;);</span><br><span class="line">        &#x2F;&#x2F;éªŒè¯ç æ–‡æœ¬å­—ç¬¦é¢œè‰² é»˜è®¤ä¸ºé»‘è‰²</span><br><span class="line">        properties.setProperty(&quot;kaptcha.textproducer.font.color&quot;, &quot;blue&quot;);</span><br><span class="line">        &#x2F;&#x2F;è®¾ç½®å­—ä½“æ ·å¼</span><br><span class="line">        properties.setProperty(&quot;kaptcha.textproducer.font.names&quot;, &quot;å®‹ä½“,æ¥·ä½“,å¾®è½¯é›… é»‘&quot;);</span><br><span class="line">        &#x2F;&#x2F;å­—ä½“å¤§å°ï¼Œé»˜è®¤40</span><br><span class="line">        properties.setProperty(&quot;kaptcha.textproducer.font.size&quot;, &quot;30&quot;);</span><br><span class="line">        &#x2F;&#x2F;éªŒè¯ç æ–‡æœ¬å­—ç¬¦å†…å®¹èŒƒå›´ é»˜è®¤ä¸ºabced2345678gfynmnpwx</span><br><span class="line">        &#x2F;&#x2F; properties.setProperty(&quot;kaptcha.textproducer.char.string&quot;, &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F;å­—ç¬¦é•¿åº¦ï¼Œé»˜è®¤ä¸º5</span><br><span class="line">        properties.setProperty(&quot;kaptcha.textproducer.char.length&quot;, &quot;4&quot;);</span><br><span class="line">        &#x2F;&#x2F;å­—ç¬¦é—´è· é»˜è®¤ä¸º2</span><br><span class="line">        properties.setProperty(&quot;kaptcha.textproducer.char.space&quot;, &quot;4&quot;);</span><br><span class="line">        &#x2F;&#x2F;éªŒè¯ç å›¾ç‰‡å®½åº¦ é»˜è®¤ä¸º200</span><br><span class="line">        properties.setProperty(&quot;kaptcha.image.width&quot;, &quot;100&quot;);</span><br><span class="line">        &#x2F;&#x2F;éªŒè¯ç å›¾ç‰‡é«˜åº¦ é»˜è®¤ä¸º40</span><br><span class="line">        properties.setProperty(&quot;kaptcha.image.height&quot;, &quot;40&quot;);</span><br><span class="line">        Config config &#x3D; new Config(properties);</span><br><span class="line">        defaultKaptcha.setConfig(config);</span><br><span class="line">        return defaultKaptcha;</span><br><span class="line">3âƒ£ï¸æ–°å»ºController</span><br><span class="line">	æ³¨è§£</span><br><span class="line">	ç±»æ³¨è§£  @RestController</span><br><span class="line">	@ApiOperation(value &#x3D; &quot;éªŒè¯ç &quot;)</span><br><span class="line">  @GetMapping(value &#x3D; &quot;&#x2F;captcha&quot;)</span><br><span class="line">  æ·»åŠ æ–¹æ³•captchaå‚æ•°ä¸ºï¼ˆHttpServletRequestï¼ŒHttpServletResponseï¼‰</span><br><span class="line">  é€šè¿‡æµä¼ é€’å›¾ç‰‡åˆ°å‰ç«¯,éœ€è¦å¯¹responseå“åº”å¤´åšç›¸åº”å¤„ç†</span><br><span class="line">  	response.setDateHeader(&quot;Expires&quot;, 0);</span><br><span class="line">    response.setHeader(&quot;Cache-Control&quot;, &quot;no-store, no-cache, must-revalidate&quot;);</span><br><span class="line">    response.addHeader(&quot;Cache-Control&quot;, &quot;post-check&#x3D;0, pre-check&#x3D;0&quot;);</span><br><span class="line">    response.setHeader(&quot;Pragma&quot;, &quot;no-cache&quot;);</span><br><span class="line">    response.setContentType(&quot;image&#x2F;jpeg&quot;);</span><br><span class="line">  æ³¨å…¥DefaultKaptcha</span><br><span class="line">  ç”ŸæˆéªŒè¯ç </span><br><span class="line">  è·å–éªŒè¯ç æ–‡æœ¬å†…å®¹</span><br><span class="line">  å°†éªŒè¯ç æ”¾å…¥session</span><br><span class="line">  æ ¹æ®textåˆ›å»ºå›¾åƒéªŒè¯ç </span><br><span class="line">  è¾“å‡ºæµè¾“å‡ºå›¾ç‰‡ï¼Œæ ¼å¼ä¸ºjpg</span><br><span class="line">4âƒ£ï¸æ·»åŠ æ”¾è¡ŒSecurityConfig&#x2F;configure(WebSecurity web)+&quot;&#x2F;captcha&quot;</span><br><span class="line">5âƒ£ï¸æ¥å£æ–‡æ¡£éªŒè¯ç ä¹±ç -åœ¨æ³¨è§£æ·»åŠ  @GetMapping(value &#x3D; &quot;&#x2F;captcha&quot;,produces &#x3D; &quot;image&#x2F;jpeg&quot;)</span><br></pre></td></tr></table></figure>
<h1 id="éªŒè¯ç æ ¡éªŒ"><a href="#éªŒè¯ç æ ¡éªŒ" class="headerlink" title="éªŒè¯ç æ ¡éªŒ"></a>éªŒè¯ç æ ¡éªŒ</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸åœ¨AdminLoginParamæ·»åŠ æ¥æ”¶å‚æ•°</span><br><span class="line">	@ApiModelProperty(value &#x3D; &quot;éªŒè¯ç &quot;,required &#x3D; true)</span><br><span class="line">    private String code;</span><br><span class="line">2âƒ£ï¸åœ¨LoginControllerï¼Œæ·»åŠ å‚æ•°éªŒè¯ç ï¼ŒåŒæ—¶åœ¨IAdminService&#x2F;AdminServiceImplä¹Ÿè¿›è¡Œæ”¹å˜</span><br><span class="line">3âƒ£ï¸åœ¨AdminServiceImplï¼Œè·å–éªŒè¯ç </span><br><span class="line">	String captcha &#x3D; (String) request.getSession().getAttribute(&quot;captcha&quot;);</span><br><span class="line">4âƒ£ï¸éªŒè¯ç æ¯”è¾ƒ</span><br><span class="line">	ä¸ä¸ºç©ºå‰ç«¯è¾“å…¥ä¸åç«¯éªŒè¯ç è¿›è¡ŒåŒ¹é…</span><br></pre></td></tr></table></figure>
<h1 id="æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢èœå•åˆ—è¡¨"><a href="#æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢èœå•åˆ—è¡¨" class="headerlink" title="æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢èœå•åˆ—è¡¨"></a>æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢èœå•åˆ—è¡¨</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸æ›´æ”¹pojoå®ä½“ç±»Menu</span><br><span class="line">	 @ApiModelProperty(value &#x3D; &quot;å­èœå•&quot;)</span><br><span class="line">   @TableField(exist &#x3D; false)</span><br><span class="line">   private List&lt;Menu&gt; children;	</span><br><span class="line">2âƒ£ï¸æ›´æ”¹MenuController</span><br><span class="line">	æ›´æ”¹è·¯å¾„&#x2F;system&#x2F;cfg</span><br><span class="line">	æ³¨å…¥ IMenuService</span><br><span class="line">	åœ¨getMenuByAdminIdè¿”å›getMenusByAdminId</span><br><span class="line">	ç”¨æˆ·ä¿¡æ¯ä¸€èˆ¬æ˜¯ä»åç«¯è·å–ï¼Œè€Œä¸æ˜¯å‰ç«¯è·å–ï¼Œå› ä¸ºå¯èƒ½ä¼šè¢«ç¯¡æ”¹</span><br><span class="line">3âƒ£ï¸åœ¨IMenuServiceæ¥å£å®šä¹‰getMenusByAdminId</span><br><span class="line">4âƒ£ï¸åœ¨MenuServiceImplå®ç°getMenusByAdminId</span><br><span class="line">	return menuMapper.getMenusAdminId(((Admin)(SecurityContextHolder.getContext().getAuthentication().getPrincipal())).getId());</span><br><span class="line">5âƒ£ï¸åœ¨MenuMapperå®šä¹‰getMenusAdminId</span><br><span class="line">6âƒ£ï¸åœ¨MenuMapperå†™æŸ¥è¯¢æ–¹æ³• å®šä¹‰è¿”å›ç±»å‹</span><br><span class="line">	&lt;!--æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢èœå•åˆ—è¡¨--&gt;</span><br><span class="line">	&lt;select id&#x3D;&quot;getMenusAdminId&quot; resultMap&#x3D;&quot;Menus&quot;&gt;</span><br><span class="line">        select distinct m1.*,</span><br><span class="line">                        m2.id            as id2,</span><br><span class="line">                        m2.url           as url2,</span><br><span class="line">                        m2.path          as path2,</span><br><span class="line">                        m2.&#96;component&#96;   as component2,</span><br><span class="line">                        m2.name          as name2,</span><br><span class="line">                        m2.&#96;iconCls&#96;     as iconCls2,</span><br><span class="line">                        m2.&#96;keepAlive&#96;   as keepAlive2,</span><br><span class="line">                        m2.&#96;requireAuth&#96; as requireAuth2,</span><br><span class="line">                        m2.&#96;parentId&#96;    as parentId2,</span><br><span class="line">                        m2.enabled       as enabled2</span><br><span class="line">        from &#96;t_menu&#96; m1,</span><br><span class="line">             &#96;t_menu&#96; m2,</span><br><span class="line">             &#96;t_menu_role&#96; mr,</span><br><span class="line">             &#96;t_admin_role&#96; ar</span><br><span class="line">        where m1.id &#x3D; m2.&#96;parentId&#96;</span><br><span class="line">          and m2.id &#x3D; mr.&#96;mid&#96;</span><br><span class="line">          and mr.&#96;rid&#96; &#x3D; ar.&#96;rid&#96;</span><br><span class="line">          and ar.&#96;adminId&#96; &#x3D; #&#123;id&#125;</span><br><span class="line">          and m2.enabled &#x3D; true</span><br><span class="line">        order by m2.id</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;resultMap id&#x3D;&quot;Menus&quot; type&#x3D;&quot;com.zoux.server.pojo.Menu&quot; extends&#x3D;&quot;BaseResultMap&quot;&gt;</span><br><span class="line">        &lt;collection property&#x3D;&quot;children&quot; ofType&#x3D;&quot;com.zoux.server.pojo.Menu&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;id2&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;url2&quot; property&#x3D;&quot;url&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;path2&quot; property&#x3D;&quot;path&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;component2&quot; property&#x3D;&quot;component&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;name2&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;iconCls2&quot; property&#x3D;&quot;iconCls&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;keepAlive2&quot; property&#x3D;&quot;keepAlive&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;requireAuth2&quot; property&#x3D;&quot;requireAuth&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;parentId2&quot; property&#x3D;&quot;parentId&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;enabled2&quot; property&#x3D;&quot;enabled&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;collection&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Redisé›†æˆèœå•åŠŸèƒ½"><a href="#Redisé›†æˆèœå•åŠŸèƒ½" class="headerlink" title="Redisé›†æˆèœå•åŠŸèƒ½"></a>Redisé›†æˆèœå•åŠŸèƒ½</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸æ·»åŠ ä¾èµ–</span><br><span class="line">	&lt;!--spring data redis ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--commons-pool2 å¯¹è±¡æ± ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.commons&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-pool2&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">2âƒ£ï¸æ·»åŠ é…ç½®application.yml </span><br><span class="line">	redis:</span><br><span class="line">    #è¶…æ—¶æ—¶é—´</span><br><span class="line">    timeout:  10000ms</span><br><span class="line">    #æœåŠ¡å™¨åœ°å€</span><br><span class="line">    host: 47.100.92.101</span><br><span class="line">    #æœåŠ¡å™¨ç«¯å£</span><br><span class="line">    port: 6379</span><br><span class="line">    database: 0</span><br><span class="line">    #    password: root</span><br><span class="line">    lettuce:</span><br><span class="line">      #é»˜è®¤è¿æ¥æ•°ï¼Œé»˜è®¤æ˜¯8</span><br><span class="line">      max-active: 1024</span><br><span class="line">      #æœ€å¤§è¿æ¥é˜»å¡ç­‰å¾…æ—¶é—´</span><br><span class="line">      max-wait: 1000ms</span><br><span class="line">      #æœ€å¤§ç©ºé—²è¿æ¥</span><br><span class="line">      max-idle: 200</span><br><span class="line">      #æœ€å°ç©ºé—²è¿æ¥</span><br><span class="line">      min-idle: 5</span><br><span class="line">3âƒ£ï¸æ–°å»ºredisé…ç½®ç±»RedisConfig å‚æ•°RedisConnectionFactory</span><br><span class="line">	å¼•å…¥Bean RedisTemplate</span><br><span class="line">	åºåˆ—åŒ–</span><br><span class="line">	Stringç±»å‹åºåˆ—å™¨</span><br><span class="line">	 Hashç±»å‹åºåˆ—å™¨</span><br><span class="line">	 å°†RedisConnectionFactory åŠ å…¥åˆ°RedisTemplate</span><br><span class="line">4âƒ£ï¸æ›´æ”¹Menucontroller-&gt;IMenuService-&gt;MenuServiceImpl&#x2F;getMenusByAdminIdæ–¹æ³•</span><br><span class="line">	æ³¨å…¥RedisTemplate</span><br><span class="line">	å…ˆå»redisè·å–</span><br><span class="line">	åˆ¤æ–­menusæ˜¯å¦ä¸ºç©º,å°±é€šè¿‡æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢</span><br><span class="line">		å°†æ•°æ®è®¾ç½®åˆ°redisä¸­</span><br><span class="line">5âƒ£ï¸åæœŸï¼Œå½“æ¶‰åŠåˆ°æ•°æ®èœå•æ›´æ–°æ—¶ï¼Œæˆ‘ä»¬è¦é‡ç½®redisé‡Œé¢çš„æ•°æ®</span><br></pre></td></tr></table></figure>
<h1 id="æ ¹æ®è¯·æ±‚urlåˆ¤æ–­è§’è‰²"><a href="#æ ¹æ®è¯·æ±‚urlåˆ¤æ–­è§’è‰²" class="headerlink" title="æ ¹æ®è¯·æ±‚urlåˆ¤æ–­è§’è‰²"></a>æ ¹æ®è¯·æ±‚urlåˆ¤æ–­è§’è‰²</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">æƒé™RBACåŸºæœ¬æ¦‚å¿µ</span><br><span class="line">	Role- Based Access Controller</span><br><span class="line">	æƒé™ä¸è§’è‰²ç›¸å…³è”ï¼Œç”¨æˆ·é€šè¿‡æ‰®æ¼”é€‚å½“çš„è§’è‰²ä»è€Œå¾—åˆ°è¿™äº›è§’è‰²çš„æƒé™ã€‚</span><br><span class="line">	ç®¡ç†æ˜¯å±‚çº§ç›¸äº’ä¾èµ–çš„ï¼Œæƒé™èµ‹äºˆç»™è§’è‰²ï¼Œè§’è‰²åˆèµ‹äºˆç”¨æˆ·ã€‚</span><br><span class="line">	æƒé™è®¾è®¡æ¸…æ¥šï¼Œç®¡ç†æ–¹ä¾¿</span><br><span class="line">	RBACå®é™…ä¸Šæ˜¯who what howä¸‰å…ƒç»„ä¹‹é—´çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯who å¯¹whatè¿›è¡Œhowçš„æ“ä½œ</span><br><span class="line">	è°å¯¹ä»€ä¹ˆèµ„æºåšäº†æ€æ ·çš„æ“ä½œã€‚</span><br><span class="line">	</span><br><span class="line">1âƒ£ï¸pojo-Menuæ·»åŠ å±æ€§</span><br><span class="line">		@ApiModelProperty(value &#x3D; &quot;è§’è‰²åˆ—è¡¨&quot;)</span><br><span class="line">    @TableField(exist &#x3D; false)</span><br><span class="line">    private List&lt;Menu&gt; roles;</span><br><span class="line">2âƒ£ï¸åœ¨IMenuServiceå®šä¹‰getMenusWithRole</span><br><span class="line">3âƒ£ï¸åœ¨MenuServiceImplå®ç°getMenusWithRole</span><br><span class="line">4âƒ£ï¸åœ¨MenuMapperå®šä¹‰getMenusWithRole</span><br><span class="line">5âƒ£ï¸åœ¨MenuMapper.xmlå®ç°sql</span><br><span class="line">	å¹¶å®ç°è¿”å›map</span><br><span class="line">6âƒ£ï¸å°†å®ç°çš„getMenusWithRoleæ”¾å…¥è¿‡æ»¤å™¨ä¸­</span><br><span class="line">	é¡ºä¾¿æ›´æ–°configç›®å½•ç»“æ„ï¼Œé‡å¯é¡¹ç›®ï¼ŒéªŒè¯æ˜¯å¦å‡ºç°é”™è¯¯</span><br><span class="line">7âƒ£ï¸	æ–°å»ºCustomFilteré…ç½®ç±»</span><br><span class="line">	æ³¨è§£@Component</span><br><span class="line">	å®ç°FilterInvocationSecurityMetadataSourceé‡å†™å†…éƒ¨æ–¹æ³• getAttributes</span><br><span class="line">	æ³¨å…¥IMenuService</span><br><span class="line">	å¼•å…¥AntPathMatcher</span><br><span class="line">		åœ¨åšuriåŒ¹é…è§„åˆ™å‘ç°è¿™ä¸ªç±»ï¼Œæ ¹æ®æºç å¯¹è¯¥ç±»è¿›è¡Œåˆ†æï¼Œå®ƒä¸»è¦ç”¨æ¥åšç±»URLså­—ç¬¦ä¸²åŒ¹é…ï¼›</span><br><span class="line">		è·å–è¯·æ±‚çš„url</span><br><span class="line">		è·å¾—menus</span><br><span class="line">		å¾ªç¯åˆ¤æ–­ æˆ‘ä»¬å½“å‰çš„urlä¸è·å–çš„urlæ˜¯å¦åŒ¹é…</span><br><span class="line">		åˆ¤æ–­è¯·æ±‚urlä¸è§’è‰²å…è®¸urlæ˜¯å¦åŒ¹é…</span><br><span class="line">		åˆ©ç”¨jdk8æ–°ç‰¹æ€§streamæµmapä¸€ä¸‹</span><br><span class="line">		èƒ½å¤ŸåŒ¹é…å°±å°†åŒ¹é…çš„è§’è‰²æ”¾å…¥&#x2F;list</span><br><span class="line">		å¦‚æœurlåŒ¹é…ä¸ä¸Šå°±é»˜è®¤ç»™ä¸€ä¸ªç™»é™†è§’è‰²</span><br></pre></td></tr></table></figure>
<h1 id="åˆ¤æ–­ç”¨æˆ·è§’è‰²"><a href="#åˆ¤æ–­ç”¨æˆ·è§’è‰²" class="headerlink" title="åˆ¤æ–­ç”¨æˆ·è§’è‰²"></a>åˆ¤æ–­ç”¨æˆ·è§’è‰²</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸ä¿®æ”¹pojo-Admin</span><br><span class="line">		@ApiModelProperty(value &#x3D; &quot;è§’è‰²&quot;)</span><br><span class="line">    @TableField(exist &#x3D; false)</span><br><span class="line">    private List&lt;Role&gt; roles;</span><br><span class="line">    æ›´æ”¹getAuthorities</span><br><span class="line">    	è·å–æƒé™åˆ—è¡¨</span><br><span class="line">2âƒ£ï¸IAdminServiceå®šä¹‰getRoles</span><br><span class="line">3âƒ£ï¸åœ¨AdminServiceImplå®ç°getRoles</span><br><span class="line">	æ³¨å…¥RoleMapper</span><br><span class="line">	æ–°å»ºæ–¹æ³•getRoles</span><br><span class="line">4âƒ£ï¸åœ¨RoleMapperå®šä¹‰getRoles</span><br><span class="line">5âƒ£ï¸åœ¨RoleMapper.xmlä¸­å®ç°sql</span><br><span class="line">7âƒ£ï¸åœ¨ç™»å½•æ–¹æ³•ä¸­åŠ å…¥getRoles</span><br><span class="line">	åœ¨LoginController-getAdminInfo&#x2F;loadUserByUsernameå®ç°æ–¹æ³•</span><br><span class="line">		æ·»åŠ è·å–ç”¨æˆ·è§’è‰²    </span><br><span class="line">8âƒ£ï¸æ·»åŠ æ‹¦æˆª</span><br><span class="line">	æ–°å»ºç±»CustomUrlDecisionManager</span><br><span class="line">		æ³¨è§£@Component</span><br><span class="line">		å®ç°AccessDecisionManagerï¼Œå¹¶é‡å†™å…¶æ–¹æ³•decide</span><br><span class="line">			è·å–å½“å‰urléœ€è¦è§’è‰²</span><br><span class="line">			åˆ¤æ–­è§’è‰²æ˜¯å¦ç™»é™†å³å¯è®¿é—®çš„è§’è‰²ï¼Œæ­¤è§’è‰²åœ¨CustomFilterä¸­è®¾ç½®</span><br><span class="line">			åˆ¤æ–­æ˜¯å¦ç™»é™†</span><br><span class="line">			åˆ¤æ–­ç”¨æˆ·è§’è‰²æ˜¯å¦ä¸ºurlæ‰€éœ€è§’è‰²</span><br><span class="line">			å¦‚è‹¥ä¸æ»¡è¶³ï¼ŒæŠ›å‡ºå¼‚å¸¸</span><br><span class="line">				throw new AccessDeniedException(&quot;æƒé™ä¸è¶³ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼&quot;);</span><br><span class="line">9âƒ£ï¸é…ç½®securityconfig</span><br><span class="line">	å¼•å…¥CustomFilterï¼ŒCustomUrlDecisionManager</span><br><span class="line">	åœ¨è®¿é—®è¯·æ±‚è¦æ±‚è®¤è¯ä¸‹æ·»åŠ </span><br><span class="line">		åŠ¨æ€æƒé™é…ç½®</span><br><span class="line">		.withObjectPostProcessor()</span><br><span class="line">			new ObjectPostProcessorèŒƒå‹ä¸ºFilterSecurityInterceptoré‡å†™å…¶æ–¹æ³•postProcess</span><br><span class="line">				æ·»åŠ CustomFilterï¼ŒCustomUrlDecisionManager</span><br><span class="line">					o.setAccessDecisionManager(customUrlDecisionManager);</span><br><span class="line">          o.setSecurityMetadataSource(customFilter);</span><br><span class="line">        è¿”å›o</span><br><span class="line">ğŸ”Ÿå‡†å¤‡æµ‹è¯•ç±»</span><br><span class="line">	HelloController</span><br><span class="line">	æ³¨è§£@RestController</span><br><span class="line">		@GetMapping(&quot;&#x2F;employee&#x2F;basic&#x2F;hello&quot;)</span><br><span class="line">    public String hello2() &#123;</span><br><span class="line">        return &quot;&#x2F;employee&#x2F;basic&#x2F;hell&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;hello&quot;)</span><br><span class="line">    public String hello() &#123;</span><br><span class="line">        return &quot;hello&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;employee&#x2F;advanced&#x2F;hello&quot;)</span><br><span class="line">    public String hello3() &#123;</span><br><span class="line">        return &quot;&#x2F;employee&#x2F;advanced&#x2F;hello&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="èŒä½ç®¡ç†åŠŸèƒ½å®ç°"><a href="#èŒä½ç®¡ç†åŠŸèƒ½å®ç°" class="headerlink" title="èŒä½ç®¡ç†åŠŸèƒ½å®ç°"></a>èŒä½ç®¡ç†åŠŸèƒ½å®ç°</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸è‡ªå®šä¹‰æ—¥æœŸæ ¼å¼</span><br><span class="line">	pojo-Position</span><br><span class="line">	æ·»åŠ æ³¨è§£</span><br><span class="line">		@JsonFormat(pattern &#x3D; &quot;yyyy-MM-dd&quot;,timezone &#x3D; &quot;Asia&#x2F;Shanghai&quot;)</span><br><span class="line">2âƒ£ï¸æ›´æ”¹PositionController</span><br><span class="line">	æŸ¥è¯¢</span><br><span class="line">    @ApiOperation(value &#x3D; &quot;è·å–æ‰€æœ‰èŒä½ä¿¡æ¯&quot;)</span><br><span class="line">    æ³¨è§£@RequestMapping(&quot;&#x2F;system&#x2F;basic&#x2F;pos&quot;)		</span><br><span class="line">    æ³¨å…¥IPositionService</span><br><span class="line">    åˆ›å»ºæ–¹æ³•getAllPositions</span><br><span class="line">      è¿”å›return positionService.list();</span><br><span class="line">  æ·»åŠ </span><br><span class="line">  	æ–¹æ³•å…¥å‚æ³¨è§£@RequestBody æ¥æ”¶å‰ç«¯ä¼ é€’ç»™åç«¯çš„jsonå­—ç¬¦ä¸²ä¸­çš„æ•°æ®çš„</span><br><span class="line">  	åŠ å…¥å½“å‰æ—¶é—´</span><br><span class="line">  		position.setCreateDate(LocalDateTime.now());</span><br><span class="line">  	positionService.save(position)</span><br><span class="line">  æ›´æ–°</span><br><span class="line">  	positionService.updateById(position)</span><br><span class="line">  åˆ é™¤</span><br><span class="line">  	æ³¨è§£@PathVariable æ¥æ”¶è¯·æ±‚è·¯å¾„ä¸­å ä½ç¬¦çš„å€¼</span><br><span class="line">  	positionService.removeById(id)</span><br><span class="line">  æ‰¹é‡åˆ é™¤</span><br><span class="line">  	positionService.removeByIds(Arrays.asList(ids))</span><br></pre></td></tr></table></figure>
<h1 id="å…¨å±€å¼‚å¸¸"><a href="#å…¨å±€å¼‚å¸¸" class="headerlink" title="å…¨å±€å¼‚å¸¸"></a>å…¨å±€å¼‚å¸¸</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸æ–°å»ºåŒ…exceptionå¹¶æ–°å»ºç±»GlobalException</span><br><span class="line">	æ³¨è§£@RestControllerAdvice è¡¨ç¤ºæ§åˆ¶å™¨çš„ä¸€ä¸ªå¢å¼ºç±»</span><br><span class="line">	æ•æ‰å¼‚å¸¸</span><br><span class="line">    @ExceptionHandler</span><br><span class="line">  </span><br></pre></td></tr></table></figure>
<h1 id="èŒç§°ç®¡ç†åŠŸèƒ½å®ç°"><a href="#èŒç§°ç®¡ç†åŠŸèƒ½å®ç°" class="headerlink" title="èŒç§°ç®¡ç†åŠŸèƒ½å®ç°"></a>èŒç§°ç®¡ç†åŠŸèƒ½å®ç°</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸ç»™pojo-Joblevelç±»çš„å±æ€§createDateåŠ ä¸Šæ³¨è§£</span><br><span class="line">	@JsonFormat(pattern &#x3D; &quot;yyyy-MM-dd&quot;,timezone &#x3D; &quot;Asia&#x2F;Shanghai&quot;)</span><br><span class="line">2âƒ£ï¸ä¿®æ”¹JoblevelControlleræ³¨è§£@RequestMappingçš„è·¯å¾„ä¸æ•°æ®åº“ç›¸åŒ¹é…</span><br><span class="line">	@RequestMapping(&quot;&#x2F;system&#x2F;basic&#x2F;joblevel&quot;)</span><br><span class="line">	ä¸èŒä½ç®¡ç†åŠŸèƒ½ç±»ä¼¼</span><br></pre></td></tr></table></figure>
<h1 id="æƒé™ç»„è§’è‰²åŠŸèƒ½å®ç°"><a href="#æƒé™ç»„è§’è‰²åŠŸèƒ½å®ç°" class="headerlink" title="æƒé™ç»„è§’è‰²åŠŸèƒ½å®ç°"></a>æƒé™ç»„è§’è‰²åŠŸèƒ½å®ç°</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">é€šè¿‡è§’è‰²è¡¨å’Œç”¨æˆ·è¡¨ç®¡å…³è”ï¼Œè¿›è€Œç»™ç”¨æˆ·åˆ†é…ä¸åŒçš„è§’è‰²</span><br><span class="line">ä¹Ÿå¯ä»¥é€šè¿‡èœå•è§’è‰²ä¹Ÿèœå•è¡¨å…³è”ï¼Œè¿›è€Œç»™ç”¨æˆ·åˆ†é…ä¸åŒçš„è§’è‰²ï¼Œå¯ä»¥æ‹¥æœ‰ä¸åŒèœå•çš„æƒé™</span><br><span class="line">æƒé™ç»„åˆ†ä¸ºè§’è‰²å’Œèœå•éƒ¨åˆ†</span><br><span class="line">1âƒ£ï¸æ–°å»ºPermissionController</span><br><span class="line">  	æ·»åŠ æ³¨è§£</span><br><span class="line">  		@RestController</span><br><span class="line">			@RequestMapping(&quot;&#x2F;system&#x2F;basic&#x2F;permission&quot;)</span><br><span class="line">		æ³¨å…¥IRoleService</span><br><span class="line">		æ³¨å…¥IMenuService</span><br><span class="line">    å®ç°è§’è‰²éƒ¨åˆ†</span><br><span class="line">    	æŸ¥è¯¢è§’è‰²</span><br><span class="line">    	æ·»åŠ è§’è‰²</span><br><span class="line">    		ç»™åå­—åŠ ä¸Šå‰ç¼€</span><br><span class="line">    	åˆ é™¤è§’è‰²</span><br><span class="line">    å®ç°èœå•éƒ¨åˆ†</span><br><span class="line">    	æŸ¥è¯¢æ‰€æœ‰èœå•</span><br><span class="line">    		åœ¨IMenuServiceä¸­å®šä¹‰getAllMenusæ–¹æ³•</span><br><span class="line">    		åœ¨MenuServiceImplä¸­å®ç°getAllMenusæ–¹æ³•</span><br><span class="line">    		åœ¨MenuMapperå®šä¹‰getAllMenusæ–¹æ³•</span><br><span class="line">    		åœ¨MenuMapper.xmlå®ç°sql ç¼–å†™resultMap</span><br><span class="line">    	æ ¹æ®è§’è‰²idæŸ¥è¯¢èœå•id</span><br><span class="line">      	@ApiOperation(value &#x3D; &quot;æ ¹æ®è§’è‰²idæŸ¥è¯¢èœå•id&quot;)</span><br><span class="line">    		@GetMapping(&quot;&#x2F;mid&#x2F;&#123;rid&#125;&quot;)</span><br><span class="line">    		public List&lt;Integer&gt; getMidByRid(@PathVariable Integer rid) &#123;</span><br><span class="line">           return menuRoleService.list(new QueryWrapper&lt;MenuRole&gt;().eq(&quot;rid&quot;, rid)).stream().map(MenuRole::getMid).collect(Collectors.toList());</span><br><span class="line">        &#125;</span><br><span class="line">    æ›´æ–°è§’è‰²èœå•</span><br><span class="line">       æµç¨‹ï¼š</span><br><span class="line">       	æ¯æ¬¡æ›´æ–°ä¹‹å‰ï¼Œå°†è¿™ä¸ªè§’è‰²çš„èœå•æ¸…ç©º</span><br><span class="line">       	ç„¶åæ ¹æ®ä¼ å…¥çš„è§’è‰²idä¸èœå•idè¿›è¡Œå…³è”</span><br><span class="line">				æ¶‰åŠåˆ°äº†ä¸¤æ­¥åŠ ä¸Šæ³¨è§£@Transactional äº‹ç‰©æ³¨è§£</span><br><span class="line">        	æ³¨å…¥mapper</span><br><span class="line">        	åˆ é™¤è§’è‰²ä¸‹æ‰€æœ‰èœå•	</span><br><span class="line">        		menuRoleMapper.delete(new QueryWrapper&lt;MenuRole&gt;().eq(&quot;rid&quot;, rid));</span><br><span class="line">        	æ‰¹é‡æ›´æ–°èœå•</span><br><span class="line">        		insertRecord</span><br><span class="line">        		åœ¨menuRoleMapperä¸‹å®šä¹‰insertRecord æ³¨æ„åœ¨å…¥å‚åŠ ä¸Šæ³¨è§£@Param</span><br><span class="line">						åœ¨mapperå®ç°sql</span><br><span class="line">							&lt;!--  æ›´æ–°è§’è‰²èœå•  --&gt;</span><br><span class="line">              &lt;insert id&#x3D;&quot;insertRecord&quot;&gt;</span><br><span class="line">                  insert into t_menu_role(mid,rid) values</span><br><span class="line">                  &lt;foreach collection&#x3D;&quot;mids&quot; item&#x3D;&quot;mid&quot; separator&#x3D;&quot;,&quot;&gt;</span><br><span class="line">                      (#&#123;mid&#125;,#&#123;rid&#125;)</span><br><span class="line">                  &lt;&#x2F;foreach&gt;</span><br><span class="line">              &lt;&#x2F;insert&gt;</span><br></pre></td></tr></table></figure>
<h1 id="å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»ºå’Œä½¿ç”¨"><a href="#å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»ºå’Œä½¿ç”¨" class="headerlink" title="å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»ºå’Œä½¿ç”¨"></a>å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»ºå’Œä½¿ç”¨</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">å­˜å‚¨è¿‡ç¨‹å°±æ˜¯å…·æœ‰åå­—çš„ä¸€æ®µä»£ç ï¼Œç”¨æ¥å®Œæˆä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½</span><br><span class="line">åˆ›å»ºçš„å­˜å‚¨è¿‡ç¨‹ä¿å­˜åœ¨æ•°æ®åº“çš„æ•°æ®å­—å…¸ä¸­</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;å®šä¹‰äº†ç”¨æˆ·rootï¼Œä½¿ç”¨æœ¬åœ°IPåœ°å€			åˆ›å»ºäº†å­˜å‚¨è¿‡ç¨‹åå­—ä¸ºdeleteDep</span><br><span class="line">CREATE DEFINER&#x3D;&#96;root&#96;@&#96;localhost&#96; PROCEDURE &#96;deleteDep&#96;(in did int,out result int)</span><br><span class="line">begin</span><br><span class="line">  declare ecount int;</span><br><span class="line">  declare pid int;</span><br><span class="line">  declare pcount int;</span><br><span class="line">  declare a int;</span><br><span class="line">  &#x2F;&#x2F;ä¸å­˜åœ¨idï¼Œæˆ–è€…æœ‰å­éƒ¨é—¨</span><br><span class="line">  select count(*) into a from t_department where id&#x3D;did and isParent&#x3D;false;</span><br><span class="line">  if a&#x3D;0 then set result&#x3D;-2;</span><br><span class="line">  else</span><br><span class="line">  &#x2F;&#x2F;æŸ¥è¯¢éƒ¨é—¨ä¸‹å‘˜å·¥æ•°é‡</span><br><span class="line">  select count(*) into ecount from t_employee where departmentId&#x3D;did;</span><br><span class="line">  if ecount&gt;0 then set result&#x3D;-1;</span><br><span class="line">  &#x2F;&#x2F;æœ‰å‘˜å·¥ä¸èƒ½è¿›è¡Œåˆ é™¤</span><br><span class="line">  else </span><br><span class="line">  &#x2F;&#x2F;æŸ¥è¯¢ çˆ¶id</span><br><span class="line">  select parentId into pid from t_department where id&#x3D;did;</span><br><span class="line">  &#x2F;&#x2F;æ­£å¼åˆ é™¤</span><br><span class="line">  delete from t_department where id&#x3D;did and isParent&#x3D;false;</span><br><span class="line">  &#x2F;&#x2F;è·å¾—å—å½±å“è¡Œæ•°</span><br><span class="line">  select row_count() into result;</span><br><span class="line">  &#x2F;&#x2F;æŸ¥è¯¢éƒ¨é—¨çš„çˆ¶éƒ¨é—¨</span><br><span class="line">  select count(*) into pcount from t_department where parentId&#x3D;pid;</span><br><span class="line">  &#x2F;&#x2F;åˆ¤æ–­å½“å­éƒ¨é—¨ä¸º0æ—¶ï¼Œå°±æ”¹å˜å­—æ®µisParentã€‚</span><br><span class="line">  if pcount&#x3D;0 then update t_department set isParent&#x3D;false where id&#x3D;pid;</span><br><span class="line">  end if;</span><br><span class="line">  end if;</span><br><span class="line">  end if;</span><br><span class="line">end</span><br><span class="line">&#x2F;&#x2F;å®šä¹‰äº†ç”¨æˆ·rootï¼Œä½¿ç”¨æœ¬åœ°IPåœ°å€      åˆ›å»ºäº†å­˜å‚¨è¿‡ç¨‹åå­—ä¸ºaddDep å‚æ•° inè¡¨è¾“å…¥å‚æ•° depNameè¡¨è¾“å…¥å‚æ•°åç§° outè¾“å‡ºå‚æ•°</span><br><span class="line">CREATE DEFINER&#x3D;&#96;root&#96;@&#96;localhost&#96; PROCEDURE &#96;addDep&#96;(in depName varchar(32),in parentId int,in enabled boolean,out result int,out result2 int)</span><br><span class="line">begin</span><br><span class="line">&#x2F;&#x2F;å®šä¹‰äº†did intç±»å‹çš„</span><br><span class="line">  declare did int;</span><br><span class="line">  declare pDepPath varchar(64);</span><br><span class="line">  &#x2F;&#x2F;æ’å…¥æ•°æ®</span><br><span class="line">  insert into t_department set name&#x3D;depName,parentId&#x3D;parentId,enabled&#x3D;enabled;</span><br><span class="line">  &#x2F;&#x2F;è·å–å—å½±å“çš„è¡Œæ•°</span><br><span class="line">  select row_count() into result;</span><br><span class="line">  &#x2F;&#x2F;è·å–æ’å…¥çš„æœ€åä¸€æ¡çš„id</span><br><span class="line">  select last_insert_id() into did;</span><br><span class="line">  set result2&#x3D;did;</span><br><span class="line">  &#x2F;&#x2F;æŸ¥è¯¢è·¯å¾„ æ”¾å…¥åˆ°pDepPathé‡Œé¢</span><br><span class="line">  select depPath into pDepPath from t_department where id&#x3D;parentId;</span><br><span class="line">  &#x2F;åœ¨åŸæœ‰çš„è·¯å¾„çš„åŸºç¡€ä¸ŠåŠ ä¸Šä¸Šä¸€æ¬¡æ’å…¥çš„è·¯å¾„</span><br><span class="line">  update t_department set depPath&#x3D;concat(pDepPath,&#39;.&#39;,did) where id&#x3D;did;</span><br><span class="line">  &#x2F;&#x2F;ç»è¿‡ä¸Šä¸€å¥ï¼Œè¿™æ¡æ•°æ®åº“è®°å½•æœ¬èº«å°±ä¸Šå‡ä¸ºæœ‰å­éƒ¨é—¨çš„è®°å½•äº†</span><br><span class="line">  update t_department set isParent&#x3D;true where id&#x3D;parentId;</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h1 id="éƒ¨é—¨ç®¡ç†åŠŸèƒ½å®ç°"><a href="#éƒ¨é—¨ç®¡ç†åŠŸèƒ½å®ç°" class="headerlink" title="éƒ¨é—¨ç®¡ç†åŠŸèƒ½å®ç°"></a>éƒ¨é—¨ç®¡ç†åŠŸèƒ½å®ç°</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸è·å–æ‰€æœ‰éƒ¨é—¨</span><br><span class="line">	æ›´æ”¹DepartmentController</span><br><span class="line">		æ³¨è§£RequestMappingè·¯å¾„&#x2F;system&#x2F;basic&#x2F;department</span><br><span class="line">		æ³¨å…¥IDepartmentService</span><br><span class="line">		å®šä¹‰æ–¹æ³•getAllDepartments</span><br><span class="line">			æ³¨è§£</span><br><span class="line">				@ApiOperation(value &#x3D; &quot;è·å–æ‰€æœ‰éƒ¨é—¨&quot;)</span><br><span class="line">		    @GetMapping(&quot;&#x2F;&quot;)</span><br><span class="line">	åœ¨pojo-Departmentä¸­</span><br><span class="line">    	å®šä¹‰å±æ€§</span><br><span class="line">    		@ApiModelProperty(value &#x3D; &quot;å­éƒ¨é—¨åˆ—è¡¨&quot;)</span><br><span class="line">        @TableField(exist &#x3D; false)</span><br><span class="line">        private List&lt;Department&gt; children;</span><br><span class="line">        @ApiModelProperty(value &#x3D; &quot;è¿”å›ç»“æœï¼Œå­˜å‚¨è¿‡ç¨‹ä½¿ç”¨&quot;)</span><br><span class="line">        @TableField(exist &#x3D; false)</span><br><span class="line">        private Integer result;</span><br><span class="line">  åœ¨IDepartmentServiceå®šä¹‰getAllDepartments</span><br><span class="line">  åœ¨DepartmentServiceImplå®ç°getAllDepartments</span><br><span class="line">  	æ³¨å…¥departmentMapper</span><br><span class="line">  åœ¨DepartmentMapperå®šä¹‰getAllDepartments</span><br><span class="line">  åœ¨DepartmentMapper.xmlå®ç°sql</span><br><span class="line">  	åˆ©ç”¨mybatisæä¾›çš„é€’å½’æŸ¥è¯¢å®ç°</span><br><span class="line">  		åœ¨DepartmentServiceImplçš„getAllDepartmentsæ–¹æ³•æä¾›å…¥å‚ï¼ˆæœ€å¤§çš„parentidï¼‰</span><br><span class="line">  		é€’å½’ä½“ç°åœ¨DepartmentMapper.xmlç¼–å†™resultMapæ—¶</span><br><span class="line">  			&lt;resultMap id&#x3D;&quot;DepartmentWithChildren&quot; type&#x3D;&quot;com.zoux.server.pojo.Department&quot; extends&#x3D;&quot;BaseResultMap&quot;&gt;</span><br><span class="line">        &lt;collection property&#x3D;&quot;children&quot; ofType&#x3D;&quot;com.zoux.server.pojo.Department&quot;</span><br><span class="line">                    select&#x3D;&quot;com.zoux.server.mapper.DepartmentMapper.getAllDepartments&quot; column&#x3D;&quot;id&quot;&gt;</span><br><span class="line">        &lt;&#x2F;collection&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line">    	å…¶ä¸­select&#x3D;&quot;com.zoux.server.mapper.DepartmentMapper.getAllDepartments&quot; column&#x3D;&quot;id&quot;&gt;</span><br><span class="line">    	ä¸ºå…¥å£</span><br><span class="line">2âƒ£ï¸æ·»åŠ éƒ¨é—¨</span><br><span class="line">	ä¿®æ”¹DepartmentController</span><br><span class="line">		æ³¨è§£</span><br><span class="line">			@ApiOperation(value &#x3D; &quot;æ·»åŠ éƒ¨é—¨&quot;)</span><br><span class="line">    	@PostMapping(&quot;&#x2F;&quot;)</span><br><span class="line">    æ–°å»ºæ–¹æ³•addDep</span><br><span class="line">    åœ¨IDepartmentServiceå®šä¹‰addDep</span><br><span class="line">    åœ¨DepartmentServiceImplå®ç°addDep</span><br><span class="line">	    æ›´æ”¹å³å°†å­˜å‚¨çš„department</span><br><span class="line">	    	enabled&#x3D;true</span><br><span class="line">	    åˆ¤æ–­æ·»åŠ æ˜¯å¦æˆåŠŸ</span><br><span class="line">    åœ¨DepartmentMapperå®šä¹‰addDep</span><br><span class="line">    åœ¨DepartmentMapper.xmlé‡Œé¢å®ç°sql</span><br><span class="line">    	ä¸ä½¿ç”¨ä¼ ç»Ÿinsert</span><br><span class="line">    	ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹</span><br><span class="line">    		&lt;!--    æ·»åŠ éƒ¨é—¨  --&gt;</span><br><span class="line">        &lt;select id&#x3D;&quot;addDep&quot; statementType&#x3D;&quot;CALLABLE&quot;&gt;</span><br><span class="line">            call addDep(#&#123;name,mode &#x3D; IN,jdbcType&#x3D;VARCHAR&#125;,</span><br><span class="line">                #&#123;parentId,mode &#x3D; IN,jdbcType&#x3D;INTEGER&#125;,</span><br><span class="line">                #&#123;enabled,mode &#x3D; IN,jdbcType&#x3D;BOOLEAN&#125;,</span><br><span class="line">                #&#123;result,mode &#x3D; OUT,jdbcType&#x3D;INTEGER&#125;,</span><br><span class="line">                #&#123;id,mode &#x3D; OUT,jdbcType&#x3D;INTEGER&#125;)</span><br><span class="line">        &lt;&#x2F;select&gt;</span><br><span class="line">3âƒ£ï¸åˆ é™¤éƒ¨é—¨ </span><br><span class="line">	ä¿®æ”¹DepartmentController</span><br><span class="line">		æ³¨è§£</span><br><span class="line">			@ApiOperation(value &#x3D; &quot;åˆ é™¤éƒ¨é—¨&quot;)</span><br><span class="line">   	  @DeleteMapping(&quot;&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">   	æ–°å»ºæ–¹æ³•deleteDep  </span><br><span class="line">   	åœ¨IDepartmentServiceå®šä¹‰deleteDep</span><br><span class="line">    åœ¨DepartmentServiceImplå®ç°deleteDep</span><br><span class="line">    	åˆ¤æ–­åˆ é™¤æ˜¯å¦æˆåŠŸ</span><br><span class="line">    åœ¨DepartmentMapperå®šä¹‰addDep</span><br><span class="line">    åœ¨DepartmentMapper.xmlé‡Œé¢å®ç°sql</span><br><span class="line">    	ä¸ä½¿ç”¨ä¼ ç»Ÿinsert</span><br><span class="line">    	ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹</span><br><span class="line">      	&lt;!--    åˆ é™¤éƒ¨é—¨  --&gt;</span><br><span class="line">        &lt;select id&#x3D;&quot;deleteDep&quot; statementType&#x3D;&quot;CALLABLE&quot;&gt;</span><br><span class="line">            call deleteDep( #&#123;id,mode &#x3D; IN,jdbcType&#x3D;INTEGER&#125;,</span><br><span class="line">                #&#123;result,mode &#x3D; OUT,jdbcType&#x3D;INTEGER&#125;</span><br><span class="line">                )</span><br><span class="line">        &lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>
<h1 id="æ“ä½œå‘˜ç®¡ç†åŠŸèƒ½"><a href="#æ“ä½œå‘˜ç®¡ç†åŠŸèƒ½" class="headerlink" title="æ“ä½œå‘˜ç®¡ç†åŠŸèƒ½"></a>æ“ä½œå‘˜ç®¡ç†åŠŸèƒ½</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸è·å–æ‰€æœ‰æ“ä½œå‘˜</span><br><span class="line">	ä¿®æ”¹AdminController</span><br><span class="line">		æ³¨è§£</span><br><span class="line">      @RequestMapping(&quot;&#x2F;system&#x2F;admin&quot;)</span><br><span class="line">      @GetMapping(&quot;&#x2F;&quot;)</span><br><span class="line">		æ³¨å…¥adminService</span><br><span class="line">		æ–°å»ºæ–¹æ³•getAllAdminså‚æ•°keyword</span><br><span class="line">		åœ¨IAdminServiceå®šä¹‰getAllAdminsæ–¹æ³•</span><br><span class="line">		åœ¨AdminServiceImplå®ç°getAllAdmins</span><br><span class="line">		åœ¨AdminMapperå®šä¹‰getAllAdmins</span><br><span class="line">		åœ¨AdminMapper.xmlå®ç°sql ç¼–å†™resultMap</span><br><span class="line">			&lt;select id&#x3D;&quot;getAllAdmins&quot; resultMap&#x3D;&quot;AdminWithRole&quot;&gt;</span><br><span class="line">        select</span><br><span class="line">        a.*,</span><br><span class="line">        r.id as rid,</span><br><span class="line">        r.name as rname,</span><br><span class="line">        r.nameZh as rnameZh</span><br><span class="line">        from t_admin a</span><br><span class="line">        LEFT JOIN</span><br><span class="line">        t_admin_role ar ON a.id &#x3D; ar.adminId</span><br><span class="line">        LEFT JOIN</span><br><span class="line">        t_role r ON r.id &#x3D; ar.rid</span><br><span class="line">        where a.id !&#x3D;#&#123;id&#125;</span><br><span class="line"></span><br><span class="line">        &lt;if test&#x3D;&quot;null!&#x3D;keyword and &#39;&#39;!&#x3D;keyword&quot;&gt;</span><br><span class="line">            and a.name   like CONCAT(&#39;%&#39;,#&#123;keyword&#125;,&#39;%&#39;)</span><br><span class="line">        &lt;&#x2F;if&gt;</span><br><span class="line">        ORDER BY</span><br><span class="line">        a.id</span><br><span class="line">    	&lt;&#x2F;select&gt;</span><br><span class="line">    	&lt;resultMap id&#x3D;&quot;AdminWithRole&quot; type&#x3D;&quot;com.zoux.server.pojo.Admin&quot; extends&#x3D;&quot;BaseResultMap&quot;&gt;</span><br><span class="line">        &lt;collection property&#x3D;&quot;roles&quot; ofType&#x3D;&quot;com.zoux.server.pojo.Role&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;rid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;rname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;rnameZh&quot; property&#x3D;&quot;nameZh&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;collection&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line">2âƒ£ï¸æ›´æ–°æ“ä½œå‘˜</span><br><span class="line">	AdminControlleræ–°å»ºæ–¹æ³•updateAdmin</span><br><span class="line">		æ³¨è§£</span><br><span class="line">			ApiOperation(value &#x3D; &quot;æ›´æ–°æ“ä½œå‘˜&quot;)</span><br><span class="line">   	  PutMapping(&quot;&#x2F;&quot;)</span><br><span class="line">   	  RequestBody</span><br><span class="line">   	è°ƒç”¨adminService.updateByIdï¼ˆadmin ï¼‰</span><br><span class="line">    æ›´æ”¹pojo-Admin	æŒ‡å®šå±æ€§enabledï¼Œlombokæ³¨è§£@Getter(AccessLevel.NONE)</span><br><span class="line">    	å› ä¸ºå®ç°äº†UserDetailsï¼Œæ‰€ä»¥æœ‰å…³enabledçš„getæ–¹æ³•è¢«é‡å†™ï¼Œä½¿ç”¨getæ–¹æ³•æ—¶å°±ä¼šå‡ºç°é”™è¯¯ï¼Œå…³é—­lombokï¼Œ		getæ–¹æ³•</span><br><span class="line">3âƒ£ï¸åˆ é™¤æ“ä½œå‘˜</span><br><span class="line">	åœ¨AdminControlleræ–°å»ºæ–¹æ³•deleteAdmin</span><br><span class="line">	æ³¨è§£</span><br><span class="line">		@ApiOperation(value &#x3D; &quot;åˆ é™¤æ“ä½œå‘˜&quot;)</span><br><span class="line">    @DeleteMapping(&quot;&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    @PathVariable</span><br><span class="line">  æ³¨å…¥adminService</span><br><span class="line">  	è°ƒç”¨removeById(id)  </span><br><span class="line">4âƒ£ï¸è·å–æ‰€æœ‰è§’è‰²</span><br><span class="line">	åœ¨AdminControlleræ–°å»ºæ–¹æ³•getAllRoles</span><br><span class="line">	æ³¨è§£</span><br><span class="line">		@ApiOperation(value &#x3D; &quot;è·å–æ‰€æœ‰è§’è‰²&quot;)</span><br><span class="line">    @GetMapping(&quot;&#x2F;roles&quot;)</span><br><span class="line">  æ³¨å…¥roleService</span><br><span class="line">  	è°ƒç”¨listï¼ˆï¼‰</span><br><span class="line">5âƒ£ï¸æ›´æ–°æ“ä½œå‘˜è§’è‰²</span><br><span class="line">	åœ¨AdminControlleræ–°å»ºæ–¹æ³•updateAdminOfRole</span><br><span class="line">	æ³¨è§£ï¼š</span><br><span class="line">		@ApiOperation(value &#x3D; &quot;æ›´æ–°æ“ä½œå‘˜è§’è‰²&quot;)</span><br><span class="line">    @PutMapping(&quot;&#x2F;role&quot;)</span><br><span class="line">  æ³¨å…¥adminService</span><br><span class="line">  	è°ƒç”¨updateAdminOfRole(adminId, rids)</span><br><span class="line">  åœ¨AdminServiceImpl</span><br><span class="line">  	æ³¨å…¥adminRoleMapper</span><br><span class="line">  		è°ƒç”¨deleteï¼Œæ ¹æ®adminIdåˆ é™¤è§’è‰²</span><br><span class="line">  			delete(new QueryWrapper&lt;AdminRole&gt;().eq(&quot;adminId&quot;, adminId))</span><br><span class="line">  		æ–°å»ºaddAdminOfRole</span><br><span class="line">  	åˆ¤æ–­addAdminOfRoleæ–¹æ³•è¿”å›ç»“æœ</span><br><span class="line">  åœ¨AdminRoleMapperå®šä¹‰addAdminOfRoleæ–¹æ³•</span><br><span class="line">  åœ¨AdminRoleMapper.xmlå®ç°sql</span><br><span class="line">  	&lt;!--    æ›´æ–°æ“ä½œå‘˜è§’è‰²--&gt;</span><br><span class="line">    &lt;update id&#x3D;&quot;addAdminOfRole&quot;&gt;</span><br><span class="line">        insert into t_admin_role(adminId,rid) values</span><br><span class="line">        &lt;foreach collection&#x3D;&quot;rids&quot; item&#x3D;&quot;rid&quot; separator&#x3D;&quot;,&quot;&gt;</span><br><span class="line">            (#&#123;adminId&#125;,#&#123;rid&#125;)</span><br><span class="line">        &lt;&#x2F;foreach&gt;</span><br><span class="line">    &lt;&#x2F;update&gt;	</span><br></pre></td></tr></table></figure>
<h1 id="å‘˜å·¥ç®¡ç†åŠŸèƒ½-åˆ†é¡µ"><a href="#å‘˜å·¥ç®¡ç†åŠŸèƒ½-åˆ†é¡µ" class="headerlink" title="å‘˜å·¥ç®¡ç†åŠŸèƒ½-åˆ†é¡µ"></a>å‘˜å·¥ç®¡ç†åŠŸèƒ½-åˆ†é¡µ</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸åˆ†é¡µé…ç½®</span><br><span class="line">	æ–°å»ºé…ç½®ç±»MybatisPlusConfig</span><br><span class="line">		æ³¨è§£@Configuration</span><br><span class="line">		æ³¨å…¥</span><br><span class="line">			@Bean</span><br><span class="line">			PaginationInterceptor</span><br><span class="line">	æ–°å»ºå…¬å…±åˆ†é¡µè¿”å›å¯¹è±¡pojo-RespPageBean</span><br><span class="line">  	æ³¨è§£</span><br><span class="line">  		@Data</span><br><span class="line">			@NoArgsConstructor</span><br><span class="line">			@AllArgsConstructor</span><br><span class="line">			</span><br><span class="line">		å®šä¹‰å±æ€§</span><br><span class="line">    	 Long total	æ€»æ¡æ•°</span><br><span class="line">    	 List&lt;?&gt; data	æ•°æ®list</span><br><span class="line">2âƒ£ï¸å…¨å±€æ—¶é—´æ ¼å¼è½¬æ¢ç±»DateConverter</span><br><span class="line">		æ³¨è§£</span><br><span class="line">			@Component</span><br><span class="line">		å®ç°Converter&lt;String, LocalDate&gt;</span><br><span class="line">			é‡å†™convert</span><br><span class="line">				return LocalDate.parse(source, DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&quot;));</span><br><span class="line">		ç»™pojo-Employeeäºæ—¶é—´ç›¸å…³çš„å±æ€§åŠ ä¸Šæ³¨è§£ï¼Œä»¥ä¾¿ç”¨äºå‰ç«¯è®¿é—®</span><br><span class="line">			@JsonFormat(pattern &#x3D; &quot;yyyy-MM-dd&quot;,timezone &#x3D; &quot;Asia&#x2F;Shanghai&quot;)</span><br><span class="line">3âƒ£ï¸å°†å¤–æ¥è¡¨åœ¨pojo-Employeeä½“ç°</span><br><span class="line">		@ApiModelProperty(value &#x3D; &quot;æ°‘æ—&quot;)</span><br><span class="line">    @TableField(exist &#x3D; false)</span><br><span class="line">    private Nation nation;</span><br><span class="line">4âƒ£ï¸è·å–å‘˜å·¥åˆ†é¡µæŸ¥è¯¢</span><br><span class="line">	ä¿®æ”¹EmployeeController</span><br><span class="line">		æ ¹æ®t_menuç¡®å®šæ³¨è§£@RequestMapping(&quot;&#x2F;employee&#x2F;basic&quot;)è·¯å¾„</span><br><span class="line">		æ–°å»ºæ–¹æ³•getEmployee</span><br><span class="line">			æ³¨è§£</span><br><span class="line">			 @ApiOperation(value &#x3D; &quot;è·å–æ‰€æœ‰å‘˜å·¥ï¼ˆåˆ†é¡µï¼‰&quot;)</span><br><span class="line">	     @GetMapping(&quot;&#x2F;&quot;)</span><br><span class="line">			å‚æ•°</span><br><span class="line">				@RequestParam(defaultValue &#x3D; &quot;1&quot;) Integer currentPage,</span><br><span class="line">        @RequestParam(defaultValue &#x3D; &quot;10&quot;) Integer size,</span><br><span class="line">        Employee employee,</span><br><span class="line">        LocalDate[] beginDateScope</span><br><span class="line">      æ³¨å…¥employeeEcServiceï¼Œæ·»åŠ æ–¹æ³•getEmployeeByPage</span><br><span class="line">      	å‚æ•°(currentPage, size, employee, beginDateScope)</span><br><span class="line">      åœ¨IEmployeeEcServiceå®šä¹‰getEmployeeByPage</span><br><span class="line">      åœ¨EmployeeEcServiceImplå®ç°getEmployeeByPage</span><br><span class="line">      	å¼€å¯åˆ†é¡µ page&#x2F;com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line">      	Page&lt;EmployeeEc&gt; page &#x3D; new Page&lt;&gt;(currentPage, size);</span><br><span class="line">      	æ³¨å…¥employeeMapperï¼Œ</span><br><span class="line">      		åœ¨employeeMapperå®šä¹‰getEmployeeByPage</span><br><span class="line">      		å‚æ•°(page, employee, beginDateScope)</span><br><span class="line">      	å°†æŸ¥è¯¢ç»“æœè®¾ç½®åˆ°IPage</span><br><span class="line">      	é€šè¿‡RespPageBeanå°†IPageæ‹†è§£è¿”å›</span><br><span class="line">      		RespPageBean respPageBean &#x3D; new RespPageBean(employeeByPage.getTotal(), 							employeeByPage.getRecords());</span><br><span class="line">      åœ¨EmployeeMapperå®šä¹‰getEmployeeByPage</span><br><span class="line">      åœ¨EmployeeMapper.xmlå®ç°sqlï¼Œç¼–å†™resultMap</span><br><span class="line">      	 &lt;!--    è·å–æ‰€æœ‰å‘˜å·¥(åˆ†é¡µ)--&gt;</span><br><span class="line">        &lt;select id&#x3D;&quot;getEmployeeByPage&quot; resultMap&#x3D;&quot;EmployeeInfo&quot;&gt;</span><br><span class="line">            SELECT</span><br><span class="line">            e.*,</span><br><span class="line">            n.id AS nid,</span><br><span class="line">            n.&#96;name&#96; AS nname,</span><br><span class="line">            p.id AS pid,</span><br><span class="line">            p.&#96;name&#96; AS pname,</span><br><span class="line">            d.id AS did,</span><br><span class="line">            d.&#96;name&#96; AS dname,</span><br><span class="line">            j.id AS jid,</span><br><span class="line">            j.&#96;name&#96; AS jname,</span><br><span class="line">            pos.id AS posid,</span><br><span class="line">            pos.&#96;name&#96; AS posname</span><br><span class="line">            FROM</span><br><span class="line">            t_employee e,</span><br><span class="line">            t_nation n,</span><br><span class="line">            t_politics_status p,</span><br><span class="line">            t_department d,</span><br><span class="line">            t_joblevel j,</span><br><span class="line">            t_position pos</span><br><span class="line">            WHERE</span><br><span class="line">            e.nationId &#x3D; n.id</span><br><span class="line">            AND e.politicId &#x3D; p.id</span><br><span class="line">            AND e.departmentId &#x3D; d.id</span><br><span class="line">            AND e.jobLevelId &#x3D; j.id</span><br><span class="line">            AND e.posId &#x3D; pos.id</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;employee.name and &#39;&#39;!&#x3D;employee.name&quot;&gt;</span><br><span class="line">                AND e.&#96;name&#96; LIKE concat( &#39;%&#39;, #&#123;employee.name&#125;, &#39;%&#39; )</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;employee.politicId &quot;&gt;</span><br><span class="line">                AND e.politicId &#x3D;#&#123;employee.politicId&#125;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;employee.nationId &quot;&gt;</span><br><span class="line">                AND e.nationId &#x3D;#&#123;mployee.nationId&#125;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;employee.jobLevelId &quot;&gt;</span><br><span class="line">                AND e.jobLevelId &#x3D;#&#123;mployee.jobLevelId&#125;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;employee.posId &quot;&gt;</span><br><span class="line">                AND e.posId &#x3D;#&#123;mployee.posId&#125;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;employee.engageForm and &#39;&#39;!&#x3D;employee.engageForm&quot;&gt;</span><br><span class="line">                AND e.engageForm &#x3D;#&#123;mployee.engageForm&#125;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;employee.departmentId &quot;&gt;</span><br><span class="line">                AND e.departmentId &#x3D;#&#123;mployee.departmentId&#125;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;null!&#x3D;beginDateScope and 2&#x3D;&#x3D;beginDateScope.length&quot;&gt;</span><br><span class="line">            AND e.beginDate BETWEEN</span><br><span class="line">            #&#123;beginDateScope[0]&#125; AND #&#123;beginDateScope[1]&#125;</span><br><span class="line">       		  &lt;&#x2F;if&gt;</span><br><span class="line">            ORDER BY</span><br><span class="line">            e.id</span><br><span class="line">         &lt;&#x2F;select&gt;</span><br><span class="line">					</span><br><span class="line">					&lt;resultMap id&#x3D;&quot;EmployeeInfo&quot; type&#x3D;&quot;com.zoux.server.pojo.Employee&quot; extends&#x3D;&quot;BaseResultMap&quot;&gt;</span><br><span class="line">            &lt;association property&#x3D;&quot;nation&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Nation&quot;&gt;</span><br><span class="line">                &lt;id column&#x3D;&quot;nid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">                &lt;result column&#x3D;&quot;nname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;association&gt;</span><br><span class="line">            &lt;association property&#x3D;&quot;politicsStatus&quot; javaType&#x3D;&quot;com.zoux.server.pojo.PoliticsStatus&quot;&gt;</span><br><span class="line">                &lt;id column&#x3D;&quot;pid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">                &lt;result column&#x3D;&quot;pname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;association&gt;</span><br><span class="line">            &lt;association property&#x3D;&quot;department&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Department&quot;&gt;</span><br><span class="line">                &lt;id column&#x3D;&quot;did&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">                &lt;result column&#x3D;&quot;dname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;association&gt;</span><br><span class="line">            &lt;association property&#x3D;&quot;joblevel&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Joblevel&quot;&gt;</span><br><span class="line">                &lt;id column&#x3D;&quot;jid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">                &lt;result column&#x3D;&quot;jname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;association&gt;</span><br><span class="line">            &lt;association property&#x3D;&quot;position&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Position&quot;&gt;</span><br><span class="line">                &lt;id column&#x3D;&quot;posid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">                &lt;result column&#x3D;&quot;posname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;association&gt;</span><br><span class="line">        &lt;&#x2F;resultMap&gt;</span><br></pre></td></tr></table></figure>
<h1 id="å‘˜å·¥ç®¡ç†åŠŸèƒ½-æ·»åŠ -åˆ é™¤-æ›´æ–°å‘˜å·¥"><a href="#å‘˜å·¥ç®¡ç†åŠŸèƒ½-æ·»åŠ -åˆ é™¤-æ›´æ–°å‘˜å·¥" class="headerlink" title="å‘˜å·¥ç®¡ç†åŠŸèƒ½-æ·»åŠ /åˆ é™¤/æ›´æ–°å‘˜å·¥"></a>å‘˜å·¥ç®¡ç†åŠŸèƒ½-æ·»åŠ /åˆ é™¤/æ›´æ–°å‘˜å·¥</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸è·å–æ‰€æœ‰æ”¿æ²»é¢è²Œ</span><br><span class="line">2âƒ£ï¸è·å–æ‰€æœ‰èŒç§°</span><br><span class="line">3âƒ£ï¸è·å–æ‰€æœ‰æ°‘æ—</span><br><span class="line">4âƒ£ï¸è·å–æ‰€æœ‰èŒä½</span><br><span class="line">5âƒ£ï¸è·å–æ‰€æœ‰éƒ¨é—¨</span><br><span class="line">å‰å…­æ­¥æ­¥éª¤ä¸€æ‘¸ä¸€æ ·</span><br><span class="line">	åœ¨EmployeeControllerç¼–è¾‘</span><br><span class="line">    æ³¨å…¥departmentService</span><br><span class="line">    @ApiOperation(value &#x3D; &quot;è·å–æ‰€æœ‰éƒ¨é—¨&quot;)</span><br><span class="line">      @GetMapping(&quot;&#x2F;department&quot;)</span><br><span class="line">      public List&lt;Department&gt; getAllDepartment() &#123;</span><br><span class="line">          return departmentService.getAllDepartments();</span><br><span class="line">      &#125;</span><br><span class="line">6âƒ£ï¸è·å–å·¥å·</span><br><span class="line">	åœ¨EmployeeControlleræ–°å»ºmaxWorkId</span><br><span class="line">	æ³¨å…¥employeeEcService</span><br><span class="line">	åœ¨IEmployeeEcServiceå®šä¹‰maxWorkId</span><br><span class="line">	åœ¨EmployeeEcServiceImplå®ç°maxWorkId</span><br><span class="line">		æ³¨å…¥employeeMapper</span><br><span class="line">    	æŸ¥è¯¢sql	</span><br><span class="line">    		employeeMapper.selectMaps(new QueryWrapper&lt;Employee&gt;().select(&quot;max(workId)&quot;))</span><br><span class="line">    è¿”å›æ ¼å¼åŒ–åçš„æ•°æ®</span><br><span class="line">    	String.format(&quot;%08d&quot;, Integer.parseInt(maps.get(0).get(&quot;max(workId)&quot;).toString()) + 1)</span><br><span class="line">7âƒ£ï¸æ·»åŠ å‘˜å·¥</span><br><span class="line">	åœ¨EmployeeControlleræ–°å»ºaddEmp</span><br><span class="line">	æ³¨å…¥employeeEcService</span><br><span class="line">	åœ¨IEmployeeEcServiceå®šä¹‰addEmp</span><br><span class="line">	åœ¨EmployeeEcServiceImplå®ç°addEmp</span><br><span class="line">		è®¡ç®—åˆåŒæœŸé™è®¡ç®—,ä¿ç•™2ä½å°æ•°</span><br><span class="line">	æ³¨å…¥employeeMapper</span><br><span class="line">  	è°ƒç”¨nsert(employee)</span><br><span class="line">  è¿”å›æç¤º	</span><br><span class="line">8âƒ£ï¸æ›´æ–°å‘˜å·¥</span><br><span class="line">	åœ¨EmployeeControlleræ–°å»ºupdateEmp</span><br><span class="line">	æ³¨è§£RequestBody</span><br><span class="line">		if (employeeEcService.updateById(employee)) &#123;</span><br><span class="line">            return RespBean.success(&quot;æ›´æ–°æˆåŠŸ&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;æ›´æ–°å¤±è´¥&quot;);</span><br><span class="line">9âƒ£ï¸åˆ é™¤å‘˜å·¥</span><br><span class="line">	åœ¨EmployeeControlleræ–°å»ºdeleteEmp</span><br><span class="line">		æ³¨è§£PathVariable</span><br><span class="line">	 if (employeeEcService.removeById(id)) &#123;</span><br><span class="line">            return RespBean.success(&quot;åˆ é™¤æˆåŠŸ&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;åˆ é™¤å¤±è´¥&quot;);</span><br></pre></td></tr></table></figure>
<h1 id="å‘˜å·¥æ•°æ®å¯¼å…¥å¯¼å‡º"><a href="#å‘˜å·¥æ•°æ®å¯¼å…¥å¯¼å‡º" class="headerlink" title="å‘˜å·¥æ•°æ®å¯¼å…¥å¯¼å‡º"></a>å‘˜å·¥æ•°æ®å¯¼å…¥å¯¼å‡º</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸å¼•å…¥easy poiä¾èµ–</span><br><span class="line">	 &lt;!--   easy poiä¾èµ–     --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;cn.afterturn&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;easypoi-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.1.3&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">2âƒ£ï¸pojo-EmployeeåŠ ä¸Šeasypoiæ³¨è§£</span><br><span class="line">		@ApiModelProperty(value &#x3D; &quot;æ€§åˆ«&quot;)</span><br><span class="line">		@Excel(name &#x3D; &quot;æ€§åˆ«&quot;)</span><br><span class="line">    private String gender;</span><br><span class="line">    withé•¿åº¦ formatæ ¼å¼åŒ–</span><br><span class="line">   		@Excel(name &#x3D; &quot;å‡ºç”Ÿæ—¥æœŸ&quot;, width &#x3D; 30, format &#x3D; &quot;yyyy-MM-dd&quot;)</span><br><span class="line"> 		è·¨å®ä½“ç±»æ³¨è§£</span><br><span class="line"> 			@ApiModelProperty(value &#x3D; &quot;èŒä½&quot;)</span><br><span class="line">      @TableField(exist &#x3D; false)</span><br><span class="line">      @ExcelEntity(name &#x3D; &quot;èŒä½&quot;)</span><br><span class="line">      private Position position;</span><br><span class="line">      	è¿›å…¥åˆ°å…·ä½“å®ä½“ç±»åŠ æ³¨è§£</span><br><span class="line">      		  @ApiModelProperty(value &#x3D; &quot;èŒä½&quot;)</span><br><span class="line">            @Excel(name &#x3D; &quot;èŒä½&quot;)</span><br><span class="line">            private String name;</span><br><span class="line">3âƒ£ï¸å¯¼å‡ºæ•°æ®</span><br><span class="line">	åœ¨EmployeeControlleræ–°å»ºexportEmployeeæ–¹æ³•</span><br><span class="line">		æ³¨è§£</span><br><span class="line">    	@ApiOperation(value &#x3D; &quot;å¯¼å‡ºå‘˜å·¥æ•°æ®&quot;)</span><br><span class="line">    	@GetMapping(value &#x3D; &quot;&#x2F;export&quot;,produces &#x3D; &quot;application&#x2F;octet-stream&quot;)</span><br><span class="line">		å‚æ•°</span><br><span class="line">			HttpServletResponse response</span><br><span class="line">		æ³¨å…¥</span><br><span class="line">			employeeService</span><br><span class="line">				æ–°å»ºæ–¹æ³•getEmployee</span><br><span class="line">					å°†æŸ¥è¯¢çš„æ•°æ®å­˜å…¥List</span><br><span class="line">					ExportParams params &#x3D; new ExportParams(&quot;å‘˜å·¥è¡¨&quot;, &quot;å‘˜å·¥è¡¨&quot;, ExcelType.HSSF);</span><br><span class="line">        	Workbook workbook &#x3D; ExcelExportUtil.exportExcel(params, Employee.class, list);</span><br><span class="line">        	è¾“å‡ºæµ</span><br><span class="line">        		ServletOutputStream out &#x3D; null;</span><br><span class="line">        		&#x2F;&#x2F;ä»¥æµçš„å½¢å¼ä¼ è¾“</span><br><span class="line">            response.setHeader(&quot;content-type&quot;, &quot;application&#x2F;octet-stream&quot;);</span><br><span class="line">            &#x2F;&#x2F;é˜²æ­¢ä¸­æ–‡ä¹±ç </span><br><span class="line">            response.setHeader(&quot;content-disposition&quot;, &quot;attachment;filename&#x3D;&quot; + URLEncoder.encode(&quot;å‘˜å·¥è¡¨.xls&quot;, &quot;UTF-8&quot;));</span><br><span class="line">            out&#x3D;response.getOutputStream();</span><br><span class="line">            workbook.write(out);</span><br><span class="line">            </span><br><span class="line">		åœ¨IEmployeeServiceå®šä¹‰	getEmployee</span><br><span class="line">    åœ¨EmployeeServiceImplå®ç° getEmployee</span><br><span class="line">    	æ³¨å…¥employeeMapper</span><br><span class="line">    åœ¨EmployeeMapper å®šä¹‰	getEmployee</span><br><span class="line">    åœ¨EmployeeMapper.xmlå®ç°sqlï¼Œç¼–å†™resultMap</span><br><span class="line">    	&lt;!--    å¯¼å‡ºå‘˜å·¥æ•°æ®--&gt;</span><br><span class="line">   	 &lt;select id&#x3D;&quot;getEmployee&quot; resultMap&#x3D;&quot;EmployeeInfo&quot;&gt;</span><br><span class="line">        SELECT e.*,</span><br><span class="line">        n.id AS nid,</span><br><span class="line">        n.&#96;name&#96; AS nname,</span><br><span class="line">        p.id AS pid,</span><br><span class="line">        p.&#96;name&#96; AS pname,</span><br><span class="line">        d.id AS did,</span><br><span class="line">        d.&#96;name&#96; AS dname,</span><br><span class="line">        j.id AS jid,</span><br><span class="line">        j.&#96;name&#96; AS jname,</span><br><span class="line">        pos.id AS posid,</span><br><span class="line">        pos.&#96;name&#96; AS posname</span><br><span class="line">        FROM t_employee e,</span><br><span class="line">        t_nation n,</span><br><span class="line">        t_politics_status p,</span><br><span class="line">        t_department d,</span><br><span class="line">        t_joblevel j,</span><br><span class="line">        t_position pos</span><br><span class="line">        WHERE e.nationId &#x3D; n.id</span><br><span class="line">        AND e.politicId &#x3D; p.id</span><br><span class="line">        AND e.departmentId &#x3D; d.id</span><br><span class="line">        AND e.jobLevelId &#x3D; j.id</span><br><span class="line">        AND e.posId &#x3D; pos.id</span><br><span class="line">        &lt;if test&#x3D;&quot;null!&#x3D;id&quot;&gt;</span><br><span class="line">            AND e.id &#x3D; #&#123;id&#125;</span><br><span class="line">        &lt;&#x2F;if&gt;</span><br><span class="line">        ORDER BY e.id</span><br><span class="line">    	&lt;&#x2F;select&gt;</span><br><span class="line">    	</span><br><span class="line">    	&lt;resultMap id&#x3D;&quot;EmployeeInfo&quot; type&#x3D;&quot;com.zoux.server.pojo.Employee&quot; extends&#x3D;&quot;BaseResultMap&quot;&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;nation&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Nation&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;nid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;nname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;association&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;politicsStatus&quot; javaType&#x3D;&quot;com.zoux.server.pojo.PoliticsStatus&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;pid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;pname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;association&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;department&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Department&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;did&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;dname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;association&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;joblevel&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Joblevel&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;jid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;jname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;association&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;position&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Position&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;posid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;posname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;association&gt;</span><br><span class="line">    	&lt;&#x2F;resultMap&gt;</span><br><span class="line">3âƒ£ï¸å¯¼å…¥æ•°æ®    	</span><br><span class="line">	ä¿®æ”¹pojoç±» Nation PoliticsStatus Department Joblevel Position</span><br><span class="line">		ä¿®æ”¹@EqualsAndHashCode(callSuper &#x3D; false,of &#x3D; &quot;name&quot;)</span><br><span class="line">			é‡å†™å…³äºnameçš„equalså’Œhashcodeæ–¹æ³•</span><br><span class="line">		åŠ å…¥@NoArgsConstructor</span><br><span class="line">		åŠ å…¥@RequiredArgsConstructor</span><br><span class="line">		åœ¨å±æ€§nameåŠ ä¸Šéç©ºæ³¨è§£@NonNull</span><br><span class="line">	åœ¨EmployeeControllerç±»é‡Œé¢æ–°å»ºimportEmployeeæ–¹æ³•</span><br><span class="line">  	æ³¨è§£</span><br><span class="line">  		 @ApiOperation(value &#x3D; &quot;å¯¼å…¥å‘˜å·¥æ•°æ®&quot;)</span><br><span class="line">   		 @PostMapping(&quot;&#x2F;import&quot;)</span><br><span class="line">   	å…¥å‚</span><br><span class="line">    	MultipartFile file</span><br><span class="line">    å‡†å¤‡å³å°†åå­—è½¬idé›†åˆ</span><br><span class="line">   	 List&lt;Nation&gt; nationList &#x3D; nationService.list();</span><br><span class="line">   	å¯¼å…¥å‚æ•°</span><br><span class="line">    	ImportParams params &#x3D; new ImportParams();</span><br><span class="line">    å»æ‰æ ‡é¢˜è¡Œ</span><br><span class="line">    	params.setTitleRows(1);</span><br><span class="line">    excel import å·¥å…·ç±» 	</span><br><span class="line">    	List&lt;Employee&gt; list &#x3D; ExcelImportUtil.importExcel(file.getInputStream(), Employee.class, params);</span><br><span class="line">    å°†å­è¡¨åç§°è½¬æ¢ä¸ºid</span><br><span class="line">    	list.forEach(employee -&gt; &#123;</span><br><span class="line">    		åæ—id</span><br><span class="line">     		employee.setNationId(nationList.get(nationList.indexOf(new Nation(employee.getNation().getName()))).getId());</span><br><span class="line">    	&#125;);</span><br><span class="line">    ä¿å­˜æ•°æ®é›†åˆ</span><br><span class="line">    	employeeService.saveBatch(list)</span><br></pre></td></tr></table></figure>
<h1 id="é‚®ä»¶åŠŸèƒ½"><a href="#é‚®ä»¶åŠŸèƒ½" class="headerlink" title="é‚®ä»¶åŠŸèƒ½"></a>é‚®ä»¶åŠŸèƒ½</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸å¼€å¯é‚®ç®±SMTPæœåŠ¡</span><br><span class="line">	ä»¥qqé‚®ç®±ä¸ºä¾‹</span><br><span class="line">		ç½‘é¡µç™»é™†-&gt;è´¦æˆ·-&gt;POP3&#x2F;IMAP&#x2F;SMTP&#x2F;Exchange&#x2F;CardDAV&#x2F;CalDAVæœåŠ¡-&gt;å¼€å¯SMTPæœåŠ¡</span><br><span class="line">2âƒ£ï¸æ–°å»ºmodule</span><br><span class="line">	maven-quickstart</span><br><span class="line">		pomä¿®æ”¹</span><br><span class="line">			å…³è”sever</span><br><span class="line">				&lt;parent&gt;</span><br><span class="line">          &lt;groupId&gt;com.zoux&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;yeb-server&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    		&lt;&#x2F;parent&gt;</span><br><span class="line">    	sourceEncoding-UTF-8</span><br><span class="line">      source-1.8</span><br><span class="line">      target-1.8</span><br><span class="line">      rabbitmq ä¾èµ–</span><br><span class="line">      mailä¾èµ–</span><br><span class="line">      thymeleaf ä¾èµ– </span><br><span class="line">      serverä¾èµ–</span><br><span class="line">3âƒ£ï¸æ–°å»ºé…ç½®æ–‡ä»¶resources&#x2F;config&#x2F;appicatioon.xml</span><br><span class="line">	ç«¯å£é…ç½®</span><br><span class="line">	é‚®ä»¶é…ç½®</span><br><span class="line">	rabbitmqé…ç½®</span><br><span class="line">4âƒ£ï¸æ·»åŠ å¯åŠ¨ç±»</span><br><span class="line">		MailApplication</span><br><span class="line">			æ³¨è§£SpringBootApplication</span><br><span class="line">			mainæ–¹æ³•</span><br><span class="line">				SpringApplication.run(MailApplication.class, args);</span><br><span class="line">4âƒ£ï¸åˆ›å»ºé‚®ä»¶æ¨¡ç‰ˆresources&#x2F;templates&#x2F;mail.html</span><br><span class="line">	&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot; xmlns:th&#x3D;&quot;http:&#x2F;&#x2F;www.thymeleaf.org&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;å…¥èŒæ¬¢è¿é‚®ä»¶&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    æ¬¢è¿ &lt;span th:text&#x3D;&quot;$&#123;name&#125;&quot;&gt;&lt;&#x2F;span&gt; åŠ å…¥ XXXX å¤§å®¶åº­ï¼Œæ‚¨çš„å…¥èŒä¿¡æ¯å¦‚ä¸‹ï¼š</span><br><span class="line">    &lt;table border&#x3D;&quot;1&quot;&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;å§“å&lt;&#x2F;td&gt;</span><br><span class="line">            &lt;td th:text&#x3D;&quot;$&#123;name&#125;&quot;&gt;&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;&#x2F;tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;èŒä½&lt;&#x2F;td&gt;</span><br><span class="line">            &lt;td th:text&#x3D;&quot;$&#123;posName&#125;&quot;&gt;&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;&#x2F;tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;èŒç§°&lt;&#x2F;td&gt;</span><br><span class="line">            &lt;td th:text&#x3D;&quot;$&#123;joblevelName&#125;&quot;&gt;&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;&#x2F;tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;éƒ¨é—¨&lt;&#x2F;td&gt;</span><br><span class="line">            &lt;td th:text&#x3D;&quot;$&#123;departmentName&#125;&quot;&gt;&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;&#x2F;tr&gt;</span><br><span class="line">    &lt;&#x2F;table&gt;</span><br><span class="line">    &lt;p&gt;æˆ‘ä»¬å…¬å¸çš„å·¥ä½œå¿ æ—¨æ˜¯ä¸¥æ ¼ï¼Œåˆ›æ–°ï¼Œè¯šä¿¡ï¼Œæ‚¨çš„åŠ å…¥å°†ä¸ºæˆ‘ä»¬å¸¦æ¥æ–°é²œçš„è¡€æ¶²ï¼Œå¸¦æ¥åˆ›æ–°çš„æ€ç»´ï¼Œä»¥åŠä¸º</span><br><span class="line">        æˆ‘ä»¬æ ‘ç«‹è‰¯å¥½çš„å…¬å¸å½¢è±¡!å¸Œæœ›åœ¨ä»¥åçš„å·¥ä½œä¸­æˆ‘ä»¬èƒ½å¤Ÿé½å¿ƒååŠ›ï¼Œä¸æ—¶ä¿±è¿›ï¼Œå›¢ç»“åä½œ!åŒæ—¶ä¹Ÿç¥æ‚¨åœ¨æœ¬å…¬</span><br><span class="line">        å¸ï¼Œå·¥ä½œæ„‰å¿«ï¼Œå®ç°è‡ªå·±çš„äººç”Ÿä»·å€¼!å¸Œæœ›åœ¨æœªæ¥çš„æ—¥å­é‡Œï¼Œæºæ‰‹å…±è¿›ï¼&lt;&#x2F;p&gt;</span><br><span class="line">		&lt;&#x2F;body&gt;</span><br><span class="line">		&lt;&#x2F;html&gt;</span><br><span class="line">5âƒ£ï¸åœ¨yeb-serveræ·»åŠ </span><br><span class="line">	pomä¾èµ–rabbitmq</span><br><span class="line">	application.xmlé…ç½®</span><br><span class="line">6âƒ£ï¸åœ¨EmployeeServiceImplçš„addEmpé‡Œé¢åŠ å…¥é‚®ä»¶å‘é€</span><br><span class="line">	æ³¨å…¥rabbitTemplate</span><br><span class="line">		Employee emp &#x3D; employeeMapper.getEmployee(employee.getId()).get(0);</span><br><span class="line">    rabbitTemplate.convertAndSend(&quot;mail.welcome&quot;,emp);</span><br><span class="line">    æ­¤æ—¶ï¼ŒEmployeeéœ€è¦å®ç°Serializable</span><br><span class="line">7âƒ£ï¸åœ¨yeb-mailæ–°å»ºMailReceiver    </span><br><span class="line">	æ³¨å…¥</span><br><span class="line">	mailProperties</span><br><span class="line">	templateEngine</span><br><span class="line">	javaMailSender</span><br><span class="line">	æ·»åŠ æ–¹æ³•handler</span><br><span class="line">		æ³¨è§£</span><br><span class="line">		@RabbitListener(queues &#x3D; &quot;mail.welcome&quot;)</span><br><span class="line">		å®šä¹‰é‚®ä»¶å†…å®¹</span><br><span class="line">		MimeMessage msg &#x3D; javaMailSender.createMimeMessage();</span><br><span class="line">    MimeMessageHelper helper &#x3D; new MimeMessageHelper(msg);</span><br><span class="line">        try &#123;</span><br><span class="line">            helper.setFrom(mailProperties.getUsername());</span><br><span class="line">            helper.setTo(employee.getEmail());</span><br><span class="line">            helper.setSubject(&quot;å…¥èŒé‚®ä»¶&quot;);</span><br><span class="line">            helper.setSentDate(new Date());</span><br><span class="line">            Context context &#x3D; new Context();</span><br><span class="line">            context.setVariable(&quot;name&quot;, employee.getName());</span><br><span class="line">            context.setVariable(&quot;posName&quot;, employee.getPosition().getName());</span><br><span class="line">            context.setVariable(&quot;joblevelName&quot;, employee.getJoblevel().getName());</span><br><span class="line">            context.setVariable(&quot;departmentName&quot;, employee.getDepartment().getName());</span><br><span class="line">            String mail &#x3D; templateEngine.process(&quot;mail&quot;, context);</span><br><span class="line">            helper.setText(mail, true);</span><br><span class="line">            javaMailSender.send(msg);</span><br><span class="line">        &#125; catch (MessagingException e) &#123;</span><br><span class="line">            LOGGER.error(&quot;MailReceiver + é‚®ä»¶å‘é€å¤±è´¥&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#125;&quot;, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">8âƒ£ï¸åœ¨MailApplicationç¼–å†™</span><br><span class="line">	æ·»åŠ é˜Ÿåˆ—</span><br><span class="line">	@Bean</span><br><span class="line">    public Queue queue()&#123;</span><br><span class="line">        return new Queue(&quot;mail.welcome&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">9âƒ£ï¸åœ¨MailApplicationæ·»åŠ æ³¨è§£å¿½ç•¥æ•°æ®åº“é…ç½®èµ„æº</span><br><span class="line">	@SpringBootApplication(exclude &#x3D; &#123;DataSourceAutoConfiguration.class&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="ç”Ÿäº§ç«¯å¯é æŠ•é€’æ–¹æ¡ˆä»‹ç»"><a href="#ç”Ÿäº§ç«¯å¯é æŠ•é€’æ–¹æ¡ˆä»‹ç»" class="headerlink" title="ç”Ÿäº§ç«¯å¯é æŠ•é€’æ–¹æ¡ˆä»‹ç»"></a>ç”Ÿäº§ç«¯å¯é æŠ•é€’æ–¹æ¡ˆä»‹ç»</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">è§£å¶</span><br><span class="line">å¼‚æ­¥</span><br><span class="line">æµé‡åŒºåˆ†</span><br><span class="line">è€ƒè™‘æ¶ˆæ¯çš„å¯é æ€§</span><br><span class="line">	ä¿è¯ç”Ÿäº§ç«¯æ¶ˆæ¯çš„å¯é æ€§æŠ•é€’ï¼Œæ˜¯å¦çœŸçœŸåˆ‡åˆ‡çš„æŠ•é€’åˆ°äº†é˜Ÿåˆ—æˆ–è€…ç»™æ¶ˆè´¹è€…æ¶ˆè´¹äº†</span><br><span class="line">	 ä¿è¯æ¶ˆæ¯çš„æˆåŠŸå‘å‡º </span><br><span class="line">	 rabbitmqé˜Ÿåˆ—æˆåŠŸçš„æ¥æ”¶åˆ°æ¶ˆæ¯</span><br><span class="line">	 å‘é€ç«¯èƒ½å¤Ÿè·å¾—rabbitmqç¡®è®¤åº”ç­”</span><br><span class="line">	æ¶ˆè´¹è€…æ€ä¹ˆåšå¹‚ç­‰æ€§ä¿è¯ï¼Œä¸€æ¡æ¶ˆæ¯é‡å¤å¤šå‘ï¼Œåªæ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯	</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="å¼€å¯æ¶ˆæ¯å›è°ƒæœºåˆ¶"><a href="#å¼€å¯æ¶ˆæ¯å›è°ƒæœºåˆ¶" class="headerlink" title="å¼€å¯æ¶ˆæ¯å›è°ƒæœºåˆ¶"></a>å¼€å¯æ¶ˆæ¯å›è°ƒæœºåˆ¶</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸æ–°å»ºpojoç±»MailConstants</span><br><span class="line">	å®šä¹‰å¸¸é‡</span><br><span class="line">2âƒ£ï¸ä¿®æ”¹EmployeeServiceImpl&#x2F;addEmp</span><br><span class="line">	æ³¨å…¥mailLogMapper</span><br><span class="line">	åœ¨å‘é€æ¶ˆæ¯ä¹‹é—´åŠ å…¥æ¶ˆæ¯å›è°ƒ</span><br><span class="line">	æ•°æ®åº“è®°å½•å‘é€çš„æ¶ˆæ¯</span><br><span class="line">  	MailLog</span><br><span class="line">  å‘é€ä¿¡æ¯</span><br><span class="line">  rabbitTemplate.convertAndSend(MailConstants.MAIL_EXCHANGE_NAME,</span><br><span class="line">                    MailConstants.MAIL_ROUTING_KEY_NAME,</span><br><span class="line">                    emp,</span><br><span class="line">                    new CorrelationData(msgId));</span><br><span class="line">3âƒ£ï¸æ›´æ”¹MailApplication</span><br><span class="line">  	return new Queue(MailConstants.MAIL_QUEUE_NAME);</span><br><span class="line">4âƒ£ï¸æ›´æ”¹MailReceiver</span><br><span class="line"> 		@RabbitListener(queues &#x3D; MailConstants.MAIL_QUEUE_NAME)ç›‘å¬</span><br><span class="line">5âƒ£ï¸æ·»åŠ rabbitMQé…ç½®ç±» RabbitMQConfig</span><br><span class="line">	æ³¨å…¥</span><br><span class="line">    cachingConnectionFactory</span><br><span class="line">    mailLogService</span><br><span class="line">	å®šä¹‰å¸¸é‡</span><br><span class="line">		public static final Logger logger &#x3D; LoggerFactory.getLogger(RabbitMQConfig.class);	</span><br><span class="line">	å¼•å…¥Bean</span><br><span class="line">    Binding</span><br><span class="line">    DirectExchange</span><br><span class="line">    Queue	</span><br><span class="line">    RabbitTemplate</span><br><span class="line">6âƒ£ï¸æ·»åŠ application.xmlé…ç½®</span><br><span class="line">	 rabbitmq:</span><br><span class="line">    username: guest</span><br><span class="line">    password: guest</span><br><span class="line">    host: localhost</span><br><span class="line">    port: 5672</span><br><span class="line">    # æ¶ˆæ¯å¤±è´¥å›è°ƒ</span><br><span class="line">    publisher-returns: true</span><br><span class="line">    # æ¶ˆæ¯ç¡®è®¤å›è°ƒ</span><br><span class="line">    publisher-confirm-type: correlated</span><br></pre></td></tr></table></figure>
<p>æ³¨å…¥Beanè¯¦æƒ…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Queue <span class="title">queue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Queue(MailConstants.MAIL_QUEUE_NAME);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DirectExchange <span class="title">directExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(MailConstants.MAIL_EXCHANGE_NAME);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">binding</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue()).to(directExchange()).with(MailConstants.MAIL_ROUTING_KEY_NAME);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RabbitTemplate <span class="title">rabbitTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        RabbitTemplate rabbitTemplate = <span class="keyword">new</span>  RabbitTemplate(cachingConnectionFactory);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ¶ˆæ¯ç¡®è®¤å›è°ƒ,ç¡®è®¤æ¶ˆæ¯æ˜¯å¦åˆ°è¾¾broker</span></span><br><span class="line"><span class="comment">         * data:æ¶ˆæ¯å”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="comment">         * ackï¼šç¡®è®¤ç»“æœ</span></span><br><span class="line"><span class="comment">         * causeï¼šå¤±è´¥åŸå› </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        rabbitTemplate.setConfirmCallback((data,ack,cause)-&gt;&#123;</span><br><span class="line">            String msgId = data.getId();</span><br><span class="line">            System.out.println(<span class="string">&quot;RabbitMQConfig: msgId = &quot;</span> + msgId);</span><br><span class="line">            <span class="keyword">if</span> (ack)&#123;</span><br><span class="line">                logger.info(<span class="string">&quot;&#123;&#125;==========&gt;æ¶ˆæ¯å‘é€æˆåŠŸ&quot;</span>,msgId);</span><br><span class="line">                <span class="comment">//æ›´æ•°æ®åº“æ•°æ®çŠ¶æ€</span></span><br><span class="line">                mailLogService.update(<span class="keyword">new</span> UpdateWrapper&lt;MailLog&gt;().set(<span class="string">&quot;status&quot;</span>,<span class="number">1</span>).eq(<span class="string">&quot;msgId&quot;</span>,msgId));</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                logger.error(<span class="string">&quot;&#123;&#125;==========&gt;æ¶ˆæ¯å‘é€å¤±è´¥&quot;</span>,msgId);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ¶ˆæ¯å¤±è´¥å›è°ƒï¼Œæ¯”å¦‚routerä¸åˆ°queueæ—¶å›è°ƒ</span></span><br><span class="line"><span class="comment">         * msg:æ¶ˆæ¯ä¸»é¢˜</span></span><br><span class="line"><span class="comment">         * repCode:å“åº”ç </span></span><br><span class="line"><span class="comment">         * repText:å“åº”æè¿°</span></span><br><span class="line"><span class="comment">         * exchange:äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">         * routingKey:è·¯ç”±é”®</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        rabbitTemplate.setReturnCallback((msg,repCode,repText,exchange,routingKey)-&gt;&#123;</span><br><span class="line">            logger.error(<span class="string">&quot;&#123;&#125;=======================&gt;æ¶ˆæ¯å‘é€åˆ°queueæ—¶å¤±è´¥&quot;</span>,msg.getBody());</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> rabbitTemplate;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<hr>
<h1 id="ç”Ÿäº§ç«¯æ¶ˆæ¯æŠ•é€’å¯é æ€§å®ç°"><a href="#ç”Ÿäº§ç«¯æ¶ˆæ¯æŠ•é€’å¯é æ€§å®ç°" class="headerlink" title="ç”Ÿäº§ç«¯æ¶ˆæ¯æŠ•é€’å¯é æ€§å®ç°"></a>ç”Ÿäº§ç«¯æ¶ˆæ¯æŠ•é€’å¯é æ€§å®ç°</h1><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸å‡†å¤‡åŒ…taskæ–°å»ºç±»MailTask</span><br><span class="line">	æ³¨è§£</span><br><span class="line">		Component</span><br><span class="line">	æ³¨å…¥</span><br><span class="line">		employeeService</span><br><span class="line">		rabbitTemplate</span><br><span class="line">		mailLogService</span><br><span class="line">	è®¾ç½®å®šæ—¶ä»»åŠ¡</span><br><span class="line">  	@Scheduled(cron &#x3D; &quot;0&#x2F;10 * * * * ?&quot;) é‚®ä»¶å‘é€å®šæ—¶ä»»åŠ¡ 10ç§’ä¸€æ¬¡</span><br><span class="line">  æ–°å»ºæ–¹æ³•mailTask</span><br><span class="line">  	åˆ¤æ–­é‡è¯•æ¡ä»¶</span><br><span class="line">  		çŠ¶æ€ä¸º0ä¸”é‡è¯•æ—¶é—´å°äºå½“å‰æ—¶é—´çš„æ‰éœ€è¦é‡æ–°å‘é€</span><br><span class="line">  		é‡è¯•æ¬¡æ•°è¶…è¿‡3æ¬¡ï¼Œæ›´æ–°ä¸ºæŠ•é€’å¤±è´¥ï¼Œä¸å†é‡è¯•</span><br><span class="line">  	å°†ä¸Šè¿°æ“ä½œè®°å½•åˆ°æ•°æ®åº“</span><br><span class="line">    	æ›´æ–°é‡è¯•æ¬¡æ•°ï¼Œæ›´æ–°æ—¶é—´ï¼Œé‡è¯•æ—¶é—´</span><br><span class="line">    æœ€åé‡å‘ä¿¡æ¯</span><br><span class="line">2âƒ£ï¸å¼€å¯å®šæ—¶ä»»åŠ¡</span><br><span class="line">	YebAppicationå¯åŠ¨ç±»</span><br><span class="line">		æ³¨è§£</span><br><span class="line">			@EnableScheduling</span><br><span class="line">3âƒ£ï¸æµ‹è¯•</span><br><span class="line">	æ­£å¸¸æ·»åŠ å‘˜å·¥æµ‹è¯•</span><br><span class="line">	æµ‹è¯•å¤±è´¥</span><br><span class="line">		å•æ¬¡å¤±è´¥ </span><br><span class="line">			ä¿®æ”¹EmployeeServiceImplå‘é€é‚®ä»¶ä¿¡æ¯å‚æ•° äº¤æ¢æœºåç§°</span><br><span class="line">			ä¸¢å¤±è·¯ç”±ï¼Œå‘é€å¤±è´¥ï¼Œå°±ä¼šèµ°å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡æ˜¯æ­£ç¡®çš„äº¤æ¢æœºåç§°</span><br><span class="line">		å¤šæ¬¡å¤±è´¥</span><br><span class="line">    	ä¿®æ”¹EmployeeServiceImplå‘é€é‚®ä»¶ä¿¡æ¯å‚æ•° äº¤æ¢æœºåç§°</span><br><span class="line">			ä¿®æ”¹å®šæ—¶ä»»åŠ¡äº¤æ¢æœºåç§°ã€‚</span><br></pre></td></tr></table></figure>
<p>MailTask</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line">import com.baomidou.mybatisplus.core.conditions.update.UpdateWrapper;</span><br><span class="line">import com.zoux.server.pojo.Employee;</span><br><span class="line">import com.zoux.server.pojo.MailConstants;</span><br><span class="line">import com.zoux.server.pojo.MailLog;</span><br><span class="line">import com.zoux.server.service.IEmployeeService;</span><br><span class="line">import com.zoux.server.service.IMailLogService;</span><br><span class="line">import org.springframework.amqp.rabbit.connection.CorrelationData;</span><br><span class="line">import org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * é‚®ä»¶å‘é€å®šæ—¶ä»»åŠ¡</span><br><span class="line"> *</span><br><span class="line"> * @author zahnglishen</span><br><span class="line"> * @since 1.0.0</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Component</span><br><span class="line">public class MailTask &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private IMailLogService mailLogService;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RabbitTemplate rabbitTemplate;</span><br><span class="line">    @Autowired</span><br><span class="line">    private IEmployeeService employeeService;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * é‚®ä»¶å‘é€å®šæ—¶ä»»åŠ¡</span><br><span class="line">     * 10ç§’ä¸€æ¬¡</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Scheduled(cron &#x3D; &quot;0&#x2F;10 * * * * ?&quot;)</span><br><span class="line">    public void mailTask()&#123;</span><br><span class="line">        &#x2F;&#x2F;çŠ¶æ€ä¸º0ä¸”é‡è¯•æ—¶é—´å°äºå½“å‰æ—¶é—´çš„æ‰éœ€è¦é‡æ–°å‘é€</span><br><span class="line">        List&lt;MailLog&gt; list &#x3D; mailLogService.list(</span><br><span class="line">                new QueryWrapper&lt;MailLog&gt;()</span><br><span class="line">                        .eq(&quot;status&quot;, 0)</span><br><span class="line">                        .lt(&quot;tryTime&quot;,</span><br><span class="line">                        LocalDateTime.now()));</span><br><span class="line">        list.forEach(mailLog -&gt; &#123;</span><br><span class="line">            &#x2F;&#x2F;é‡è¯•æ¬¡æ•°è¶…è¿‡3æ¬¡ï¼Œæ›´æ–°ä¸ºæŠ•é€’å¤±è´¥ï¼Œä¸å†é‡è¯•</span><br><span class="line">            if (3 &lt;&#x3D; mailLog.getCount())&#123;</span><br><span class="line">                mailLogService.update(</span><br><span class="line">                        new UpdateWrapper&lt;MailLog&gt;().</span><br><span class="line">                        set(&quot;status&quot;,2).</span><br><span class="line">                        eq(&quot;msgId&quot;, mailLog.getMsgId()));</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F;æ›´æ–°é‡è¯•æ¬¡æ•°ï¼Œæ›´æ–°æ—¶é—´ï¼Œé‡è¯•æ—¶é—´</span><br><span class="line">            mailLogService.update(</span><br><span class="line">                    new UpdateWrapper&lt;MailLog&gt;()</span><br><span class="line">                            .set(&quot;count&quot;,mailLog.getCount()+1)</span><br><span class="line">                            .set(&quot;updateTime&quot;,LocalDateTime.now())</span><br><span class="line">                            .set(&quot;tryTime&quot;,LocalDateTime.now() .plusMinutes(MailConstants.MSG_TIMEOUT))</span><br><span class="line">                            .eq(&quot;msgId&quot;,mailLog.getMsgId()));</span><br><span class="line">            Employee employee &#x3D; employeeService.getEmployee(mailLog.getEid()).get(0);</span><br><span class="line">            System.out.println(&quot;MailTask: employee &#x3D; &quot; + employee );</span><br><span class="line">            System.out.println(&quot;MailTask: msgId: &quot; + mailLog.getMsgId());</span><br><span class="line">            &#x2F;&#x2F;å‘é€æ¶ˆæ¯</span><br><span class="line">            rabbitTemplate.convertAndSend(MailConstants.MAIL_EXCHANGE_NAME,MailConstants.MAIL_ROUTING_KEY_NAME,employee,new CorrelationData(mailLog.getMsgId()));</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="æ¶ˆè´¹ç«¯å¹‚ç­‰æ€§"><a href="#æ¶ˆè´¹ç«¯å¹‚ç­‰æ€§" class="headerlink" title="æ¶ˆè´¹ç«¯å¹‚ç­‰æ€§"></a>æ¶ˆè´¹ç«¯å¹‚ç­‰æ€§</h1><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸rabbitMQå¼€å¯æ‰‹åŠ¨ç¡®è®¤</span><br><span class="line">	yeb-mail&#x2F;application.xml</span><br><span class="line">		listener:</span><br><span class="line">      simple:</span><br><span class="line">        #å¼€å¯æ‰‹åŠ¨ç¡®è®¤</span><br><span class="line">        acknowledge-mode: manual</span><br><span class="line">2âƒ£ï¸yeb-mail&#x2F;application.xml</span><br><span class="line">	åŠ å…¥redisé…ç½®</span><br><span class="line">		redis:</span><br><span class="line">    #è¶…æ—¶æ—¶é—´</span><br><span class="line">    timeout: 10000ms</span><br><span class="line">    #æœåŠ¡å™¨åœ°å€</span><br><span class="line">    host: 47.100.92.101</span><br><span class="line">    #æœåŠ¡å™¨ç«¯å£</span><br><span class="line">    port: 6379</span><br><span class="line">    database: 0</span><br><span class="line">    #    password: root</span><br><span class="line">    lettuce:</span><br><span class="line">      #é»˜è®¤è¿æ¥æ•°ï¼Œé»˜è®¤æ˜¯8</span><br><span class="line">      max-active: 1024</span><br><span class="line">      #æœ€å¤§è¿æ¥é˜»å¡ç­‰å¾…æ—¶é—´</span><br><span class="line">      max-wait: 1000ms</span><br><span class="line">      #æœ€å¤§ç©ºé—²è¿æ¥</span><br><span class="line">      max-idle: 200</span><br><span class="line">      #æœ€å°ç©ºé—²è¿æ¥</span><br><span class="line">      min-idle: 5</span><br><span class="line">3âƒ£ï¸ä¿®æ”¹MailReceiver</span><br><span class="line">	æ³¨å…¥</span><br><span class="line">	redisTemplate</span><br><span class="line">	æ”¹å˜handleræ–¹æ³•å‚æ•°</span><br><span class="line">		Message message, Channel channel</span><br><span class="line">	è·å–employee</span><br><span class="line">		Employee employee &#x3D; (Employee) message.getPayload();</span><br><span class="line">	è·å–æ¶ˆæ¯åºå·</span><br><span class="line">  	 MessageHeaders headers &#x3D; message.getHeaders();</span><br><span class="line">     long tag &#x3D; (long) headers.get(AmqpHeaders.DELIVERY_TAG);</span><br><span class="line">  è·å–msgId</span><br><span class="line">  	 String msgId &#x3D; (String) headers.get(&quot;spring_returned_message_correlation&quot;);</span><br><span class="line">  å­˜å…¥redis</span><br><span class="line">  		HashOperations hash &#x3D; redisTemplate.opsForHash();</span><br><span class="line">  ç¬¬ä¸€æ¬¡å‘é€é‚®ä»¶æ—¶å°†æ¶ˆæ¯idå­˜å…¥redis</span><br><span class="line">  		LOGGER.info(&quot;é‚®ä»¶å‘é€æˆåŠŸ&quot;);</span><br><span class="line">       å°†æ¶ˆæ¯idå­˜å…¥redis</span><br><span class="line">       hash.put(&quot;mail_log&quot;, msgId, &quot;OK&quot;);</span><br><span class="line">       æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯</span><br><span class="line">       channel.basicAck(tag, false);</span><br><span class="line">  åˆ¤æ–­ä¿¡æ¯æ˜¯å¦å·²ç»æ¶ˆè´¹</span><br><span class="line">  	hash.entries(&quot;mail_log&quot;).containsKey(msgId)</span><br><span class="line">  	ç¡®è®¤ç›´æ¥è¿”å›ä¸åšæ“ä½œ</span><br><span class="line">4âƒ£ï¸æ€»ç»“</span><br><span class="line">	æ¶ˆæ¯å¯é æ€§</span><br><span class="line">		ä¸€æ–¹é¢ï¼Œç”Ÿäº§ç«¯ä¿è¯æ¶ˆæ¯è¢«æ­£ç¡®çš„é€è¾¾ï¼Œé‡‡ç”¨äº†æ¶ˆæ¯è½åº“ï¼Œå¼€å¯ç¡®è®¤å›è°ƒä»¥åŠå¤±è´¥å›è°ƒåŠ ä¸Šå®šæ—¶ä»»åŠ¡</span><br><span class="line">		ä¸€æ–¹é¢ï¼Œå¹‚ç­‰æ€§ï¼Œåœ¨rediså­˜å…¥æ¶ˆæ¯idï¼Œç„¶åæ ¹æ®è¿™ä¸ªidå»åˆ¤æ–­ï¼Œå¦‚æœidå­˜åœ¨ï¼Œè¯´æ˜è¿™ä¸ªæ•°æ®å·²ç»è¢«æ¶ˆè´¹äº†ã€‚</span><br></pre></td></tr></table></figure>
<p>MailReceiverè¯¦æƒ…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">import com.zoux.server.pojo.Employee;</span><br><span class="line">import com.zoux.server.pojo.MailConstants;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line">import org.springframework.amqp.support.AmqpHeaders;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.autoconfigure.mail.MailProperties;</span><br><span class="line">import org.springframework.data.redis.core.HashOperations;</span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">import org.springframework.mail.javamail.JavaMailSender;</span><br><span class="line">import org.springframework.mail.javamail.MimeMessageHelper;</span><br><span class="line">import org.springframework.messaging.MessageHeaders;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.thymeleaf.TemplateEngine;</span><br><span class="line">import org.thymeleaf.context.Context;</span><br><span class="line">import com.rabbitmq.client.Channel;</span><br><span class="line"></span><br><span class="line">import javax.mail.MessagingException;</span><br><span class="line">import javax.mail.internet.MimeMessage;</span><br><span class="line"></span><br><span class="line">import org.springframework.messaging.Message;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * æ¶ˆæ¯æ¥æ”¶è€…</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class MailReceiver &#123;</span><br><span class="line">    private static final Logger LOGGER &#x3D; LoggerFactory.getLogger(MailReceiver.class);</span><br><span class="line">    @Autowired</span><br><span class="line">    private MailProperties mailProperties;</span><br><span class="line">    @Autowired</span><br><span class="line">    private TemplateEngine templateEngine;</span><br><span class="line">    @Autowired</span><br><span class="line">    private JavaMailSender javaMailSender;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    @RabbitListener(queues &#x3D; MailConstants.MAIL_QUEUE_NAME)</span><br><span class="line">    public void handler(Message message, Channel channel) &#123;</span><br><span class="line">        Employee employee &#x3D; (Employee) message.getPayload();</span><br><span class="line">        MessageHeaders headers &#x3D; message.getHeaders();</span><br><span class="line">        &#x2F;&#x2F;æ¶ˆæ¯åºå·</span><br><span class="line">        long tag &#x3D; (long) headers.get(AmqpHeaders.DELIVERY_TAG);</span><br><span class="line">        String msgId &#x3D; (String) headers.get(&quot;spring_returned_message_correlation&quot;);</span><br><span class="line">        HashOperations hash &#x3D; redisTemplate.opsForHash();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            if (hash.entries(&quot;mail_log&quot;).containsKey(msgId)) &#123;</span><br><span class="line">                &#x2F;&#x2F;redisä¸­åŒ…å«keyï¼Œè¯´æ˜æ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹</span><br><span class="line">                LOGGER.error(&quot;æ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;&#123;&#125;&quot;, msgId);</span><br><span class="line">                &#x2F;**</span><br><span class="line">                 * æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯</span><br><span class="line">                 * tag:æ¶ˆæ¯åºå·</span><br><span class="line">                 * multiple:æ˜¯å¦å¤šæ¡</span><br><span class="line">                 *&#x2F;</span><br><span class="line">                channel.basicAck(tag, false);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            MimeMessage msg &#x3D; javaMailSender.createMimeMessage();</span><br><span class="line">            MimeMessageHelper helper &#x3D; new MimeMessageHelper(msg);</span><br><span class="line">            helper.setFrom(mailProperties.getUsername());</span><br><span class="line">            helper.setTo(employee.getEmail());</span><br><span class="line">            helper.setSubject(&quot;å…¥èŒé‚®ä»¶&quot;);</span><br><span class="line">            helper.setSentDate(new Date());</span><br><span class="line">            Context context &#x3D; new Context();</span><br><span class="line">            context.setVariable(&quot;name&quot;, employee.getName());</span><br><span class="line">            context.setVariable(&quot;posName&quot;, employee.getPosition().getName());</span><br><span class="line">            context.setVariable(&quot;joblevelName&quot;, employee.getJoblevel().getName());</span><br><span class="line">            context.setVariable(&quot;departmentName&quot;, employee.getDepartment().getName());</span><br><span class="line">            String mail &#x3D; templateEngine.process(&quot;mail&quot;, context);</span><br><span class="line">            helper.setText(mail, true);</span><br><span class="line">            &#x2F;&#x2F;å‘é€é‚®ä»¶</span><br><span class="line">            javaMailSender.send(msg);</span><br><span class="line">            LOGGER.info(&quot;é‚®ä»¶å‘é€æˆåŠŸ&quot;);</span><br><span class="line">            &#x2F;&#x2F;å°†æ¶ˆæ¯idå­˜å…¥redis</span><br><span class="line">            hash.put(&quot;mail_log&quot;, msgId, &quot;OK&quot;);</span><br><span class="line">            &#x2F;&#x2F;æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯</span><br><span class="line">            channel.basicAck(tag, false);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                &#x2F;**</span><br><span class="line">                 * æ‰‹åŠ¨ç¡®è®¤ä¿¡æ¯</span><br><span class="line">                 * tag æ¶ˆæ¯åºå·</span><br><span class="line">                 * multiple æ˜¯å¦ç¡®è®¤å¤šæ¡</span><br><span class="line">                 * requeue æ˜¯å¦é€€å›é˜Ÿåˆ—</span><br><span class="line">                 *&#x2F;</span><br><span class="line">                channel.basicNack(tag, false, true);</span><br><span class="line">            &#125; catch (IOException ioException) &#123;</span><br><span class="line">                LOGGER.error(&quot;MailReceiver + é‚®ä»¶å‘é€å¤±è´¥&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#125;&quot;, e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">            LOGGER.error(&quot;MailReceiver + é‚®ä»¶å‘é€å¤±è´¥&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#123;&#125;&quot;, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="å·¥èµ„å¸å¥—ç®¡ç†å®ç°"><a href="#å·¥èµ„å¸å¥—ç®¡ç†å®ç°" class="headerlink" title="å·¥èµ„å¸å¥—ç®¡ç†å®ç°"></a>å·¥èµ„å¸å¥—ç®¡ç†å®ç°</h1><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸æ›´æ”¹pojoç±»Salaryå±æ€§æ—¶é—´æ ¼å¼</span><br><span class="line">	åœ¨æ—¶é—´ç›¸å…³å±æ€§ä¸ŠåŠ æ³¨è§£</span><br><span class="line">    @JsonFormat(pattern &#x3D; &quot;yyyy-MM-dd&quot;,timezone &#x3D; &quot;Asia&#x2F;shanghai&quot;)</span><br><span class="line">2âƒ£ï¸æ›´æ”¹SalaryController</span><br><span class="line">	æ³¨è§£è·¯å¾„â€œ&#x2F;salary&#x2F;sobâ€</span><br><span class="line">	å¢</span><br><span class="line">		@PostMapping(&quot;&#x2F;&quot;)</span><br><span class="line">	åˆ </span><br><span class="line">		@DeleteMapping(&quot;&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">	æ”¹</span><br><span class="line">		@PutMapping(&quot;&#x2F;&quot;)</span><br><span class="line">	æŸ¥</span><br><span class="line">		@GetMapping(&quot;&#x2F;&quot;)		</span><br></pre></td></tr></table></figure>
<p>SalaryControllerè¯¦æƒ…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">import com.zoux.server.pojo.RespBean;</span><br><span class="line">import com.zoux.server.pojo.Salary;</span><br><span class="line">import com.zoux.server.service.ISalaryService;</span><br><span class="line">import io.swagger.annotations.ApiOperation;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * å‰ç«¯æ§åˆ¶å™¨</span><br><span class="line"> * &lt;&#x2F;p&gt;</span><br><span class="line"> *</span><br><span class="line"> * @author zoux</span><br><span class="line"> * @since 2021-02-13</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;&#x2F;salary&#x2F;sob&quot;)</span><br><span class="line">public class SalaryController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private ISalaryService salaryService;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;è·å–æ‰€æœ‰å·¥èµ„å¥—è´¦&quot;)</span><br><span class="line">    @GetMapping(&quot;&#x2F;&quot;)</span><br><span class="line">    public List&lt;Salary&gt; getAllSalary() &#123;</span><br><span class="line">        return salaryService.list();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;æ·»åŠ å·¥èµ„å¥—è´¦&quot;)</span><br><span class="line">    @PostMapping(&quot;&#x2F;&quot;)</span><br><span class="line">    public RespBean addSalary(@RequestBody Salary salary) &#123;</span><br><span class="line">        salary.setCreateDate(LocalDateTime.now());</span><br><span class="line">        if (salaryService.save(salary)) &#123;</span><br><span class="line">            return RespBean.success(&quot;æ·»åŠ æˆåŠŸ&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;æ·»åŠ å¤±è´¥&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;åˆ é™¤å·¥èµ„å¥—è´¦&quot;)</span><br><span class="line">    @DeleteMapping(&quot;&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">    public RespBean deleteSalary(@PathVariable Integer id) &#123;</span><br><span class="line">        if (salaryService.removeById(id)) &#123;</span><br><span class="line">            return RespBean.success(&quot;åˆ é™¤æˆåŠŸ&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;åˆ é™¤å¤±è´¥&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;æ›´æ–°å·¥èµ„å¥—è´¦&quot;)</span><br><span class="line">    @PutMapping(&quot;&#x2F;&quot;)</span><br><span class="line">    public RespBean updateSalary(@RequestBody Salary salary) &#123;</span><br><span class="line">        if (salaryService.updateById(salary)) &#123;</span><br><span class="line">            return RespBean.success(&quot;æ›´æ–°æˆåŠŸ&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;æ›´æ–°å¤±è´¥&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<hr>
<h1 id="å‘˜å·¥å¸å¥—ç®¡ç†å®ç°"><a href="#å‘˜å·¥å¸å¥—ç®¡ç†å®ç°" class="headerlink" title="å‘˜å·¥å¸å¥—ç®¡ç†å®ç°"></a>å‘˜å·¥å¸å¥—ç®¡ç†å®ç°</h1><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸æ–°å»ºç±»SalarySobCfgController</span><br><span class="line">	æ³¨è§£	</span><br><span class="line">		@RequestMapping(&quot;&#x2F;salary&#x2F;sobcfg&quot;)</span><br><span class="line">		@RestController</span><br><span class="line">	æ³¨å…¥</span><br><span class="line">  	employeeService</span><br><span class="line">  	salaryService</span><br><span class="line">  æ–°å»ºæ–¹æ³•</span><br><span class="line">  	è·å–æ‰€æœ‰å‘˜å·¥å¥—è´¦</span><br><span class="line">  	è·å–æ‰€æœ‰å·¥èµ„å¥—è´¦</span><br><span class="line">  	æ›´æ–°å‘˜å·¥å¥—è´¦</span><br><span class="line">2âƒ£ï¸getEmployeeWithSalaryéœ€è¦è‡ªå®šä¹‰</span><br><span class="line">	IEmployeeService-&gt;EmployeeServiceImpl-&gt;EmployeeMapper-&gt;EmployeeMapper.xml</span><br><span class="line">3âƒ£ï¸åœ¨pojo-Employeeå®šä¹‰ï¼Œä»¥ä¾¿ç”¨äºxml</span><br><span class="line">	@ApiModelProperty(value &#x3D; &quot;å·¥èµ„å¸å¥—&quot;)</span><br><span class="line">  @TableField(exist &#x3D; false)</span><br><span class="line">  private Salary salary;</span><br></pre></td></tr></table></figure>
<p>SalarySobCfgControllerè¯¦æƒ…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">import com.baomidou.mybatisplus.core.conditions.update.UpdateWrapper;</span><br><span class="line">import com.zoux.server.pojo.Employee;</span><br><span class="line">import com.zoux.server.pojo.RespBean;</span><br><span class="line">import com.zoux.server.pojo.RespPageBean;</span><br><span class="line">import com.zoux.server.pojo.Salary;</span><br><span class="line">import com.zoux.server.service.IEmployeeService;</span><br><span class="line">import com.zoux.server.service.ISalaryService;</span><br><span class="line">import io.swagger.annotations.ApiOperation;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@RequestMapping(&quot;&#x2F;salary&#x2F;sobcfg&quot;)</span><br><span class="line">@RestController</span><br><span class="line">public class SalarySobCfgController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private ISalaryService salaryService;</span><br><span class="line">    @Autowired</span><br><span class="line">    private IEmployeeService employeeService;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;è·å–æ‰€æœ‰å‘˜å·¥å¥—è´¦&quot;)</span><br><span class="line">    @GetMapping(&quot;&#x2F;&quot;)</span><br><span class="line">    public RespPageBean getEmployeeWithSalary(@RequestParam(defaultValue &#x3D; &quot;1&quot;) Integer currentPage,@RequestParam(defaultValue &#x3D; &quot;10&quot;) Integer size)&#123;</span><br><span class="line">        return employeeService.getEmployeeWithSalary(currentPage,size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;è·å–æ‰€æœ‰å·¥èµ„å¥—è´¦&quot;)</span><br><span class="line">    @GetMapping(&quot;&#x2F;salaries&quot;)</span><br><span class="line">    public List&lt;Salary&gt; getAllSalary()&#123;</span><br><span class="line">        return salaryService.list();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;æ›´æ–°å‘˜å·¥å¥—è´¦&quot;)</span><br><span class="line">    @PutMapping(&quot;&#x2F;&quot;)</span><br><span class="line">    public RespBean updateEmployeeSalary(Integer eid,Integer sid)&#123;</span><br><span class="line">        if (employeeService.update(new UpdateWrapper&lt;Employee&gt;().set(&quot;salaryId&quot;,sid).eq(&quot;id&quot;,eid)))&#123;</span><br><span class="line">            return RespBean.success(&quot;æ›´æ–°æˆåŠŸ&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;æ›´æ–°å¤±è´¥&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>EmployeeServiceImplè¯¦æƒ…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * è·å–æ‰€æœ‰å‘˜å·¥å¥—è´¦</span><br><span class="line">     *</span><br><span class="line">     * @param currentPage</span><br><span class="line">     * @param size</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public RespPageBean getEmployeeWithSalary(Integer currentPage, Integer size) &#123;</span><br><span class="line">        &#x2F;&#x2F;å¼€å¯åˆ†é¡µ</span><br><span class="line">        Page&lt;Employee&gt; page &#x3D; new Page&lt;&gt;(currentPage, size);</span><br><span class="line"></span><br><span class="line">        IPage&lt;Employee&gt; employeeIPage &#x3D; employeeMapper.getEmployeeWithSalary(page);</span><br><span class="line">        RespPageBean respPageBean &#x3D; new RespPageBean(employeeIPage.getTotal(), employeeIPage.getRecords());</span><br><span class="line">        return respPageBean;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>EmployeeMapper.xmlè¯¦æƒ…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--    è·å–æ‰€æœ‰å‘˜å·¥å¥—è´¦--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;getEmployeeWithSalary&quot; resultMap&#x3D;&quot;EmployeeWithSalary&quot;&gt;</span><br><span class="line">        SELECT e.*,</span><br><span class="line">               td.&#96;name&#96;              as dname,</span><br><span class="line">               s.id                   AS sid,</span><br><span class="line">               s.&#96;name&#96;               AS sname,</span><br><span class="line">               s.basicSalary          AS sbasicSalary,</span><br><span class="line">               s.trafficSalary        AS strafficSalary,</span><br><span class="line">               s.lunchSalary          AS slunchSalary,</span><br><span class="line">               s.bonus                AS sbonus,</span><br><span class="line">               s.allSalary            AS sallSalary,</span><br><span class="line">               s.pensionPer           AS spensionPer,</span><br><span class="line">               s.pensionBase          AS spensionBase,</span><br><span class="line">               s.medicalPer           AS smedicalPer,</span><br><span class="line">               s.medicalBase          AS smedicalBase,</span><br><span class="line">               s.accumulationFundPer  AS saccumulationFundPer,</span><br><span class="line">               s.accumulationFundBase AS saccumulationFundBase</span><br><span class="line">        FROM t_employee as e</span><br><span class="line">                 LEFT JOIN t_salary as s ON e.salaryId &#x3D; s.id</span><br><span class="line">                 LEFT JOIN t_department as td ON e.departmentId &#x3D; td.id</span><br><span class="line">        ORDER BY e.id</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;resultMap id&#x3D;&quot;EmployeeWithSalary&quot; type&#x3D;&quot;com.zoux.server.pojo.Employee&quot; extends&#x3D;&quot;BaseResultMap&quot;&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;salary&quot; javaType&#x3D;&quot;com.zoux.server.pojo.Salary&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;sid&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;sbasicSalary&quot; property&#x3D;&quot;basicSalary&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;sbonus&quot; property&#x3D;&quot;bonus&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;slunchSalary&quot; property&#x3D;&quot;lunchSalary&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;strafficSalary&quot; property&#x3D;&quot;trafficSalary&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;sallSalary&quot; property&#x3D;&quot;allSalary&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;spensionBase&quot; property&#x3D;&quot;pensionBase&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;spensionPer&quot; property&#x3D;&quot;pensionPer&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;smedicalBase&quot; property&#x3D;&quot;medicalBase&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;smedicalPer&quot; property&#x3D;&quot;medicalPer&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;saccumulationFundBase&quot;</span><br><span class="line">                    property&#x3D;&quot;accumulationFundBase&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;saccumulationFundPer&quot;</span><br><span class="line">                    property&#x3D;&quot;accumulationFundPer&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;sname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;association&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;department&quot;</span><br><span class="line">                     javaType&#x3D;&quot;com.zoux.server.pojo.Department&quot;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;dname&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;association&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br></pre></td></tr></table></figure>


<hr>
<h1 id="WebSocketåœ¨çº¿èŠå¤©åŠŸèƒ½å®ç°"><a href="#WebSocketåœ¨çº¿èŠå¤©åŠŸèƒ½å®ç°" class="headerlink" title="WebSocketåœ¨çº¿èŠå¤©åŠŸèƒ½å®ç°"></a>WebSocketåœ¨çº¿èŠå¤©åŠŸèƒ½å®ç°</h1><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">æœ€å¤§ç‰¹ç‚¹ï¼ŒæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·æ¨é€ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸»åŠ¨å‘æœåŠ¡å™¨å‘ä¿¡æ¯ï¼ŒçœŸæ­£çš„åŒå‘å¹³ç­‰å¯¹è¯</span><br><span class="line">1âƒ£ï¸å¼•å…¥ä¾èµ–yeb-server</span><br><span class="line">	&lt;!--websocket ä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-websocket&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">2âƒ£ï¸æ–°å»ºç±»WebSocketConfigï¼Œå®ç°WebSocketMessageBrokerConfigurer</span><br><span class="line">	æ³¨è§£</span><br><span class="line">		@Configuration</span><br><span class="line">		@EnableWebSocketMessageBroker</span><br><span class="line">	é‡å†™ä¸‰ä¸ªæ–¹æ³•</span><br><span class="line">  	registerStompEndpoints</span><br><span class="line">  	configureClientInboundChannel</span><br><span class="line">  		jwtä»¤ç‰Œç›¸å…³</span><br><span class="line">  	configureMessageBroker</span><br><span class="line">3âƒ£ï¸æ–°å»ºpojoç±»-ChatMsg</span><br><span class="line">4âƒ£ï¸æ–°å»ºWebSocketController</span><br><span class="line">5âƒ£ï¸åœ¨SecurityConfigè¿›è¡Œæ”¾è¡Œ</span><br><span class="line">	&quot;&#x2F;ws&#x2F;**&quot;</span><br><span class="line">6âƒ£ï¸æ–°å»ºç±»ChatController	</span><br></pre></td></tr></table></figure>
<p>WebSocketConfigè¯¦æƒ…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">import com.zoux.server.config.security.component.JwtTokenUtil;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.messaging.Message;</span><br><span class="line">import org.springframework.messaging.MessageChannel;</span><br><span class="line">import org.springframework.messaging.simp.config.ChannelRegistration;</span><br><span class="line">import org.springframework.messaging.simp.config.MessageBrokerRegistry;</span><br><span class="line">import org.springframework.messaging.simp.stomp.StompCommand;</span><br><span class="line">import org.springframework.messaging.simp.stomp.StompHeaderAccessor;</span><br><span class="line">import org.springframework.messaging.support.ChannelInterceptor;</span><br><span class="line">import org.springframework.messaging.support.MessageHeaderAccessor;</span><br><span class="line">import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line">import org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line">import org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line">import org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line">import org.springframework.util.StringUtils;</span><br><span class="line">import org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;</span><br><span class="line">import org.springframework.web.socket.config.annotation.StompEndpointRegistry;</span><br><span class="line">import org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * WebSocketé…ç½®ç±»</span><br><span class="line"> *</span><br><span class="line"> * @author zhanglishen</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@EnableWebSocketMessageBroker</span><br><span class="line">public class WebSocketConfig implements WebSocketMessageBrokerConfigurer &#123;</span><br><span class="line">    @Value(&quot;$&#123;jwt.tokenHead&#125;&quot;)</span><br><span class="line">    private String tokenHead;</span><br><span class="line">    @Autowired</span><br><span class="line">    private JwtTokenUtil jwtTokenUtil;</span><br><span class="line">    @Autowired</span><br><span class="line">    private UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * æ·»åŠ è¿™ä¸ªEndpointï¼Œè¿™æ ·åœ¨ç½‘é¡µå¯ä»¥é€šè¿‡websocketè¿æ¥ä¸ŠæœåŠ¡</span><br><span class="line">     * ä¹Ÿå°±æ˜¯æˆ‘ä»¬é…ç½®websocketçš„æœåŠ¡åœ°å€ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šæ˜¯å¦ä½¿ç”¨socketJS</span><br><span class="line">     * @param registry</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public void registerStompEndpoints(StompEndpointRegistry registry) &#123;</span><br><span class="line">        &#x2F;**</span><br><span class="line">         * 1.å°†ws&#x2F;epè·¯å¾„æ³¨å†Œä¸ºstompçš„ç«¯ç‚¹ï¼Œç”¨æˆ·è¿æ¥äº†è¿™ä¸ªç«¯ç‚¹å°±å¯ä»¥è¿›è¡Œwebsocketé€šè®¯ï¼Œæ”¯æŒ</span><br><span class="line">         socketJS</span><br><span class="line">         * 2.setAllowedOrigins(&quot;*&quot;)ï¼šå…è®¸è·¨åŸŸ</span><br><span class="line">         * 3.withSockJS():æ”¯æŒsocketJSè®¿é—®</span><br><span class="line">         *&#x2F;</span><br><span class="line">        registry.addEndpoint(&quot;&#x2F;ws&#x2F;ep&quot;).setAllowedOrigins(&quot;*&quot;).withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * è¾“å…¥é€šé“å‚æ•°é…ç½®</span><br><span class="line">     * @param registration</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public void configureClientInboundChannel(ChannelRegistration registration) &#123;</span><br><span class="line">        registration.interceptors(new ChannelInterceptor() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public Message&lt;?&gt; preSend(Message&lt;?&gt; message, MessageChannel channel) &#123;</span><br><span class="line">                StompHeaderAccessor accessor &#x3D; MessageHeaderAccessor.getAccessor(message, StompHeaderAccessor.class);</span><br><span class="line">                &#x2F;&#x2F;åˆ¤æ–­æ˜¯å¦ä¸ºè¿æ¥ï¼Œå¦‚æœæ˜¯ï¼Œéœ€è¦è·å–tokenï¼Œå¹¶ä¸”è®¾ç½®ç”¨æˆ·å¯¹è±¡</span><br><span class="line">                if (StompCommand.CONNECT.equals(accessor.getCommand()))&#123;</span><br><span class="line">                    &#x2F;&#x2F;å®¢æˆ·ç«¯å‘æ¥çš„</span><br><span class="line">                    String token &#x3D; accessor.getFirstNativeHeader(&quot;Auth-Token&quot;);</span><br><span class="line">                    if (!StringUtils.isEmpty(token))&#123;</span><br><span class="line">                        &#x2F;&#x2F;æˆªå–tokenï¼Œå»æ‰å‰ç¼€</span><br><span class="line">                        String authToken &#x3D; token.substring(tokenHead.length());</span><br><span class="line">                        &#x2F;&#x2F;è·å–ç”¨æˆ·å</span><br><span class="line">                        String username &#x3D; jwtTokenUtil.getUserNameFromToken(authToken);</span><br><span class="line">                        &#x2F;&#x2F;tokenä¸­å­˜åœ¨ç”¨æˆ·å</span><br><span class="line">                        if (!StringUtils.isEmpty(username))&#123;</span><br><span class="line">                            &#x2F;&#x2F;ç™»å½•</span><br><span class="line">                            UserDetails userDetails &#x3D; userDetailsService.loadUserByUsername(username);</span><br><span class="line">                            &#x2F;&#x2F;éªŒè¯tokenæ˜¯å¦æœ‰æ•ˆï¼Œé‡æ–°è®¾ç½®ç”¨æˆ·å¯¹è±¡</span><br><span class="line">                            if (jwtTokenUtil.validateToken(authToken,userDetails))&#123;</span><br><span class="line">                                UsernamePasswordAuthenticationToken authenticationToken &#x3D; new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());</span><br><span class="line">                                SecurityContextHolder.getContext().setAuthentication(authenticationToken);</span><br><span class="line">                                accessor.setUser(authenticationToken);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                return message;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * é…ç½®æ¶ˆæ¯ä»£ç†</span><br><span class="line">     * @param registry</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public void configureMessageBroker(MessageBrokerRegistry registry) &#123;</span><br><span class="line">        &#x2F;&#x2F;é…ç½®ä»£ç†åŸŸï¼Œå¯ä»¥é…ç½®å¤šä¸ªï¼Œé…ç½®ä»£ç†ç›®çš„åœ°å‰ç¼€ä¸º&#x2F;queue,å¯ä»¥åœ¨é…ç½®åŸŸä¸Šå‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯</span><br><span class="line">        registry.enableSimpleBroker(&quot;&#x2F;queue&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ChatMsè¯¦æƒ…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">package com.zoux.server.pojo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.EqualsAndHashCode;</span><br><span class="line">import lombok.experimental.Accessors;</span><br><span class="line">import org.springframework.security.core.parameters.P;</span><br><span class="line"></span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * æ¶ˆæ¯</span><br><span class="line"> *</span><br><span class="line"> * @author zoux</span><br><span class="line"> * @since 1.0.0</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">@Accessors(chain &#x3D; true)</span><br><span class="line">@EqualsAndHashCode(callSuper &#x3D; false)</span><br><span class="line">public class ChatMsg &#123;</span><br><span class="line">    private String from;</span><br><span class="line">    private String to;</span><br><span class="line">    private String content;</span><br><span class="line">    private LocalDateTime date;</span><br><span class="line">    private String fromNickName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>WebSocketControllerè¯¦æƒ…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">package com.zoux.server.controller;</span><br><span class="line">import com.zoux.server.pojo.Admin;</span><br><span class="line">import com.zoux.server.pojo.ChatMsg;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.messaging.handler.annotation.MessageMapping;</span><br><span class="line">import org.springframework.messaging.simp.SimpMessagingTemplate;</span><br><span class="line">import org.springframework.security.core.Authentication;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> *</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Controller</span><br><span class="line">public class WebSocketController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private SimpMessagingTemplate simpMessagingTemplate;</span><br><span class="line"></span><br><span class="line">    @MessageMapping(&quot;&#x2F;ws&#x2F;chat&quot;)</span><br><span class="line">    public void handleMsg(Authentication authentication, ChatMsg chatMsg)&#123;</span><br><span class="line">        Admin admin &#x3D; (Admin) authentication.getPrincipal();</span><br><span class="line">        chatMsg.setFrom(admin.getUsername());</span><br><span class="line">        chatMsg.setFromNickName(admin.getName());</span><br><span class="line">        chatMsg.setDate(LocalDateTime.now());</span><br><span class="line">        &#x2F;**</span><br><span class="line">         * å‘é€æ¶ˆæ¯</span><br><span class="line">         * 1.æ¶ˆæ¯æ¥æ”¶è€…</span><br><span class="line">         * 2.æ¶ˆæ¯é˜Ÿåˆ—</span><br><span class="line">         * 3.æ¶ˆæ¯å¯¹è±¡</span><br><span class="line">         *&#x2F;</span><br><span class="line">        simpMessagingTemplate.convertAndSendToUser(chatMsg.getTo(),&quot;&#x2F;queue&#x2F;chat&quot;,chatMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ChatControllerè¯¦æƒ…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">package com.zoux.server.controller;</span><br><span class="line"></span><br><span class="line">import com.zoux.server.pojo.Admin;</span><br><span class="line">import com.zoux.server.service.IAdminService;</span><br><span class="line">import io.swagger.annotations.ApiOperation;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * åœ¨çº¿èŠå¤©</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;&#x2F;chat&quot;)</span><br><span class="line">public class ChatController &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private IAdminService adminService;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;è·å–æ‰€æœ‰æ“ä½œå‘˜&quot;)</span><br><span class="line">    @GetMapping(&quot;&#x2F;admin&quot;)</span><br><span class="line">    public List&lt;Admin&gt; getAllAdmin(String keywords) &#123;</span><br><span class="line">        return adminService.getAllAdmins(keywords);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SecurityConfigè¯¦æƒ…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">package com.zoux.server.config.security;</span><br><span class="line"></span><br><span class="line">import com.zoux.server.config.security.component.*;</span><br><span class="line">import com.zoux.server.pojo.Admin;</span><br><span class="line">import com.zoux.server.service.IAdminService;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.security.config.annotation.ObjectPostProcessor;</span><br><span class="line">import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;</span><br><span class="line">import org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line">import org.springframework.security.config.annotation.web.builders.WebSecurity;</span><br><span class="line">import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line">import org.springframework.security.config.http.SessionCreationPolicy;</span><br><span class="line">import org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line">import org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line">import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line">import org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line">import org.springframework.security.web.access.intercept.FilterSecurityInterceptor;</span><br><span class="line">import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class SecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private IAdminService adminService;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private RestAuthorizationEntryPoint restAuthorizationEntryPoint;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RestfulAccessDeniedHandler restfulAccessDeniedHandler;</span><br><span class="line">    @Autowired</span><br><span class="line">    private CustomUrlDecisionManager customUrlDecisionManager;</span><br><span class="line">    @Autowired</span><br><span class="line">    private CustomFilter customFilter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;</span><br><span class="line">        auth.userDetailsService(userDetailsService()).passwordEncoder(passwordEncoder());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    @Bean</span><br><span class="line">    public UserDetailsService userDetailsService() &#123;</span><br><span class="line">        return username -&gt; &#123;</span><br><span class="line">            Admin admin &#x3D; adminService.getAdminByUserName(username);</span><br><span class="line">            if (null !&#x3D; admin) &#123;</span><br><span class="line">                admin.setRoles(adminService.getRoles(admin.getId()));</span><br><span class="line">                return admin;</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F;æŠ›å‡ºå¼‚å¸¸</span><br><span class="line">            throw new UsernameNotFoundException(&quot;ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®&quot;);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public PasswordEncoder passwordEncoder() &#123;</span><br><span class="line">        return new BCryptPasswordEncoder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;åˆ©ç”¨Beanæ³¨è§£å°†JwtAuthorizationTokenFilteræš´éœ²å‡ºæ¥</span><br><span class="line">    @Bean</span><br><span class="line">    public JwtAuthorizationTokenFilter jwtAuthorizationTokenFilter() &#123;</span><br><span class="line">        return new JwtAuthorizationTokenFilter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void configure(WebSecurity web) throws Exception &#123;</span><br><span class="line">        web.ignoring().antMatchers(</span><br><span class="line">                &quot;&#x2F;login&quot;,</span><br><span class="line">                &quot;&#x2F;logout&quot;,</span><br><span class="line">                &quot;&#x2F;css&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;js&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;index.html&quot;,</span><br><span class="line">                &quot;favicon.ico&quot;,</span><br><span class="line">                &quot;&#x2F;doc.html&quot;,</span><br><span class="line">                &quot;&#x2F;webjars&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;swagger-resources&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;v2&#x2F;api-docs&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;captcha&quot;,</span><br><span class="line">                &quot;&#x2F;ws&#x2F;**&quot;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">        &#x2F;&#x2F;ä½¿ç”¨JWTä¸éœ€è¦csrf</span><br><span class="line">        http.csrf()</span><br><span class="line">                .disable()</span><br><span class="line">                &#x2F;&#x2F;åŸºäºtokenä¸éœ€è¦session</span><br><span class="line">                .sessionManagement()</span><br><span class="line">                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">                .and()</span><br><span class="line">                &#x2F;&#x2F;å…è®¸ç™»é™†è®¿é—®</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">&#x2F;&#x2F;                .antMatchers(&quot;&#x2F;login&quot;, &quot;&#x2F;logout&quot;)</span><br><span class="line">&#x2F;&#x2F;                .permitAll()</span><br><span class="line">                &#x2F;&#x2F;è®¿é—®è¯·æ±‚è¦æ±‚è®¤è¯</span><br><span class="line">                .anyRequest()</span><br><span class="line">                .authenticated()</span><br><span class="line">                &#x2F;&#x2F;åŠ¨æ€æƒé™é…ç½®</span><br><span class="line">                .withObjectPostProcessor(new ObjectPostProcessor&lt;FilterSecurityInterceptor&gt;() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    public &lt;O extends FilterSecurityInterceptor&gt; O postProcess(O o) &#123;</span><br><span class="line">                        o.setAccessDecisionManager(customUrlDecisionManager);</span><br><span class="line">                        o.setSecurityMetadataSource(customFilter);</span><br><span class="line">                        return o;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .and()</span><br><span class="line">                &#x2F;&#x2F;ç¼“å­˜å…³é—­</span><br><span class="line">                .headers()</span><br><span class="line">                .cacheControl();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;æ·»åŠ jwtç™»é™†æˆæƒæ‹¦æˆªå™¨</span><br><span class="line">        http.addFilterBefore(jwtAuthorizationTokenFilter(), UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">        &#x2F;&#x2F;è‡ªå®šä¹‰æœªæˆæƒï¼Œæˆ–è€…æœªç™»å½•çš„ç»“æœè¿”å›</span><br><span class="line">        http.exceptionHandling()</span><br><span class="line">                .accessDeniedHandler(restfulAccessDeniedHandler)</span><br><span class="line">                .authenticationEntryPoint(restAuthorizationEntryPoint);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<hr>
<h1 id="ä¸ªäººä¸­å¿ƒåŠŸèƒ½å®ç°"><a href="#ä¸ªäººä¸­å¿ƒåŠŸèƒ½å®ç°" class="headerlink" title="ä¸ªäººä¸­å¿ƒåŠŸèƒ½å®ç°"></a>ä¸ªäººä¸­å¿ƒåŠŸèƒ½å®ç°</h1><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1âƒ£ï¸æ–°å»ºAdminInfoControllerç±»</span><br><span class="line">	æ³¨è§£</span><br><span class="line">		@RestController</span><br><span class="line">	æ³¨å…¥</span><br><span class="line">		adminService</span><br><span class="line">	å®ç°</span><br><span class="line">  	æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯ updateAdmin @PutMapping(&quot;&#x2F;admin&#x2F;info&quot;)</span><br><span class="line">  	æ›´æ–°ç”¨æˆ·å¯†ç  updateAdminPassword @PutMapping(&quot;&#x2F;admin&#x2F;pass&quot;)</span><br><span class="line">2âƒ£ï¸åœ¨AdminServiceImplå®ç°updatePassword</span><br><span class="line">	æŸ¥è¯¢ç”¨æˆ·</span><br><span class="line">	æ¯”è¾ƒæ–°æ—§å¯†ç </span><br><span class="line">	æ›´æ–°æ•°æ®</span><br><span class="line">3âƒ£ï¸è‡ªå®šä¹‰Authorityè§£æå™¨</span><br><span class="line">	æ–°å»ºCustomAuthorityDeserializerç±»ï¼Œç»§æ‰¿JsonDeserializer</span><br><span class="line">	é‡å†™deserialize</span><br><span class="line">4âƒ£ï¸åœ¨pojo-Adminå¯ç”¨	Authorityè§£æå™¨</span><br><span class="line">	@JsonDeserialize(using &#x3D; CustomAuthorityDeserializer.class)</span><br><span class="line">5âƒ£ï¸å¼•å…¥FastDFSä¾èµ– yeb-server pom</span><br><span class="line">	 &lt;!--FastDFSä¾èµ–--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.csource&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;fastdfs-client-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.29-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">å¦‚æœçˆ†çº¢</span><br><span class="line">	åœ¨é¡¹ç›®ä¸‹é¢</span><br><span class="line">		git clone https:&#x2F;&#x2F;github.com&#x2F;happyfish100&#x2F;fastdfs-client-java.git</span><br><span class="line">		cd &#x2F;fastdfs-client-java</span><br><span class="line">		mvn clean install</span><br><span class="line">6âƒ£ï¸æ–°å»ºæ–‡ä»¶&#x2F;resources&#x2F;fdfs_client.conf</span><br><span class="line">7âƒ£ï¸æ–°å»ºå·¥å…·ç±»FastDFSUtils	</span><br><span class="line">8âƒ£ï¸AdminInfoControlleræ–°å»ºæ–¹æ³• æ›´æ–°ç”¨æˆ·å¤´åƒ updateUserFace</span><br><span class="line">	æ³¨è§£</span><br><span class="line">		@ApiOperation(value &#x3D; &quot;æ›´æ–°ç”¨æˆ·å¤´åƒ&quot;)</span><br><span class="line">    @ApiImplicitParams(&#123;@ApiImplicitParam(name &#x3D; &quot;file&quot;, value &#x3D; &quot;å¤´åƒ&quot;, dataType &#x3D; &quot;MultipartFile&quot;)&#125;)</span><br><span class="line">    @PutMapping(&quot;&#x2F;admin&#x2F;userface&quot;)</span><br><span class="line">9âƒ£ï¸åœ¨AdminServiceImplå®ç°updateAdminUserFace</span><br></pre></td></tr></table></figure>
<p>AdminServiceImplå®ç°updatePassword</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * æ›´æ–°ç”¨æˆ·å¯†ç </span><br><span class="line">     *</span><br><span class="line">     * @param oldPass</span><br><span class="line">     * @param pass</span><br><span class="line">     * @param adminId</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public RespBean updatePassword(String oldPass, String pass, Integer adminId) &#123;</span><br><span class="line">        Admin admin &#x3D; adminMapper.selectById(adminId);</span><br><span class="line">        BCryptPasswordEncoder encoder &#x3D; new BCryptPasswordEncoder();</span><br><span class="line">        &#x2F;&#x2F;åˆ¤æ–­æ—§å¯†ç æ˜¯å¦æ­£ç¡®</span><br><span class="line">        if (encoder.matches(oldPass, admin.getPassword())) &#123;</span><br><span class="line">            admin.setPassword(encoder.encode(pass));</span><br><span class="line">            int result &#x3D; adminMapper.updateById(admin);</span><br><span class="line">            if (1 &#x3D;&#x3D; result) &#123;</span><br><span class="line">                return RespBean.success(&quot;æ›´æ–°æˆåŠŸ&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;æ›´æ–°å¤±è´¥&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>AdminInfoController</p>
<p>å®ç°<br>      æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯ updateAdmin @PutMapping(â€œ/admin/infoâ€)<br>      æ›´æ–°ç”¨æˆ·å¯†ç  updateAdminPassword @PutMapping(â€œ/admin/passâ€)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">    private IAdminService adminService;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯&quot;)</span><br><span class="line">    @PutMapping(&quot;&#x2F;admin&#x2F;info&quot;)</span><br><span class="line">    public RespBean updateAdmin(@RequestBody Admin admin, Authentication authentication) &#123;</span><br><span class="line">        &#x2F;&#x2F;æ›´æ–°æˆåŠŸ,é‡æ–°æ„å»ºAuthenticationå¯¹è±¡</span><br><span class="line">        if (adminService.updateById(admin)) &#123;</span><br><span class="line">            &#x2F;**</span><br><span class="line">             * 1.ç”¨æˆ·å¯¹è±¡</span><br><span class="line">             * 2.å‡­è¯ï¼ˆå¯†ç ï¼‰</span><br><span class="line">             * 3.ç”¨æˆ·è§’è‰²</span><br><span class="line">             *&#x2F;</span><br><span class="line">            SecurityContextHolder.getContext().setAuthentication(</span><br><span class="line">                    new UsernamePasswordAuthenticationToken(</span><br><span class="line">                            admin,</span><br><span class="line">                            authentication.getCredentials(),</span><br><span class="line">                            authentication.getAuthorities())</span><br><span class="line">            );</span><br><span class="line">            return RespBean.success(&quot;æ›´æ–°æˆåŠŸ&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return RespBean.error(&quot;æ›´æ–°å¤±è´¥&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value &#x3D; &quot;æ›´æ–°ç”¨æˆ·å¯†ç &quot;)</span><br><span class="line">    @PutMapping(&quot;&#x2F;admin&#x2F;pass&quot;)</span><br><span class="line">    public RespBean updateAdminPassword(@RequestBody Map&lt;String, Object&gt; info) &#123;</span><br><span class="line">        String oldPass &#x3D; (String) info.get(&quot;oldPass&quot;);</span><br><span class="line">        String pass &#x3D; (String) info.get(&quot;pass&quot;);</span><br><span class="line">        Integer adminId &#x3D; (Integer) info.get(&quot;adminId&quot;);</span><br><span class="line">        return adminService.updatePassword(oldPass, pass, adminId);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æ–°å»ºæ–‡ä»¶/resources/fdfs_client.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#è¿æ¥è¶…æ—¶</span><br><span class="line">connect_timeout &#x3D; 2</span><br><span class="line">#ç½‘ç»œè¶…æ—¶</span><br><span class="line">network_timeout &#x3D; 30</span><br><span class="line">#ç¼–ç æ ¼å¼</span><br><span class="line">charset &#x3D; UTF-8</span><br><span class="line">#trackerç«¯å£å·</span><br><span class="line">#http.tracker_http_port &#x3D; 8080</span><br><span class="line">#é˜²ç›—é“¾åŠŸèƒ½</span><br><span class="line">http.anti_steal_token &#x3D; no</span><br><span class="line">#ç§˜é’¥</span><br><span class="line">http.secret_key &#x3D; FastDFS1234567890</span><br><span class="line">#tracker ipï¼šç«¯å£å·</span><br><span class="line">tracker_server &#x3D; 39.102.65.157:22122</span><br><span class="line">#è¿æ¥æ± é…ç½®</span><br><span class="line">connection_pool.enabled &#x3D; true</span><br><span class="line">connection_pool.max_count_per_entry &#x3D; 500</span><br><span class="line">connection_pool.max_idle_time &#x3D; 3600</span><br><span class="line">connection_pool.max_wait_time_in_ms &#x3D; 1000</span><br></pre></td></tr></table></figure>
<p>æ–°å»ºå·¥å…·ç±»FastDFSUtils    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line">package com.zoux.server.utils;</span><br><span class="line"></span><br><span class="line">import org.csource.fastdfs.*;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.core.io.ClassPathResource;</span><br><span class="line">import org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line">import java.io.ByteArrayInputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * FDFSå·¥å…·ç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class FastDFSUtils &#123;</span><br><span class="line">    private static Logger logger &#x3D; LoggerFactory.getLogger(FastDFSUtils.class);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * åˆå§‹åŒ–å®¢æˆ·ç«¯</span><br><span class="line">     * ClientClobal.ini è¯»å–é…ç½®æ–‡ä»¶ï¼Œå¹¶åˆå§‹åŒ–å¯¹åº”çš„é…ç½®</span><br><span class="line">     *&#x2F;</span><br><span class="line">    static &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            String filePath &#x3D; new ClassPathResource(&quot;fdfs_client.conf&quot;).getFile().getAbsolutePath();</span><br><span class="line">            ClientGlobal.init(filePath);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            logger.error(&quot;åˆå§‹åŒ–Fdfså¤±è´¥&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">     *</span><br><span class="line">     * @param file</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static String[] upload(MultipartFile file) &#123;</span><br><span class="line">        String filename &#x3D; file.getOriginalFilename();</span><br><span class="line">        logger.info(&quot;File Name :&quot; + filename);</span><br><span class="line">        long startTime &#x3D; System.currentTimeMillis();</span><br><span class="line">        String[] uploadResults &#x3D; null;</span><br><span class="line">        StorageClient storageClient &#x3D; null;</span><br><span class="line">        &#x2F;&#x2F;è·å–storageå®¢æˆ·ç«¯</span><br><span class="line">        try &#123;</span><br><span class="line">            storageClient &#x3D; getStorageClient();</span><br><span class="line">            &#x2F;&#x2F;ä¸Šä¼ </span><br><span class="line">            try &#123;</span><br><span class="line">                uploadResults &#x3D; storageClient.upload_file(file.getBytes(),</span><br><span class="line">                        filename.substring(filename.lastIndexOf(&quot;.&quot;) + 1), null);</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                logger.error(&quot;IO Exception when uploadind the file:&quot; + filename, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            logger.error(&quot;Non IO Exception when uploadind the file:&quot; + filename, e);</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(&quot;upload_file time used:&quot; + (System.currentTimeMillis() - startTime) + &quot; ms&quot;);</span><br><span class="line">        &#x2F;&#x2F;éªŒè¯ä¸Šä¼ ç»“æœ</span><br><span class="line">        if (uploadResults &#x3D;&#x3D; null &amp;&amp; storageClient !&#x3D; null) &#123;</span><br><span class="line">            logger.error(&quot;upload file fail, error code:&quot; + storageClient.getErrorCode());</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;ä¸Šä¼ æˆåŠŸè¿”å›groupName</span><br><span class="line">        logger.info(&quot;upload file successfully!!!&quot; + &quot;group_name:&quot; + uploadResults[0] + &quot;, remoteFileName:&quot; + &quot; &quot; + uploadResults[1]);</span><br><span class="line">        return uploadResults;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * è·å–æ–‡ä»¶ä¿¡æ¯</span><br><span class="line">     *</span><br><span class="line">     * @param groupName</span><br><span class="line">     * @param remoteFileName</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static FileInfo getFileInfo(String groupName, String remoteFileName) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            StorageClient storageClient &#x3D; getStorageClient();</span><br><span class="line">            return storageClient.get_file_info(groupName, remoteFileName);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            logger.error(&quot;IO Exception: Get File from Fast DFS failed&quot;, e);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            logger.error(&quot;Non IO Exception: Get File from Fast DFS failed&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * ä¸‹è½½</span><br><span class="line">     *</span><br><span class="line">     * @param groupName</span><br><span class="line">     * @param remoteFileName</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static InputStream downFile(String groupName, String remoteFileName) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            StorageClient storageClient &#x3D; getStorageClient();</span><br><span class="line">            byte[] bytes &#x3D; storageClient.download_file(groupName, remoteFileName);</span><br><span class="line">            InputStream inputStream &#x3D; new ByteArrayInputStream(bytes);</span><br><span class="line">            return inputStream;</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            logger.error(&quot;IO Exception: Get File from Fast DFS failed&quot;, e);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            logger.error(&quot;Non IO Exception: Get File from Fast DFS failed&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * åˆ é™¤æ–‡ä»¶</span><br><span class="line">     *</span><br><span class="line">     * @param groupName</span><br><span class="line">     * @param remoteFileName</span><br><span class="line">     * @throws Exception</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static void deleteFile(String groupName, String remoteFileName) throws Exception &#123;</span><br><span class="line">        StorageClient storageClient &#x3D; getStorageClient();</span><br><span class="line">        int i &#x3D; storageClient.delete_file(groupName, remoteFileName);</span><br><span class="line">        logger.info(&quot;delete file successfully!!!&quot; + i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * ç”ŸæˆStorageå®¢æˆ·ç«¯</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static StorageClient getStorageClient() throws IOException &#123;</span><br><span class="line">        TrackerServer trackerServer &#x3D; getTrackerServer();</span><br><span class="line">        StorageClient storageClient &#x3D; new StorageClient(trackerServer, null);</span><br><span class="line">        return storageClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * ç”ŸæˆTrackeræœåŠ¡å™¨ç«¯</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static TrackerServer getTrackerServer() throws IOException &#123;</span><br><span class="line">        TrackerClient trackerClient &#x3D; new TrackerClient();</span><br><span class="line">        TrackerServer trackerServer &#x3D; trackerClient.getTrackerServer();</span><br><span class="line">        return trackerServer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * è·å–æ–‡ä»¶è·¯å¾„</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static String getTrackerUrl() &#123;</span><br><span class="line">        TrackerClient trackerClient &#x3D; new TrackerClient();</span><br><span class="line">        TrackerServer trackerServer &#x3D; null;</span><br><span class="line">        StorageServer storageServer &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            trackerServer &#x3D; trackerClient.getTrackerServer();</span><br><span class="line">            storageServer &#x3D; trackerClient.getStoreStorage(trackerServer);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return &quot;http:&#x2F;&#x2F;&quot; + storageServer.getInetSocketAddress().getHostString() + &quot;:8888&#x2F;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<hr>

  </div>
  <div> 
    <a href="https://github.com/Zoushaozx/zoushaozx.github.io/edit/myblog/source/_posts/äº‘eåŠåç«¯.md" target="_blank">
             <!-- https://github.com/Zoushaozx/zoushaozx.github.io/edit/myblog/source/_posts/hello-world.md -->
      ç¼–è¾‘
    </a>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">é¦–é¡µ</a></li>
         
          <li><a href="/about">å…³äº</a></li>
         
          <li><a href="/archives">å½’æ¡£</a></li>
         
          <li><a href="/projects">é¡¹ç›®</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%91e%E5%8A%9E%EF%BC%8C%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%EF%BC%8C%E5%89%8D%E7%AB%AFvue-%E5%90%8E%E7%AB%AFJava"><span class="toc-number">1.</span> <span class="toc-text">äº‘eåŠï¼Œå‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯vue åç«¯Java</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">2.</span> <span class="toc-text">åç«¯æŠ€æœ¯æ ˆ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">3.</span> <span class="toc-text">å‰ç«¯æŠ€æœ¯æ ˆ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-number">4.</span> <span class="toc-text">æ­å»ºåç«¯é¡¹ç›®</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B"><span class="toc-number">5.</span> <span class="toc-text">é€†å‘å·¥ç¨‹</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Jwt-Token%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">6.</span> <span class="toc-text">Jwt Tokenå·¥å…·ç±»</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.</span> <span class="toc-text">å…¬å…±è¿”å›å¯¹è±¡</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E4%B9%8B%E5%90%8E%E8%BF%94%E5%9B%9Etoken"><span class="toc-number">8.</span> <span class="toc-text">ç™»å½•ä¹‹åè¿”å›token</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">9.</span> <span class="toc-text">è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95"><span class="toc-number">10.</span> <span class="toc-text">é€€å‡ºç™»å½•</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEsecurity%E7%99%BB%E9%99%86%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">11.</span> <span class="toc-text">é…ç½®securityç™»é™†è¿‡æ»¤å™¨</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#security%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C"><span class="toc-number">12.</span> <span class="toc-text">securityè‡ªå®šä¹‰è¿”å›ç»“æœ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swagger2%E6%8F%90%E4%BE%9BAuthorize"><span class="toc-number">13.</span> <span class="toc-text">swagger2æä¾›Authorize</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">14.</span> <span class="toc-text">ç”ŸæˆéªŒè¯ç </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E6%A0%A1%E9%AA%8C"><span class="toc-number">15.</span> <span class="toc-text">éªŒè¯ç æ ¡éªŒ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7id%E6%9F%A5%E8%AF%A2%E8%8F%9C%E5%8D%95%E5%88%97%E8%A1%A8"><span class="toc-number">16.</span> <span class="toc-text">æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢èœå•åˆ—è¡¨</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E9%9B%86%E6%88%90%E8%8F%9C%E5%8D%95%E5%8A%9F%E8%83%BD"><span class="toc-number">17.</span> <span class="toc-text">Redisé›†æˆèœå•åŠŸèƒ½</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E8%AF%B7%E6%B1%82url%E5%88%A4%E6%96%AD%E8%A7%92%E8%89%B2"><span class="toc-number">18.</span> <span class="toc-text">æ ¹æ®è¯·æ±‚urlåˆ¤æ–­è§’è‰²</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2"><span class="toc-number">19.</span> <span class="toc-text">åˆ¤æ–­ç”¨æˆ·è§’è‰²</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%81%8C%E4%BD%8D%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">20.</span> <span class="toc-text">èŒä½ç®¡ç†åŠŸèƒ½å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8"><span class="toc-number">21.</span> <span class="toc-text">å…¨å±€å¼‚å¸¸</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%81%8C%E7%A7%B0%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">22.</span> <span class="toc-text">èŒç§°ç®¡ç†åŠŸèƒ½å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%BB%84%E8%A7%92%E8%89%B2%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">23.</span> <span class="toc-text">æƒé™ç»„è§’è‰²åŠŸèƒ½å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="toc-number">24.</span> <span class="toc-text">å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»ºå’Œä½¿ç”¨</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">25.</span> <span class="toc-text">éƒ¨é—¨ç®¡ç†åŠŸèƒ½å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E5%91%98%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD"><span class="toc-number">26.</span> <span class="toc-text">æ“ä½œå‘˜ç®¡ç†åŠŸèƒ½</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD-%E5%88%86%E9%A1%B5"><span class="toc-number">27.</span> <span class="toc-text">å‘˜å·¥ç®¡ç†åŠŸèƒ½-åˆ†é¡µ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD-%E6%B7%BB%E5%8A%A0-%E5%88%A0%E9%99%A4-%E6%9B%B4%E6%96%B0%E5%91%98%E5%B7%A5"><span class="toc-number">28.</span> <span class="toc-text">å‘˜å·¥ç®¡ç†åŠŸèƒ½-æ·»åŠ &#x2F;åˆ é™¤&#x2F;æ›´æ–°å‘˜å·¥</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA"><span class="toc-number">29.</span> <span class="toc-text">å‘˜å·¥æ•°æ®å¯¼å…¥å¯¼å‡º</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%82%AE%E4%BB%B6%E5%8A%9F%E8%83%BD"><span class="toc-number">30.</span> <span class="toc-text">é‚®ä»¶åŠŸèƒ½</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E7%AB%AF%E5%8F%AF%E9%9D%A0%E6%8A%95%E9%80%92%E6%96%B9%E6%A1%88%E4%BB%8B%E7%BB%8D"><span class="toc-number">31.</span> <span class="toc-text">ç”Ÿäº§ç«¯å¯é æŠ•é€’æ–¹æ¡ˆä»‹ç»</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E6%B6%88%E6%81%AF%E5%9B%9E%E8%B0%83%E6%9C%BA%E5%88%B6"><span class="toc-number">32.</span> <span class="toc-text">å¼€å¯æ¶ˆæ¯å›è°ƒæœºåˆ¶</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E7%AB%AF%E6%B6%88%E6%81%AF%E6%8A%95%E9%80%92%E5%8F%AF%E9%9D%A0%E6%80%A7%E5%AE%9E%E7%8E%B0"><span class="toc-number">33.</span> <span class="toc-text">ç”Ÿäº§ç«¯æ¶ˆæ¯æŠ•é€’å¯é æ€§å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E7%AB%AF%E5%B9%82%E7%AD%89%E6%80%A7"><span class="toc-number">34.</span> <span class="toc-text">æ¶ˆè´¹ç«¯å¹‚ç­‰æ€§</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E8%B5%84%E5%B8%90%E5%A5%97%E7%AE%A1%E7%90%86%E5%AE%9E%E7%8E%B0"><span class="toc-number">35.</span> <span class="toc-text">å·¥èµ„å¸å¥—ç®¡ç†å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E5%B8%90%E5%A5%97%E7%AE%A1%E7%90%86%E5%AE%9E%E7%8E%B0"><span class="toc-number">36.</span> <span class="toc-text">å‘˜å·¥å¸å¥—ç®¡ç†å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WebSocket%E5%9C%A8%E7%BA%BF%E8%81%8A%E5%A4%A9%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">37.</span> <span class="toc-text">WebSocketåœ¨çº¿èŠå¤©åŠŸèƒ½å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">38.</span> <span class="toc-text">ä¸ªäººä¸­å¿ƒåŠŸèƒ½å®ç°</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&text=äº‘eåŠ"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=äº‘eåŠ"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&is_video=false&description=äº‘eåŠ"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=äº‘eåŠ&body=Check out this article: http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=äº‘eåŠ"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=äº‘eåŠ"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=äº‘eåŠ"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&title=äº‘eåŠ"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&name=äº‘eåŠ&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E%E5%90%8E%E7%AB%AF/&t=äº‘eåŠ"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> èœå•</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> ç›®å½•</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> åˆ†äº«</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> è¿”å›é¡¶éƒ¨</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2021
    Zoux
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">é¦–é¡µ</a></li>
         
          <li><a href="/about">å…³äº</a></li>
         
          <li><a href="/archives">å½’æ¡£</a></li>
         
          <li><a href="/projects">é¡¹ç›®</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"å¤åˆ¶åˆ°ç²˜è´´æ¿!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "å¤åˆ¶æˆåŠŸ!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
