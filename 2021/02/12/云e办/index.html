<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="云e办，前后端分离，前端vue 后端Java后端技术栈123456789101112131415springboot springmvc mybatisplus 对项目侵入少 代码编写简单Lombok	注解插件AutoGenerator	Swagger2	接口文档springsecret 安全框架jwt 令牌captcha 图形验证码redis	easypoi 文档导入导出rabbitmq 消息队">
<meta property="og:type" content="article">
<meta property="og:title" content="云e办">
<meta property="og:url" content="http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/index.html">
<meta property="og:site_name" content="Zoux">
<meta property="og:description" content="云e办，前后端分离，前端vue 后端Java后端技术栈123456789101112131415springboot springmvc mybatisplus 对项目侵入少 代码编写简单Lombok	注解插件AutoGenerator	Swagger2	接口文档springsecret 安全框架jwt 令牌captcha 图形验证码redis	easypoi 文档导入导出rabbitmq 消息队">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-02-12T19:11:21.000Z">
<meta property="article:modified_time" content="2021-02-17T00:30:18.920Z">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>云e办</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about">关于</a></li>
         
          <li><a href="/archives">归档</a></li>
         
          <li><a href="/projects">项目</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2021/02/12/hexo/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2021/02/12/linux/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&text=云e办"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&title=云e办"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&is_video=false&description=云e办"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=云e办&body=Check out this article: http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&title=云e办"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&title=云e办"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&title=云e办"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&title=云e办"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&name=云e办&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&t=云e办"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%91e%E5%8A%9E%EF%BC%8C%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%EF%BC%8C%E5%89%8D%E7%AB%AFvue-%E5%90%8E%E7%AB%AFJava"><span class="toc-number">1.</span> <span class="toc-text">云e办，前后端分离，前端vue 后端Java</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">1.1.</span> <span class="toc-text">后端技术栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">1.2.</span> <span class="toc-text">前端技术栈</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        云e办
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name"></span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-02-12T19:11:21.000Z" itemprop="datePublished">2021-02-12</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="云e办，前后端分离，前端vue-后端Java"><a href="#云e办，前后端分离，前端vue-后端Java" class="headerlink" title="云e办，前后端分离，前端vue 后端Java"></a>云e办，前后端分离，前端vue 后端Java</h1><h2 id="后端技术栈"><a href="#后端技术栈" class="headerlink" title="后端技术栈"></a>后端技术栈</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">springboot </span><br><span class="line">springmvc </span><br><span class="line">mybatisplus 对项目侵入少 代码编写简单</span><br><span class="line">Lombok	注解插件</span><br><span class="line">AutoGenerator	</span><br><span class="line">Swagger2	接口文档</span><br><span class="line">springsecret 安全框架</span><br><span class="line">jwt 令牌</span><br><span class="line">captcha 图形验证码</span><br><span class="line">redis	</span><br><span class="line">easypoi 文档导入导出</span><br><span class="line">rabbitmq 消息队列 异步处理</span><br><span class="line">mail 邮件 </span><br><span class="line">websocket 在线聊天</span><br><span class="line">fastDFS 文件服务器 承载静态资源</span><br></pre></td></tr></table></figure>
<h2 id="前端技术栈"><a href="#前端技术栈" class="headerlink" title="前端技术栈"></a>前端技术栈</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vue</span><br><span class="line">element UI</span><br><span class="line">vue_cli 项目搭建</span><br><span class="line">vuex 状态管理</span><br><span class="line">vuerouter 路由管理</span><br><span class="line">axios 通讯框架</span><br><span class="line">es6 前端语法</span><br><span class="line">webpack 打包</span><br><span class="line">websocket 在线聊天</span><br><span class="line">vue_chat 在线聊天</span><br><span class="line">font_awesome 字体</span><br><span class="line">js-file-download 文件下载</span><br></pre></td></tr></table></figure>


<p>搭建后端项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">搭建数据库 yeb.sql</span><br><span class="line">lombok 插件</span><br><span class="line">整个项目采用了maven 聚合的项目</span><br><span class="line"></span><br><span class="line">创建父工程：</span><br><span class="line">	1⃣️spring initialize-&gt;next-&gt;修改Group&#x2F;Artifact-&gt;next-&gt;spring boot devtools-&gt;Project location（项目存放地址）</span><br><span class="line">	2⃣️父工程只是用来做pom依赖管理，就可以只保留pom.xml</span><br><span class="line">	3⃣️修改pom文件</span><br><span class="line">    删除dependencies标签</span><br><span class="line">    删除build标签</span><br><span class="line">    加packaging标签</span><br><span class="line">		    &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">创建子项目：</span><br><span class="line">	1⃣️new-&gt;Module-&gt;Maven-&gt;Create from archetype-&gt;org...:maven-ar..-quickstart等待默认依赖加载完成</span><br><span class="line">	2⃣️删除main和test下面的App和Apptest类</span><br><span class="line">	3⃣️更改包名，com.xxxx.server</span><br><span class="line">	4⃣️修改server的pom依赖</span><br><span class="line">		我们会发现，父工程下面多了，这个是关联server的</span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;module&gt;yeb-server&lt;&#x2F;module&gt;</span><br><span class="line">    &lt;&#x2F;modules&gt;</span><br><span class="line">    </span><br><span class="line">    此时观察server的pom是否有关联父工程的parent标签，没有就加上 </span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;yeb&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.zoux&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    </span><br><span class="line">    name和url标签可以删除</span><br><span class="line">    </span><br><span class="line">    maven.compiler.source&#x2F;maven.compiler.target 版本改为1.8</span><br><span class="line">    </span><br><span class="line">    删除build标签 </span><br><span class="line">    删除dependency标签</span><br><span class="line">    </span><br><span class="line">    添加依赖</span><br><span class="line">    	&lt;!--web 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--lombok 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--mysql 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--mybatis 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.3.1.tmp&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">         </span><br><span class="line">	5⃣️新建resources目录，并设置配置文件</span><br><span class="line">  	在main下面新建resources，并设置为source目录 mark directory as -&gt; resource root</span><br><span class="line">  	并在resources里面新建文件，</span><br><span class="line">  	application.yml</span><br><span class="line">  	内容：</span><br><span class="line">  		server:</span><br><span class="line"> 			 # 端口</span><br><span class="line">			  port: 8081</span><br><span class="line"></span><br><span class="line">  		spring:</span><br><span class="line">        #数据源配置</span><br><span class="line">        datasource:</span><br><span class="line">          driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">          url: jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;yeb?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai</span><br><span class="line">          username: root</span><br><span class="line">          password: rootzoux</span><br><span class="line">          hikari:	</span><br><span class="line">            # 连接池名</span><br><span class="line">            pool-name: DateHikariCP</span><br><span class="line">            # 最小空闲连接数</span><br><span class="line">            minimum-idle: 5</span><br><span class="line">            #最大连接存活最大时间，默认600000 10分钟</span><br><span class="line">            idle-timeout: 180000</span><br><span class="line">            #最大连接数，默认10</span><br><span class="line">            maximum-pool-size: 10</span><br><span class="line">            #从连接池返回的连接自动提交</span><br><span class="line">            auto-commit: true</span><br><span class="line">            #连接存活的最大时间，0表示永久存活，默认1800000 30分钟</span><br><span class="line">            max-lifetime: 1800000</span><br><span class="line">            #连接超时，30000 默认30秒</span><br><span class="line">            connection-timeout: 30000</span><br><span class="line">            #测试连接是否可用的查询语句</span><br><span class="line">            connection-test-query: SELECT 1</span><br><span class="line">				# Mabatis-plug 配置</span><br><span class="line">        mybatis-plus:</span><br><span class="line">          #配置 Mapper映射文件</span><br><span class="line">          mapper-locations: classpath*:&#x2F;mapper&#x2F;*Mapper.xml</span><br><span class="line">          #配置 Mabatis数据返回类型别名 默认别名是类名</span><br><span class="line">          type-aliases-package: com.zoux.server.pojo</span><br><span class="line">          #自动驼峰命名</span><br><span class="line">          configuration:</span><br><span class="line">            map-underscore-to-camel-case: false</span><br><span class="line"></span><br><span class="line">        # mybatis SQL 打印 （接口所在的包，不是mapper.xml 所在的包）</span><br><span class="line">        logging:</span><br><span class="line">          level:</span><br><span class="line">            com.zoux.server.mapper: debug</span><br><span class="line">            </span><br><span class="line">	6⃣️在resources目录下新建mapper</span><br><span class="line">	7⃣️添加包名，pojo，service，mapper，service.impl,controller</span><br><span class="line">	8⃣️启动类YebApplication</span><br><span class="line">			import org.springframework.boot.SpringApplication;</span><br><span class="line">			import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">			@SpringBootApplication</span><br><span class="line">			public class YebAppication &#123;</span><br><span class="line">   			 public static void main(String[] args) &#123;</span><br><span class="line">       			 SpringApplication.run(YebAppication.class, args);</span><br><span class="line">   			 &#125;</span><br><span class="line">			&#125;</span><br><span class="line">	9⃣️添加mapper扫描</span><br><span class="line">	@MapperScan(&quot;com.zoux.server.mapper&quot;)</span><br><span class="line">	🔟在resources下新建comfig目录，将YebAppication.yml</span><br></pre></td></tr></table></figure>
<p>逆向工程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line">根据新建pojo mapper controller 单表查询</span><br><span class="line">mybatisplus，官网</span><br><span class="line">https:&#x2F;&#x2F;mp.baomidou.com&#x2F;guide&#x2F;generator.html</span><br><span class="line">逆向工程本身与项目没有太大关联，就新建module承载</span><br><span class="line">1⃣️新建module，maven，quikerstart</span><br><span class="line">2⃣️删除pom， name、url标签，maven.compiler.source&#x2F;target 版本号为1.8，删除dependencies&#x2F;build标签</span><br><span class="line">3⃣️删除App类，新建包generator</span><br><span class="line">4⃣️删除test文件夹</span><br><span class="line">5⃣️指定父工程</span><br><span class="line">	    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;yeb&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.zoux&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">   		 &lt;&#x2F;parent&gt;</span><br><span class="line"> 6⃣️添加依赖</span><br><span class="line"> 		&lt;!--web 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--mybatis 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.3.1.tmp&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--mybatis-plus 代码生成器依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-plus-generator&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.3.1.tmp&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--    ferrmarker 依赖 模版--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.freemarker&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;freemarker&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--mysql 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">7⃣️新建类MysqlGenerator</span><br><span class="line">package com.zoux.generator;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.core.exceptions.MybatisPlusException;</span><br><span class="line">import com.baomidou.mybatisplus.core.toolkit.StringPool;</span><br><span class="line">import com.baomidou.mybatisplus.core.toolkit.StringUtils;</span><br><span class="line">import com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line">import com.baomidou.mybatisplus.generator.InjectionConfig;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.*;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.po.TableInfo;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line">import com.baomidou.mybatisplus.generator.engine.FreemarkerTemplateEngine;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Scanner;</span><br><span class="line"></span><br><span class="line">public class MysqlGenerator &#123;</span><br><span class="line">    &#x2F;&#x2F; 演示例子，执行 main 方法控制台输入模块表名回车自动生成对应项目目录中</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * &lt;p&gt;</span><br><span class="line">     * 读取控制台内容</span><br><span class="line">     * &lt;&#x2F;p&gt;</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static String scanner(String tip) &#123;</span><br><span class="line">        Scanner scanner &#x3D; new Scanner(System.in);</span><br><span class="line">        StringBuilder help &#x3D; new StringBuilder();</span><br><span class="line">        help.append(&quot;请输入&quot; + tip + &quot;：&quot;);</span><br><span class="line">        System.out.println(help.toString());</span><br><span class="line">        if (scanner.hasNext()) &#123;</span><br><span class="line">            String ipt &#x3D; scanner.next();</span><br><span class="line">            if (StringUtils.isNotBlank(ipt)) &#123;</span><br><span class="line">                return ipt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        throw new MybatisPlusException(&quot;请输入正确的&quot; + tip + &quot;！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        &#x2F;&#x2F; 代码生成器</span><br><span class="line">        AutoGenerator mpg &#x3D; new AutoGenerator();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 全局配置</span><br><span class="line">        GlobalConfig gc &#x3D; new GlobalConfig();</span><br><span class="line">        String projectPath &#x3D; System.getProperty(&quot;user.dir&quot;);</span><br><span class="line">        gc.setOutputDir(projectPath + &quot;&#x2F;yeb-generator&#x2F;src&#x2F;main&#x2F;java&quot;);</span><br><span class="line">        &#x2F;&#x2F;作者</span><br><span class="line">        gc.setAuthor(&quot;zoux&quot;);</span><br><span class="line">        &#x2F;&#x2F;是否打开输出目录</span><br><span class="line">        gc.setOpen(false);</span><br><span class="line">        &#x2F;&#x2F;xml  开启BaseResultMap</span><br><span class="line">        gc.setBaseResultMap(true);</span><br><span class="line">        &#x2F;&#x2F;xml  开启BaseColumnList</span><br><span class="line">        gc.setBaseColumnList(true);</span><br><span class="line">        &#x2F;&#x2F;实体属性 Swagger2 注解</span><br><span class="line">        gc.setSwagger2(true); &#x2F;&#x2F;实体属性 Swagger2 注解</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 数据源配置</span><br><span class="line">        DataSourceConfig dsc &#x3D; new DataSourceConfig();</span><br><span class="line">        dsc.setUrl(&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;yeb?useUnicode&#x3D;true&amp;useSSL&#x3D;false&amp;characterEncoding&#x3D;utf8&amp;serverTimezone&#x3D;Asia&quot; + &quot;&#x2F;Shanghai&quot;);</span><br><span class="line">        &#x2F;&#x2F; dsc.setSchemaName(&quot;public&quot;);</span><br><span class="line">        dsc.setDriverName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span><br><span class="line">        dsc.setUsername(&quot;root&quot;);</span><br><span class="line">        dsc.setPassword(&quot;rootzoux&quot;);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 包配置</span><br><span class="line">        PackageConfig pc &#x3D; new PackageConfig();</span><br><span class="line">&#x2F;&#x2F;        pc.setModuleName(scanner(&quot;模块名&quot;));</span><br><span class="line">        pc.setParent(&quot;com.zoux&quot;)</span><br><span class="line">                .setEntity(&quot;pojo&quot;)</span><br><span class="line">                .setMapper(&quot;mapper&quot;)</span><br><span class="line">                .setService(&quot;service&quot;)</span><br><span class="line">                .setServiceImpl(&quot;service.impl&quot;)</span><br><span class="line">                .setController(&quot;controller&quot;);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 自定义配置</span><br><span class="line">        InjectionConfig cfg &#x3D; new InjectionConfig() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void initMap() &#123;</span><br><span class="line">                &#x2F;&#x2F; to do nothing</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 如果模板引擎是 freemarker</span><br><span class="line">        String templatePath &#x3D; &quot;&#x2F;templates&#x2F;mapper.xml.ftl&quot;;</span><br><span class="line">        &#x2F;&#x2F; 如果模板引擎是 velocity</span><br><span class="line">        &#x2F;&#x2F; String templatePath &#x3D; &quot;&#x2F;templates&#x2F;mapper.xml.vm&quot;;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 自定义输出配置</span><br><span class="line">        List&lt;FileOutConfig&gt; focList &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">        &#x2F;&#x2F; 自定义配置会被优先输出</span><br><span class="line">        focList.add(new FileOutConfig(templatePath) &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public String outputFile(TableInfo tableInfo) &#123;</span><br><span class="line">                &#x2F;&#x2F; 自定义输出文件名 ， 如果你 Entity 设置了前后缀、此处注意 xml 的名称会跟着发生变化！！</span><br><span class="line">&#x2F;&#x2F;                return projectPath + &quot;&#x2F;src&#x2F;main&#x2F;resources&#x2F;mapper&#x2F;&quot; + pc.getModuleName()</span><br><span class="line">&#x2F;&#x2F;                        + &quot;&#x2F;&quot; + tableInfo.getEntityName() + &quot;Mapper&quot; + StringPool.DOT_XML;</span><br><span class="line">                return projectPath + &quot;&#x2F;yeb-generator&#x2F;src&#x2F;main&#x2F;resources&#x2F;mapper&#x2F;&quot; + tableInfo.getEntityName() + &quot;Mapper&quot; + StringPool.DOT_XML;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        &#x2F;*</span><br><span class="line">        cfg.setFileCreate(new IFileCreate() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean isCreate(ConfigBuilder configBuilder, FileType fileType, String filePath) &#123;</span><br><span class="line">                &#x2F;&#x2F; 判断自定义文件夹是否需要创建</span><br><span class="line">                checkDir(&quot;调用默认方法创建的目录，自定义目录用&quot;);</span><br><span class="line">                if (fileType &#x3D;&#x3D; FileType.MAPPER) &#123;</span><br><span class="line">                    &#x2F;&#x2F; 已经生成 mapper 文件判断存在，不想重新生成返回 false</span><br><span class="line">                    return !new File(filePath).exists();</span><br><span class="line">                &#125;</span><br><span class="line">                &#x2F;&#x2F; 允许生成模板文件</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        *&#x2F;</span><br><span class="line">        cfg.setFileOutConfigList(focList);</span><br><span class="line">        mpg.setCfg(cfg);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 配置模板</span><br><span class="line">        TemplateConfig templateConfig &#x3D; new TemplateConfig();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 配置自定义输出模板</span><br><span class="line">        &#x2F;&#x2F;指定自定义模板路径，注意不要带上.ftl&#x2F;.vm, 会根据使用的模板引擎自动识别</span><br><span class="line">        &#x2F;&#x2F; templateConfig.setEntity(&quot;templates&#x2F;entity2.java&quot;);</span><br><span class="line">        &#x2F;&#x2F; templateConfig.setService();</span><br><span class="line">        &#x2F;&#x2F; templateConfig.setController();</span><br><span class="line"></span><br><span class="line">        templateConfig.setXml(null);</span><br><span class="line">        mpg.setTemplate(templateConfig);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 策略配置</span><br><span class="line">        StrategyConfig strategy &#x3D; new StrategyConfig();</span><br><span class="line">        &#x2F;&#x2F;数据库表映射到实体的命名策略</span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        &#x2F;&#x2F;数据库表字段映射到实体的命名策略</span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.no_change);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;strategy.setSuperEntityClass(&quot;你自己的父类实体,没有就不用设置!&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;lombok 模型</span><br><span class="line">        strategy.setEntityLombokModel(true);</span><br><span class="line">        &#x2F;&#x2F;生成@RestController 控制器 这个相对于普通controller 返回数据为json字符串</span><br><span class="line">        strategy.setRestControllerStyle(true);</span><br><span class="line">        &#x2F;&#x2F; 公共父类</span><br><span class="line">        &#x2F;&#x2F;strategy.setSuperControllerClass(&quot;你自己的父类控制器,没有就不用设置!&quot;);</span><br><span class="line">        &#x2F;&#x2F; 写于父类中的公共字段</span><br><span class="line">        &#x2F;&#x2F;strategy.setSuperEntityColumns(&quot;id&quot;);</span><br><span class="line">        strategy.setInclude(scanner(&quot;表名，多个英文逗号分割&quot;).split(&quot;,&quot;));</span><br><span class="line">        strategy.setControllerMappingHyphenStyle(true);</span><br><span class="line">        &#x2F;&#x2F;表前缀</span><br><span class="line">        &#x2F;&#x2F;strategy.setTablePrefix(pc.getModuleName() + &quot;_&quot;);</span><br><span class="line">        strategy.setTablePrefix(&quot;t_&quot;);</span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        mpg.setTemplateEngine(new FreemarkerTemplateEngine());</span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">8⃣️运行，输入表名，</span><br><span class="line">9⃣️将所有生成的类拷贝到yeb-server</span><br><span class="line">🔟更改路径，和添加swagger依赖</span><br><span class="line">	        &lt;!--Swagger2 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger2&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.7.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--Swagger第三方UI依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.github.xiaoymin&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;swagger-bootstrap-ui&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.9.6&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Jwt Token工具类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">1⃣️引入jwt，security依赖</span><br><span class="line">	 		&lt;!--security 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-security&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--JWT 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.jsonwebtoken&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jjwt&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;0.9.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">2⃣️引入security配置，application.yml</span><br><span class="line">jwt:</span><br><span class="line">  #JWT存储的请求头</span><br><span class="line">  tokenHeader: Authorization</span><br><span class="line">  #JWT 加密使用的密钥</span><br><span class="line">  secret: yeb-secret</span><br><span class="line">  #JWT 的超期限时间 （60*60*24）</span><br><span class="line">  expiration: 604800</span><br><span class="line">  #JWT 负载中拿到开头</span><br><span class="line">  tokenHead: Bearer</span><br><span class="line">3⃣️新建包config.security</span><br><span class="line">4⃣️新建JwtTokenUtil类 </span><br><span class="line">5⃣️添加注解@Component </span><br><span class="line">	把普通pojo实例化到spring容器中，相当于配置文件中的泛指各种组件，就是说当我们的类不属于各种归类的时候（不属于@Controller、@Services等的时候），我们就可以使用@Component来标注这个类</span><br><span class="line">6⃣️准备荷载变量</span><br><span class="line">	CLAIM_KEY_USERNAME</span><br><span class="line">	CLAIM_KEY_CREATED</span><br><span class="line">	secret</span><br><span class="line">	expiration</span><br><span class="line">	</span><br><span class="line">		private static final String CLAIM_KEY_USERNAME&#x3D;&quot;sub&quot;;</span><br><span class="line">    private static final String CLAIM_KEY_CREATED&#x3D;&quot;created&quot;;</span><br><span class="line">    @Value(&quot;$&#123;jwt.secret&#125;&quot;)</span><br><span class="line">    private String secret;</span><br><span class="line">    @Value(&quot;$&#123;jwt.expiration&#125;&quot;)</span><br><span class="line">    private Long expiration;</span><br><span class="line">    </span><br><span class="line">7⃣️主要功能</span><br><span class="line">	一 根据用户名生成token</span><br><span class="line">	1，根据用户信息生成token</span><br><span class="line">		public String generatorToken(UserDetails userDetails) &#123;</span><br><span class="line">        Map&lt;String, Object&gt; claims &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        claims.put(CLAIM_KEY_USERNAME, userDetails.getUsername());</span><br><span class="line">        claims.put(CLAIM_KEY_CREATED, new Date());</span><br><span class="line">        return generatorToken();</span><br><span class="line">        &#125;</span><br><span class="line">  2，根据荷载生成JWT TOKEN</span><br><span class="line">  	private String generatorToken(Map&lt;String,Object&gt; claims) &#123;</span><br><span class="line">        return Jwts.builder()</span><br><span class="line">                .setClaims(claims)</span><br><span class="line">                .setExpiration(generateExpirationDate())</span><br><span class="line">                .signWith(SignatureAlgorithm.ES512,secret)</span><br><span class="line">                .compact();</span><br><span class="line">                &#125;</span><br><span class="line">  3，生成token失效时间</span><br><span class="line">   private Date generateExpirationDate() &#123;</span><br><span class="line">        return new Date(System.currentTimeMillis() + expiration * 1000);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"> 二 从token拿用户名</span><br><span class="line">  1，从token中获得登录用户名</span><br><span class="line">  public String getUserNameFromToken(String token) &#123;</span><br><span class="line">        String username;</span><br><span class="line">        try &#123;</span><br><span class="line">            Claims claims &#x3D; getClaimsFromToken(token);</span><br><span class="line">            username &#x3D; claims.getSubject();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            username &#x3D; null;</span><br><span class="line">        &#125;</span><br><span class="line">        return username;</span><br><span class="line">    &#125;</span><br><span class="line">  2，从token里面获取荷载</span><br><span class="line">  private Claims getClaimsFromToken(String token) &#123;</span><br><span class="line">        Claims claims &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            claims &#x3D; Jwts.parser()</span><br><span class="line">                    .setSigningKey(secret)</span><br><span class="line">                    .parseClaimsJws(token)</span><br><span class="line">                    .getBody();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return claims;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">	三 判断token是否失效</span><br><span class="line">	1，token是否过期</span><br><span class="line">	 private boolean isTokenExpired(String token) &#123;</span><br><span class="line">        Date expiredDate &#x3D; getExpiredDateFromToken(token);</span><br><span class="line">        return expiredDate.before(new Date());</span><br><span class="line">    &#125;</span><br><span class="line">    private Date getExpiredDateFromToken(String token) &#123;</span><br><span class="line">        Claims claims &#x3D; getClaimsFromToken(token);</span><br><span class="line">        return claims.getExpiration();</span><br><span class="line">    &#125;</span><br><span class="line">	2，token里面的用户名与userDetail里面用户名是否一致</span><br><span class="line">	public boolean validateToken(String token, UserDetails userDetails) &#123;</span><br><span class="line">        String username &#x3D; getUserNameFromToken(token);</span><br><span class="line">        return username.equals(userDetails.getUsername()) &amp;&amp; !isTokenExpired(token);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">	四 是否可以刷新token</span><br><span class="line">	 public boolean canRefresh(String token) &#123;</span><br><span class="line">        return !isTokenExpired(token);</span><br><span class="line">    &#125;</span><br><span class="line">	五 刷新token</span><br><span class="line">	public String refreshToken(String token) &#123;</span><br><span class="line">        Claims claims &#x3D; getClaimsFromToken(token);</span><br><span class="line">        claims.put(CLAIM_KEY_CREATED, new Date());</span><br><span class="line">        return generatorToken(claims);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>公共返回对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">登录流程：</span><br><span class="line">	前端传用户名和密码</span><br><span class="line">	后端校验用户名和密码，</span><br><span class="line">		有错误就重新输入</span><br><span class="line">		正确就会生成JWT令牌，并且返回给前端，前端获得JWT令牌就会放入到请求头里面，任何请求都会携带JWT令牌，</span><br><span class="line">		后端会有对应的拦截器，对JWT令牌做相应的验证，验证通过才能访问对应的接口，验证不通过，令牌可能失效了，可能是用户名有问题，或者密码有问题，不是合法登陆</span><br><span class="line">		</span><br><span class="line">1⃣️在pojo新建公共返回对象RespBean</span><br><span class="line">2⃣️加注解@Data，生成getters and setters</span><br><span class="line">	@NoArgsConstructor 无参</span><br><span class="line">	@AllArgsConstructor	有参</span><br><span class="line">3⃣️成功，失败返回方法，公共变量，code message obj</span><br><span class="line"> public static RespBean success(String message) &#123;</span><br><span class="line">        return new RespBean(200, message, null);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>登录之后返回token</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">一 前端传用户名密码，后端校验</span><br><span class="line">	1⃣️Admin类，里面实现springsecurity框架UserDetails</span><br><span class="line">	实现方法，除了getAuthorities的返回值不变，isEnabled返回值为属性字段enabled，</span><br><span class="line">	其他的都返回true</span><br><span class="line">	2⃣️新建登陆实体类 AdminLoginParam</span><br><span class="line">		添加lombok注解</span><br><span class="line">			@Data</span><br><span class="line">			@EqualsAndHashCode 此注解会生成equals(Object other) 和 hashCode()方法 callSuper是否调用父类中的方法</span><br><span class="line">			@Accessors(chain &#x3D; true)，Accessors翻译是存取器。通过该注解可以控制getter和setter方法的形式chain为true，setter方法返回当前对象</span><br><span class="line">		  @ApiModel(value &#x3D; &quot;AdminLogin对对象&quot;,description &#x3D; &quot;&quot; swagger注解</span><br><span class="line">		  @ApiModelProperty(value &#x3D; &quot;密码&quot;,required &#x3D; true) swagger注解，required是否必填</span><br><span class="line">	3⃣️controller编写，LoginController</span><br><span class="line">		注解：</span><br><span class="line">			@Api(tags &#x3D; &quot;LoginController&quot;) 表示标识这个类是swagger的资源 </span><br><span class="line">			@RestController 等同于@Controller + @ResponseBody，表明了这个类是一个控制器类+表示方法的返回值直接以指定的格式写入Http response body</span><br><span class="line">      @ApiOperation(value &#x3D; &quot;登陆之后返回token&quot;)表示一个http请求的操作 </span><br><span class="line">       @PostMapping(&quot;&#x2F;login&quot;) 映射一个POST请求 </span><br><span class="line">   4⃣️添加方法 login，参数 AdminLoginParam，HttpServletRequest</span><br><span class="line">      public RespBean login(AdminLoginParam adminLoginParam, HttpServletRequest request);</span><br><span class="line">   5⃣️引入IAdminService，并加入方法login，参数（用户名，密码，request）</span><br><span class="line">   6⃣️在IAminService里面实现login</span><br><span class="line">   7⃣️在AdminServiceImpl实现login</span><br><span class="line">   	 注入UserDetailsService</span><br><span class="line">   	 通过UserDetailsService，获得UserDetails</span><br><span class="line">   	 注入PasswordEncoder</span><br><span class="line">   	 利用PasswordEncoder 匹配一下密码</span><br><span class="line">   	 判断userDetails账户是否禁用</span><br><span class="line">   	 注入JWT工具类</span><br><span class="line">   	 生成token</span><br><span class="line">   	 注入tokenHead，jwt配置</span><br><span class="line">   	 将token装入map</span><br><span class="line">		 使用springsecurity框架，登陆成功后，获取用户信息可以使用springsecurity提供的对象userdetails等</span><br><span class="line">		 所以登录时，要将用户信息放入springsecurity全文中</span><br><span class="line">		 UsernamePasswordAuthenticationToken authenticationToken &#x3D; new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());</span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(authenticationToken);</span><br><span class="line">	8⃣️passwordEncoder对象等待处理</span><br></pre></td></tr></table></figure>
<p>获取当前登录用户信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">登陆时将当前登录对象设制到springsecurity全局，所以可以利用Principal获取当前登录用户对象</span><br><span class="line">1⃣️在LoginController新建方法getAdminInfo</span><br><span class="line">2⃣️利用Principal获取用户对象</span><br><span class="line">3⃣️将获得admin对象密码置空，避免前端获取明文密码</span><br><span class="line">4⃣️在IAdminService定义getAdminByUserName</span><br><span class="line">5⃣️在AdminServiceImpl实现getAdminByUserName</span><br><span class="line">	注入AdminMapper</span><br><span class="line">	return adminMapper.selectOne(</span><br><span class="line">			newQueryWrapper&lt;Admin()</span><br><span class="line">					   .eq(&quot;username&quot;,username)</span><br><span class="line">					   .eq(&quot;enabled&quot;, true)</span><br><span class="line">					   );</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>退出登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">后端返回200状态码，前端根据状态码，将请求头里面的token删除 </span><br><span class="line">1⃣️在LoginController里面 新建方法logout 返回状态码200</span><br></pre></td></tr></table></figure>
<p>配置security登陆过滤器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">1⃣️准备配置类SecurityConfig，继承 WebSecurityConfigurerAdapter</span><br><span class="line">2⃣️注解@Configuration</span><br><span class="line">3⃣️注入Bean UserDetailsService，重写这个容器里的</span><br><span class="line">		@Override</span><br><span class="line">    @Bean</span><br><span class="line">    public UserDetailsService userDetailsService() &#123;</span><br><span class="line">        return username -&gt; &#123;</span><br><span class="line">            Admin admin &#x3D; adminService.getAdminByUserName(username);</span><br><span class="line">            if (null !&#x3D; admin) &#123;</span><br><span class="line">                return admin;</span><br><span class="line">            &#125;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">4⃣️重写configure方法，能够将我们重写的UserDetyailsService 注入到springsecurit</span><br><span class="line">5⃣️实现passwordEncoder容器</span><br><span class="line">6⃣️重写springsecurity配置configure(HttpSecurity http)</span><br><span class="line">	关闭scrf，使用JWT不需要csrf</span><br><span class="line">	 http.csrf()</span><br><span class="line">        .disable()</span><br><span class="line">	关闭session相关的</span><br><span class="line">		基于token不需要session</span><br><span class="line">                .sessionManagement()</span><br><span class="line">                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">	允许登陆访问</span><br><span class="line">		.antMatchers(&quot;&#x2F;login&quot;, &quot;logout&quot;)</span><br><span class="line">	配置生效</span><br><span class="line">		.permitAll();</span><br><span class="line">	访问请求要求认证</span><br><span class="line">                .anyRequest()</span><br><span class="line">                .authenticated()</span><br><span class="line">   缓存关闭</span><br><span class="line">                .headers()</span><br><span class="line">                .cacheControl();</span><br><span class="line">   添加jwt登陆授权拦截器</span><br><span class="line">        http.addFilterBefore();</span><br><span class="line">   自定义未授权，或者未登录的结果返回</span><br><span class="line">        http.exceptionHandling()</span><br><span class="line">                .accessDeniedHandler()</span><br><span class="line">                .authenticationEntryPoint();</span><br><span class="line">7⃣️准备jwt的登陆过滤器 JwtAuthorizationTokenFilter 继承OncePerRequestFilter 重写doFilterInternal&#x3D;&#x3D;相当于前置拦截</span><br><span class="line">	通过request获取Header</span><br><span class="line">	进行token校验</span><br><span class="line">		token是否存在，token是否以tokenHead为开头</span><br><span class="line">	利用JwtUtils获取用户名</span><br><span class="line">	进行用户名判断</span><br><span class="line">		判断用户名是否为空，同时检查springsecurity全局上下文找不到用户对象，即未登录</span><br><span class="line">	获取userdetails，相当于登陆了</span><br><span class="line">	判断token是否有效，有效就将token重新放入用户对象	</span><br><span class="line">		重新设置用户对象,更新荷载</span><br><span class="line">		重新设置用户对象，更新details</span><br><span class="line">		设置springsecurity全局上下文</span><br><span class="line">	经过一系列验证，最后进行放行</span><br><span class="line">8⃣️回到SecurityConfig类，利用Bean注解将JwtAuthorizationTokenFilter暴露出来</span><br><span class="line">	并填入【添加jwt登陆授权拦截器】同时加上参数，UsernamePasswordAuthenticationFilter.class</span><br></pre></td></tr></table></figure>
<p>security自定义返回结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1⃣️新建类RestAuthorizationEntryPoint，实现AuthenticationEntryPoint</span><br><span class="line">2⃣️通过response设置字符集</span><br><span class="line">3⃣️设置数据交流格式</span><br><span class="line">4⃣️获取输出流</span><br><span class="line">5⃣️自定义返回类型</span><br><span class="line"></span><br><span class="line">1⃣️新建类RestfulAccessDeniedHandler实现AccessDeniedHandler重写handle方法</span><br><span class="line">2⃣️通过response设置字符集</span><br><span class="line">3⃣️设置数据交流格式</span><br><span class="line">4⃣️获取输出流</span><br><span class="line">5⃣️自定义返回类型</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在SecurityConfig类中进行注入RestAuthorizationEntryPoint，RestfulAccessDeniedHandler</span><br><span class="line">将注入的两个类放入配置中</span><br></pre></td></tr></table></figure>
<p>swagger2配资</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1⃣️pom依赖</span><br><span class="line">	 &lt;!--Swagger2 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger2&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.7.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--Swagger第三方UI依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.github.xiaoymin&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;swagger-bootstrap-ui&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.9.6&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line"> 2⃣️配置swagger，新建Swagger2Config类</span><br><span class="line"> 		注解</span><br><span class="line"> 		@Component 配置类</span><br><span class="line">		@EnableSwagger2 开启swagger2</span><br><span class="line"> 3⃣️准备APiInfo</span><br><span class="line"> 4⃣️注入bean，规定扫描那些包，具体什么包，任意路径	 	</span><br><span class="line"> 5⃣️启动测试，重写允许通过方法，添加通过资源</span><br><span class="line"> 	 public void configure(WebSecurity web) throws Exception &#123;</span><br><span class="line">        web.ignoring().antMatchers(</span><br><span class="line">                &quot;&#x2F;login&quot;,</span><br><span class="line">                &quot;&#x2F;logout&quot;,</span><br><span class="line">                &quot;&#x2F;css&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;js&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;index.html&quot;,</span><br><span class="line">                &quot;favicon.ico&quot;,</span><br><span class="line">                &quot;&#x2F;doc.html&quot;,</span><br><span class="line">                &quot;&#x2F;webjars&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;swagger-resources&#x2F;**&quot;,</span><br><span class="line">                &quot;&#x2F;v2&#x2F;api-docs&#x2F;**&quot;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>swagger2提供Authorize</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">实现全局登录</span><br><span class="line">1⃣️在swagger2config类createRestApi方法里面继续添加 </span><br><span class="line">																	.securityContexts()</span><br><span class="line">									                .securitySchemes();</span><br><span class="line">2⃣️完成securitySchemes</span><br><span class="line">	设置请求头信息</span><br><span class="line">		新建List</span><br><span class="line">		新建ApiKey，三个参数</span><br><span class="line">		将ApiKey加入List</span><br><span class="line">		返回List</span><br><span class="line">3⃣️完成securityContexts</span><br><span class="line">	设置登陆访问认证路径</span><br><span class="line">	result.add(getContextByPath(&quot;&#x2F;hello&#x2F;.*&quot;));</span><br><span class="line">	默认权限</span><br><span class="line">	.securityReferences(defaultAuth())</span><br><span class="line">	指代路径</span><br><span class="line">	.forPaths(PathSelectors.regex(pathRegex))</span><br><span class="line">	默认权限</span><br><span class="line">		授权范围</span><br><span class="line">			AuthorizationScope authorizationScope &#x3D; new AuthorizationScope(&quot;global&quot;, &quot;accessEverything&quot;);</span><br><span class="line">     	result.add(new SecurityReference(&quot;Authorization&quot;, authorizationScopes));</span><br><span class="line">4⃣️json传参</span><br><span class="line">更改LoginController&#x2F;login 参数注解@RequestBody ，更改JwtTokenUtil&#x2F;generatorToken&#x2F;加密模式HS512</span><br><span class="line">5⃣️注意，SecurityConfig&#x2F;configure（WebSecurity web）里面放行的配置与SecurityConfig&#x2F;configure(HttpSecurity http)的放行配置重合，</span><br><span class="line">可以将SecurityConfig&#x2F;configure(HttpSecurity http)的login放行配置进行注释</span><br><span class="line">	.antMatchers(&quot;&#x2F;login&quot;, &quot;&#x2F;logout&quot;)</span><br><span class="line">  .permitAll()</span><br><span class="line">6⃣️进行Authorize设置，将Bearer空格tokon进行保存</span><br></pre></td></tr></table></figure>
<p>生成验证码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">1⃣️引入Google验证码依赖</span><br><span class="line">	 &lt;!--验证码--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.github.axet&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;kaptcha&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;0.0.9&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">2⃣️准备谷歌验证码配置类</span><br><span class="line">	注解@Configuration</span><br><span class="line">	准备bean</span><br><span class="line">	具体配置</span><br><span class="line">				&#x2F;&#x2F;验证码生成器</span><br><span class="line">        DefaultKaptcha defaultKaptcha &#x3D; new DefaultKaptcha();</span><br><span class="line">        &#x2F;&#x2F;配置</span><br><span class="line">        Properties properties &#x3D; new Properties();</span><br><span class="line">        &#x2F;&#x2F;是否有边框</span><br><span class="line">        properties.setProperty(&quot;kaptcha.border&quot;, &quot;yes&quot;);</span><br><span class="line">        &#x2F;&#x2F;设置边框颜色</span><br><span class="line">        properties.setProperty(&quot;kaptcha.border.color&quot;, &quot;105,179,90&quot;);</span><br><span class="line">        &#x2F;&#x2F;边框粗细度，默认为1</span><br><span class="line">        &#x2F;&#x2F; properties.setProperty(&quot;kaptcha.border.thickness&quot;,&quot;1&quot;);</span><br><span class="line">        &#x2F;&#x2F;验证码</span><br><span class="line">        properties.setProperty(&quot;kaptcha.session.key&quot;, &quot;code&quot;);</span><br><span class="line">        &#x2F;&#x2F;验证码文本字符颜色 默认为黑色</span><br><span class="line">        properties.setProperty(&quot;kaptcha.textproducer.font.color&quot;, &quot;blue&quot;);</span><br><span class="line">        &#x2F;&#x2F;设置字体样式</span><br><span class="line">        properties.setProperty(&quot;kaptcha.textproducer.font.names&quot;, &quot;宋体,楷体,微软雅 黑&quot;);</span><br><span class="line">        &#x2F;&#x2F;字体大小，默认40</span><br><span class="line">        properties.setProperty(&quot;kaptcha.textproducer.font.size&quot;, &quot;30&quot;);</span><br><span class="line">        &#x2F;&#x2F;验证码文本字符内容范围 默认为abced2345678gfynmnpwx</span><br><span class="line">        &#x2F;&#x2F; properties.setProperty(&quot;kaptcha.textproducer.char.string&quot;, &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F;字符长度，默认为5</span><br><span class="line">        properties.setProperty(&quot;kaptcha.textproducer.char.length&quot;, &quot;4&quot;);</span><br><span class="line">        &#x2F;&#x2F;字符间距 默认为2</span><br><span class="line">        properties.setProperty(&quot;kaptcha.textproducer.char.space&quot;, &quot;4&quot;);</span><br><span class="line">        &#x2F;&#x2F;验证码图片宽度 默认为200</span><br><span class="line">        properties.setProperty(&quot;kaptcha.image.width&quot;, &quot;100&quot;);</span><br><span class="line">        &#x2F;&#x2F;验证码图片高度 默认为40</span><br><span class="line">        properties.setProperty(&quot;kaptcha.image.height&quot;, &quot;40&quot;);</span><br><span class="line">        Config config &#x3D; new Config(properties);</span><br><span class="line">        defaultKaptcha.setConfig(config);</span><br><span class="line">        return defaultKaptcha;</span><br><span class="line">3⃣️新建Controller</span><br><span class="line">	注解</span><br><span class="line">	类注解  @RestController</span><br><span class="line">	@ApiOperation(value &#x3D; &quot;验证码&quot;)</span><br><span class="line">  @GetMapping(value &#x3D; &quot;&#x2F;captcha&quot;)</span><br><span class="line">  添加方法captcha参数为（HttpServletRequest，HttpServletResponse）</span><br><span class="line">  通过流传递图片到前端,需要对response响应头做相应处理</span><br><span class="line">  	response.setDateHeader(&quot;Expires&quot;, 0);</span><br><span class="line">    response.setHeader(&quot;Cache-Control&quot;, &quot;no-store, no-cache, must-revalidate&quot;);</span><br><span class="line">    response.addHeader(&quot;Cache-Control&quot;, &quot;post-check&#x3D;0, pre-check&#x3D;0&quot;);</span><br><span class="line">    response.setHeader(&quot;Pragma&quot;, &quot;no-cache&quot;);</span><br><span class="line">    response.setContentType(&quot;image&#x2F;jpeg&quot;);</span><br><span class="line">  注入DefaultKaptcha</span><br><span class="line">  生成验证码</span><br><span class="line">  获取验证码文本内容</span><br><span class="line">  将验证码放入session</span><br><span class="line">  根据text创建图像验证码</span><br><span class="line">  输出流输出图片，格式为jpg</span><br><span class="line">4⃣️添加放行SecurityConfig&#x2F;configure(WebSecurity web)+&quot;&#x2F;captcha&quot;</span><br><span class="line">5⃣️接口文档验证码乱码-在注解添加 @GetMapping(value &#x3D; &quot;&#x2F;captcha&quot;,produces &#x3D; &quot;image&#x2F;jpeg&quot;)</span><br></pre></td></tr></table></figure>
<p>验证码校验</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1⃣️在AdminLoginParam添加接收参数</span><br><span class="line">	@ApiModelProperty(value &#x3D; &quot;验证码&quot;,required &#x3D; true)</span><br><span class="line">    private String code;</span><br><span class="line">2⃣️在LoginController，添加参数验证码，同时在IAdminService&#x2F;AdminServiceImpl也进行改变</span><br><span class="line">3⃣️在AdminServiceImpl，获取验证码</span><br><span class="line">	String captcha &#x3D; (String) request.getSession().getAttribute(&quot;captcha&quot;);</span><br><span class="line">4⃣️验证码比较</span><br><span class="line">	不为空前端输入与后端验证码进行匹配</span><br></pre></td></tr></table></figure>
<p>根据用户id查询菜单列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">1⃣️更改pojo实体类Menu</span><br><span class="line">	 @ApiModelProperty(value &#x3D; &quot;子菜单&quot;)</span><br><span class="line">   @TableField(exist &#x3D; false)</span><br><span class="line">   private List&lt;Menu&gt; children;	</span><br><span class="line">2⃣️更改MenuController</span><br><span class="line">	更改路径&#x2F;system&#x2F;cfg</span><br><span class="line">	注入 IMenuService</span><br><span class="line">	在getMenuByAdminId返回getMenusByAdminId</span><br><span class="line">	用户信息一般是从后端获取，而不是前端获取，因为可能会被篡改</span><br><span class="line">3⃣️在IMenuService接口定义getMenusByAdminId</span><br><span class="line">4⃣️在MenuServiceImpl实现getMenusByAdminId</span><br><span class="line">	return menuMapper.getMenusAdminId(((Admin)(SecurityContextHolder.getContext().getAuthentication().getPrincipal())).getId());</span><br><span class="line">5⃣️在MenuMapper定义getMenusAdminId</span><br><span class="line">6⃣️在MenuMapper写查询方法 定义返回类型</span><br><span class="line">	&lt;!--根据用户id查询菜单列表--&gt;</span><br><span class="line">	&lt;select id&#x3D;&quot;getMenusAdminId&quot; resultMap&#x3D;&quot;Menus&quot;&gt;</span><br><span class="line">        select distinct m1.*,</span><br><span class="line">                        m2.id            as id2,</span><br><span class="line">                        m2.url           as url2,</span><br><span class="line">                        m2.path          as path2,</span><br><span class="line">                        m2.&#96;component&#96;   as component2,</span><br><span class="line">                        m2.name          as name2,</span><br><span class="line">                        m2.&#96;iconCls&#96;     as iconCls2,</span><br><span class="line">                        m2.&#96;keepAlive&#96;   as keepAlive2,</span><br><span class="line">                        m2.&#96;requireAuth&#96; as requireAuth2,</span><br><span class="line">                        m2.&#96;parentId&#96;    as parentId2,</span><br><span class="line">                        m2.enabled       as enabled2</span><br><span class="line">        from &#96;t_menu&#96; m1,</span><br><span class="line">             &#96;t_menu&#96; m2,</span><br><span class="line">             &#96;t_menu_role&#96; mr,</span><br><span class="line">             &#96;t_admin_role&#96; ar</span><br><span class="line">        where m1.id &#x3D; m2.&#96;parentId&#96;</span><br><span class="line">          and m2.id &#x3D; mr.&#96;mid&#96;</span><br><span class="line">          and mr.&#96;rid&#96; &#x3D; ar.&#96;rid&#96;</span><br><span class="line">          and ar.&#96;adminId&#96; &#x3D; #&#123;id&#125;</span><br><span class="line">          and m2.enabled &#x3D; true</span><br><span class="line">        order by m2.id</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;resultMap id&#x3D;&quot;Menus&quot; type&#x3D;&quot;com.zoux.server.pojo.Menu&quot; extends&#x3D;&quot;BaseResultMap&quot;&gt;</span><br><span class="line">        &lt;collection property&#x3D;&quot;children&quot; ofType&#x3D;&quot;com.zoux.server.pojo.Menu&quot;&gt;</span><br><span class="line">            &lt;id column&#x3D;&quot;id2&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;url2&quot; property&#x3D;&quot;url&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;path2&quot; property&#x3D;&quot;path&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;component2&quot; property&#x3D;&quot;component&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;name2&quot; property&#x3D;&quot;name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;iconCls2&quot; property&#x3D;&quot;iconCls&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;keepAlive2&quot; property&#x3D;&quot;keepAlive&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;requireAuth2&quot; property&#x3D;&quot;requireAuth&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;parentId2&quot; property&#x3D;&quot;parentId&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result column&#x3D;&quot;enabled2&quot; property&#x3D;&quot;enabled&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;collection&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Redis集成菜单功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">1⃣️添加依赖</span><br><span class="line">	&lt;!--spring data redis 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!--commons-pool2 对象池依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.commons&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-pool2&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">2⃣️添加配置application.yml </span><br><span class="line">	redis:</span><br><span class="line">    #超时时间</span><br><span class="line">    timeout:  10000ms</span><br><span class="line">    #服务器地址</span><br><span class="line">    host: 47.100.92.101</span><br><span class="line">    #服务器端口</span><br><span class="line">    port: 6379</span><br><span class="line">    database: 0</span><br><span class="line">    #    password: root</span><br><span class="line">    lettuce:</span><br><span class="line">      #默认连接数，默认是8</span><br><span class="line">      max-active: 1024</span><br><span class="line">      #最大连接阻塞等待时间</span><br><span class="line">      max-wait: 1000ms</span><br><span class="line">      #最大空闲连接</span><br><span class="line">      max-idle: 200</span><br><span class="line">      #最小空闲连接</span><br><span class="line">      min-idle: 5</span><br><span class="line">3⃣️新建redis配置类RedisConfig 参数RedisConnectionFactory</span><br><span class="line">	引入Bean RedisTemplate</span><br><span class="line">	序列化</span><br><span class="line">	String类型序列器</span><br><span class="line">	 Hash类型序列器</span><br><span class="line">	 将RedisConnectionFactory 加入到RedisTemplate</span><br><span class="line">4⃣️更改Menucontroller-&gt;IMenuService-&gt;MenuServiceImpl&#x2F;getMenusByAdminId方法</span><br><span class="line">	注入RedisTemplate</span><br><span class="line">	先去redis获取</span><br><span class="line">	判断menus是否为空,就通过数据库进行查询</span><br><span class="line">		将数据设置到redis中</span><br><span class="line">5⃣️后期，当涉及到数据菜单更新时，我们要重置redis里面的数据</span><br></pre></td></tr></table></figure>
<p>根据请求url判断角色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">权限RBAC基本概念</span><br><span class="line">	Role- Based Access Controller</span><br><span class="line">	权限与角色相关联，用户通过扮演适当的角色从而得到这些角色的权限。</span><br><span class="line">	管理是层级相互依赖的，权限赋予给角色，角色又赋予用户。</span><br><span class="line">	权限设计清楚，管理方便</span><br><span class="line">	RBAC实际上是who what how三元组之间的关系，也就是who 对what进行how的操作</span><br><span class="line">	谁对什么资源做了怎样的操作。</span><br><span class="line">	</span><br><span class="line">1⃣️pojo-Menu添加属性</span><br><span class="line">		@ApiModelProperty(value &#x3D; &quot;角色列表&quot;)</span><br><span class="line">    @TableField(exist &#x3D; false)</span><br><span class="line">    private List&lt;Menu&gt; roles;</span><br><span class="line">2⃣️在IMenuService定义getMenusWithRole</span><br><span class="line">3⃣️在MenuServiceImpl实现getMenusWithRole</span><br><span class="line">4⃣️在MenuMapper定义getMenusWithRole</span><br><span class="line">5⃣️在MenuMapper.xml实现sql</span><br><span class="line">	并实现返回map</span><br><span class="line">6⃣️将实现的getMenusWithRole放入过滤器中</span><br><span class="line">	顺便更新config目录结构，重启项目，验证是否出现错误</span><br><span class="line">7⃣️	新建CustomFilter配置类</span><br><span class="line">	注解@Component</span><br><span class="line">	实现FilterInvocationSecurityMetadataSource重写内部方法 getAttributes</span><br><span class="line">	注入IMenuService</span><br><span class="line">	引入AntPathMatcher</span><br><span class="line">		在做uri匹配规则发现这个类，根据源码对该类进行分析，它主要用来做类URLs字符串匹配；</span><br><span class="line">		获取请求的url</span><br><span class="line">		获得menus</span><br><span class="line">		循环判断 我们当前的url与获取的url是否匹配</span><br><span class="line">		判断请求url与角色允许url是否匹配</span><br><span class="line">		利用jdk8新特性stream流map一下</span><br><span class="line">		能够匹配就将匹配的角色放入&#x2F;list</span><br><span class="line">		如果url匹配不上就默认给一个登陆角色</span><br></pre></td></tr></table></figure>
<p>判断用户角色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">1⃣️修改pojo-Admin</span><br><span class="line">		@ApiModelProperty(value &#x3D; &quot;角色&quot;)</span><br><span class="line">    @TableField(exist &#x3D; false)</span><br><span class="line">    private List&lt;Role&gt; roles;</span><br><span class="line">    更改getAuthorities</span><br><span class="line">    	获取权限列表</span><br><span class="line">2⃣️IAdminService定义getRoles</span><br><span class="line">3⃣️在AdminServiceImpl实现getRoles</span><br><span class="line">	注入RoleMapper</span><br><span class="line">	新建方法getRoles</span><br><span class="line">4⃣️在RoleMapper定义getRoles</span><br><span class="line">5⃣️在RoleMapper.xml中实现sql</span><br><span class="line">7⃣️在登录方法中加入getRoles</span><br><span class="line">	在LoginController-getAdminInfo&#x2F;loadUserByUsername实现方法</span><br><span class="line">		添加获取用户角色    </span><br><span class="line">8⃣️添加拦截</span><br><span class="line">	新建类CustomUrlDecisionManager</span><br><span class="line">		注解@Component</span><br><span class="line">		实现AccessDecisionManager，并重写其方法decide</span><br><span class="line">			获取当前url需要角色</span><br><span class="line">			判断角色是否登陆即可访问的角色，此角色在CustomFilter中设置</span><br><span class="line">			判断是否登陆</span><br><span class="line">			判断用户角色是否为url所需角色</span><br><span class="line">			如若不满足，抛出异常</span><br><span class="line">				throw new AccessDeniedException(&quot;权限不足，请联系管理员！&quot;);</span><br><span class="line">9⃣️配置securityconfig</span><br><span class="line">	引入CustomFilter，CustomUrlDecisionManager</span><br><span class="line">	在访问请求要求认证下添加</span><br><span class="line">		动态权限配置</span><br><span class="line">		.withObjectPostProcessor()</span><br><span class="line">			new ObjectPostProcessor范型为FilterSecurityInterceptor重写其方法postProcess</span><br><span class="line">				添加CustomFilter，CustomUrlDecisionManager</span><br><span class="line">					o.setAccessDecisionManager(customUrlDecisionManager);</span><br><span class="line">          o.setSecurityMetadataSource(customFilter);</span><br><span class="line">        返回o</span><br><span class="line">🔟准备测试类</span><br><span class="line">	HelloController</span><br><span class="line">	注解@RestController</span><br><span class="line">		@GetMapping(&quot;&#x2F;employee&#x2F;basic&#x2F;hello&quot;)</span><br><span class="line">    public String hello2() &#123;</span><br><span class="line">        return &quot;&#x2F;employee&#x2F;basic&#x2F;hell&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;hello&quot;)</span><br><span class="line">    public String hello() &#123;</span><br><span class="line">        return &quot;hello&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;employee&#x2F;advanced&#x2F;hello&quot;)</span><br><span class="line">    public String hello3() &#123;</span><br><span class="line">        return &quot;&#x2F;employee&#x2F;advanced&#x2F;hello&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

  </div>
  <div> 
    <a href="https://github.com/Zoushaozx/zoushaozx.github.io/edit/myblog/source/_posts/云e办.md" target="_blank">
             <!-- https://github.com/Zoushaozx/zoushaozx.github.io/edit/myblog/source/_posts/hello-world.md -->
      编辑
    </a>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about">关于</a></li>
         
          <li><a href="/archives">归档</a></li>
         
          <li><a href="/projects">项目</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%91e%E5%8A%9E%EF%BC%8C%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%EF%BC%8C%E5%89%8D%E7%AB%AFvue-%E5%90%8E%E7%AB%AFJava"><span class="toc-number">1.</span> <span class="toc-text">云e办，前后端分离，前端vue 后端Java</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">1.1.</span> <span class="toc-text">后端技术栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">1.2.</span> <span class="toc-text">前端技术栈</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&text=云e办"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&title=云e办"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&is_video=false&description=云e办"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=云e办&body=Check out this article: http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&title=云e办"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&title=云e办"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&title=云e办"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&title=云e办"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&name=云e办&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2021/02/12/%E4%BA%91e%E5%8A%9E/&t=云e办"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2021
    Zoux
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about">关于</a></li>
         
          <li><a href="/archives">归档</a></li>
         
          <li><a href="/projects">项目</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
