---
title: 尚医通
date: 2021-03-20 12:10:38
tags:
---

# MyBatis-plus

---

链接

```
GitHub：https://github.com/Jiangw2020/Hospital
码云：https://gitee.com/jiangwei_2020/Hospital

```

1 创建数据库

```
CREATE TABLE `user`(
  id BIGINT (20) NOT NULL COMMENT '主键ID',
  NAME VARCHAR (30) NULL DEFAULT NULL COMMENT '姓名',
  age INT(11) NULL DEFAULT NULL COMMENT '年龄',
  email VARCHAR(50) NULL DEFAULT NULL COMMENT '邮箱',
  PRIMARY KEY (id)
)
INSERT INTO user(id,NAME,age,email) VALUES
(1,'Jone',18,'test1@baomidou.com'),
(2,'Jack',20,'test2@baomidou.com'),
(3,'Tom',28,'test3@baomidou.com'),
(4,'Sandy',21,'test4@baomidou.com'),
(5,'Billie',24,'test5@baomidou.com')
```

2 application.yml配置

```
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://47.100.92.101:3306/mybatis_plus?serverTimezone=GMT%2B8
    username: root
    password: root
```

3 创建实体类

```
entity
	User
加注解
@Data getter setter 都有
```

4 创建mapper 接口

```
mapper
	UserMapper
注解 @Repository 能够消除 扫描mapper 爆红
UserMapper继承 BaseMapper<User>
```

5 启动类添加扫描mapper

```
@MapperScan("com.zoux.demomptest.mapper")
```

6 测试

```
查询
@Autowired
    private UserMapper userMapper;

    @Test
    public void findAll() {
        List<User> users = userMapper.selectList(null);
        System.out.println(users);
    }
添加
@Test
    public void testAdd(){
        User user = new User();
        user.setName("zoux");
        user.setAge(24);
        user.setEmail("1234@qq.com");
        int insert = userMapper.insert(user);
        System.out.println(insert);
    }
修改
@Test
    public void testUpdate(){
        User user = new User();
        user.setId(6L);
        user.setName("zouxing");
        int count = userMapper.updateById(user);
        System.out.println("受影响的行数"+count);
    }
乐观锁测试
@Test
    public void testOptimisticLock() {
        User user = userMapper.selectById(7L);
        int count = userMapper.updateById(user);
    }    
```

7 添加log输出

```
mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```

8 主键策略

```
ASSIGN_ID 19位
AUTO 自动增长
雪花算法

配置
#    主键策略
  global-config:
    db-config:
      id-type: auto
```

9 自动填充

```
数据库加字段
实体类增加相应字段
添加新包handler 
	添加实现自动填充的类 实现接口MetaObjectHandler 注解 @Component 将类交给spring管理
		重写 insertFill updateFill
			@Override
      public void updateFill(MetaObject metaObject) {
          this.setFieldValByName("updateTime", new Date(), metaObject);

      }
```

10 乐观锁

```
给数据库添加属性版本号
给实体类添加属性版本号
在自动填充类加上相应规则
增加config类
	可以将mapper扫描移到这个类上
	@Configuration
	@MapperScan("com.zoux.demomptest.mapper")
	乐观锁插件
    @Bean
    public OptimisticLockerInterceptor optimisticLockerInterceptor(){
        return new OptimisticLockerInterceptor();
    }
```

11 查询方法集合

```
多个id查询
@Test
    public void testSelectByIds() {
        List<User> users = userMapper.selectBatchIds(Arrays.asList(1, 2, 3));
        System.out.println(users);

    }
条件查询
 @Test
    public void testSelectByCondition() {
        HashMap<String, Object> columnMap = new HashMap<>();
        columnMap.put("name", "zoux");
        columnMap.put("age", 24);
        List<User> users = userMapper.selectByMap(columnMap);
        System.out.println(users);

    }
分页查询 
分页插件
	@Bean
    public PaginationInterceptor paginationInterceptor() {
        return new PaginationInterceptor();
    }
 @Test
    public void testSelectWithPage() {
        Page<User> page = new Page<>(1, 2);
        Page<User> userPage = userMapper.selectPage(page, null);
        long pages = userPage.getPages();
        long current = userPage.getCurrent();
        long total = userPage.getTotal();
        boolean hasNext = userPage.hasNext();
        boolean hasPrevious = userPage.hasPrevious();
        List<User> records = userPage.getRecords();
        System.out.println(pages);
        System.out.println(current);
        System.out.println(total);
        System.out.println(hasNext);
        System.out.println(hasPrevious);
        System.out.println(records);
    }
```

12 删除方法集合

```
物理删除
	根据id删除
	deleteById()
  批量删除
    deleteBatchIds(Arrays.asList(8,9,10));
  条件删除
    HashMap<String, Object> columnMap = new HashMap<>();
          columnMap.put("name", "zoux");
          columnMap.put("age", 24);
    deleteByMap(columnMap); 

逻辑删除
	数据库新建字段 deleted 
  实体类 增加deleted 属性 注解@TableLogic
  自动填充 增加相应 规则
  
```

13 条件构造器QueryWrapper

```
ge	>=
gt	>
le	<=
lt  <

eq  =
ne  !=

between  在范围
notbetween	不在范围

like	模糊查询
notlike	不再模糊查询范围之内
likeleft	模糊字符在开头
lekeright  模糊字符在结尾

orderBy 排序
orderByDesc 降序
orderByAsc 升序

@Test
    public void testSelect(){
        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
        queryWrapper.le("age",24);
        List<User> users = userMapper.selectList(queryWrapper);
        System.out.println(users);
    }
    
```



---

# 尚医通后端环境搭建

新建springboot项目

```
结构	
	syt
		common
			common_util
			service_util
		service
    	service_uuser
```

git

```
gitee
	新建库
idea 
	VCS 添加gitee账户
```

