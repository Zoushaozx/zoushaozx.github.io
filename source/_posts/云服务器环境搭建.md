---
title: 云服务器环境搭建
date: 2021-02-20 13:06:46
tags:
---

# 重置云服务器环境

---

```
https://swas.console.aliyun.com/?spm=5176.19720258.ace-homepage-2020-service-tab.21.1d302c4aZhLsLU&ags=20210217_1277812095969522_swas#/server/0d4dd6fb80c7499eb513b9a59f643c94/cn-shanghai/dashboard
```

---

# linux镜像获取

---

```
http://mirrors.ustc.edu.cn/
```



---





# linux安装软件方式

```
一：Linux源码安装
二：RPM包安装
三、yum安装
```

```
1、解压源码包文件
    源码包通常会使用tar工具归档然后使用gunzip或bzip2进行压缩，后缀格式会分别为.tar.gz与.tar.bz2，分别的解压方式：
    tar -zxvf FileName.tar.gz
    tar -jxvf FileName.tar.bz2

        tar 对文件进行压缩或解压 tar [参数] [文件]
            -c 压缩文件
            -x 解压文件
            -t 查看压缩包内有哪些文件
            -z 用Gzip压缩或解压
            -j 用bzip2压缩或解压
            -v 显示压缩或解压过程信息
            -f 目标文件名
            -P 保留原始权限和属性
            -p 使用绝对路径压缩
            -C 指定解压到的目录

    2、切换到解压后的目录
    cd FileDirectory

    3、准备编译工作
    在开始安装服务之前，需要执行configure脚本，会自动的对当前系统进行一系列的评估，如源文件、软件依赖库、编译器、
    汇编器、连接器检查等等，如果有需要，还可以使用-prefix参数来指定程序的安装路径，而当脚本检查系统环境符合要求后，
    则会在当前目录下生成一个Makefile文件。
    ./configure -prefix=/usr/local/program

    4、生成安装程序
    上步生成的Makefile文件会保存有系统环境依赖关系的安装规则，接下来需要使用make命令来根据Makefile文件提供
    的规则使用合适的SHELL来编译所有依赖的源码，然后make命令会生成一个最终可执行的安装程序。
    make

    5、安装服务程序
    如果在configure脚本阶段中没有使用-prefix参数，那么程序一般会被默认安装到/usr/local/bin目录中。
    make install
    
    6、清理临时文件（可选）：
    make clean

    7、卸载服务程序命令（需要才执行）
    make uninstall

    8、查看安装信息
        whereis 命令定位可执行文件、源代码文件、帮助文件在文件系统中的位置。这些文件的属性应属于原始代码，二进制文件，或是帮助文件。
        whereis [-bmsu] [BMS 目录名 -f ] 文件名
        -b 搜索文件的二进制部分。
        -m 搜索文件的手册部分。
        -s 搜索文件的源部分。
        -u 没有说明文档的文件
        -B、-M 和 -S 标志可以用于更改或限制 whereis 命令搜索的位置。由于该程序为了运行得更快而使用了 chdir 子例程，所以用 -M、-S 和 -B 标志目录列表给出的路径名必须是完整的；例如，它们必须以一个 / （斜杠）开始。
        -B 与 -b 一样，但是添加了要搜索的目录。更改或限制 whereis 命令搜索二进制文件的位置。
        -M 与 -m 一样，但是添加了要搜索的目录。更改或限定 whereis 命令搜索手册部分的位置。
        -S 与 -s 一样，但是添加了要搜索的目录。更改或限定 whereis 命令搜索源的位置。
        -f 终止最后的 -M、-S 或 -B 目录列表并发文件名起始位置信号。

    源码包安装会比RPM包安装慢，是因为RPM的软件包是根据特定系统和平台而指定的，经常一种程序会提供很多RPM包
    的格式，用户根据系统情况选择适合的RPM包直接安装，而源码包相当于通用型，可以是用于多个系统中，所以需要
    运行configure脚本来检测环境，生成对应的安装信息。
```

```
 rpm [选项] [参数]
    -a：查询所有软件包
    -e：删除指定的软件包
    -f<文件>：查询拥有指定文件的套件； 
    -h或--hash：显示进度信息 
    -i：显示包的详细信息
    -i<软件包>或--install<软件包>：安装指定的软件包 
    -l：显示包的文件列表
    -p：查询指定的RPM包 
    -q：使用询问模式
    -U<软件包>或--upgrade<软件包>：升级指定的程序包
    -v：显示指令执行过程； 
    -vv：详细显示指令执行过程，便于排错。

    常用命令组合：
    －ivh：安装显示安装进度--install--verbose--hash
    －Uvh：升级软件包--Update；
    －qpl： 列出RPM软件包内的文件信息[Query Package list]；
    －qpi：列出RPM软件包的描述信息[Query Package install package(s)]；
    －qf：查找指定文件属于哪个RPM软件包[Query File]；
    －Va：校验所有的 RPM软件包，查找丢失的文件[View Lost]；
    －e：删除包
    --force 强制操作 如强制删除等；
    --requires 显示该包的依赖关系；
    --nodeps 忽略依赖关系并继续操作
    
    1、安装
    rpm -i 需要安装的包文件
    rpm -iv    需要安装的包文件（显示安装详情）
    rpm -ivh 需要安装的包文件（显示安装详情及进度）

    2、升级
    rpm -U 需要升级的包文件
    rpm -Uvh 需要升级的包文件（显示升级详情及进度）

    3、卸载
    rpm -e 需要卸载的软件包
    注：如果其他程序依赖要卸载的包，系统会提示不能删除，若需要强行删除加上--nodeps，会强制删除，但可能导致
    依赖于它的软件不能运行。
    
    4、查看已安装
        rpm -qa
    
    5、查看指定包
        rpm -qa | grep "软件或者包的名字"
```

```
1、安装
        yum install 软件

    2、升级
        yum update 软件

    3、删除
        yum remove 软件
    
    4、查看
        yum info 软件
    
    5、搜索软件
        yum search 软件

    6、查看依赖关系
        yum deplist 软件
    
    7、查看已安装软件
        yum list installded
    
    yum 命令参数列表：
        -e 静默执行
　　        -t 忽略错误
　　        -R[分钟] 设置等待时间
　　        -y 自动应答yes
　　        --skip-broken 忽略依赖问题
　　        --nogpgcheck 忽略GPG验证

        check-update 检查可更新的包
　　        clean all 清除全部
　　        clean packages 清除临时包文件（/var/cache/yum 下文件）
　　        clean headers 清除rpm头文件
　　        clean oldheaders 清除旧的rpm头文件
　　        deplist 列出包的依赖
　　        list 可安装和可更新的RPM包
　　        list installed 已安装的包
　　        list extras 已安装且不在资源库的包
　　        info 可安装和可更新的RPM包 信息
　　        info installed 已安装包的信息(-qa 参数相似)
　　        install[RPM包] 安装包
　　        localinstall 安装本地的 RPM包
　　        update[RPM包] 更新包
　　        upgrade 升级系统
　　        search[关键词] 搜索包
　　        provides[关键词] 搜索特定包文件名
　　        reinstall[RPM包] 重新安装包
　　        repolist 显示资源库的配置
　　        resolvedep 指定依赖
　　        remove[RPM包] 卸载包
```



---



# 更换yum源

---

```
链接：https://www.cnblogs.com/zrxuexi/p/11587173.html
```

自己操作

```
1）备份当前yum源防止出现意外还可以还原回来
	cd /etc/yum.repos.d/
	cp /CentOS-Base.repo /CentOS-Base-repo.bak
2）使用wget下载阿里yum源repo文件
	wget http://mirrors.aliyun.com/repo/Centos-7.repo
3) 清理旧包
	yum clean all
4）把下载下来阿里云repo文件设置成为默认源
	mv Centos-7.repo CentOS-Base.repo
5）生成阿里云yum源缓存并更新yum源
	yum makecache
	yum update
```



---



# 搭建环境

---

```
1⃣️安装JDK
	yum -y install java-1.8.0-openjdk*
	验证
		java -version
```

```
2⃣️安装MySQL数据库
	1.下载相关软件包 http://mirrors.ustc.edu.cn/
		wget http://mirrors.ustc.edu.cn/mysql-repo/yum/mysql-5.7-community/el/7/x86_64/mysql-community-server-5.7.25-1.el7.x86_64.rpm
		 wget http://mirrors.ustc.edu.cn/mysql-repo/yum/mysql-5.7-community/el/7/x86_64/mysql-community-client-5.7.25-1.el7.x86_64.rpm
		  wget http://mirrors.ustc.edu.cn/mysql-repo/yum/mysql-5.7-community/el/7/x86_64/mysql-community-common-5.7.25-1.el7.x86_64.rpm
		  wget http://mirrors.ustc.edu.cn/mysql-repo/yum/mysql-5.7-community/el/7/x86_64/mysql-community-libs-5.7.25-1.el7.x86_64.rpm
	2.安装依赖包
	yum install -y net-tools.x86_64 libaio.x86_64 perl.x86_64	 
  3.安装MySQL服务器
  	yum install -y mysql-community*
  	报错解决方法
  		yum list installed
  		yum remove mysql相关的软件
  4.启动MySQL服务器
  	systemctl start mysqld
  	systemctl status mysqld
  5.查看密码
	  cat /var/log/mysqld.log	
	  grep "password" /var/log/mysqld.log
	  	查看带有password
	6.修改MySQL服务器密码
		mysqladmin -uroot -p原始密码 password 你的密码(Zouxroo@t97) 密码先设置的难一些
		mysql -uroot -p 输入密码进入数据库
			SHOW VARIABLES LIKE 'validate_password%';
			set global validate_password_policy=LOW;
			set global validate_password_length=4;
			ALTER USER 'root'@'localhost' IDENTIFIED BY 'zoux';
```

```
3⃣️安装tomcat
	去http://mirrors.ustc.edu.cn/寻找合适的镜像
	wget http://mirrors.ustc.edu.cn/apache/tomcat/tomcat-8/v8.5.61/bin/apache-tomcat-8.5.61.tar.gz 
	解压
		tar -xvf apache-tomcat-8.5.61.tar.gz 
	移动并重命名
  	mv apache-tomcat-8.5.61 /usr/local/Tomcat8.5
  为Tomcat授权
  	chmod +x /usr/local/Tomcat8.5/bin/*.sh
  修改Tomcat默认端口号为80
  	sed -i 's/Connector port="8080"/Connector port="80"/' /usr/local/Tomcat8.5/conf/server.xml
  启动Tomcat
  	启动Tomcat。
```

```
4⃣️安装redis
	创建目录/usr/local/redis
	下载redis
		wget http://download.redis.io/releases/redis-3.2.10.tar.gz
	解压
  	tar -xzvf redis-3.2.10.tar.gz
  安装
  	进入redis-3.2.10
  		make
  修改配置文件
  	注释掉 bind 172.0.0.1
  	关闭保护模式 daemonize no
  启动服务，实用个人配置
  	cd /usr/local/redis/redis-3.2.10/src/
  	./redis-server /usr/local/redis/redis-3.2.10/redis.conf
  测试
  	./redis-cli -h 47.100.92.101 -p 6379
  	成功
  		47.100.92.101:6379> 
```



```

5⃣️安装FasfDFS 
	链接：https://developer.aliyun.com/article/758253?spm=a2c6h.14164896.0.0.62d4701cbc5muT
	1.上传所需文件到centos服务器上并解压这些文件
		fastdfs-nginx-module_v1.16.tar.gz
		FastDFS_v5.05.tar.gz
		libfastcommon-1.0.7.tar.gz
		nginx-1.8.0.tar.gz
	2.安装libevent库
  	yum -y install libevent
  3.进入解压后的 libfastcommon-1.0.7 目录执行
  	./make.sh && ./make.sh install
    安装后能在/usr/lib64或者/usr/lib目录中查找libfastcommon.so文件 , 如果只在/usr/lib64目录中找到就把它复制到/usr/lib目录中	
  	cp /usr/lib64/libfastcommon.so /usr/lib	
  4.进入fasfdfs解压后的目录
  	cd FastDFS
  	./make.sh && ./make.sh install
  	ll /usr/bin/fdfs*命令可以查看到安装后的相关文件
    FastDFS/conf目录中，把里面所有的配置文件复制到/etc/fdfs目录中
    	cp * /etc/fdfs
  5.到根目录下创建这些目录
  	 mkdir /fastdfss/tracker -p
  	 mkdir /fastdfs/storage -p
  	 mkdir /fastdfs/client -p
  	 mkdir /fastdfs/temp -p
  6.进入/etc/fdfs/目录中, 使用$ vim tracker.conf命令打开tracker.conf文件 
  	将basepath的值修改为/fastdfs/tracker(fastdf目录下的tracker)
  7.使用以下的命令启动tracker	
  	/usr/bin/fdfs_trackerd /etc/fdfs/tracker_conf
  	重启服务
  	/usr/bin/fdfs_trackerd /etc/fdfs/tracker_conf restart
  8.到/etc/fdfs目录下，打开并修改storage.conf文件	
  	basepath=/fasddfs/storage
		store_path0=/fastdfs/storage
		group_name=sl (注：这个组名自己定义)
		tracker_server=47.100.92.101:22122（注：这里填写服务器本机ip）	
	9.使用以下命令启动storage
  	/usr/bin/fdfs_storaged /etc/fdfs/storage.conf
	  # 重启服务
    /usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart
  10.可以使用以下命令查看服务启动后的状态  
  	# 查看tracker状态
    ps aux|grep tracker  
    # 查看storage状态
    ps aux|grep storage
  11.测试上传文件功能  
  	进入/etc/fdfs/目录下，修改这个目录中的client.conf文件
  		basepath=/fastdfs/client
			tracker_server=192.169.213.120:22122 （注：这里填写服务器本机ip）
		使用下面的测试命令上传一张图片，会返回图片的访问链接地址
    	/usr/bin/fdfs_test /etc/fdfs/client.conf upload 我是测试图片.jpg
    		成功界面
    		This is FastDFS client test program v5.11

            Copyright (C) 2008, Happy Fish / YuQing

            FastDFS may be copied only under the terms of the GNU General
            Public License V3, which may be found in the FastDFS source kit.
            Please visit the FastDFS Home Page http://www.csource.org/
            for more detail.

            [2018-11-20 04:36:38] DEBUG - base_path=/fastdfs/client, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0

            tracker_query_storage_store_list_without_group:
                    server 1. group_name=, ip_addr=192.168.213.120, port=23000

            group_name=sl, ip_addr=192.168.213.120, port=23000
            storage_upload_by_filename
            group_name=sl, remote_filename=M00/00/00/wKjVeFvz_9aAcMNOAAEJsJdjMjM460.jpg
            source ip address: 192.168.213.120
            file timestamp=2018-11-20 04:36:38
            file size=68016
            file crc32=2539860531
            example file url: http://192.168.213.120/sl/M00/00/00/wKjVeFvz_9aAcMNOAAEJsJdjMjM460.jpg
            storage_upload_slave_by_filename
            group_name=sl, remote_filename=M00/00/00/wKjVeFvz_9aAcMNOAAEJsJdjMjM460_big.jpg
            source ip address: 192.168.213.120
            file timestamp=2018-11-20 04:36:38
            file size=68016
            file crc32=2539860531
            example file url: 
		# 这是图片文件上传服务器后返回的图片访问路径
		http://192.168.213.120/sl/M00/00/00/wKjVeFvz_9aAcMNOAAEJsJdjMjM460_big.jpg
		12.安装并配置nginx
			配置nginx的fastdfs模块
				进入前面第3步解压后的fastdfs-nginx-module-1.20/src目录中
					修改此目录下的config文件，修改内容如下：
						把CORE_INCS="$CORE_INCS /usr/local/include/fastdfs /usr/include/fastcommon/"
						修改为：CORE_INCS="$CORE_INCS /usr/include/fastdfs /usr/include/fastcommon/"
						把CORE_LIBS="$CORE_LIBS -L/usr/local/lib -lfastcommon -lfdfsclient"
						修改为：CORE_LIBS="$CORE_LIBS -L/usr/lib -lfastcommon -lfdfsclient"
							实际就是把路径中的local这一层删除掉
				安装nginx支持库
        	 yum -y install gcc-c++
					 yum -y install pcre pcre-devel
					 yum -y install zlib zlib-devel
					 yum -y install openssl openssl-devel
				在nginx的文件目录中执行
        	./configure \
          --prefix=/usr/local/nginx \
          --pid-path=/var/run/nginx/nginx/pid \
          --lock-path=/var/lock/nginx.lock \
          --error-log-path=/var/log/nginx/error.log \
          --http-log-path=/var/log/nginx/access.log \
          --with-http_gzip_static_module \
          --http-client-body-temp-path=/var/temp/nginx/client \
          --http-proxy-temp-path=/var/temp/nginx/proxy \
          --http-fastcgi-temp-path=/var/temp/nginx/fastcgi \
          --http-uwsgi-temp-path=/var/temp/nginx/uwsgi \
          --http-scgi-temp-path=/var/temp/nginx/scgi \
          --add-module=root/FasfDFS/fastdfs-nginx-module/src
          
          执行命令后返回的结果

          Configuration summary
            + using system PCRE library
            + OpenSSL library is not used
            + using system zlib library

            nginx path prefix: "/usr/local/nginx"
            nginx binary file: "/usr/local/nginx/sbin/nginx"
            nginx modules path: "/usr/local/nginx/modules"
            nginx configuration prefix: "/usr/local/nginx/conf"
            nginx configuration file: "/usr/local/nginx/conf/nginx.conf"
            nginx pid file: "/var/run/nginx/nginx/pid"
            nginx error log file: "/var/log/nginx/error.log"
            nginx http access log file: "/var/log/nginx/access.log"
            nginx http client request body temporary files: "/var/temp/nginx/client"
            nginx http proxy temporary files: "/var/temp/nginx/proxy"
            nginx http fastcgi temporary files: "/var/temp/nginx/fastcgi"
            nginx http uwsgi temporary files: "/var/temp/nginx/uwsgi"
            nginx http scgi temporary files: "/var/temp/nginx/scgi"
            
       进入nginx-1.8.0文件目录   
       		make && make install
       进入fastdfs-nginx-module目录中,复制模块配置(这个是fastdfs和nginx配合的配置文件)
					cp mod_fastdfs.conf /etc/fdfs/
       进入/etc/fdfs/目录中，修改此目录中的mod_fastdfs.conf文件，修改内容
       		basepath=/fastdfs/temp
					group_name=sl # (注：同上面storage的组名一样)
					url_have_group_name = true
					store_path0=/fastdfs/storage # (注：同storage的配置目录，这个是用于存储文件的目录)
			 进入nginx的安装目录/usr/local/nginx/中,修改nginx.conf这个配置文件
      		# 添加一个server
          server {
              listen  88;
              server_name  localhost;

              # 这个/sl/M00是上面设置的组名和自动生成的MOO前缀
              location /sl/M00 {
                  # 这里是我们添加的模块名
                  ngx_fastdfs_module;
              }
          }
        进入/usr/local/nginx/sbin目录执行以下相关命令操作nginx
        	检查nginx配置文件是否正确
     			./nginx -t
     			根据错误提示操作
     		开启nginx服务
        	./nginx
        重启所有服务(tracker storage nginx firewall)
        	/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf
          /usr/bin/fdfs_storaged /etc/fdfs/storage.con$ /usr/bin/fdfs_storaged /etc/fdfs/storage.conf
          /usr/local/nginx/sbin/nginx
          /etc/init.d/iptables stop关闭防火墙
    13.关闭防火墙
      /etc/init.d/iptables stop

        执行命令返回结果如下：
        iptables: Flushing firewall rules:                         [  OK  ]
        iptables: Setting chains to policy ACCEPT: filter          [  OK  ]
        iptables: Unloading modules:   													 	 [  OK  ]

```

```
6⃣️RabbitMQ环境   https://ld246.com/article/1591950291832
	Erlang 安装 (22.3.4.1 版本)
		密钥下载地址：https://dl.bintray.com/rabbitmq/Keys/rabbitmq-release-signing-key.asc
		安装包下载地址：https://github.com/rabbitmq/erlang-rpm/releases/download/v22.3.4.1/erlang-22.3.4.1-1.el7.x86_64.rpm
		配置密钥 rpm --import rabbitmq-release-signing-key.asc
		安装 rpm -ivh erlang-22.3.4.1-1.el7.x86_64.rpm
		验证 erl 
		-------------------------------------------------------------------
	安装 RabbitMQ (3.8.4 版本)	
		导入签名密钥 sudo rpm --import https://github.com/rabbitmq/signing-keys/releases/download/2.0/rabbitmq-release-signing-key.asc
		CentOS 7配置软件仓库 在 /etc/yum.repos. 目录下添加.repo 文件（例如 rabbitmq.repo），在文件中添加以下内容
      [bintray-rabbitmq-server]
      name=bintray-rabbitmq-rpm
      baseurl=https://dl.bintray.com/rabbitmq/rpm/rabbitmq-server/v3.8.x/el/7/
      gpgcheck=0
      repo_gpgcheck=0
      enabled=1
    安装 yum install https://dl.bintray.com/rabbitmq/rpm/rabbitmq-server/v3.8.x/el/7/noarch/rabbitmq-server-3.8.4-1.el7.noarch.rpm
    安装路径 whereis rabbitmq
    开启守护进程 chkconfig rabbitmq-server on
    启动/停止 
    	service rabbitmq-server start
    	service rabbitmq-server stop
    	service rabbitmq-server status
    放行端口（服务器配资放行端口）
    	systemctl status firewalld
        firewall-cmd --list-ports
        firewall-cmd --zone=public --add-port=5672/tcp --permanent
        firewall-cmd --zone=public --add-port=15672/tcp --permanent
        firewall-cmd --zone=public --add-port=15674-15675/tcp --permanent
        firewall-cmd --zone=public --add-port=1883/tcp --permanent
        firewall-cmd --reload
		查看所有用户 rabbitmqctl list_users
    添加一个用户 rabbitmqctl add_user admin zoux
    配置权限 rabbitmqctl set_permissions -p "/" admin ".*" ".*" ".*" 
    查看用户权限 rabbitmqctl list_user_permissions admin 
    设置tag rabbitmqctl set_user_tags admin administrator 
    启用插件
    	Web 管理 rabbitmq-plugins enable rabbitmq_management
    		访问：http://{ip}:15672/
				默认账号密码：guest guest（这个账号只允许本机访问）
			启动MQTT插件 rabbitmq-plugins enable rabbitmq_mqtt	
				创建账号
					rabbitmqctl add_user mqtt-user mqtt-password
					rabbitmqctl set_permissions -p / mqtt-user ".*" ".*" ".*"
					rabbitmqctl set_user_tags mqtt-user management
      WebSTOMP rabbitmq-plugins enable rabbitmq_web_stomp
      WebMQTT rabbitmq-plugins enable rabbitmq_web_mqtt
      TRACING消息记录追踪插件 rabbitmq-plugins enable rabbitmq_tracing
```



---

# 将项目部署到云端

---

```

```

